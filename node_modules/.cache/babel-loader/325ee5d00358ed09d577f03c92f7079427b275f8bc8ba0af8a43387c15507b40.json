{"ast":null,"code":"var _s = $RefreshSig$();\nimport React, { useEffect, useRef, useState, useCallback } from 'react';\nimport { useMap } from 'react-leaflet';\nimport L from 'leaflet';\nimport { createCustomIcon, createBrandLogo } from '../utils/iconHelpers';\nconst IconMarkersLayer = ({\n  markers,\n  selectedRegion,\n  baseCompData = []\n}) => {\n  _s();\n  const map = useMap();\n  const markersRef = useRef({});\n  const cacheRef = useRef({});\n  const updateInProgressRef = useRef(false);\n  const zoomUpdateRef = useRef(null);\n  const [showingAssociated, setShowingAssociated] = useState(false);\n  const [originalPopupMarker, setOriginalPopupMarker] = useState(null);\n  const makeDraggable = useCallback(popup => {\n    if (!map || !popup || !popup._container) return;\n    try {\n      const pos = map.latLngToLayerPoint(popup.getLatLng());\n      L.DomUtil.setPosition(popup._wrapper.parentNode, pos);\n      const draggable = new L.Draggable(popup._container, popup._wrapper);\n      draggable.enable();\n    } catch (error) {\n      console.error('Error draggable:', error);\n    }\n  }, [map]);\n  const showAssociated = useCallback(markerPbl => {\n    console.log('üîç Buscando competencia para PBL:', markerPbl);\n    console.log('üìä Base de competencia disponible:', baseCompData);\n    if (!baseCompData || baseCompData.length === 0) {\n      console.warn('‚ö†Ô∏è No hay datos de competencia disponibles');\n      return;\n    }\n\n    // Buscar competencia por PBL\n    const competenciaData = baseCompData.filter(item => String(item.pbl).trim() === String(markerPbl).trim());\n    console.log(`üìç Competencia encontrada: ${competenciaData.length} estaciones`);\n    if (competenciaData.length === 0) {\n      console.warn('‚ö†Ô∏è No se encontr√≥ competencia para este PBL');\n      return;\n    }\n\n    // Limpiar marcadores de competencia previos\n    Object.keys(markersRef.current).forEach(key => {\n      if (key.startsWith('comp_')) {\n        map.removeLayer(markersRef.current[key]);\n        delete markersRef.current[key];\n      }\n    });\n\n    // Agregar marcadores de competencia\n    competenciaData.forEach((comp, index) => {\n      const lat = parseFloat(comp.latitud);\n      const lng = parseFloat(comp.longitud);\n      if (isNaN(lat) || isNaN(lng)) {\n        console.warn('‚ö†Ô∏è Coordenadas inv√°lidas para competencia:', comp);\n        return;\n      }\n      const iconUrl = createCustomIcon(comp.Marca);\n      const compMarker = L.marker([lat, lng], {\n        icon: iconUrl\n      }).addTo(map);\n      const popupContent = `\n        <div class=\"custom-popup\" style=\"min-width: 250px;\">\n          <div class=\"popup-header\" style=\"background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 12px; border-radius: 8px 8px 0 0; text-align: center;\">\n            <img src=\"${createBrandLogo(comp.Marca)}\" alt=\"${comp.Marca}\" style=\"width: 40px; height: 40px; border-radius: 50%; margin-bottom: 8px;\">\n            <h3 style=\"margin: 0; font-size: 16px; font-weight: bold;\">${comp.eds || 'Sin nombre'}</h3>\n            <p style=\"margin: 4px 0 0; font-size: 12px; opacity: 0.9;\">Competencia - ${comp.Marca}</p>\n          </div>\n          <div class=\"popup-body\" style=\"padding: 12px; background: white;\">\n            <p style=\"margin: 8px 0;\"><strong>üìç Direcci√≥n:</strong> ${comp.direccion || 'No disponible'}</p>\n            <p style=\"margin: 8px 0;\"><strong>üèôÔ∏è Comuna:</strong> ${comp.Comuna || 'No disponible'}</p>\n            <div style=\"background: #f0f4f8; padding: 10px; border-radius: 6px; margin-top: 10px;\">\n              <p style=\"margin: 4px 0; font-size: 13px;\"><strong>‚õΩ G93:</strong> $${comp.G93 || 0}</p>\n              <p style=\"margin: 4px 0; font-size: 13px;\"><strong>‚õΩ G95:</strong> $${comp.G95 || 0}</p>\n              <p style=\"margin: 4px 0; font-size: 13px;\"><strong>‚õΩ Diesel:</strong> $${comp.Diesel || 0}</p>\n            </div>\n          </div>\n        </div>\n      `;\n      compMarker.bindPopup(popupContent, {\n        maxWidth: 300,\n        className: 'custom-leaflet-popup'\n      });\n      markersRef.current[`comp_${index}_${comp.eds}`] = compMarker;\n    });\n    setShowingAssociated(true);\n    console.log('‚úÖ Marcadores de competencia agregados al mapa');\n  }, [map, baseCompData]);\n  const addMarkers = useCallback((data, mapInstance) => {\n    data.forEach(marker => {\n      const lat = parseFloat(marker.lat);\n      const lng = parseFloat(marker.lng);\n      if (!isNaN(lat) && !isNaN(lng)) {\n        const iconUrl = createCustomIcon(marker.Marca);\n        const leafletMarker = L.marker([lat, lng], {\n          icon: iconUrl\n        }).addTo(mapInstance);\n        let popupContent = `\n          <div class=\"custom-popup\" style=\"min-width: 280px;\">\n            <div class=\"popup-header\" style=\"background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 12px; border-radius: 8px 8px 0 0; text-align: center;\">\n              <img src=\"${createBrandLogo(marker.Marca)}\" alt=\"${marker.Marca}\" style=\"width: 50px; height: 50px; border-radius: 50%; margin-bottom: 10px; border: 2px solid white;\">\n              <h3 style=\"margin: 0; font-size: 18px; font-weight: bold;\">${marker.eds || marker.nombre}</h3>\n              <p style=\"margin: 5px 0 0; font-size: 13px; opacity: 0.95;\">${marker.Marca}</p>\n            </div>\n            <div class=\"popup-body\" style=\"padding: 14px; background: white;\">\n              <p style=\"margin: 8px 0;\"><strong>üÜî PBL:</strong> ${marker.pbl || 'N/A'}</p>\n              <p style=\"margin: 8px 0;\"><strong>üìç Direcci√≥n:</strong> ${marker.direccion || 'No disponible'}</p>\n              <p style=\"margin: 8px 0;\"><strong>üèôÔ∏è Comuna:</strong> ${marker.Comuna || 'No disponible'}</p>\n              <p style=\"margin: 8px 0;\"><strong>üó∫Ô∏è Regi√≥n:</strong> ${marker.Region || 'No disponible'}</p>\n              \n              <div style=\"background: #f0f4f8; padding: 12px; border-radius: 6px; margin: 12px 0;\">\n                <h4 style=\"margin: 0 0 8px; color: #4a5568; font-size: 14px;\">üí∞ Precios</h4>\n                <p style=\"margin: 5px 0; font-size: 14px;\"><strong>‚õΩ G93:</strong> $${marker.precio_g93 || 0}</p>\n                <p style=\"margin: 5px 0; font-size: 14px;\"><strong>‚õΩ G95:</strong> $${marker.precio_g95 || 0}</p>\n                <p style=\"margin: 5px 0; font-size: 14px;\"><strong>‚õΩ Diesel:</strong> $${marker.precio_diesel || 0}</p>\n              </div>\n\n              ${marker.Guerra_Precio === 'Si' ? '<div style=\"background: #fed7d7; color: #9b2c2c; padding: 8px; border-radius: 6px; margin: 10px 0; text-align: center; font-weight: bold;\">‚ö†Ô∏è Guerra de Precios</div>' : ''}\n              \n              ${marker.Actualizacion ? `<p style=\"margin: 10px 0 0; font-size: 12px; color: #718096;\"><strong>üìÖ √öltima actualizaci√≥n:</strong> ${marker.Actualizacion}</p>` : ''}\n              \n              <button \n                id=\"show-mercado-${marker.pbl}\" \n                style=\"width: 100%; margin-top: 15px; padding: 10px; background: linear-gradient(135deg, #48bb78 0%, #38a169 100%); color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; font-size: 14px; transition: all 0.3s;\"\n                onmouseover=\"this.style.transform='scale(1.05)'; this.style.boxShadow='0 4px 12px rgba(72, 187, 120, 0.4)';\"\n                onmouseout=\"this.style.transform='scale(1)'; this.style.boxShadow='none';\"\n              >\n                üè™ Ver Mercado\n              </button>\n            </div>\n          </div>\n        `;\n        leafletMarker.bindPopup(popupContent, {\n          maxWidth: 320,\n          className: 'custom-leaflet-popup',\n          autoPan: true,\n          autoPanPadding: [50, 50]\n        });\n\n        // Evento cuando se abre el popup\n        leafletMarker.on('popupopen', e => {\n          const popup = e.popup;\n          setOriginalPopupMarker(leafletMarker);\n\n          // Agregar evento al bot√≥n \"Ver Mercado\"\n          setTimeout(() => {\n            const button = document.getElementById(`show-mercado-${marker.pbl}`);\n            if (button) {\n              button.onclick = event => {\n                event.stopPropagation();\n                console.log('üîò Bot√≥n Mercado presionado para PBL:', marker.pbl);\n                showAssociated(marker.pbl);\n              };\n            }\n          }, 100);\n          makeDraggable(popup);\n        });\n        const cacheKey = `${marker.id || marker.pbl}_${marker.Marca}`;\n        markersRef.current[cacheKey] = leafletMarker;\n        cacheRef.current[cacheKey] = marker;\n      }\n    });\n  }, [makeDraggable, showAssociated]);\n  useEffect(() => {\n    if (!map || updateInProgressRef.current) return;\n    const handleUpdate = () => {\n      if (zoomUpdateRef.current) {\n        clearTimeout(zoomUpdateRef.current);\n      }\n      zoomUpdateRef.current = setTimeout(() => {\n        updateInProgressRef.current = true;\n        const currentZoom = map.getZoom();\n        const visibleBounds = map.getBounds();\n\n        // Limpiar marcadores previos (excepto competencia si est√° activa)\n        Object.keys(markersRef.current).forEach(key => {\n          if (!showingAssociated || !key.startsWith('comp_')) {\n            const marker = markersRef.current[key];\n            if (marker && !key.startsWith('comp_')) {\n              map.removeLayer(marker);\n              delete markersRef.current[key];\n            }\n          }\n        });\n\n        // Filtrar marcadores visibles\n        const visibleMarkers = markers.filter(m => {\n          const lat = parseFloat(m.lat);\n          const lng = parseFloat(m.lng);\n          return !isNaN(lat) && !isNaN(lng) && visibleBounds.contains([lat, lng]);\n        });\n        console.log(`üó∫Ô∏è Renderizando ${visibleMarkers.length} marcadores (zoom: ${currentZoom})`);\n        addMarkers(visibleMarkers, map);\n        updateInProgressRef.current = false;\n      }, 300);\n    };\n    handleUpdate();\n    map.on('moveend', handleUpdate);\n    map.on('zoomend', handleUpdate);\n    return () => {\n      map.off('moveend', handleUpdate);\n      map.off('zoomend', handleUpdate);\n      if (zoomUpdateRef.current) {\n        clearTimeout(zoomUpdateRef.current);\n      }\n    };\n  }, [map, markers, addMarkers, showingAssociated]);\n  return null;\n};\n_s(IconMarkersLayer, \"TKJKA4aqI63MHoLuoQXWnsiqVuY=\", false, function () {\n  return [useMap];\n});\n_c = IconMarkersLayer;\nexport default IconMarkersLayer;\nvar _c;\n$RefreshReg$(_c, \"IconMarkersLayer\");","map":{"version":3,"names":["React","useEffect","useRef","useState","useCallback","useMap","L","createCustomIcon","createBrandLogo","IconMarkersLayer","markers","selectedRegion","baseCompData","_s","map","markersRef","cacheRef","updateInProgressRef","zoomUpdateRef","showingAssociated","setShowingAssociated","originalPopupMarker","setOriginalPopupMarker","makeDraggable","popup","_container","pos","latLngToLayerPoint","getLatLng","DomUtil","setPosition","_wrapper","parentNode","draggable","Draggable","enable","error","console","showAssociated","markerPbl","log","length","warn","competenciaData","filter","item","String","pbl","trim","Object","keys","current","forEach","key","startsWith","removeLayer","comp","index","lat","parseFloat","latitud","lng","longitud","isNaN","iconUrl","Marca","compMarker","marker","icon","addTo","popupContent","eds","direccion","Comuna","G93","G95","Diesel","bindPopup","maxWidth","className","addMarkers","data","mapInstance","leafletMarker","nombre","Region","precio_g93","precio_g95","precio_diesel","Guerra_Precio","Actualizacion","autoPan","autoPanPadding","on","e","setTimeout","button","document","getElementById","onclick","event","stopPropagation","cacheKey","id","handleUpdate","clearTimeout","currentZoom","getZoom","visibleBounds","getBounds","visibleMarkers","m","contains","off","_c","$RefreshReg$"],"sources":["C:/Users/e08f/Desktop/Proyectos/Resumen/mapa-v2/src/components/IconMarkersLayer.jsx"],"sourcesContent":["import React, { useEffect, useRef, useState, useCallback } from 'react';\r\nimport { useMap } from 'react-leaflet';\r\nimport L from 'leaflet';\r\nimport { createCustomIcon, createBrandLogo } from '../utils/iconHelpers';\r\n\r\nconst IconMarkersLayer = ({ markers, selectedRegion, baseCompData = [] }) => {\r\n  const map = useMap();\r\n  const markersRef = useRef({});\r\n  const cacheRef = useRef({});\r\n  const updateInProgressRef = useRef(false);\r\n  const zoomUpdateRef = useRef(null);\r\n  const [showingAssociated, setShowingAssociated] = useState(false);\r\n  const [originalPopupMarker, setOriginalPopupMarker] = useState(null);\r\n\r\n  const makeDraggable = useCallback((popup) => {\r\n    if (!map || !popup || !popup._container) return;\r\n    try {\r\n      const pos = map.latLngToLayerPoint(popup.getLatLng());\r\n      L.DomUtil.setPosition(popup._wrapper.parentNode, pos);\r\n      const draggable = new L.Draggable(popup._container, popup._wrapper);\r\n      draggable.enable();\r\n    } catch (error) {\r\n      console.error('Error draggable:', error);\r\n    }\r\n  }, [map]);\r\n\r\n  const showAssociated = useCallback((markerPbl) => {\r\n    console.log('üîç Buscando competencia para PBL:', markerPbl);\r\n    console.log('üìä Base de competencia disponible:', baseCompData);\r\n\r\n    if (!baseCompData || baseCompData.length === 0) {\r\n      console.warn('‚ö†Ô∏è No hay datos de competencia disponibles');\r\n      return;\r\n    }\r\n\r\n    // Buscar competencia por PBL\r\n    const competenciaData = baseCompData.filter(item => \r\n      String(item.pbl).trim() === String(markerPbl).trim()\r\n    );\r\n\r\n    console.log(`üìç Competencia encontrada: ${competenciaData.length} estaciones`);\r\n\r\n    if (competenciaData.length === 0) {\r\n      console.warn('‚ö†Ô∏è No se encontr√≥ competencia para este PBL');\r\n      return;\r\n    }\r\n\r\n    // Limpiar marcadores de competencia previos\r\n    Object.keys(markersRef.current).forEach(key => {\r\n      if (key.startsWith('comp_')) {\r\n        map.removeLayer(markersRef.current[key]);\r\n        delete markersRef.current[key];\r\n      }\r\n    });\r\n\r\n    // Agregar marcadores de competencia\r\n    competenciaData.forEach((comp, index) => {\r\n      const lat = parseFloat(comp.latitud);\r\n      const lng = parseFloat(comp.longitud);\r\n\r\n      if (isNaN(lat) || isNaN(lng)) {\r\n        console.warn('‚ö†Ô∏è Coordenadas inv√°lidas para competencia:', comp);\r\n        return;\r\n      }\r\n\r\n      const iconUrl = createCustomIcon(comp.Marca);\r\n      const compMarker = L.marker([lat, lng], { icon: iconUrl }).addTo(map);\r\n\r\n      const popupContent = `\r\n        <div class=\"custom-popup\" style=\"min-width: 250px;\">\r\n          <div class=\"popup-header\" style=\"background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 12px; border-radius: 8px 8px 0 0; text-align: center;\">\r\n            <img src=\"${createBrandLogo(comp.Marca)}\" alt=\"${comp.Marca}\" style=\"width: 40px; height: 40px; border-radius: 50%; margin-bottom: 8px;\">\r\n            <h3 style=\"margin: 0; font-size: 16px; font-weight: bold;\">${comp.eds || 'Sin nombre'}</h3>\r\n            <p style=\"margin: 4px 0 0; font-size: 12px; opacity: 0.9;\">Competencia - ${comp.Marca}</p>\r\n          </div>\r\n          <div class=\"popup-body\" style=\"padding: 12px; background: white;\">\r\n            <p style=\"margin: 8px 0;\"><strong>üìç Direcci√≥n:</strong> ${comp.direccion || 'No disponible'}</p>\r\n            <p style=\"margin: 8px 0;\"><strong>üèôÔ∏è Comuna:</strong> ${comp.Comuna || 'No disponible'}</p>\r\n            <div style=\"background: #f0f4f8; padding: 10px; border-radius: 6px; margin-top: 10px;\">\r\n              <p style=\"margin: 4px 0; font-size: 13px;\"><strong>‚õΩ G93:</strong> $${comp.G93 || 0}</p>\r\n              <p style=\"margin: 4px 0; font-size: 13px;\"><strong>‚õΩ G95:</strong> $${comp.G95 || 0}</p>\r\n              <p style=\"margin: 4px 0; font-size: 13px;\"><strong>‚õΩ Diesel:</strong> $${comp.Diesel || 0}</p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      `;\r\n\r\n      compMarker.bindPopup(popupContent, {\r\n        maxWidth: 300,\r\n        className: 'custom-leaflet-popup'\r\n      });\r\n\r\n      markersRef.current[`comp_${index}_${comp.eds}`] = compMarker;\r\n    });\r\n\r\n    setShowingAssociated(true);\r\n    console.log('‚úÖ Marcadores de competencia agregados al mapa');\r\n  }, [map, baseCompData]);\r\n\r\n  const addMarkers = useCallback((data, mapInstance) => {\r\n    data.forEach(marker => {\r\n      const lat = parseFloat(marker.lat);\r\n      const lng = parseFloat(marker.lng);\r\n\r\n      if (!isNaN(lat) && !isNaN(lng)) {\r\n        const iconUrl = createCustomIcon(marker.Marca);\r\n        const leafletMarker = L.marker([lat, lng], { icon: iconUrl }).addTo(mapInstance);\r\n\r\n        let popupContent = `\r\n          <div class=\"custom-popup\" style=\"min-width: 280px;\">\r\n            <div class=\"popup-header\" style=\"background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 12px; border-radius: 8px 8px 0 0; text-align: center;\">\r\n              <img src=\"${createBrandLogo(marker.Marca)}\" alt=\"${marker.Marca}\" style=\"width: 50px; height: 50px; border-radius: 50%; margin-bottom: 10px; border: 2px solid white;\">\r\n              <h3 style=\"margin: 0; font-size: 18px; font-weight: bold;\">${marker.eds || marker.nombre}</h3>\r\n              <p style=\"margin: 5px 0 0; font-size: 13px; opacity: 0.95;\">${marker.Marca}</p>\r\n            </div>\r\n            <div class=\"popup-body\" style=\"padding: 14px; background: white;\">\r\n              <p style=\"margin: 8px 0;\"><strong>üÜî PBL:</strong> ${marker.pbl || 'N/A'}</p>\r\n              <p style=\"margin: 8px 0;\"><strong>üìç Direcci√≥n:</strong> ${marker.direccion || 'No disponible'}</p>\r\n              <p style=\"margin: 8px 0;\"><strong>üèôÔ∏è Comuna:</strong> ${marker.Comuna || 'No disponible'}</p>\r\n              <p style=\"margin: 8px 0;\"><strong>üó∫Ô∏è Regi√≥n:</strong> ${marker.Region || 'No disponible'}</p>\r\n              \r\n              <div style=\"background: #f0f4f8; padding: 12px; border-radius: 6px; margin: 12px 0;\">\r\n                <h4 style=\"margin: 0 0 8px; color: #4a5568; font-size: 14px;\">üí∞ Precios</h4>\r\n                <p style=\"margin: 5px 0; font-size: 14px;\"><strong>‚õΩ G93:</strong> $${marker.precio_g93 || 0}</p>\r\n                <p style=\"margin: 5px 0; font-size: 14px;\"><strong>‚õΩ G95:</strong> $${marker.precio_g95 || 0}</p>\r\n                <p style=\"margin: 5px 0; font-size: 14px;\"><strong>‚õΩ Diesel:</strong> $${marker.precio_diesel || 0}</p>\r\n              </div>\r\n\r\n              ${marker.Guerra_Precio === 'Si' ? \r\n                '<div style=\"background: #fed7d7; color: #9b2c2c; padding: 8px; border-radius: 6px; margin: 10px 0; text-align: center; font-weight: bold;\">‚ö†Ô∏è Guerra de Precios</div>' \r\n                : ''}\r\n              \r\n              ${marker.Actualizacion ? \r\n                `<p style=\"margin: 10px 0 0; font-size: 12px; color: #718096;\"><strong>üìÖ √öltima actualizaci√≥n:</strong> ${marker.Actualizacion}</p>` \r\n                : ''}\r\n              \r\n              <button \r\n                id=\"show-mercado-${marker.pbl}\" \r\n                style=\"width: 100%; margin-top: 15px; padding: 10px; background: linear-gradient(135deg, #48bb78 0%, #38a169 100%); color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; font-size: 14px; transition: all 0.3s;\"\r\n                onmouseover=\"this.style.transform='scale(1.05)'; this.style.boxShadow='0 4px 12px rgba(72, 187, 120, 0.4)';\"\r\n                onmouseout=\"this.style.transform='scale(1)'; this.style.boxShadow='none';\"\r\n              >\r\n                üè™ Ver Mercado\r\n              </button>\r\n            </div>\r\n          </div>\r\n        `;\r\n\r\n        leafletMarker.bindPopup(popupContent, {\r\n          maxWidth: 320,\r\n          className: 'custom-leaflet-popup',\r\n          autoPan: true,\r\n          autoPanPadding: [50, 50]\r\n        });\r\n\r\n        // Evento cuando se abre el popup\r\n        leafletMarker.on('popupopen', (e) => {\r\n          const popup = e.popup;\r\n          setOriginalPopupMarker(leafletMarker);\r\n          \r\n          // Agregar evento al bot√≥n \"Ver Mercado\"\r\n          setTimeout(() => {\r\n            const button = document.getElementById(`show-mercado-${marker.pbl}`);\r\n            if (button) {\r\n              button.onclick = (event) => {\r\n                event.stopPropagation();\r\n                console.log('üîò Bot√≥n Mercado presionado para PBL:', marker.pbl);\r\n                showAssociated(marker.pbl);\r\n              };\r\n            }\r\n          }, 100);\r\n\r\n          makeDraggable(popup);\r\n        });\r\n\r\n        const cacheKey = `${marker.id || marker.pbl}_${marker.Marca}`;\r\n        markersRef.current[cacheKey] = leafletMarker;\r\n        cacheRef.current[cacheKey] = marker;\r\n      }\r\n    });\r\n  }, [makeDraggable, showAssociated]);\r\n\r\n  useEffect(() => {\r\n    if (!map || updateInProgressRef.current) return;\r\n\r\n    const handleUpdate = () => {\r\n      if (zoomUpdateRef.current) {\r\n        clearTimeout(zoomUpdateRef.current);\r\n      }\r\n\r\n      zoomUpdateRef.current = setTimeout(() => {\r\n        updateInProgressRef.current = true;\r\n\r\n        const currentZoom = map.getZoom();\r\n        const visibleBounds = map.getBounds();\r\n\r\n        // Limpiar marcadores previos (excepto competencia si est√° activa)\r\n        Object.keys(markersRef.current).forEach(key => {\r\n          if (!showingAssociated || !key.startsWith('comp_')) {\r\n            const marker = markersRef.current[key];\r\n            if (marker && !key.startsWith('comp_')) {\r\n              map.removeLayer(marker);\r\n              delete markersRef.current[key];\r\n            }\r\n          }\r\n        });\r\n\r\n        // Filtrar marcadores visibles\r\n        const visibleMarkers = markers.filter(m => {\r\n          const lat = parseFloat(m.lat);\r\n          const lng = parseFloat(m.lng);\r\n          return !isNaN(lat) && !isNaN(lng) && visibleBounds.contains([lat, lng]);\r\n        });\r\n\r\n        console.log(`üó∫Ô∏è Renderizando ${visibleMarkers.length} marcadores (zoom: ${currentZoom})`);\r\n        addMarkers(visibleMarkers, map);\r\n\r\n        updateInProgressRef.current = false;\r\n      }, 300);\r\n    };\r\n\r\n    handleUpdate();\r\n    map.on('moveend', handleUpdate);\r\n    map.on('zoomend', handleUpdate);\r\n\r\n    return () => {\r\n      map.off('moveend', handleUpdate);\r\n      map.off('zoomend', handleUpdate);\r\n      if (zoomUpdateRef.current) {\r\n        clearTimeout(zoomUpdateRef.current);\r\n      }\r\n    };\r\n  }, [map, markers, addMarkers, showingAssociated]);\r\n\r\n  return null;\r\n};\r\n\r\nexport default IconMarkersLayer;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}