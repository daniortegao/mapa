{"ast":null,"code":"var _s = $RefreshSig$();\nimport React, { useEffect, useRef, useState, useCallback } from 'react';\nimport { useMap } from 'react-leaflet';\nimport L from 'leaflet';\nimport { createCustomIcon, createBrandLogo } from '../utils/iconHelpers';\nimport { guardarCoordenadaCorregida } from '../services/apiService';\nimport '../styles/iconMarkersLayer.css';\nconst IconMarkersLayer = ({\n  markers,\n  markersForMercado = null,\n  selectedRegion,\n  baseCompData = []\n}) => {\n  _s();\n  const map = useMap();\n  const markersRef = useRef({});\n  const guerraMarkersRef = useRef({});\n  const cacheRef = useRef({});\n  const updateInProgressRef = useRef(false);\n  const zoomUpdateRef = useRef(null);\n  const [showingAssociated, setShowingAssociated] = useState(false);\n  const [originalPopupMarker, setOriginalPopupMarker] = useState(null);\n  const [activeMercadoPbl, setActiveMercadoPbl] = useState(null);\n  const competenciaMarkersRef = useRef([]);\n  const polylineRef = useRef([]);\n  const [debugTable, setDebugTable] = useState(null);\n  const [maxHeight, setMaxHeight] = useState(500);\n\n  // ‚úÖ NUEVO: Estado para almacenar el tab activo de cada popup por PBL\n  const [popupStates, setPopupStates] = useState({});\n  const [modoCorreccion, setModoCorreccion] = useState(null);\n  const makeDraggable = useCallback(popup => {\n    if (!map || !popup || !popup._container) return;\n    try {\n      const pos = map.latLngToLayerPoint(popup.getLatLng());\n      L.DomUtil.setPosition(popup._wrapper.parentNode, pos);\n      const draggable = new L.Draggable(popup._container, popup._wrapper);\n      draggable.enable();\n    } catch (error) {\n      console.error('Error draggable:', error);\n    }\n  }, [map]);\n  const clearCompetenciaMarkers = useCallback(() => {\n    competenciaMarkersRef.current.forEach(marker => {\n      try {\n        if (map && map.hasLayer(marker)) {\n          map.removeLayer(marker);\n        }\n      } catch (e) {\n        console.error('Error limpiando competencia:', e);\n      }\n    });\n    competenciaMarkersRef.current = [];\n  }, [map]);\n  const clearPolylines = useCallback(() => {\n    polylineRef.current.forEach(line => {\n      try {\n        if (map && map.hasLayer(line)) {\n          map.removeLayer(line);\n        }\n      } catch (e) {\n        console.error('Error limpiando polyline:', e);\n      }\n    });\n    polylineRef.current = [];\n  }, [map]);\n  const clearGuerraMarkers = useCallback(() => {\n    Object.values(guerraMarkersRef.current).forEach(marker => {\n      try {\n        if (map && map.hasLayer(marker)) {\n          map.removeLayer(marker);\n        }\n      } catch (e) {\n        console.error('Error limpiando guerra markers:', e);\n      }\n    });\n    guerraMarkersRef.current = {};\n  }, [map]);\n  const generarTablaPrecios = useCallback((datos, variant = 'primary') => {\n    if (!datos || datos.length === 0) {\n      return `\n        <div style=\"text-align:center; padding:20px; color:#666;\">\n          Sin datos de precios\n        </div>\n      `;\n    }\n    const variantClass = variant === 'secondary' ? 'price-table-secondary' : '';\n    const headerClass = variant === 'secondary' ? 'table-header-secondary' : '';\n    const filas = datos.map(fila => `\n      <tr>\n        <td>${fila.fecha}</td>\n        <td>${fila.g93}</td>\n        <td>${fila.g95}</td>\n        <td>${fila.g97}</td>\n        <td>${fila.diesel}</td>\n        <td>${fila.kero}</td>\n      </tr>\n    `).join('');\n    return `\n      <div class=\"price-table-wrapper\">\n        <table class=\"price-table ${variantClass}\">\n          <thead>\n            <tr class=\"${headerClass}\">\n              <th>Fecha</th>\n              <th>G93</th>\n              <th>G95</th>\n              <th>G97</th>\n              <th>Diesel</th>\n              <th>Kero</th>\n            </tr>\n          </thead>\n          <tbody>\n            ${filas}\n          </tbody>\n        </table>\n      </div>\n    `;\n  }, []);\n  const generarTablaCompetencia = useCallback(competencia => {\n    if (!competencia || competencia.length === 0) {\n      return `\n        <div style=\"text-align:center; padding:20px; color:#666;\">\n          Sin competencia cercana\n        </div>\n      `;\n    }\n    const filas = competencia.map(comp => `\n      <tr>\n        <td>${comp.nombre_competencia || '-'}</td>\n        <td>${comp.marca_competencia || '-'}</td>\n        <td>${comp.distancia ? comp.distancia.toFixed(2) + ' km' : '-'}</td>\n      </tr>\n    `).join('');\n    return `\n      <div class=\"price-table-wrapper\">\n        <table class=\"price-table\">\n          <thead>\n            <tr>\n              <th>Nombre</th>\n              <th>Marca</th>\n              <th>Distancia</th>\n            </tr>\n          </thead>\n          <tbody>\n            ${filas}\n          </tbody>\n        </table>\n      </div>\n    `;\n  }, []);\n\n  // ‚úÖ MODIFICADO: Funci√≥n para obtener el tab activo de un popup espec√≠fico\n  const getActiveTab = useCallback(pbl => {\n    var _popupStates$pbl;\n    return ((_popupStates$pbl = popupStates[pbl]) === null || _popupStates$pbl === void 0 ? void 0 : _popupStates$pbl.activeTab) || 'precios';\n  }, [popupStates]);\n\n  // ‚úÖ MODIFICADO: Funci√≥n para actualizar el tab de un popup espec√≠fico\n  const setActiveTabForPopup = useCallback((pbl, tab) => {\n    setPopupStates(prev => ({\n      ...prev,\n      [pbl]: {\n        ...prev[pbl],\n        activeTab: tab\n      }\n    }));\n  }, []);\n  const generarContenidoPopup = useCallback((marker, competencia = []) => {\n    const pbl = marker.pbl;\n    const currentTab = getActiveTab(pbl); // ‚úÖ Obtener tab del popup espec√≠fico\n\n    const tabsHTML = `\n      <div class=\"popup-tabs\">\n        <button class=\"popup-tab ${currentTab === 'precios' ? 'active' : ''}\" data-tab=\"precios\" data-pbl=\"${pbl}\">\n          üí∞ Precios\n        </button>\n        <button class=\"popup-tab ${currentTab === 'info' ? 'active' : ''}\" data-tab=\"info\" data-pbl=\"${pbl}\">\n          ‚ÑπÔ∏è Info\n        </button>\n        <button class=\"popup-tab ${currentTab === 'competencia' ? 'active' : ''}\" data-tab=\"competencia\" data-pbl=\"${pbl}\">\n          üè™ Competencia\n        </button>\n      </div>\n    `;\n    let contenidoTab = '';\n    if (currentTab === 'precios') {\n      const datosPrecios = marker.precios_historicos || [];\n      contenidoTab = generarTablaPrecios(datosPrecios);\n    } else if (currentTab === 'info') {\n      contenidoTab = `\n        <div class=\"popup-info\">\n          <p><strong>PBL:</strong> ${marker.pbl || '-'}</p>\n          <p><strong>Lat corregida:</strong> ${marker.lat.toFixed(6)}</p>\n          <p><strong>Lon corregida:</strong> ${marker.lng.toFixed(6)}</p>\n          <p><strong>Regi√≥n:</strong> ${marker.Region || '-'}</p>\n          <p><strong>Comuna:</strong> ${marker.Comuna || '-'}</p>\n          <p><strong>Direcci√≥n:</strong> ${marker.direccion || '-'}</p>\n          <p><strong>Surtidores PES:</strong> ${marker.Surtidores_Autoservicio || '-'}</p>\n          <p><strong>Posici√≥n Surtidor:</strong> ${marker.Posicion_Surtidor || '-'}</p>\n          ${marker.Guerra_Precio === 'Si' ? `\n            <p><strong>Tipo Isla:</strong> ${marker.Tipo_Isla || '-'}</p>\n            <p style=\"color:red; font-weight:bold;\">‚ö†Ô∏è Guerra de Precio Activa</p>\n          ` : ''}\n        </div>\n      `;\n    } else if (currentTab === 'competencia') {\n      contenidoTab = generarTablaCompetencia(competencia);\n    }\n    return `\n      <div class=\"custom-popup-content\">\n        <div class=\"popup-header\">\n          <div class=\"popup-title\">\n            ${createBrandLogo(marker.Marca)}\n            <span>${marker.eds || 'Sin nombre'}</span>\n          </div>\n        </div>\n        ${tabsHTML}\n        <div class=\"popup-body\">\n          ${contenidoTab}\n        </div>\n      </div>\n    `;\n  }, [generarTablaPrecios, generarTablaCompetencia, getActiveTab]);\n  const actualizarPopup = useCallback(marker => {\n    const leafletMarker = markersRef.current[marker.pbl];\n    if (!leafletMarker) return;\n    const popup = leafletMarker.getPopup();\n    if (!popup) return;\n    const competencia = baseCompData.filter(item => String(item.pbl).trim() === String(marker.pbl).trim());\n    const nuevoContenido = generarContenidoPopup(marker, competencia);\n    popup.setContent(nuevoContenido);\n\n    // ‚úÖ Re-asignar event listeners despu√©s de actualizar contenido\n    setTimeout(() => {\n      const container = popup._container;\n      if (!container) return;\n      const tabs = container.querySelectorAll('.popup-tab');\n      tabs.forEach(tab => {\n        tab.addEventListener('click', e => {\n          e.stopPropagation();\n          const tabName = tab.getAttribute('data-tab');\n          const pbl = tab.getAttribute('data-pbl');\n          setActiveTabForPopup(pbl, tabName); // ‚úÖ Actualizar solo el tab de este popup\n          actualizarPopup(marker);\n        });\n      });\n    }, 0);\n  }, [baseCompData, generarContenidoPopup, setActiveTabForPopup]);\n  const createMarker = useCallback(marker => {\n    if (cacheRef.current[marker.pbl]) {\n      return cacheRef.current[marker.pbl];\n    }\n    const icon = createCustomIcon(marker.Marca, marker.Guerra_Precio);\n    const leafletMarker = L.marker([marker.lat, marker.lng], {\n      icon,\n      draggable: false\n    });\n    const competencia = baseCompData.filter(item => String(item.pbl).trim() === String(marker.pbl).trim());\n    const popupContent = generarContenidoPopup(marker, competencia);\n    const popup = L.popup({\n      maxWidth: 600,\n      minWidth: 400,\n      maxHeight: maxHeight,\n      className: 'custom-popup',\n      closeButton: true,\n      autoClose: false,\n      closeOnClick: false,\n      autoPan: true\n    }).setContent(popupContent);\n    leafletMarker.bindPopup(popup);\n    leafletMarker.on('click', () => {\n      if (modoCorreccion) {\n        setModoCorreccion(marker.pbl);\n        return;\n      }\n    });\n    leafletMarker.on('popupopen', () => {\n      makeDraggable(popup);\n\n      // ‚úÖ Inicializar estado del popup si no existe\n      setPopupStates(prev => {\n        if (!prev[marker.pbl]) {\n          return {\n            ...prev,\n            [marker.pbl]: {\n              activeTab: 'precios'\n            }\n          };\n        }\n        return prev;\n      });\n      setTimeout(() => {\n        const container = popup._container;\n        if (!container) return;\n        const tabs = container.querySelectorAll('.popup-tab');\n        tabs.forEach(tab => {\n          tab.addEventListener('click', e => {\n            e.stopPropagation();\n            const tabName = tab.getAttribute('data-tab');\n            const pbl = tab.getAttribute('data-pbl');\n            setActiveTabForPopup(pbl, tabName); // ‚úÖ Actualizar solo este popup\n            actualizarPopup(marker);\n          });\n        });\n      }, 0);\n    });\n\n    // ‚úÖ Limpiar estado cuando se cierra el popup\n    leafletMarker.on('popupclose', () => {\n      setPopupStates(prev => {\n        const newState = {\n          ...prev\n        };\n        delete newState[marker.pbl];\n        return newState;\n      });\n    });\n    cacheRef.current[marker.pbl] = leafletMarker;\n    markersRef.current[marker.pbl] = leafletMarker;\n    return leafletMarker;\n  }, [baseCompData, generarContenidoPopup, makeDraggable, maxHeight, modoCorreccion, actualizarPopup, setActiveTabForPopup]);\n  useEffect(() => {\n    if (!map || !markers || markers.length === 0) return;\n    const updateMarkers = () => {\n      if (updateInProgressRef.current) return;\n      updateInProgressRef.current = true;\n      try {\n        const currentPbls = new Set(markers.map(m => m.pbl));\n        Object.keys(markersRef.current).forEach(pbl => {\n          if (!currentPbls.has(pbl)) {\n            const marker = markersRef.current[pbl];\n            if (map.hasLayer(marker)) {\n              map.removeLayer(marker);\n            }\n            delete markersRef.current[pbl];\n            delete cacheRef.current[pbl];\n          }\n        });\n        markers.forEach(marker => {\n          let leafletMarker = markersRef.current[marker.pbl];\n          if (!leafletMarker) {\n            leafletMarker = createMarker(marker);\n            leafletMarker.addTo(map);\n          } else {\n            const newIcon = createCustomIcon(marker.Marca, marker.Guerra_Precio);\n            leafletMarker.setIcon(newIcon);\n            leafletMarker.setLatLng([marker.lat, marker.lng]);\n            if (leafletMarker.isPopupOpen()) {\n              actualizarPopup(marker);\n            }\n          }\n        });\n      } finally {\n        updateInProgressRef.current = false;\n      }\n    };\n    if (zoomUpdateRef.current) {\n      clearTimeout(zoomUpdateRef.current);\n    }\n    zoomUpdateRef.current = setTimeout(updateMarkers, 100);\n    return () => {\n      if (zoomUpdateRef.current) {\n        clearTimeout(zoomUpdateRef.current);\n      }\n    };\n  }, [markers, map, createMarker, actualizarPopup]);\n  return null;\n};\n_s(IconMarkersLayer, \"b/t16CTDyAorqp99bkpYdkSt7b4=\", false, function () {\n  return [useMap];\n});\n_c = IconMarkersLayer;\nexport default IconMarkersLayer;\nvar _c;\n$RefreshReg$(_c, \"IconMarkersLayer\");","map":{"version":3,"names":["React","useEffect","useRef","useState","useCallback","useMap","L","createCustomIcon","createBrandLogo","guardarCoordenadaCorregida","IconMarkersLayer","markers","markersForMercado","selectedRegion","baseCompData","_s","map","markersRef","guerraMarkersRef","cacheRef","updateInProgressRef","zoomUpdateRef","showingAssociated","setShowingAssociated","originalPopupMarker","setOriginalPopupMarker","activeMercadoPbl","setActiveMercadoPbl","competenciaMarkersRef","polylineRef","debugTable","setDebugTable","maxHeight","setMaxHeight","popupStates","setPopupStates","modoCorreccion","setModoCorreccion","makeDraggable","popup","_container","pos","latLngToLayerPoint","getLatLng","DomUtil","setPosition","_wrapper","parentNode","draggable","Draggable","enable","error","console","clearCompetenciaMarkers","current","forEach","marker","hasLayer","removeLayer","e","clearPolylines","line","clearGuerraMarkers","Object","values","generarTablaPrecios","datos","variant","length","variantClass","headerClass","filas","fila","fecha","g93","g95","g97","diesel","kero","join","generarTablaCompetencia","competencia","comp","nombre_competencia","marca_competencia","distancia","toFixed","getActiveTab","pbl","_popupStates$pbl","activeTab","setActiveTabForPopup","tab","prev","generarContenidoPopup","currentTab","tabsHTML","contenidoTab","datosPrecios","precios_historicos","lat","lng","Region","Comuna","direccion","Surtidores_Autoservicio","Posicion_Surtidor","Guerra_Precio","Tipo_Isla","Marca","eds","actualizarPopup","leafletMarker","getPopup","filter","item","String","trim","nuevoContenido","setContent","setTimeout","container","tabs","querySelectorAll","addEventListener","stopPropagation","tabName","getAttribute","createMarker","icon","popupContent","maxWidth","minWidth","className","closeButton","autoClose","closeOnClick","autoPan","bindPopup","on","newState","updateMarkers","currentPbls","Set","m","keys","has","addTo","newIcon","setIcon","setLatLng","isPopupOpen","clearTimeout","_c","$RefreshReg$"],"sources":["C:/Users/e08f/Desktop/Proyectos/Resumen/mapa-v2/src/components/IconMarkersLayer.jsx"],"sourcesContent":["import React, { useEffect, useRef, useState, useCallback } from 'react';\r\nimport { useMap } from 'react-leaflet';\r\nimport L from 'leaflet';\r\nimport { createCustomIcon, createBrandLogo } from '../utils/iconHelpers';\r\nimport { guardarCoordenadaCorregida } from '../services/apiService';\r\nimport '../styles/iconMarkersLayer.css';\r\n\r\nconst IconMarkersLayer = ({\r\n  markers,\r\n  markersForMercado = null,\r\n  selectedRegion,\r\n  baseCompData = []\r\n}) => {\r\n  const map = useMap();\r\n  const markersRef = useRef({});\r\n  const guerraMarkersRef = useRef({});\r\n  const cacheRef = useRef({});\r\n  const updateInProgressRef = useRef(false);\r\n  const zoomUpdateRef = useRef(null);\r\n\r\n  const [showingAssociated, setShowingAssociated] = useState(false);\r\n  const [originalPopupMarker, setOriginalPopupMarker] = useState(null);\r\n  const [activeMercadoPbl, setActiveMercadoPbl] = useState(null);\r\n\r\n  const competenciaMarkersRef = useRef([]);\r\n  const polylineRef = useRef([]);\r\n  const [debugTable, setDebugTable] = useState(null);\r\n  const [maxHeight, setMaxHeight] = useState(500);\r\n  \r\n  // ‚úÖ NUEVO: Estado para almacenar el tab activo de cada popup por PBL\r\n  const [popupStates, setPopupStates] = useState({});\r\n  \r\n  const [modoCorreccion, setModoCorreccion] = useState(null);\r\n\r\n  const makeDraggable = useCallback((popup) => {\r\n    if (!map || !popup || !popup._container) return;\r\n    try {\r\n      const pos = map.latLngToLayerPoint(popup.getLatLng());\r\n      L.DomUtil.setPosition(popup._wrapper.parentNode, pos);\r\n      const draggable = new L.Draggable(popup._container, popup._wrapper);\r\n      draggable.enable();\r\n    } catch (error) {\r\n      console.error('Error draggable:', error);\r\n    }\r\n  }, [map]);\r\n\r\n  const clearCompetenciaMarkers = useCallback(() => {\r\n    competenciaMarkersRef.current.forEach(marker => {\r\n      try {\r\n        if (map && map.hasLayer(marker)) {\r\n          map.removeLayer(marker);\r\n        }\r\n      } catch (e) {\r\n        console.error('Error limpiando competencia:', e);\r\n      }\r\n    });\r\n    competenciaMarkersRef.current = [];\r\n  }, [map]);\r\n\r\n  const clearPolylines = useCallback(() => {\r\n    polylineRef.current.forEach(line => {\r\n      try {\r\n        if (map && map.hasLayer(line)) {\r\n          map.removeLayer(line);\r\n        }\r\n      } catch (e) {\r\n        console.error('Error limpiando polyline:', e);\r\n      }\r\n    });\r\n    polylineRef.current = [];\r\n  }, [map]);\r\n\r\n  const clearGuerraMarkers = useCallback(() => {\r\n    Object.values(guerraMarkersRef.current).forEach(marker => {\r\n      try {\r\n        if (map && map.hasLayer(marker)) {\r\n          map.removeLayer(marker);\r\n        }\r\n      } catch (e) {\r\n        console.error('Error limpiando guerra markers:', e);\r\n      }\r\n    });\r\n    guerraMarkersRef.current = {};\r\n  }, [map]);\r\n\r\n  const generarTablaPrecios = useCallback((datos, variant = 'primary') => {\r\n    if (!datos || datos.length === 0) {\r\n      return `\r\n        <div style=\"text-align:center; padding:20px; color:#666;\">\r\n          Sin datos de precios\r\n        </div>\r\n      `;\r\n    }\r\n\r\n    const variantClass = variant === 'secondary' ? 'price-table-secondary' : '';\r\n    const headerClass = variant === 'secondary' ? 'table-header-secondary' : '';\r\n\r\n    const filas = datos.map(fila => `\r\n      <tr>\r\n        <td>${fila.fecha}</td>\r\n        <td>${fila.g93}</td>\r\n        <td>${fila.g95}</td>\r\n        <td>${fila.g97}</td>\r\n        <td>${fila.diesel}</td>\r\n        <td>${fila.kero}</td>\r\n      </tr>\r\n    `).join('');\r\n\r\n    return `\r\n      <div class=\"price-table-wrapper\">\r\n        <table class=\"price-table ${variantClass}\">\r\n          <thead>\r\n            <tr class=\"${headerClass}\">\r\n              <th>Fecha</th>\r\n              <th>G93</th>\r\n              <th>G95</th>\r\n              <th>G97</th>\r\n              <th>Diesel</th>\r\n              <th>Kero</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            ${filas}\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n    `;\r\n  }, []);\r\n\r\n  const generarTablaCompetencia = useCallback((competencia) => {\r\n    if (!competencia || competencia.length === 0) {\r\n      return `\r\n        <div style=\"text-align:center; padding:20px; color:#666;\">\r\n          Sin competencia cercana\r\n        </div>\r\n      `;\r\n    }\r\n\r\n    const filas = competencia.map(comp => `\r\n      <tr>\r\n        <td>${comp.nombre_competencia || '-'}</td>\r\n        <td>${comp.marca_competencia || '-'}</td>\r\n        <td>${comp.distancia ? comp.distancia.toFixed(2) + ' km' : '-'}</td>\r\n      </tr>\r\n    `).join('');\r\n\r\n    return `\r\n      <div class=\"price-table-wrapper\">\r\n        <table class=\"price-table\">\r\n          <thead>\r\n            <tr>\r\n              <th>Nombre</th>\r\n              <th>Marca</th>\r\n              <th>Distancia</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            ${filas}\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n    `;\r\n  }, []);\r\n\r\n  // ‚úÖ MODIFICADO: Funci√≥n para obtener el tab activo de un popup espec√≠fico\r\n  const getActiveTab = useCallback((pbl) => {\r\n    return popupStates[pbl]?.activeTab || 'precios';\r\n  }, [popupStates]);\r\n\r\n  // ‚úÖ MODIFICADO: Funci√≥n para actualizar el tab de un popup espec√≠fico\r\n  const setActiveTabForPopup = useCallback((pbl, tab) => {\r\n    setPopupStates(prev => ({\r\n      ...prev,\r\n      [pbl]: { ...prev[pbl], activeTab: tab }\r\n    }));\r\n  }, []);\r\n\r\n  const generarContenidoPopup = useCallback((marker, competencia = []) => {\r\n    const pbl = marker.pbl;\r\n    const currentTab = getActiveTab(pbl); // ‚úÖ Obtener tab del popup espec√≠fico\r\n\r\n    const tabsHTML = `\r\n      <div class=\"popup-tabs\">\r\n        <button class=\"popup-tab ${currentTab === 'precios' ? 'active' : ''}\" data-tab=\"precios\" data-pbl=\"${pbl}\">\r\n          üí∞ Precios\r\n        </button>\r\n        <button class=\"popup-tab ${currentTab === 'info' ? 'active' : ''}\" data-tab=\"info\" data-pbl=\"${pbl}\">\r\n          ‚ÑπÔ∏è Info\r\n        </button>\r\n        <button class=\"popup-tab ${currentTab === 'competencia' ? 'active' : ''}\" data-tab=\"competencia\" data-pbl=\"${pbl}\">\r\n          üè™ Competencia\r\n        </button>\r\n      </div>\r\n    `;\r\n\r\n    let contenidoTab = '';\r\n\r\n    if (currentTab === 'precios') {\r\n      const datosPrecios = marker.precios_historicos || [];\r\n      contenidoTab = generarTablaPrecios(datosPrecios);\r\n    } else if (currentTab === 'info') {\r\n      contenidoTab = `\r\n        <div class=\"popup-info\">\r\n          <p><strong>PBL:</strong> ${marker.pbl || '-'}</p>\r\n          <p><strong>Lat corregida:</strong> ${marker.lat.toFixed(6)}</p>\r\n          <p><strong>Lon corregida:</strong> ${marker.lng.toFixed(6)}</p>\r\n          <p><strong>Regi√≥n:</strong> ${marker.Region || '-'}</p>\r\n          <p><strong>Comuna:</strong> ${marker.Comuna || '-'}</p>\r\n          <p><strong>Direcci√≥n:</strong> ${marker.direccion || '-'}</p>\r\n          <p><strong>Surtidores PES:</strong> ${marker.Surtidores_Autoservicio || '-'}</p>\r\n          <p><strong>Posici√≥n Surtidor:</strong> ${marker.Posicion_Surtidor || '-'}</p>\r\n          ${marker.Guerra_Precio === 'Si' ? `\r\n            <p><strong>Tipo Isla:</strong> ${marker.Tipo_Isla || '-'}</p>\r\n            <p style=\"color:red; font-weight:bold;\">‚ö†Ô∏è Guerra de Precio Activa</p>\r\n          ` : ''}\r\n        </div>\r\n      `;\r\n    } else if (currentTab === 'competencia') {\r\n      contenidoTab = generarTablaCompetencia(competencia);\r\n    }\r\n\r\n    return `\r\n      <div class=\"custom-popup-content\">\r\n        <div class=\"popup-header\">\r\n          <div class=\"popup-title\">\r\n            ${createBrandLogo(marker.Marca)}\r\n            <span>${marker.eds || 'Sin nombre'}</span>\r\n          </div>\r\n        </div>\r\n        ${tabsHTML}\r\n        <div class=\"popup-body\">\r\n          ${contenidoTab}\r\n        </div>\r\n      </div>\r\n    `;\r\n  }, [generarTablaPrecios, generarTablaCompetencia, getActiveTab]);\r\n\r\n  const actualizarPopup = useCallback((marker) => {\r\n    const leafletMarker = markersRef.current[marker.pbl];\r\n    if (!leafletMarker) return;\r\n\r\n    const popup = leafletMarker.getPopup();\r\n    if (!popup) return;\r\n\r\n    const competencia = baseCompData.filter(\r\n      item => String(item.pbl).trim() === String(marker.pbl).trim()\r\n    );\r\n\r\n    const nuevoContenido = generarContenidoPopup(marker, competencia);\r\n    popup.setContent(nuevoContenido);\r\n\r\n    // ‚úÖ Re-asignar event listeners despu√©s de actualizar contenido\r\n    setTimeout(() => {\r\n      const container = popup._container;\r\n      if (!container) return;\r\n\r\n      const tabs = container.querySelectorAll('.popup-tab');\r\n      tabs.forEach(tab => {\r\n        tab.addEventListener('click', (e) => {\r\n          e.stopPropagation();\r\n          const tabName = tab.getAttribute('data-tab');\r\n          const pbl = tab.getAttribute('data-pbl');\r\n          setActiveTabForPopup(pbl, tabName); // ‚úÖ Actualizar solo el tab de este popup\r\n          actualizarPopup(marker);\r\n        });\r\n      });\r\n    }, 0);\r\n  }, [baseCompData, generarContenidoPopup, setActiveTabForPopup]);\r\n\r\n  const createMarker = useCallback((marker) => {\r\n    if (cacheRef.current[marker.pbl]) {\r\n      return cacheRef.current[marker.pbl];\r\n    }\r\n\r\n    const icon = createCustomIcon(marker.Marca, marker.Guerra_Precio);\r\n    const leafletMarker = L.marker([marker.lat, marker.lng], {\r\n      icon,\r\n      draggable: false\r\n    });\r\n\r\n    const competencia = baseCompData.filter(\r\n      item => String(item.pbl).trim() === String(marker.pbl).trim()\r\n    );\r\n\r\n    const popupContent = generarContenidoPopup(marker, competencia);\r\n\r\n    const popup = L.popup({\r\n      maxWidth: 600,\r\n      minWidth: 400,\r\n      maxHeight: maxHeight,\r\n      className: 'custom-popup',\r\n      closeButton: true,\r\n      autoClose: false,\r\n      closeOnClick: false,\r\n      autoPan: true\r\n    }).setContent(popupContent);\r\n\r\n    leafletMarker.bindPopup(popup);\r\n\r\n    leafletMarker.on('click', () => {\r\n      if (modoCorreccion) {\r\n        setModoCorreccion(marker.pbl);\r\n        return;\r\n      }\r\n    });\r\n\r\n    leafletMarker.on('popupopen', () => {\r\n      makeDraggable(popup);\r\n\r\n      // ‚úÖ Inicializar estado del popup si no existe\r\n      setPopupStates(prev => {\r\n        if (!prev[marker.pbl]) {\r\n          return { ...prev, [marker.pbl]: { activeTab: 'precios' } };\r\n        }\r\n        return prev;\r\n      });\r\n\r\n      setTimeout(() => {\r\n        const container = popup._container;\r\n        if (!container) return;\r\n\r\n        const tabs = container.querySelectorAll('.popup-tab');\r\n        tabs.forEach(tab => {\r\n          tab.addEventListener('click', (e) => {\r\n            e.stopPropagation();\r\n            const tabName = tab.getAttribute('data-tab');\r\n            const pbl = tab.getAttribute('data-pbl');\r\n            setActiveTabForPopup(pbl, tabName); // ‚úÖ Actualizar solo este popup\r\n            actualizarPopup(marker);\r\n          });\r\n        });\r\n      }, 0);\r\n    });\r\n\r\n    // ‚úÖ Limpiar estado cuando se cierra el popup\r\n    leafletMarker.on('popupclose', () => {\r\n      setPopupStates(prev => {\r\n        const newState = { ...prev };\r\n        delete newState[marker.pbl];\r\n        return newState;\r\n      });\r\n    });\r\n\r\n    cacheRef.current[marker.pbl] = leafletMarker;\r\n    markersRef.current[marker.pbl] = leafletMarker;\r\n\r\n    return leafletMarker;\r\n  }, [\r\n    baseCompData,\r\n    generarContenidoPopup,\r\n    makeDraggable,\r\n    maxHeight,\r\n    modoCorreccion,\r\n    actualizarPopup,\r\n    setActiveTabForPopup\r\n  ]);\r\n\r\n  useEffect(() => {\r\n    if (!map || !markers || markers.length === 0) return;\r\n\r\n    const updateMarkers = () => {\r\n      if (updateInProgressRef.current) return;\r\n      updateInProgressRef.current = true;\r\n\r\n      try {\r\n        const currentPbls = new Set(markers.map(m => m.pbl));\r\n\r\n        Object.keys(markersRef.current).forEach(pbl => {\r\n          if (!currentPbls.has(pbl)) {\r\n            const marker = markersRef.current[pbl];\r\n            if (map.hasLayer(marker)) {\r\n              map.removeLayer(marker);\r\n            }\r\n            delete markersRef.current[pbl];\r\n            delete cacheRef.current[pbl];\r\n          }\r\n        });\r\n\r\n        markers.forEach(marker => {\r\n          let leafletMarker = markersRef.current[marker.pbl];\r\n\r\n          if (!leafletMarker) {\r\n            leafletMarker = createMarker(marker);\r\n            leafletMarker.addTo(map);\r\n          } else {\r\n            const newIcon = createCustomIcon(marker.Marca, marker.Guerra_Precio);\r\n            leafletMarker.setIcon(newIcon);\r\n            leafletMarker.setLatLng([marker.lat, marker.lng]);\r\n\r\n            if (leafletMarker.isPopupOpen()) {\r\n              actualizarPopup(marker);\r\n            }\r\n          }\r\n        });\r\n      } finally {\r\n        updateInProgressRef.current = false;\r\n      }\r\n    };\r\n\r\n    if (zoomUpdateRef.current) {\r\n      clearTimeout(zoomUpdateRef.current);\r\n    }\r\n\r\n    zoomUpdateRef.current = setTimeout(updateMarkers, 100);\r\n\r\n    return () => {\r\n      if (zoomUpdateRef.current) {\r\n        clearTimeout(zoomUpdateRef.current);\r\n      }\r\n    };\r\n  }, [markers, map, createMarker, actualizarPopup]);\r\n\r\n  return null;\r\n};\r\n\r\nexport default IconMarkersLayer;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}