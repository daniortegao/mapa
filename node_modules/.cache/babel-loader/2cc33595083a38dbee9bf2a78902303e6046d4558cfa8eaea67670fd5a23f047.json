{"ast":null,"code":"var _s = $RefreshSig$();\nimport React, { useEffect, useRef } from 'react';\nimport { useMap } from 'react-leaflet';\nimport L from 'leaflet';\nimport { createCustomIcon, createBrandLogo } from '../utils/iconHelpers';\nconst IconMarkersLayer = ({\n  markers,\n  selectedRegion\n}) => {\n  _s();\n  const map = useMap();\n  const markersRef = useRef({});\n  const updateInProgressRef = useRef(false);\n\n  // Limpiar y agregar marcadores\n  const updateMarkers = markersToShow => {\n    if (!map || updateInProgressRef.current) return;\n    updateInProgressRef.current = true;\n\n    // Limpiar marcadores anteriores\n    Object.values(markersRef.current).forEach(marker => {\n      try {\n        if (map.hasLayer(marker)) {\n          map.removeLayer(marker);\n        }\n      } catch (error) {\n        console.error('Error removiendo marcador:', error);\n      }\n    });\n    markersRef.current = {};\n    console.log(`üìç Agregando ${markersToShow.length} marcadores...`);\n    markersToShow.forEach(marker => {\n      try {\n        const markerId = `${marker.id}-${marker.Marca}`;\n        if (markersRef.current[markerId]) {\n          return;\n        }\n\n        // Crear marcador\n        const leafletMarker = L.marker([marker.lat, marker.lng], {\n          icon: createCustomIcon(marker.Marca),\n          title: marker.nombre\n        });\n\n        // Contenido del popup\n        const popupContent = `\n          <div class=\"popup-container\">\n            <div class=\"popup-header\">\n              <img \n                src=\"${createBrandLogo(marker.Marca)}\"\n                alt=\"${marker.Marca}\"\n                style=\"width: 30px; height: 30px; border-radius: 50%; object-fit: cover; margin-right: 8px;\"\n                onerror=\"this.style.display='none'\"\n              />\n              <h3 style=\"margin: 0;\">${marker.nombre}</h3>\n            </div>\n            <div class=\"popup-content\">\n              <div class=\"popup-data\">\n                <strong>Marca:</strong> ${marker.Marca}<br />\n                <strong>Region:</strong> ${marker.Region}<br />\n                <strong>Comuna:</strong> ${marker.Comuna}<br />\n                ${marker.direccion ? `<strong>Direcci√≥n:</strong> ${marker.direccion}<br />` : ''}\n                ${marker.eds ? `<strong>EDS:</strong> ${marker.eds}<br />` : ''}\n              </div>\n              <hr style=\"margin: 10px 0; border: none; border-top: 1px solid #e0e0e0\" />\n              <div class=\"popup-data\">\n                <strong>Precios:</strong><br />\n                G93: ${marker.precio_g93 ? `$${marker.precio_g93}` : 'N/A'}<br />\n                G95: ${marker.precio_g95 ? `$${marker.precio_g95}` : 'N/A'}<br />\n                Diesel: ${marker.precio_diesel ? `$${marker.precio_diesel}` : 'N/A'}<br />\n              </div>\n              ${marker.Guerra_Precio === 'Si' ? `\n                <hr style=\"margin: 10px 0; border: none; border-top: 1px solid #e0e0e0\" />\n                <div class=\"popup-data\" style=\"color: #d32f2f; font-weight: bold;\">\n                  ‚ö†Ô∏è Guerra de Precio Activa\n                </div>\n              ` : ''}\n            </div>\n          </div>\n        `;\n        const popup = L.popup({\n          maxWidth: 350,\n          minWidth: 280,\n          autoClose: false,\n          closeOnClick: false\n        }).setContent(popupContent);\n        leafletMarker.bindPopup(popup);\n\n        // Hacer draggable al abrir\n        leafletMarker.on('popupopen', () => {\n          makeDraggable(leafletMarker.getPopup());\n        });\n        leafletMarker.on('click', function () {\n          leafletMarker.openPopup();\n        });\n        leafletMarker.addTo(map);\n        markersRef.current[markerId] = leafletMarker;\n      } catch (error) {\n        console.error(`Error agregando marcador:`, error);\n      }\n    });\n    updateInProgressRef.current = false;\n  };\n\n  // Hacer popup draggable\n  const makeDraggable = popup => {\n    if (!map || !popup || !popup._container) return;\n    try {\n      const pos = map.latLngToLayerPoint(popup.getLatLng());\n      L.DomUtil.setPosition(popup._wrapper.parentNode, pos);\n      const draggable = new L.Draggable(popup._container, popup._wrapper);\n      draggable.enable();\n    } catch (error) {\n      console.error('Error making popup draggable:', error);\n    }\n  };\n\n  // Actualizar cuando cambian los marcadores\n  useEffect(() => {\n    if (!map || !markers || markers.length === 0) {\n      // Limpiar si no hay marcadores\n      Object.values(markersRef.current).forEach(marker => {\n        try {\n          if (map.hasLayer(marker)) {\n            map.removeLayer(marker);\n          }\n        } catch (error) {\n          console.error('Error removiendo marcador:', error);\n        }\n      });\n      markersRef.current = {};\n      return;\n    }\n    console.log(`‚úÖ Actualizando ${markers.length} marcadores para regi√≥n: ${selectedRegion}`);\n    updateMarkers(markers);\n  }, [markers, selectedRegion, map]);\n  return null;\n};\n_s(IconMarkersLayer, \"aU3zUsljmgDvbFIDPcoC/BNOOCQ=\", false, function () {\n  return [useMap];\n});\n_c = IconMarkersLayer;\nexport default IconMarkersLayer;\nvar _c;\n$RefreshReg$(_c, \"IconMarkersLayer\");","map":{"version":3,"names":["React","useEffect","useRef","useMap","L","createCustomIcon","createBrandLogo","IconMarkersLayer","markers","selectedRegion","_s","map","markersRef","updateInProgressRef","updateMarkers","markersToShow","current","Object","values","forEach","marker","hasLayer","removeLayer","error","console","log","length","markerId","id","Marca","leafletMarker","lat","lng","icon","title","nombre","popupContent","Region","Comuna","direccion","eds","precio_g93","precio_g95","precio_diesel","Guerra_Precio","popup","maxWidth","minWidth","autoClose","closeOnClick","setContent","bindPopup","on","makeDraggable","getPopup","openPopup","addTo","_container","pos","latLngToLayerPoint","getLatLng","DomUtil","setPosition","_wrapper","parentNode","draggable","Draggable","enable","_c","$RefreshReg$"],"sources":["C:/Users/e08f/Desktop/Proyectos/Resumen/mapa-v2/src/components/IconMarkersLayer.jsx"],"sourcesContent":["import React, { useEffect, useRef } from 'react';\r\nimport { useMap } from 'react-leaflet';\r\nimport L from 'leaflet';\r\nimport { createCustomIcon, createBrandLogo } from '../utils/iconHelpers';\r\n\r\nconst IconMarkersLayer = ({ markers, selectedRegion }) => {\r\n  const map = useMap();\r\n  const markersRef = useRef({});\r\n  const updateInProgressRef = useRef(false);\r\n\r\n  // Limpiar y agregar marcadores\r\n  const updateMarkers = (markersToShow) => {\r\n    if (!map || updateInProgressRef.current) return;\r\n\r\n    updateInProgressRef.current = true;\r\n\r\n    // Limpiar marcadores anteriores\r\n    Object.values(markersRef.current).forEach(marker => {\r\n      try {\r\n        if (map.hasLayer(marker)) {\r\n          map.removeLayer(marker);\r\n        }\r\n      } catch (error) {\r\n        console.error('Error removiendo marcador:', error);\r\n      }\r\n    });\r\n    markersRef.current = {};\r\n\r\n    console.log(`üìç Agregando ${markersToShow.length} marcadores...`);\r\n\r\n    markersToShow.forEach((marker) => {\r\n      try {\r\n        const markerId = `${marker.id}-${marker.Marca}`;\r\n\r\n        if (markersRef.current[markerId]) {\r\n          return;\r\n        }\r\n\r\n        // Crear marcador\r\n        const leafletMarker = L.marker([marker.lat, marker.lng], {\r\n          icon: createCustomIcon(marker.Marca),\r\n          title: marker.nombre\r\n        });\r\n\r\n        // Contenido del popup\r\n        const popupContent = `\r\n          <div class=\"popup-container\">\r\n            <div class=\"popup-header\">\r\n              <img \r\n                src=\"${createBrandLogo(marker.Marca)}\"\r\n                alt=\"${marker.Marca}\"\r\n                style=\"width: 30px; height: 30px; border-radius: 50%; object-fit: cover; margin-right: 8px;\"\r\n                onerror=\"this.style.display='none'\"\r\n              />\r\n              <h3 style=\"margin: 0;\">${marker.nombre}</h3>\r\n            </div>\r\n            <div class=\"popup-content\">\r\n              <div class=\"popup-data\">\r\n                <strong>Marca:</strong> ${marker.Marca}<br />\r\n                <strong>Region:</strong> ${marker.Region}<br />\r\n                <strong>Comuna:</strong> ${marker.Comuna}<br />\r\n                ${marker.direccion ? `<strong>Direcci√≥n:</strong> ${marker.direccion}<br />` : ''}\r\n                ${marker.eds ? `<strong>EDS:</strong> ${marker.eds}<br />` : ''}\r\n              </div>\r\n              <hr style=\"margin: 10px 0; border: none; border-top: 1px solid #e0e0e0\" />\r\n              <div class=\"popup-data\">\r\n                <strong>Precios:</strong><br />\r\n                G93: ${marker.precio_g93 ? `$${marker.precio_g93}` : 'N/A'}<br />\r\n                G95: ${marker.precio_g95 ? `$${marker.precio_g95}` : 'N/A'}<br />\r\n                Diesel: ${marker.precio_diesel ? `$${marker.precio_diesel}` : 'N/A'}<br />\r\n              </div>\r\n              ${marker.Guerra_Precio === 'Si' ? `\r\n                <hr style=\"margin: 10px 0; border: none; border-top: 1px solid #e0e0e0\" />\r\n                <div class=\"popup-data\" style=\"color: #d32f2f; font-weight: bold;\">\r\n                  ‚ö†Ô∏è Guerra de Precio Activa\r\n                </div>\r\n              ` : ''}\r\n            </div>\r\n          </div>\r\n        `;\r\n\r\n        const popup = L.popup({\r\n          maxWidth: 350,\r\n          minWidth: 280,\r\n          autoClose: false,\r\n          closeOnClick: false\r\n        }).setContent(popupContent);\r\n\r\n        leafletMarker.bindPopup(popup);\r\n\r\n        // Hacer draggable al abrir\r\n        leafletMarker.on('popupopen', () => {\r\n          makeDraggable(leafletMarker.getPopup());\r\n        });\r\n\r\n        leafletMarker.on('click', function() {\r\n          leafletMarker.openPopup();\r\n        });\r\n\r\n        leafletMarker.addTo(map);\r\n        markersRef.current[markerId] = leafletMarker;\r\n\r\n      } catch (error) {\r\n        console.error(`Error agregando marcador:`, error);\r\n      }\r\n    });\r\n\r\n    updateInProgressRef.current = false;\r\n  };\r\n\r\n  // Hacer popup draggable\r\n  const makeDraggable = (popup) => {\r\n    if (!map || !popup || !popup._container) return;\r\n\r\n    try {\r\n      const pos = map.latLngToLayerPoint(popup.getLatLng());\r\n      L.DomUtil.setPosition(popup._wrapper.parentNode, pos);\r\n      \r\n      const draggable = new L.Draggable(popup._container, popup._wrapper);\r\n      draggable.enable();\r\n    } catch (error) {\r\n      console.error('Error making popup draggable:', error);\r\n    }\r\n  };\r\n\r\n  // Actualizar cuando cambian los marcadores\r\n  useEffect(() => {\r\n    if (!map || !markers || markers.length === 0) {\r\n      // Limpiar si no hay marcadores\r\n      Object.values(markersRef.current).forEach(marker => {\r\n        try {\r\n          if (map.hasLayer(marker)) {\r\n            map.removeLayer(marker);\r\n          }\r\n        } catch (error) {\r\n          console.error('Error removiendo marcador:', error);\r\n        }\r\n      });\r\n      markersRef.current = {};\r\n      return;\r\n    }\r\n\r\n    console.log(`‚úÖ Actualizando ${markers.length} marcadores para regi√≥n: ${selectedRegion}`);\r\n    updateMarkers(markers);\r\n\r\n  }, [markers, selectedRegion, map]);\r\n\r\n  return null;\r\n};\r\n\r\nexport default IconMarkersLayer;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}