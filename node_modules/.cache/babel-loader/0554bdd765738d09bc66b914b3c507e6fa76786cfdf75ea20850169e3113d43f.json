{"ast":null,"code":"// --- Utilidad para obtener la última fila por nivel ---\nexport function obtenerUltimaFilaPorNivel(nivel,data){const filas=data.filter(f=>f.nivel&&f.nivel.toString().toLowerCase()===nivel.toLowerCase()).sort((a,b)=>new Date(b.fecha_aplicacion||b.Fecha)-new Date(a.fecha_aplicacion||a.Fecha));return filas[0]||null;}/*\r\n * baseHistorico: tu arreglo de datos históricos filtrado (usas markersForMercado || markers, por ejemplo)\r\n * marker: el marcador que se está usando para el popup actual\r\n */export function obtenerDiferenciasNiveles(marker,baseHistorico){const filaNivel1=obtenerUltimaFilaPorNivel('Nivel 1',baseHistorico.filter(m=>m.id===marker.id));const filaNivel2=obtenerUltimaFilaPorNivel('Nivel 2',baseHistorico.filter(m=>m.id===marker.id));if(!filaNivel1||!filaNivel2)return null;return{g93:filaNivel2.g93-filaNivel1.g93,g95:filaNivel2.g95-filaNivel1.g95,g97:filaNivel2.g97-filaNivel1.g97,diesel:filaNivel2.diesel-filaNivel1.diesel,kero:filaNivel2.kero-filaNivel1.kero};}// Normaliza histórico del marker con filtro de nivel\nexport function obtenerHistoricoMarker(markerId,dataArray){let nivel=arguments.length>2&&arguments[2]!==undefined?arguments[2]:\"Nivel 1\";const datos=dataArray.filter(m=>m.id===markerId&&m.nivel&&m.nivel.toLowerCase()===nivel.toLowerCase());return datos.sort((a,b)=>{const fechaA=a.fecha_aplicacion?new Date(a.fecha_aplicacion):new Date(0);const fechaB=b.fecha_aplicacion?new Date(b.fecha_aplicacion):new Date(0);return fechaB-fechaA;}).map(item=>({fecha:item.fecha_aplicacion||item.Fecha||'S/F',g93:item.precio_g93||item.G93||'-',g95:item.precio_g95||item.G95||'-',g97:item.precio_g97||item.G97||'-',diesel:item.precio_diesel||item.Diesel||'-',kero:item.precio_kero||item.Kero||'-'}));}","map":{"version":3,"names":["obtenerUltimaFilaPorNivel","nivel","data","filas","filter","f","toString","toLowerCase","sort","a","b","Date","fecha_aplicacion","Fecha","obtenerDiferenciasNiveles","marker","baseHistorico","filaNivel1","m","id","filaNivel2","g93","g95","g97","diesel","kero","obtenerHistoricoMarker","markerId","dataArray","arguments","length","undefined","datos","fechaA","fechaB","map","item","fecha","precio_g93","G93","precio_g95","G95","precio_g97","G97","precio_diesel","Diesel","precio_kero","Kero"],"sources":["C:/Users/e08f/Desktop/Proyectos/Resumen/mapa-v2/src/utils/markerUtils.js"],"sourcesContent":["\r\n// --- Utilidad para obtener la última fila por nivel ---\r\nexport function obtenerUltimaFilaPorNivel(nivel, data) {\r\n    const filas = data\r\n        .filter(f => f.nivel && f.nivel.toString().toLowerCase() === nivel.toLowerCase())\r\n        .sort((a, b) => new Date(b.fecha_aplicacion || b.Fecha) - new Date(a.fecha_aplicacion || a.Fecha));\r\n    return filas[0] || null;\r\n}\r\n\r\n/*\r\n * baseHistorico: tu arreglo de datos históricos filtrado (usas markersForMercado || markers, por ejemplo)\r\n * marker: el marcador que se está usando para el popup actual\r\n */\r\nexport function obtenerDiferenciasNiveles(marker, baseHistorico) {\r\n    const filaNivel1 = obtenerUltimaFilaPorNivel('Nivel 1', baseHistorico.filter(m => m.id === marker.id));\r\n    const filaNivel2 = obtenerUltimaFilaPorNivel('Nivel 2', baseHistorico.filter(m => m.id === marker.id));\r\n    if (!filaNivel1 || !filaNivel2) return null;\r\n    return {\r\n        g93: filaNivel2.g93 - filaNivel1.g93,\r\n        g95: filaNivel2.g95 - filaNivel1.g95,\r\n        g97: filaNivel2.g97 - filaNivel1.g97,\r\n        diesel: filaNivel2.diesel - filaNivel1.diesel,\r\n        kero: filaNivel2.kero - filaNivel1.kero\r\n    };\r\n}\r\n\r\n// Normaliza histórico del marker con filtro de nivel\r\nexport function obtenerHistoricoMarker(markerId, dataArray, nivel = \"Nivel 1\") {\r\n    const datos = dataArray.filter(m =>\r\n        m.id === markerId &&\r\n        m.nivel &&\r\n        m.nivel.toLowerCase() === nivel.toLowerCase()\r\n    );\r\n\r\n    return datos\r\n        .sort((a, b) => {\r\n            const fechaA = a.fecha_aplicacion ? new Date(a.fecha_aplicacion) : new Date(0);\r\n            const fechaB = b.fecha_aplicacion ? new Date(b.fecha_aplicacion) : new Date(0);\r\n            return fechaB - fechaA;\r\n        })\r\n        .map(item => ({\r\n            fecha: item.fecha_aplicacion || item.Fecha || 'S/F',\r\n            g93: item.precio_g93 || item.G93 || '-',\r\n            g95: item.precio_g95 || item.G95 || '-',\r\n            g97: item.precio_g97 || item.G97 || '-',\r\n            diesel: item.precio_diesel || item.Diesel || '-',\r\n            kero: item.precio_kero || item.Kero || '-'\r\n        }));\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}