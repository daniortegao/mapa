{"ast":null,"code":"import _objectSpread from\"C:/Users/e08f/Desktop/Proyectos/Resumen/mapa-v2/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useEffect,useRef,useState,useCallback}from'react';import{useMap}from'react-leaflet';import L from'leaflet';import ReactDOM from'react-dom/client';import{createCustomIcon}from'../utils/iconHelpers';import{guardarCoordenadaCorregida}from'../services/apiService';import MapPopup from'./MapPopup';import'../styles/iconMarkersLayer.css';import{jsx as _jsx}from\"react/jsx-runtime\";const IconMarkersLayer=_ref=>{let{markers,markersForMercado=null,selectedRegion,baseCompData=[]}=_ref;const map=useMap();const markersRef=useRef({});const guerraMarkersRef=useRef({});const competenciaMarkersRef=useRef([]);const polylineRef=useRef([]);const[showingAssociated,setShowingAssociated]=useState(false);const[activeMercadoPbl,setActiveMercadoPbl]=useState(null);const[modoCorreccion,setModoCorreccion]=useState(null);// --- Helpers de UI (Draggable & Resize) ---\nconst makeDraggable=useCallback(popup=>{if(!map||!popup||!popup._container)return;try{const pos=map.latLngToLayerPoint(popup.getLatLng());L.DomUtil.setPosition(popup._wrapper.parentNode,pos);const draggable=new L.Draggable(popup._container,popup._wrapper);draggable.enable();}catch(error){console.error('Error draggable:',error);}},[map]);const crearGripEnWrapper=useCallback(popupContainer=>{const wrapper=popupContainer.querySelector('.leaflet-popup-content-wrapper');const content=popupContainer.querySelector('.leaflet-popup-content');if(!wrapper||!content)return;content===null||content===void 0?void 0:content.querySelectorAll('.popup-resize-grip').forEach(n=>n.remove());const handleWheel=e=>{e.preventDefault();const scrollSpeed=0.5;const scrollAmount=e.deltaY*scrollSpeed;content.scrollTop+=scrollAmount;};content.addEventListener('wheel',handleWheel,{passive:false});let grip=wrapper.querySelector('.popup-resize-grip');if(!grip){grip=document.createElement('div');grip.className='popup-resize-grip';wrapper.appendChild(grip);let isResizing=false;const startResize=e=>{isResizing=true;document.body.classList.add('is-resizing-popup');document.body.style.cursor='nwse-resize';document.body.style.userSelect='none';e.preventDefault();e.stopPropagation();};const doResize=e=>{if(!isResizing)return;const clientX=e.clientX||e.touches&&e.touches[0].clientX;const clientY=e.clientY||e.touches&&e.touches[0].clientY;const gripRect=grip.getBoundingClientRect();const gripCenterX=gripRect.left+gripRect.width/2;const gripCenterY=gripRect.top+gripRect.height/2;const deltaX=clientX-gripCenterX;const deltaY=clientY-gripCenterY;if(Math.abs(deltaX)>5||Math.abs(deltaY)>5){const currentRect=content.getBoundingClientRect();const newWidth=Math.max(240,currentRect.width+deltaX);const newHeight=Math.max(180,currentRect.height+deltaY);content.style.width=newWidth+'px';content.style.height=newHeight+'px';}e.preventDefault();};const stopResize=()=>{if(!isResizing)return;isResizing=false;document.body.classList.remove('is-resizing-popup');document.body.style.cursor='';document.body.style.userSelect='';};grip.addEventListener('mousedown',startResize);document.addEventListener('mousemove',doResize);document.addEventListener('mouseup',stopResize);grip.addEventListener('touchstart',startResize,{passive:false});document.addEventListener('touchmove',doResize,{passive:false});document.addEventListener('touchend',stopResize);const cleanup=()=>{content.removeEventListener('wheel',handleWheel);document.removeEventListener('mousemove',doResize);document.removeEventListener('mouseup',stopResize);document.removeEventListener('touchmove',doResize);document.removeEventListener('touchend',stopResize);document.body.classList.remove('is-resizing-popup');};grip._cleanup=cleanup;}},[]);// --- Helpers de limpieza ---\nconst clearCompetenciaMarkers=useCallback(()=>{competenciaMarkersRef.current.forEach(marker=>{try{if(map&&map.hasLayer(marker))map.removeLayer(marker);}catch(e){}});competenciaMarkersRef.current=[];},[map]);const clearPolylines=useCallback(()=>{polylineRef.current.forEach(line=>{try{if(map&&map.hasLayer(line))map.removeLayer(line);}catch(e){}});polylineRef.current=[];},[map]);const clearGuerraMarkers=useCallback(()=>{Object.values(guerraMarkersRef.current).forEach(marker=>{try{if(map&&map.hasLayer(marker))map.removeLayer(marker);}catch(e){}});guerraMarkersRef.current={};},[map]);// --- Handlers ---\nconst handleActivateCoords=useCallback(marker=>{if(modoCorreccion&&(modoCorreccion.id===marker.id||modoCorreccion.pbl===marker.pbl)){// Si ya está activo para este marcador, lo desactivamos (cancelar)\nsetModoCorreccion(null);if(map)map.getContainer().style.cursor='';return;}if(map)map.getContainer().style.cursor='crosshair';setModoCorreccion({pbl:marker.pbl,id:marker.id,eds:marker.eds,marca:marker.Marca,lat:null,lng:null});},[map,modoCorreccion]);const handleSaveCoords=useCallback(async marker=>{if(!modoCorreccion||!modoCorreccion.lat||!modoCorreccion.lng)return;try{const coordenada={id:marker.id||marker.pbl,pbl:marker.pbl||marker.id,eds:marker.eds||'',marca:marker.Marca||'',comuna:marker.Comuna||'',lat_corregida:modoCorreccion.lat,lon_corregida:modoCorreccion.lng};await guardarCoordenadaCorregida(coordenada);// Actualizar marcador localmente\nmarker.lat=modoCorreccion.lat;marker.lng=modoCorreccion.lng;// Resetear modo corrección\nsetModoCorreccion(null);if(map)map.getContainer().style.cursor='';// Re-renderizar marcadores (esto forzará un update del efecto principal)\n// Nota: En una app real, deberíamos actualizar el estado 'markers' en el padre\n// pero aquí simulamos el refresco limpiando y dejando que el efecto corra.\n// Para simplificar, forzamos un re-render limpiando refs (el efecto lo notará si markers cambia, \n// pero como mutamos el objeto, necesitamos forzar update o confiar en que el padre refresque).\n// Aquí asumimos que el padre refrescará o que el efecto de abajo se encargará si cambiamos algo.\n// Como mutamos 'marker', React no detecta cambio de prop 'markers' si es el mismo array.\n// ACTUALIZACIÓN OPTIMIZADA: No borrar todo. Solo mover el marcador.\nconst leafletMarker=markersRef.current[marker.id];if(leafletMarker){const newLatLng=new L.LatLng(modoCorreccion.lat,modoCorreccion.lng);leafletMarker.setLatLng(newLatLng);// Si el popup está abierto, Leaflet lo mueve con el marcador automáticamente.\n// Pero necesitamos actualizar el contenido del popup para que refleje que ya no estamos en modo corrección\n// y muestre las nuevas coordenadas fijas.\n// Esto se hace abajo con el re-render manual de popups.\n}// No borramos markersRef.current ni clearGuerraMarkers() para evitar parpadeo/cierre.\n// Solo limpiamos si fuera necesario por lógica de negocio estricta, pero el usuario quiere que se mantenga.\n// Disparamos un evento custom o callback si fuera necesario, \n// por ahora confiamos en que el usuario recargue o que el efecto se dispare si cambiamos algo de estado.\n// Un truco es setear un estado dummy para forzar re-render, pero mejor dejemos que el flujo siga.\n}catch(error){console.error(\"Error guardando coordenadas:\",error);}},[modoCorreccion,map,clearGuerraMarkers]);// --- Refs para romper ciclo de dependencias ---\nconst showAssociatedIdsRef=useRef(null);const handleActivateCoordsRef=useRef(handleActivateCoords);const handleSaveCoordsRef=useRef(handleSaveCoords);const modoCorreccionRef=useRef(modoCorreccion);useEffect(()=>{handleActivateCoordsRef.current=handleActivateCoords;handleSaveCoordsRef.current=handleSaveCoords;modoCorreccionRef.current=modoCorreccion;});// --- Lógica de Mercado (Show Associated) ---\nconst showAssociatedIds=useCallback((pbl,lat,lng,originalMarkerId)=>{const searchArray=markersForMercado&&markersForMercado.length>0?markersForMercado:markers;if(showingAssociated&&activeMercadoPbl===pbl){// Toggle OFF\nclearCompetenciaMarkers();clearPolylines();setShowingAssociated(false);setActiveMercadoPbl(null);// Restaurar marcadores originales\nObject.values(markersRef.current).forEach(marker=>{try{if(map&&map.hasLayer(marker))map.removeLayer(marker);}catch(e){}});markersRef.current={};// Re-crear todos\nmarkers.forEach(marker=>{const leafletMarker=createMarkerWithPopup(marker,markersForMercado||markers,'primary');if(leafletMarker){map.addLayer(leafletMarker);markersRef.current[marker.id]=leafletMarker;addGuerraMarker(marker);}});return;}// Toggle ON (o cambio de PBL)\nclearCompetenciaMarkers();clearPolylines();const associatedData=baseCompData.filter(item=>String(item.pbl).trim()===String(pbl).trim());if(associatedData.length===0)return;const ids=associatedData.map(item=>item.id);// Limpiar actuales\nObject.values(markersRef.current).forEach(marker=>{try{if(map&&map.hasLayer(marker))map.removeLayer(marker);}catch(e){}});markersRef.current={};clearGuerraMarkers();// Mostrar original\nconst originalMarker=markers.find(m=>m.id===originalMarkerId);if(originalMarker){const leafletMarker=createMarkerWithPopup(originalMarker,markersForMercado||markers,'primary');if(leafletMarker){map.addLayer(leafletMarker);markersRef.current[originalMarker.id]=leafletMarker;addGuerraMarker(originalMarker);}}// Mostrar competencia\nconst associatedMarkers=searchArray.filter(item=>ids.includes(item.id));const uniqueAssociatedMarkers=[];const seenIds=new Set();associatedMarkers.forEach(marker=>{if(!seenIds.has(marker.id)){seenIds.add(marker.id);uniqueAssociatedMarkers.push(marker);}});uniqueAssociatedMarkers.forEach(marker=>{const leafletMarker=createMarkerWithPopup(marker,markersForMercado||baseCompData,'secondary');if(leafletMarker){map.addLayer(leafletMarker);competenciaMarkersRef.current.push(leafletMarker);if(marker.Guerra_Precio==='Si'){// Guerra marker logic for secondary\nconst guerraIcon=L.icon({iconUrl:\"\".concat(process.env.PUBLIC_URL,\"/iconos/calavera.jpg\"),iconSize:[15,15],iconAnchor:[7.5,7.5],className:'icono-guerra'});const guerraMarker=L.marker([marker.lat,marker.lng],{icon:guerraIcon,interactive:false});map.addLayer(guerraMarker);// No lo guardamos en ref global para no borrarlo accidentalmente con clearGuerraMarkers si solo queremos borrar los principales, \n// aunque aquí borramos todo al cambiar de vista.\n// Para simplificar, los agregamos a competenciaMarkersRef si queremos limpiarlos con eso, o los dejamos sueltos (pero hay que limpiarlos).\n// Mejor los metemos en competenciaMarkersRef también (aunque sean markers distintos).\ncompetenciaMarkersRef.current.push(guerraMarker);}}});// Polylines\nconst mainMarkersData=associatedData.filter(m=>m.Marcador_Principal==='Si');mainMarkersData.forEach(mainMarker=>{const markerWithCoords=searchArray.find(m=>m.id===mainMarker.id);if(!markerWithCoords)return;const mainLat=parseFloat(markerWithCoords.lat);const mainLng=parseFloat(markerWithCoords.lng);if(isNaN(mainLat)||isNaN(mainLng))return;const polyline=L.polyline([[parseFloat(lat),parseFloat(lng)],[mainLat,mainLng]],{color:'#FF6B6B',weight:3,opacity:0.8,dashArray:'5, 5'}).addTo(map);polylineRef.current.push(polyline);});setShowingAssociated(true);setActiveMercadoPbl(pbl);},[baseCompData,markers,markersForMercado,map,showingAssociated,activeMercadoPbl,clearCompetenciaMarkers,clearPolylines,clearGuerraMarkers]);useEffect(()=>{showAssociatedIdsRef.current=showAssociatedIds;},[showAssociatedIds]);// Helper para Guerra Marker\nconst addGuerraMarker=marker=>{if(marker.Guerra_Precio==='Si'){const guerraIcon=L.icon({iconUrl:\"\".concat(process.env.PUBLIC_URL,\"/iconos/calavera.jpg\"),iconSize:[15,15],iconAnchor:[7.5,7.5],className:'icono-guerra'});const guerraMarker=L.marker([marker.lat,marker.lng],{icon:guerraIcon,interactive:false});map.addLayer(guerraMarker);guerraMarkersRef.current[marker.id]=guerraMarker;}};// --- Crear Marcador con Popup React ---\nconst createMarkerWithPopup=useCallback(function(marker,allMarkers){let variant=arguments.length>2&&arguments[2]!==undefined?arguments[2]:'primary';const lat=parseFloat(marker.lat);const lng=parseFloat(marker.lng);if(isNaN(lat)||isNaN(lng))return null;const iconUrl=createCustomIcon(marker.Marca);const leafletMarker=L.marker([lat,lng],{icon:iconUrl});// Popup vacío inicial\nconst popup=L.popup({autoClose:false,closeOnClick:false,keepInView:true,autoPan:false,maxWidth:450,className:'custom-popup'}).setContent('<div id=\"popup-root-'+marker.id+'\"></div>');leafletMarker.bindPopup(popup);leafletMarker.on('popupopen',e=>{makeDraggable(popup);const container=e.popup._contentNode;const wrapperContainer=e.popup._container;if(wrapperContainer){crearGripEnWrapper(wrapperContainer);}setTimeout(()=>{const rootDiv=document.getElementById('popup-root-'+marker.id);if(rootDiv&&!rootDiv._reactRoot){const root=ReactDOM.createRoot(rootDiv);rootDiv._reactRoot=root;root.render(/*#__PURE__*/_jsx(MapPopup,{marker:marker,allMarkers:allMarkers,onShowAssociated:function(){return showAssociatedIdsRef.current&&showAssociatedIdsRef.current(...arguments);},onActivateCoords:function(){return handleActivateCoordsRef.current&&handleActivateCoordsRef.current(...arguments);},onSaveCoords:function(){return handleSaveCoordsRef.current&&handleSaveCoordsRef.current(...arguments);},modoCorreccion:modoCorreccionRef.current,variant:variant}));}},0);});leafletMarker.on('popupclose',e=>{var _e$popup;const container=(_e$popup=e.popup)===null||_e$popup===void 0?void 0:_e$popup._container;if(container){const wrapper=container.querySelector('.leaflet-popup-content-wrapper');const grip=wrapper===null||wrapper===void 0?void 0:wrapper.querySelector('.popup-resize-grip');if(grip&&grip._cleanup){grip._cleanup();}}const rootDiv=document.getElementById('popup-root-'+marker.id);if(rootDiv&&rootDiv._reactRoot){setTimeout(()=>{if(rootDiv._reactRoot){rootDiv._reactRoot.unmount();rootDiv._reactRoot=null;}},0);}});return leafletMarker;},[makeDraggable,crearGripEnWrapper]);// --- Efecto Principal de Renderizado ---\nuseEffect(()=>{if(!map||!markers||markers.length===0)return;// Si estamos mostrando asociados, no refrescamos todo (a menos que cambien los filtros drásticamente, \n// pero aquí asumimos que si 'markers' cambia, reseteamos vista).\n// Para simplificar: si markers cambia, reseteamos todo.\nclearCompetenciaMarkers();clearPolylines();setShowingAssociated(false);setActiveMercadoPbl(null);Object.values(markersRef.current).forEach(marker=>{try{if(map&&map.hasLayer(marker))map.removeLayer(marker);}catch(e){}});markersRef.current={};clearGuerraMarkers();markers.forEach(marker=>{const leafletMarker=createMarkerWithPopup(marker,markersForMercado||markers,'primary');if(leafletMarker){map.addLayer(leafletMarker);markersRef.current[marker.id]=leafletMarker;addGuerraMarker(marker);}});if(markers.length===1&&markersRef.current[markers[0].id]){markersRef.current[markers[0].id].openPopup();}},[map,markers,markersForMercado,selectedRegion,clearCompetenciaMarkers,clearPolylines,clearGuerraMarkers,createMarkerWithPopup]);// --- Efecto para Click en Mapa (Corrección Coordenadas) ---\nuseEffect(()=>{if(!map||!modoCorreccion)return;const handleMapClick=e=>{const{lat,lng}=e.latlng;setModoCorreccion(prev=>_objectSpread(_objectSpread({},prev),{},{lat,lng}));};map.on('click',handleMapClick);return()=>{map.off('click',handleMapClick);};},[map,modoCorreccion]);// --- Efecto para Actualizar Popups cuando cambia modoCorreccion ---\nuseEffect(()=>{if(!map)return;// Iterar sobre los popups abiertos y re-renderizarlos con el nuevo estado\nmap.eachLayer(layer=>{if(layer.getPopup&&layer.getPopup()&&layer.getPopup().isOpen()){const markerId=Object.keys(markersRef.current).find(key=>markersRef.current[key]===layer);if(markerId){const marker=markers.find(m=>m.id===markerId)||(markersForMercado||[]).find(m=>m.id===markerId);if(marker){const rootDiv=document.getElementById('popup-root-'+marker.id);if(rootDiv&&rootDiv._reactRoot){rootDiv._reactRoot.render(/*#__PURE__*/_jsx(MapPopup,{marker:marker,allMarkers:markersForMercado||markers,onShowAssociated:function(){return showAssociatedIdsRef.current&&showAssociatedIdsRef.current(...arguments);},onActivateCoords:function(){return handleActivateCoordsRef.current&&handleActivateCoordsRef.current(...arguments);},onSaveCoords:function(){return handleSaveCoordsRef.current&&handleSaveCoordsRef.current(...arguments);},modoCorreccion:modoCorreccion// Usamos el valor actual del estado\n,variant:markersForMercado&&markersForMercado.includes(marker)?'secondary':'primary'}));}}}}});},[modoCorreccion,map,markers,markersForMercado]);return null;};export default IconMarkersLayer;","map":{"version":3,"names":["React","useEffect","useRef","useState","useCallback","useMap","L","ReactDOM","createCustomIcon","guardarCoordenadaCorregida","MapPopup","jsx","_jsx","IconMarkersLayer","_ref","markers","markersForMercado","selectedRegion","baseCompData","map","markersRef","guerraMarkersRef","competenciaMarkersRef","polylineRef","showingAssociated","setShowingAssociated","activeMercadoPbl","setActiveMercadoPbl","modoCorreccion","setModoCorreccion","makeDraggable","popup","_container","pos","latLngToLayerPoint","getLatLng","DomUtil","setPosition","_wrapper","parentNode","draggable","Draggable","enable","error","console","crearGripEnWrapper","popupContainer","wrapper","querySelector","content","querySelectorAll","forEach","n","remove","handleWheel","e","preventDefault","scrollSpeed","scrollAmount","deltaY","scrollTop","addEventListener","passive","grip","document","createElement","className","appendChild","isResizing","startResize","body","classList","add","style","cursor","userSelect","stopPropagation","doResize","clientX","touches","clientY","gripRect","getBoundingClientRect","gripCenterX","left","width","gripCenterY","top","height","deltaX","Math","abs","currentRect","newWidth","max","newHeight","stopResize","cleanup","removeEventListener","_cleanup","clearCompetenciaMarkers","current","marker","hasLayer","removeLayer","clearPolylines","line","clearGuerraMarkers","Object","values","handleActivateCoords","id","pbl","getContainer","eds","marca","Marca","lat","lng","handleSaveCoords","coordenada","comuna","Comuna","lat_corregida","lon_corregida","leafletMarker","newLatLng","LatLng","setLatLng","showAssociatedIdsRef","handleActivateCoordsRef","handleSaveCoordsRef","modoCorreccionRef","showAssociatedIds","originalMarkerId","searchArray","length","createMarkerWithPopup","addLayer","addGuerraMarker","associatedData","filter","item","String","trim","ids","originalMarker","find","m","associatedMarkers","includes","uniqueAssociatedMarkers","seenIds","Set","has","push","Guerra_Precio","guerraIcon","icon","iconUrl","concat","process","env","PUBLIC_URL","iconSize","iconAnchor","guerraMarker","interactive","mainMarkersData","Marcador_Principal","mainMarker","markerWithCoords","mainLat","parseFloat","mainLng","isNaN","polyline","color","weight","opacity","dashArray","addTo","allMarkers","variant","arguments","undefined","autoClose","closeOnClick","keepInView","autoPan","maxWidth","setContent","bindPopup","on","container","_contentNode","wrapperContainer","setTimeout","rootDiv","getElementById","_reactRoot","root","createRoot","render","onShowAssociated","onActivateCoords","onSaveCoords","_e$popup","unmount","openPopup","handleMapClick","latlng","prev","_objectSpread","off","eachLayer","layer","getPopup","isOpen","markerId","keys","key"],"sources":["C:/Users/e08f/Desktop/Proyectos/Resumen/mapa-v2/src/components/IconMarkersLayer.jsx"],"sourcesContent":["import React, { useEffect, useRef, useState, useCallback } from 'react';\r\nimport { useMap } from 'react-leaflet';\r\nimport L from 'leaflet';\r\nimport ReactDOM from 'react-dom/client';\r\nimport { createCustomIcon } from '../utils/iconHelpers';\r\nimport { guardarCoordenadaCorregida } from '../services/apiService';\r\nimport MapPopup from './MapPopup';\r\nimport '../styles/iconMarkersLayer.css';\r\n\r\nconst IconMarkersLayer = ({ markers, markersForMercado = null, selectedRegion, baseCompData = [] }) => {\r\n  const map = useMap();\r\n  const markersRef = useRef({});\r\n  const guerraMarkersRef = useRef({});\r\n  const competenciaMarkersRef = useRef([]);\r\n  const polylineRef = useRef([]);\r\n\r\n  const [showingAssociated, setShowingAssociated] = useState(false);\r\n  const [activeMercadoPbl, setActiveMercadoPbl] = useState(null);\r\n  const [modoCorreccion, setModoCorreccion] = useState(null);\r\n\r\n  // --- Helpers de UI (Draggable & Resize) ---\r\n  const makeDraggable = useCallback((popup) => {\r\n    if (!map || !popup || !popup._container) return;\r\n    try {\r\n      const pos = map.latLngToLayerPoint(popup.getLatLng());\r\n      L.DomUtil.setPosition(popup._wrapper.parentNode, pos);\r\n      const draggable = new L.Draggable(popup._container, popup._wrapper);\r\n      draggable.enable();\r\n    } catch (error) {\r\n      console.error('Error draggable:', error);\r\n    }\r\n  }, [map]);\r\n\r\n  const crearGripEnWrapper = useCallback((popupContainer) => {\r\n    const wrapper = popupContainer.querySelector('.leaflet-popup-content-wrapper');\r\n    const content = popupContainer.querySelector('.leaflet-popup-content');\r\n    if (!wrapper || !content) return;\r\n\r\n    content?.querySelectorAll('.popup-resize-grip').forEach(n => n.remove());\r\n\r\n    const handleWheel = (e) => {\r\n      e.preventDefault();\r\n      const scrollSpeed = 0.5;\r\n      const scrollAmount = e.deltaY * scrollSpeed;\r\n      content.scrollTop += scrollAmount;\r\n    };\r\n\r\n    content.addEventListener('wheel', handleWheel, { passive: false });\r\n\r\n    let grip = wrapper.querySelector('.popup-resize-grip');\r\n    if (!grip) {\r\n      grip = document.createElement('div');\r\n      grip.className = 'popup-resize-grip';\r\n      wrapper.appendChild(grip);\r\n\r\n      let isResizing = false;\r\n\r\n      const startResize = (e) => {\r\n        isResizing = true;\r\n        document.body.classList.add('is-resizing-popup');\r\n        document.body.style.cursor = 'nwse-resize';\r\n        document.body.style.userSelect = 'none';\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n      };\r\n\r\n      const doResize = (e) => {\r\n        if (!isResizing) return;\r\n\r\n        const clientX = e.clientX || (e.touches && e.touches[0].clientX);\r\n        const clientY = e.clientY || (e.touches && e.touches[0].clientY);\r\n\r\n        const gripRect = grip.getBoundingClientRect();\r\n        const gripCenterX = gripRect.left + gripRect.width / 2;\r\n        const gripCenterY = gripRect.top + gripRect.height / 2;\r\n\r\n        const deltaX = clientX - gripCenterX;\r\n        const deltaY = clientY - gripCenterY;\r\n\r\n        if (Math.abs(deltaX) > 5 || Math.abs(deltaY) > 5) {\r\n          const currentRect = content.getBoundingClientRect();\r\n          const newWidth = Math.max(240, currentRect.width + deltaX);\r\n          const newHeight = Math.max(180, currentRect.height + deltaY);\r\n\r\n          content.style.width = newWidth + 'px';\r\n          content.style.height = newHeight + 'px';\r\n        }\r\n\r\n        e.preventDefault();\r\n      };\r\n\r\n      const stopResize = () => {\r\n        if (!isResizing) return;\r\n        isResizing = false;\r\n        document.body.classList.remove('is-resizing-popup');\r\n        document.body.style.cursor = '';\r\n        document.body.style.userSelect = '';\r\n      };\r\n\r\n      grip.addEventListener('mousedown', startResize);\r\n      document.addEventListener('mousemove', doResize);\r\n      document.addEventListener('mouseup', stopResize);\r\n\r\n      grip.addEventListener('touchstart', startResize, { passive: false });\r\n      document.addEventListener('touchmove', doResize, { passive: false });\r\n      document.addEventListener('touchend', stopResize);\r\n\r\n      const cleanup = () => {\r\n        content.removeEventListener('wheel', handleWheel);\r\n        document.removeEventListener('mousemove', doResize);\r\n        document.removeEventListener('mouseup', stopResize);\r\n        document.removeEventListener('touchmove', doResize);\r\n        document.removeEventListener('touchend', stopResize);\r\n        document.body.classList.remove('is-resizing-popup');\r\n      };\r\n\r\n      grip._cleanup = cleanup;\r\n    }\r\n  }, []);\r\n\r\n  // --- Helpers de limpieza ---\r\n  const clearCompetenciaMarkers = useCallback(() => {\r\n    competenciaMarkersRef.current.forEach(marker => {\r\n      try { if (map && map.hasLayer(marker)) map.removeLayer(marker); } catch (e) { }\r\n    });\r\n    competenciaMarkersRef.current = [];\r\n  }, [map]);\r\n\r\n  const clearPolylines = useCallback(() => {\r\n    polylineRef.current.forEach(line => {\r\n      try { if (map && map.hasLayer(line)) map.removeLayer(line); } catch (e) { }\r\n    });\r\n    polylineRef.current = [];\r\n  }, [map]);\r\n\r\n  const clearGuerraMarkers = useCallback(() => {\r\n    Object.values(guerraMarkersRef.current).forEach(marker => {\r\n      try { if (map && map.hasLayer(marker)) map.removeLayer(marker); } catch (e) { }\r\n    });\r\n    guerraMarkersRef.current = {};\r\n  }, [map]);\r\n\r\n  // --- Handlers ---\r\n  const handleActivateCoords = useCallback((marker) => {\r\n    if (modoCorreccion && (modoCorreccion.id === marker.id || modoCorreccion.pbl === marker.pbl)) {\r\n      // Si ya está activo para este marcador, lo desactivamos (cancelar)\r\n      setModoCorreccion(null);\r\n      if (map) map.getContainer().style.cursor = '';\r\n      return;\r\n    }\r\n\r\n    if (map) map.getContainer().style.cursor = 'crosshair';\r\n    setModoCorreccion({\r\n      pbl: marker.pbl,\r\n      id: marker.id,\r\n      eds: marker.eds,\r\n      marca: marker.Marca,\r\n      lat: null,\r\n      lng: null\r\n    });\r\n  }, [map, modoCorreccion]);\r\n\r\n  const handleSaveCoords = useCallback(async (marker) => {\r\n    if (!modoCorreccion || !modoCorreccion.lat || !modoCorreccion.lng) return;\r\n\r\n    try {\r\n      const coordenada = {\r\n        id: marker.id || marker.pbl,\r\n        pbl: marker.pbl || marker.id,\r\n        eds: marker.eds || '',\r\n        marca: marker.Marca || '',\r\n        comuna: marker.Comuna || '',\r\n        lat_corregida: modoCorreccion.lat,\r\n        lon_corregida: modoCorreccion.lng\r\n      };\r\n      await guardarCoordenadaCorregida(coordenada);\r\n\r\n      // Actualizar marcador localmente\r\n      marker.lat = modoCorreccion.lat;\r\n      marker.lng = modoCorreccion.lng;\r\n\r\n      // Resetear modo corrección\r\n      setModoCorreccion(null);\r\n      if (map) map.getContainer().style.cursor = '';\r\n\r\n      // Re-renderizar marcadores (esto forzará un update del efecto principal)\r\n      // Nota: En una app real, deberíamos actualizar el estado 'markers' en el padre\r\n      // pero aquí simulamos el refresco limpiando y dejando que el efecto corra.\r\n      // Para simplificar, forzamos un re-render limpiando refs (el efecto lo notará si markers cambia, \r\n      // pero como mutamos el objeto, necesitamos forzar update o confiar en que el padre refresque).\r\n      // Aquí asumimos que el padre refrescará o que el efecto de abajo se encargará si cambiamos algo.\r\n      // Como mutamos 'marker', React no detecta cambio de prop 'markers' si es el mismo array.\r\n\r\n      // ACTUALIZACIÓN OPTIMIZADA: No borrar todo. Solo mover el marcador.\r\n      const leafletMarker = markersRef.current[marker.id];\r\n      if (leafletMarker) {\r\n        const newLatLng = new L.LatLng(modoCorreccion.lat, modoCorreccion.lng);\r\n        leafletMarker.setLatLng(newLatLng);\r\n\r\n        // Si el popup está abierto, Leaflet lo mueve con el marcador automáticamente.\r\n        // Pero necesitamos actualizar el contenido del popup para que refleje que ya no estamos en modo corrección\r\n        // y muestre las nuevas coordenadas fijas.\r\n        // Esto se hace abajo con el re-render manual de popups.\r\n      }\r\n\r\n      // No borramos markersRef.current ni clearGuerraMarkers() para evitar parpadeo/cierre.\r\n      // Solo limpiamos si fuera necesario por lógica de negocio estricta, pero el usuario quiere que se mantenga.\r\n\r\n      // Disparamos un evento custom o callback si fuera necesario, \r\n      // por ahora confiamos en que el usuario recargue o que el efecto se dispare si cambiamos algo de estado.\r\n      // Un truco es setear un estado dummy para forzar re-render, pero mejor dejemos que el flujo siga.\r\n\r\n    } catch (error) {\r\n      console.error(\"Error guardando coordenadas:\", error);\r\n    }\r\n  }, [modoCorreccion, map, clearGuerraMarkers]);\r\n\r\n  // --- Refs para romper ciclo de dependencias ---\r\n  const showAssociatedIdsRef = useRef(null);\r\n  const handleActivateCoordsRef = useRef(handleActivateCoords);\r\n  const handleSaveCoordsRef = useRef(handleSaveCoords);\r\n  const modoCorreccionRef = useRef(modoCorreccion);\r\n\r\n  useEffect(() => {\r\n    handleActivateCoordsRef.current = handleActivateCoords;\r\n    handleSaveCoordsRef.current = handleSaveCoords;\r\n    modoCorreccionRef.current = modoCorreccion;\r\n  });\r\n\r\n\r\n  // --- Lógica de Mercado (Show Associated) ---\r\n  const showAssociatedIds = useCallback((pbl, lat, lng, originalMarkerId) => {\r\n    const searchArray = markersForMercado && markersForMercado.length > 0 ? markersForMercado : markers;\r\n\r\n    if (showingAssociated && activeMercadoPbl === pbl) {\r\n      // Toggle OFF\r\n      clearCompetenciaMarkers();\r\n      clearPolylines();\r\n      setShowingAssociated(false);\r\n      setActiveMercadoPbl(null);\r\n\r\n      // Restaurar marcadores originales\r\n      Object.values(markersRef.current).forEach(marker => {\r\n        try { if (map && map.hasLayer(marker)) map.removeLayer(marker); } catch (e) { }\r\n      });\r\n      markersRef.current = {};\r\n\r\n      // Re-crear todos\r\n      markers.forEach(marker => {\r\n        const leafletMarker = createMarkerWithPopup(marker, markersForMercado || markers, 'primary');\r\n        if (leafletMarker) {\r\n          map.addLayer(leafletMarker);\r\n          markersRef.current[marker.id] = leafletMarker;\r\n          addGuerraMarker(marker);\r\n        }\r\n      });\r\n      return;\r\n    }\r\n\r\n    // Toggle ON (o cambio de PBL)\r\n    clearCompetenciaMarkers();\r\n    clearPolylines();\r\n\r\n    const associatedData = baseCompData.filter(item => String(item.pbl).trim() === String(pbl).trim());\r\n    if (associatedData.length === 0) return;\r\n\r\n    const ids = associatedData.map(item => item.id);\r\n\r\n    // Limpiar actuales\r\n    Object.values(markersRef.current).forEach(marker => {\r\n      try { if (map && map.hasLayer(marker)) map.removeLayer(marker); } catch (e) { }\r\n    });\r\n    markersRef.current = {};\r\n    clearGuerraMarkers();\r\n\r\n    // Mostrar original\r\n    const originalMarker = markers.find(m => m.id === originalMarkerId);\r\n    if (originalMarker) {\r\n      const leafletMarker = createMarkerWithPopup(originalMarker, markersForMercado || markers, 'primary');\r\n      if (leafletMarker) {\r\n        map.addLayer(leafletMarker);\r\n        markersRef.current[originalMarker.id] = leafletMarker;\r\n        addGuerraMarker(originalMarker);\r\n      }\r\n    }\r\n\r\n    // Mostrar competencia\r\n    const associatedMarkers = searchArray.filter(item => ids.includes(item.id));\r\n    const uniqueAssociatedMarkers = [];\r\n    const seenIds = new Set();\r\n    associatedMarkers.forEach(marker => {\r\n      if (!seenIds.has(marker.id)) {\r\n        seenIds.add(marker.id);\r\n        uniqueAssociatedMarkers.push(marker);\r\n      }\r\n    });\r\n\r\n    uniqueAssociatedMarkers.forEach(marker => {\r\n      const leafletMarker = createMarkerWithPopup(marker, markersForMercado || baseCompData, 'secondary');\r\n      if (leafletMarker) {\r\n        map.addLayer(leafletMarker);\r\n        competenciaMarkersRef.current.push(leafletMarker);\r\n        if (marker.Guerra_Precio === 'Si') {\r\n          // Guerra marker logic for secondary\r\n          const guerraIcon = L.icon({\r\n            iconUrl: `${process.env.PUBLIC_URL}/iconos/calavera.jpg`,\r\n            iconSize: [15, 15],\r\n            iconAnchor: [7.5, 7.5],\r\n            className: 'icono-guerra'\r\n          });\r\n          const guerraMarker = L.marker([marker.lat, marker.lng], { icon: guerraIcon, interactive: false });\r\n          map.addLayer(guerraMarker);\r\n          // No lo guardamos en ref global para no borrarlo accidentalmente con clearGuerraMarkers si solo queremos borrar los principales, \r\n          // aunque aquí borramos todo al cambiar de vista.\r\n          // Para simplificar, los agregamos a competenciaMarkersRef si queremos limpiarlos con eso, o los dejamos sueltos (pero hay que limpiarlos).\r\n          // Mejor los metemos en competenciaMarkersRef también (aunque sean markers distintos).\r\n          competenciaMarkersRef.current.push(guerraMarker);\r\n        }\r\n      }\r\n    });\r\n\r\n    // Polylines\r\n    const mainMarkersData = associatedData.filter(m => m.Marcador_Principal === 'Si');\r\n    mainMarkersData.forEach(mainMarker => {\r\n      const markerWithCoords = searchArray.find(m => m.id === mainMarker.id);\r\n      if (!markerWithCoords) return;\r\n      const mainLat = parseFloat(markerWithCoords.lat);\r\n      const mainLng = parseFloat(markerWithCoords.lng);\r\n      if (isNaN(mainLat) || isNaN(mainLng)) return;\r\n\r\n      const polyline = L.polyline(\r\n        [[parseFloat(lat), parseFloat(lng)], [mainLat, mainLng]],\r\n        { color: '#FF6B6B', weight: 3, opacity: 0.8, dashArray: '5, 5' }\r\n      ).addTo(map);\r\n      polylineRef.current.push(polyline);\r\n    });\r\n\r\n    setShowingAssociated(true);\r\n    setActiveMercadoPbl(pbl);\r\n\r\n  }, [baseCompData, markers, markersForMercado, map, showingAssociated, activeMercadoPbl, clearCompetenciaMarkers, clearPolylines, clearGuerraMarkers]);\r\n\r\n  useEffect(() => {\r\n    showAssociatedIdsRef.current = showAssociatedIds;\r\n  }, [showAssociatedIds]);\r\n\r\n  // Helper para Guerra Marker\r\n  const addGuerraMarker = (marker) => {\r\n    if (marker.Guerra_Precio === 'Si') {\r\n      const guerraIcon = L.icon({\r\n        iconUrl: `${process.env.PUBLIC_URL}/iconos/calavera.jpg`,\r\n        iconSize: [15, 15],\r\n        iconAnchor: [7.5, 7.5],\r\n        className: 'icono-guerra'\r\n      });\r\n      const guerraMarker = L.marker([marker.lat, marker.lng], { icon: guerraIcon, interactive: false });\r\n      map.addLayer(guerraMarker);\r\n      guerraMarkersRef.current[marker.id] = guerraMarker;\r\n    }\r\n  };\r\n\r\n  // --- Crear Marcador con Popup React ---\r\n  const createMarkerWithPopup = useCallback((marker, allMarkers, variant = 'primary') => {\r\n    const lat = parseFloat(marker.lat);\r\n    const lng = parseFloat(marker.lng);\r\n    if (isNaN(lat) || isNaN(lng)) return null;\r\n\r\n    const iconUrl = createCustomIcon(marker.Marca);\r\n    const leafletMarker = L.marker([lat, lng], { icon: iconUrl });\r\n\r\n    // Popup vacío inicial\r\n    const popup = L.popup({\r\n      autoClose: false,\r\n      closeOnClick: false,\r\n      keepInView: true,\r\n      autoPan: false,\r\n      maxWidth: 450,\r\n      className: 'custom-popup'\r\n    }).setContent('<div id=\"popup-root-' + marker.id + '\"></div>');\r\n\r\n    leafletMarker.bindPopup(popup);\r\n\r\n    leafletMarker.on('popupopen', (e) => {\r\n      makeDraggable(popup);\r\n      const container = e.popup._contentNode;\r\n      const wrapperContainer = e.popup._container;\r\n      if (wrapperContainer) {\r\n        crearGripEnWrapper(wrapperContainer);\r\n      }\r\n\r\n      setTimeout(() => {\r\n        const rootDiv = document.getElementById('popup-root-' + marker.id);\r\n        if (rootDiv && !rootDiv._reactRoot) {\r\n          const root = ReactDOM.createRoot(rootDiv);\r\n          rootDiv._reactRoot = root;\r\n          root.render(\r\n            <MapPopup\r\n              marker={marker}\r\n              allMarkers={allMarkers}\r\n              onShowAssociated={(...args) => showAssociatedIdsRef.current && showAssociatedIdsRef.current(...args)}\r\n              onActivateCoords={(...args) => handleActivateCoordsRef.current && handleActivateCoordsRef.current(...args)}\r\n              onSaveCoords={(...args) => handleSaveCoordsRef.current && handleSaveCoordsRef.current(...args)}\r\n              modoCorreccion={modoCorreccionRef.current}\r\n              variant={variant}\r\n            />\r\n          );\r\n        }\r\n      }, 0);\r\n    });\r\n\r\n    leafletMarker.on('popupclose', (e) => {\r\n      const container = e.popup?._container;\r\n      if (container) {\r\n        const wrapper = container.querySelector('.leaflet-popup-content-wrapper');\r\n        const grip = wrapper?.querySelector('.popup-resize-grip');\r\n        if (grip && grip._cleanup) {\r\n          grip._cleanup();\r\n        }\r\n      }\r\n\r\n      const rootDiv = document.getElementById('popup-root-' + marker.id);\r\n      if (rootDiv && rootDiv._reactRoot) {\r\n        setTimeout(() => {\r\n          if (rootDiv._reactRoot) {\r\n            rootDiv._reactRoot.unmount();\r\n            rootDiv._reactRoot = null;\r\n          }\r\n        }, 0);\r\n      }\r\n    });\r\n\r\n    return leafletMarker;\r\n  }, [makeDraggable, crearGripEnWrapper]);\r\n\r\n\r\n  // --- Efecto Principal de Renderizado ---\r\n  useEffect(() => {\r\n    if (!map || !markers || markers.length === 0) return;\r\n\r\n    // Si estamos mostrando asociados, no refrescamos todo (a menos que cambien los filtros drásticamente, \r\n    // pero aquí asumimos que si 'markers' cambia, reseteamos vista).\r\n    // Para simplificar: si markers cambia, reseteamos todo.\r\n\r\n    clearCompetenciaMarkers();\r\n    clearPolylines();\r\n    setShowingAssociated(false);\r\n    setActiveMercadoPbl(null);\r\n\r\n    Object.values(markersRef.current).forEach(marker => {\r\n      try { if (map && map.hasLayer(marker)) map.removeLayer(marker); } catch (e) { }\r\n    });\r\n    markersRef.current = {};\r\n    clearGuerraMarkers();\r\n\r\n    markers.forEach(marker => {\r\n      const leafletMarker = createMarkerWithPopup(\r\n        marker,\r\n        markersForMercado || markers,\r\n        'primary'\r\n      );\r\n      if (leafletMarker) {\r\n        map.addLayer(leafletMarker);\r\n        markersRef.current[marker.id] = leafletMarker;\r\n        addGuerraMarker(marker);\r\n      }\r\n    });\r\n\r\n    if (markers.length === 1 && markersRef.current[markers[0].id]) {\r\n      markersRef.current[markers[0].id].openPopup();\r\n    }\r\n\r\n  }, [map, markers, markersForMercado, selectedRegion, clearCompetenciaMarkers, clearPolylines, clearGuerraMarkers, createMarkerWithPopup]);\r\n\r\n\r\n  // --- Efecto para Click en Mapa (Corrección Coordenadas) ---\r\n  useEffect(() => {\r\n    if (!map || !modoCorreccion) return;\r\n\r\n    const handleMapClick = (e) => {\r\n      const { lat, lng } = e.latlng;\r\n      setModoCorreccion(prev => ({ ...prev, lat, lng }));\r\n    };\r\n\r\n    map.on('click', handleMapClick);\r\n    return () => { map.off('click', handleMapClick); };\r\n  }, [map, modoCorreccion]);\r\n\r\n  // --- Efecto para Actualizar Popups cuando cambia modoCorreccion ---\r\n  useEffect(() => {\r\n    if (!map) return;\r\n\r\n    // Iterar sobre los popups abiertos y re-renderizarlos con el nuevo estado\r\n    map.eachLayer(layer => {\r\n      if (layer.getPopup && layer.getPopup() && layer.getPopup().isOpen()) {\r\n        const markerId = Object.keys(markersRef.current).find(key => markersRef.current[key] === layer);\r\n        if (markerId) {\r\n          const marker = markers.find(m => m.id === markerId) || (markersForMercado || []).find(m => m.id === markerId);\r\n          if (marker) {\r\n            const rootDiv = document.getElementById('popup-root-' + marker.id);\r\n            if (rootDiv && rootDiv._reactRoot) {\r\n              rootDiv._reactRoot.render(\r\n                <MapPopup\r\n                  marker={marker}\r\n                  allMarkers={markersForMercado || markers}\r\n                  onShowAssociated={(...args) => showAssociatedIdsRef.current && showAssociatedIdsRef.current(...args)}\r\n                  onActivateCoords={(...args) => handleActivateCoordsRef.current && handleActivateCoordsRef.current(...args)}\r\n                  onSaveCoords={(...args) => handleSaveCoordsRef.current && handleSaveCoordsRef.current(...args)}\r\n                  modoCorreccion={modoCorreccion} // Usamos el valor actual del estado\r\n                  variant={markersForMercado && markersForMercado.includes(marker) ? 'secondary' : 'primary'}\r\n                />\r\n              );\r\n            }\r\n          }\r\n        }\r\n      }\r\n    });\r\n  }, [modoCorreccion, map, markers, markersForMercado]);\r\n\r\n\r\n  return null;\r\n};\r\n\r\nexport default IconMarkersLayer;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}