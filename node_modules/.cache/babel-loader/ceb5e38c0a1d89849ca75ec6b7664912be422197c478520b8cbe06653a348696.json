{"ast":null,"code":"var _s = $RefreshSig$();\nimport React, { useEffect, useRef, useState } from 'react';\nimport { useMap } from 'react-leaflet';\nimport L from 'leaflet';\nimport { createCustomIcon, createBrandLogo } from '../utils/iconHelpers';\nimport { getDataBaseComp } from '../utils/apiService';\nconst IconMarkersLayer = ({\n  markers,\n  selectedRegion\n}) => {\n  _s();\n  const map = useMap();\n  const markersRef = useRef({});\n  const competenciaMarkersRef = useRef({});\n  const updateInProgressRef = useRef(false);\n  const [baseCompData, setBaseCompData] = useState([]);\n  const [showingCompetencia, setShowingCompetencia] = useState(false);\n  const [currentPbl, setCurrentPbl] = useState(null);\n\n  // Cargar base_comp al montar el componente\n  useEffect(() => {\n    const loadBaseComp = async () => {\n      try {\n        const data = await getDataBaseComp();\n        console.log('‚úÖ Base competencia cargada:', data);\n        setBaseCompData(data.base_comp || data || []);\n      } catch (error) {\n        console.error('‚ùå Error cargando base_comp:', error);\n      }\n    };\n    loadBaseComp();\n  }, []);\n\n  // Hacer popup draggable\n  const makeDraggable = popup => {\n    if (!map || !popup || !popup._container) return;\n    try {\n      const pos = map.latLngToLayerPoint(popup.getLatLng());\n      L.DomUtil.setPosition(popup._wrapper.parentNode, pos);\n      const draggable = new L.Draggable(popup._container, popup._wrapper);\n      draggable.enable();\n    } catch (error) {\n      console.error('Error making popup draggable:', error);\n    }\n  };\n\n  // Limpiar marcadores de competencia\n  const clearCompetenciaMarkers = () => {\n    Object.values(competenciaMarkersRef.current).forEach(marker => {\n      try {\n        if (map.hasLayer(marker)) {\n          map.removeLayer(marker);\n        }\n      } catch (error) {\n        console.error('Error removiendo marcador competencia:', error);\n      }\n    });\n    competenciaMarkersRef.current = {};\n  };\n\n  // Mostrar competencia en el mapa\n  const handleShowCompetencia = pbl => {\n    console.log(`üîç Mostrando competencia para PBL: ${pbl}`);\n    if (showingCompetencia && currentPbl === pbl) {\n      // Si ya est√° mostrando, ocultar\n      clearCompetenciaMarkers();\n      setShowingCompetencia(false);\n      setCurrentPbl(null);\n      return;\n    }\n\n    // Limpiar competencia anterior\n    clearCompetenciaMarkers();\n\n    // Obtener competencia del PBL seleccionado\n    const competencia = baseCompData.filter(item => String(item.pbl).trim() === String(pbl).trim());\n    console.log(`üìç Encontrados ${competencia.length} competidores para PBL ${pbl}`);\n    if (competencia.length === 0) {\n      alert('No hay datos de competencia para este PBL');\n      return;\n    }\n\n    // Agregar marcadores de competencia\n    competencia.forEach(comp => {\n      try {\n        // Obtener el marcador original para obtener coordenadas\n        const originalMarker = markers.find(m => m.id === comp.id);\n        if (!originalMarker) {\n          console.warn(`No se encontr√≥ marcador original para ID: ${comp.id}`);\n          return;\n        }\n        const compId = `comp-${comp.id}`;\n        const leafletMarker = L.marker([originalMarker.lat, originalMarker.lng], {\n          icon: createCustomIcon(comp.Marca),\n          title: `${comp.Marca} - Competencia`\n        });\n        const popupContent = `\n          <div class=\"popup-container\">\n            <div class=\"popup-header\">\n              <img \n                src=\"${createBrandLogo(comp.Marca)}\"\n                alt=\"${comp.Marca}\"\n                style=\"width: 30px; height: 30px; border-radius: 50%; object-fit: cover; margin-right: 8px;\"\n                onerror=\"this.style.display='none'\"\n              />\n              <h3 style=\"margin: 0;\">üè™ ${comp.Marca} (Competencia)</h3>\n            </div>\n            <div class=\"popup-content\">\n              <div class=\"popup-data\">\n                <strong>ID:</strong> ${comp.id}<br />\n                <strong>Marca:</strong> ${comp.Marca}<br />\n                <strong>Direcci√≥n:</strong> ${comp.direccion || '-'}<br />\n              </div>\n              <hr style=\"margin: 10px 0; border: none; border-top: 1px solid #e0e0e0\" />\n              <div class=\"popup-data\">\n                <strong>Precios:</strong><br />\n                G93: ${comp.precio_g93 ? `$${comp.precio_g93}` : 'N/A'}<br />\n                G95: ${comp.precio_g95 ? `$${comp.precio_g95}` : 'N/A'}<br />\n                Diesel: ${comp.precio_diesel ? `$${comp.precio_diesel}` : 'N/A'}<br />\n              </div>\n            </div>\n          </div>\n        `;\n        const popup = L.popup({\n          maxWidth: 350,\n          minWidth: 280,\n          autoClose: false,\n          closeOnClick: false\n        }).setContent(popupContent);\n        leafletMarker.bindPopup(popup);\n        leafletMarker.on('popupopen', () => {\n          makeDraggable(leafletMarker.getPopup());\n        });\n        leafletMarker.on('click', function () {\n          leafletMarker.openPopup();\n        });\n        leafletMarker.addTo(map);\n        competenciaMarkersRef.current[compId] = leafletMarker;\n      } catch (error) {\n        console.error(`Error agregando marcador competencia:`, error);\n      }\n    });\n    setShowingCompetencia(true);\n    setCurrentPbl(pbl);\n  };\n\n  // Limpiar y agregar marcadores\n  const updateMarkers = markersToShow => {\n    if (!map || updateInProgressRef.current) return;\n    updateInProgressRef.current = true;\n\n    // Limpiar marcadores anteriores (pero no competencia)\n    Object.values(markersRef.current).forEach(marker => {\n      try {\n        if (map.hasLayer(marker)) {\n          map.removeLayer(marker);\n        }\n      } catch (error) {\n        console.error('Error removiendo marcador:', error);\n      }\n    });\n    markersRef.current = {};\n\n    // Limpiar competencia al cambiar regi√≥n/filtros\n    clearCompetenciaMarkers();\n    setShowingCompetencia(false);\n    setCurrentPbl(null);\n    console.log(`üìç Agregando ${markersToShow.length} marcadores...`);\n    markersToShow.forEach(marker => {\n      try {\n        const markerId = `${marker.id}-${marker.Marca}`;\n        const uniqueId = `marker-${Date.now()}-${Math.random()}`;\n        if (markersRef.current[markerId]) {\n          return;\n        }\n\n        // Crear marcador\n        const leafletMarker = L.marker([marker.lat, marker.lng], {\n          icon: createCustomIcon(marker.Marca),\n          title: marker.nombre\n        });\n\n        // Contenido del popup\n        const popupContent = `\n          <div class=\"popup-container\">\n            <div class=\"popup-header\">\n              <img \n                src=\"${createBrandLogo(marker.Marca)}\"\n                alt=\"${marker.Marca}\"\n                style=\"width: 30px; height: 30px; border-radius: 50%; object-fit: cover; margin-right: 8px;\"\n                onerror=\"this.style.display='none'\"\n              />\n              <h3 style=\"margin: 0;\">${marker.nombre}</h3>\n            </div>\n            <div class=\"popup-content\">\n              <div class=\"popup-data\">\n                <strong>Marca:</strong> ${marker.Marca}<br />\n                <strong>PBL:</strong> ${marker.pbl || '-'}<br />\n                <strong>Region:</strong> ${marker.Region}<br />\n                <strong>Comuna:</strong> ${marker.Comuna}<br />\n                ${marker.direccion ? `<strong>Direcci√≥n:</strong> ${marker.direccion}<br />` : ''}\n                ${marker.eds ? `<strong>EDS:</strong> ${marker.eds}<br />` : ''}\n              </div>\n              <hr style=\"margin: 10px 0; border: none; border-top: 1px solid #e0e0e0\" />\n              <div class=\"popup-data\">\n                <strong>Precios:</strong><br />\n                G93: ${marker.precio_g93 ? `$${marker.precio_g93}` : 'N/A'}<br />\n                G95: ${marker.precio_g95 ? `$${marker.precio_g95}` : 'N/A'}<br />\n                Diesel: ${marker.precio_diesel ? `$${marker.precio_diesel}` : 'N/A'}<br />\n              </div>\n              ${marker.Guerra_Precio === 'Si' ? `\n                <hr style=\"margin: 10px 0; border: none; border-top: 1px solid #e0e0e0\" />\n                <div class=\"popup-data\" style=\"color: #d32f2f; font-weight: bold;\">\n                  ‚ö†Ô∏è Guerra de Precio Activa\n                </div>\n              ` : ''}\n              <hr style=\"margin: 10px 0; border: none; border-top: 1px solid #e0e0e0\" />\n              <div id=\"competencia-${uniqueId}\"></div>\n            </div>\n          </div>\n        `;\n        const popup = L.popup({\n          maxWidth: 400,\n          minWidth: 300,\n          autoClose: false,\n          closeOnClick: false\n        }).setContent(popupContent);\n        leafletMarker.bindPopup(popup);\n\n        // Hacer draggable al abrir\n        leafletMarker.on('popupopen', () => {\n          makeDraggable(leafletMarker.getPopup());\n          setTimeout(() => {\n            const btn = document.getElementById(`btn-comp-${uniqueId}`);\n            if (btn) {\n              btn.addEventListener('click', () => {\n                handleShowCompetencia(marker.pbl);\n              });\n            }\n          }, 100);\n        });\n        leafletMarker.on('click', function () {\n          leafletMarker.openPopup();\n        });\n        leafletMarker.addTo(map);\n        markersRef.current[markerId] = leafletMarker;\n\n        // Insertar bot√≥n despu√©s de crear el popup\n        setTimeout(() => {\n          const container = document.getElementById(`competencia-${uniqueId}`);\n          if (container) {\n            const btnText = showingCompetencia && currentPbl === marker.pbl ? 'Ocultar Competencia' : 'Ver Competencia';\n            container.innerHTML = `\n              <button id=\"btn-comp-${uniqueId}\" class=\"btn-competencia\">\n                üîç ${btnText}\n              </button>\n            `;\n            const btn = document.getElementById(`btn-comp-${uniqueId}`);\n            if (btn) {\n              btn.addEventListener('click', () => {\n                handleShowCompetencia(marker.pbl);\n              });\n            }\n          }\n        }, 150);\n      } catch (error) {\n        console.error(`Error agregando marcador:`, error);\n      }\n    });\n    updateInProgressRef.current = false;\n  };\n\n  // Actualizar cuando cambian los marcadores\n  useEffect(() => {\n    if (!map || !markers || markers.length === 0) {\n      Object.values(markersRef.current).forEach(marker => {\n        try {\n          if (map.hasLayer(marker)) {\n            map.removeLayer(marker);\n          }\n        } catch (error) {\n          console.error('Error removiendo marcador:', error);\n        }\n      });\n      markersRef.current = {};\n      clearCompetenciaMarkers();\n      return;\n    }\n    console.log(`‚úÖ Actualizando ${markers.length} marcadores para regi√≥n: ${selectedRegion}`);\n    updateMarkers(markers);\n  }, [markers, selectedRegion, map]);\n  return null;\n};\n_s(IconMarkersLayer, \"RP+AKMbmQJMCqSclQ/TW9CFAyY0=\", false, function () {\n  return [useMap];\n});\n_c = IconMarkersLayer;\nexport default IconMarkersLayer;\nvar _c;\n$RefreshReg$(_c, \"IconMarkersLayer\");","map":{"version":3,"names":["React","useEffect","useRef","useState","useMap","L","createCustomIcon","createBrandLogo","getDataBaseComp","IconMarkersLayer","markers","selectedRegion","_s","map","markersRef","competenciaMarkersRef","updateInProgressRef","baseCompData","setBaseCompData","showingCompetencia","setShowingCompetencia","currentPbl","setCurrentPbl","loadBaseComp","data","console","log","base_comp","error","makeDraggable","popup","_container","pos","latLngToLayerPoint","getLatLng","DomUtil","setPosition","_wrapper","parentNode","draggable","Draggable","enable","clearCompetenciaMarkers","Object","values","current","forEach","marker","hasLayer","removeLayer","handleShowCompetencia","pbl","competencia","filter","item","String","trim","length","alert","comp","originalMarker","find","m","id","warn","compId","leafletMarker","lat","lng","icon","Marca","title","popupContent","direccion","precio_g93","precio_g95","precio_diesel","maxWidth","minWidth","autoClose","closeOnClick","setContent","bindPopup","on","getPopup","openPopup","addTo","updateMarkers","markersToShow","markerId","uniqueId","Date","now","Math","random","nombre","Region","Comuna","eds","Guerra_Precio","setTimeout","btn","document","getElementById","addEventListener","container","btnText","innerHTML","_c","$RefreshReg$"],"sources":["C:/Users/e08f/Desktop/Proyectos/Resumen/mapa-v2/src/components/IconMarkersLayer.jsx"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\r\nimport { useMap } from 'react-leaflet';\r\nimport L from 'leaflet';\r\nimport { createCustomIcon, createBrandLogo } from '../utils/iconHelpers';\r\nimport { getDataBaseComp } from '../utils/apiService';\r\n\r\nconst IconMarkersLayer = ({ markers, selectedRegion }) => {\r\n  const map = useMap();\r\n  const markersRef = useRef({});\r\n  const competenciaMarkersRef = useRef({});\r\n  const updateInProgressRef = useRef(false);\r\n  const [baseCompData, setBaseCompData] = useState([]);\r\n  const [showingCompetencia, setShowingCompetencia] = useState(false);\r\n  const [currentPbl, setCurrentPbl] = useState(null);\r\n\r\n  // Cargar base_comp al montar el componente\r\n  useEffect(() => {\r\n    const loadBaseComp = async () => {\r\n      try {\r\n        const data = await getDataBaseComp();\r\n        console.log('‚úÖ Base competencia cargada:', data);\r\n        setBaseCompData(data.base_comp || data || []);\r\n      } catch (error) {\r\n        console.error('‚ùå Error cargando base_comp:', error);\r\n      }\r\n    };\r\n    loadBaseComp();\r\n  }, []);\r\n\r\n  // Hacer popup draggable\r\n  const makeDraggable = (popup) => {\r\n    if (!map || !popup || !popup._container) return;\r\n\r\n    try {\r\n      const pos = map.latLngToLayerPoint(popup.getLatLng());\r\n      L.DomUtil.setPosition(popup._wrapper.parentNode, pos);\r\n      \r\n      const draggable = new L.Draggable(popup._container, popup._wrapper);\r\n      draggable.enable();\r\n    } catch (error) {\r\n      console.error('Error making popup draggable:', error);\r\n    }\r\n  };\r\n\r\n  // Limpiar marcadores de competencia\r\n  const clearCompetenciaMarkers = () => {\r\n    Object.values(competenciaMarkersRef.current).forEach(marker => {\r\n      try {\r\n        if (map.hasLayer(marker)) {\r\n          map.removeLayer(marker);\r\n        }\r\n      } catch (error) {\r\n        console.error('Error removiendo marcador competencia:', error);\r\n      }\r\n    });\r\n    competenciaMarkersRef.current = {};\r\n  };\r\n\r\n  // Mostrar competencia en el mapa\r\n  const handleShowCompetencia = (pbl) => {\r\n    console.log(`üîç Mostrando competencia para PBL: ${pbl}`);\r\n\r\n    if (showingCompetencia && currentPbl === pbl) {\r\n      // Si ya est√° mostrando, ocultar\r\n      clearCompetenciaMarkers();\r\n      setShowingCompetencia(false);\r\n      setCurrentPbl(null);\r\n      return;\r\n    }\r\n\r\n    // Limpiar competencia anterior\r\n    clearCompetenciaMarkers();\r\n\r\n    // Obtener competencia del PBL seleccionado\r\n    const competencia = baseCompData.filter(item => \r\n      String(item.pbl).trim() === String(pbl).trim()\r\n    );\r\n\r\n    console.log(`üìç Encontrados ${competencia.length} competidores para PBL ${pbl}`);\r\n\r\n    if (competencia.length === 0) {\r\n      alert('No hay datos de competencia para este PBL');\r\n      return;\r\n    }\r\n\r\n    // Agregar marcadores de competencia\r\n    competencia.forEach((comp) => {\r\n      try {\r\n        // Obtener el marcador original para obtener coordenadas\r\n        const originalMarker = markers.find(m => m.id === comp.id);\r\n        \r\n        if (!originalMarker) {\r\n          console.warn(`No se encontr√≥ marcador original para ID: ${comp.id}`);\r\n          return;\r\n        }\r\n\r\n        const compId = `comp-${comp.id}`;\r\n\r\n        const leafletMarker = L.marker([originalMarker.lat, originalMarker.lng], {\r\n          icon: createCustomIcon(comp.Marca),\r\n          title: `${comp.Marca} - Competencia`\r\n        });\r\n\r\n        const popupContent = `\r\n          <div class=\"popup-container\">\r\n            <div class=\"popup-header\">\r\n              <img \r\n                src=\"${createBrandLogo(comp.Marca)}\"\r\n                alt=\"${comp.Marca}\"\r\n                style=\"width: 30px; height: 30px; border-radius: 50%; object-fit: cover; margin-right: 8px;\"\r\n                onerror=\"this.style.display='none'\"\r\n              />\r\n              <h3 style=\"margin: 0;\">üè™ ${comp.Marca} (Competencia)</h3>\r\n            </div>\r\n            <div class=\"popup-content\">\r\n              <div class=\"popup-data\">\r\n                <strong>ID:</strong> ${comp.id}<br />\r\n                <strong>Marca:</strong> ${comp.Marca}<br />\r\n                <strong>Direcci√≥n:</strong> ${comp.direccion || '-'}<br />\r\n              </div>\r\n              <hr style=\"margin: 10px 0; border: none; border-top: 1px solid #e0e0e0\" />\r\n              <div class=\"popup-data\">\r\n                <strong>Precios:</strong><br />\r\n                G93: ${comp.precio_g93 ? `$${comp.precio_g93}` : 'N/A'}<br />\r\n                G95: ${comp.precio_g95 ? `$${comp.precio_g95}` : 'N/A'}<br />\r\n                Diesel: ${comp.precio_diesel ? `$${comp.precio_diesel}` : 'N/A'}<br />\r\n              </div>\r\n            </div>\r\n          </div>\r\n        `;\r\n\r\n        const popup = L.popup({\r\n          maxWidth: 350,\r\n          minWidth: 280,\r\n          autoClose: false,\r\n          closeOnClick: false\r\n        }).setContent(popupContent);\r\n\r\n        leafletMarker.bindPopup(popup);\r\n\r\n        leafletMarker.on('popupopen', () => {\r\n          makeDraggable(leafletMarker.getPopup());\r\n        });\r\n\r\n        leafletMarker.on('click', function() {\r\n          leafletMarker.openPopup();\r\n        });\r\n\r\n        leafletMarker.addTo(map);\r\n        competenciaMarkersRef.current[compId] = leafletMarker;\r\n\r\n      } catch (error) {\r\n        console.error(`Error agregando marcador competencia:`, error);\r\n      }\r\n    });\r\n\r\n    setShowingCompetencia(true);\r\n    setCurrentPbl(pbl);\r\n  };\r\n\r\n  // Limpiar y agregar marcadores\r\n  const updateMarkers = (markersToShow) => {\r\n    if (!map || updateInProgressRef.current) return;\r\n\r\n    updateInProgressRef.current = true;\r\n\r\n    // Limpiar marcadores anteriores (pero no competencia)\r\n    Object.values(markersRef.current).forEach(marker => {\r\n      try {\r\n        if (map.hasLayer(marker)) {\r\n          map.removeLayer(marker);\r\n        }\r\n      } catch (error) {\r\n        console.error('Error removiendo marcador:', error);\r\n      }\r\n    });\r\n    markersRef.current = {};\r\n\r\n    // Limpiar competencia al cambiar regi√≥n/filtros\r\n    clearCompetenciaMarkers();\r\n    setShowingCompetencia(false);\r\n    setCurrentPbl(null);\r\n\r\n    console.log(`üìç Agregando ${markersToShow.length} marcadores...`);\r\n\r\n    markersToShow.forEach((marker) => {\r\n      try {\r\n        const markerId = `${marker.id}-${marker.Marca}`;\r\n        const uniqueId = `marker-${Date.now()}-${Math.random()}`;\r\n\r\n        if (markersRef.current[markerId]) {\r\n          return;\r\n        }\r\n\r\n        // Crear marcador\r\n        const leafletMarker = L.marker([marker.lat, marker.lng], {\r\n          icon: createCustomIcon(marker.Marca),\r\n          title: marker.nombre\r\n        });\r\n\r\n        // Contenido del popup\r\n        const popupContent = `\r\n          <div class=\"popup-container\">\r\n            <div class=\"popup-header\">\r\n              <img \r\n                src=\"${createBrandLogo(marker.Marca)}\"\r\n                alt=\"${marker.Marca}\"\r\n                style=\"width: 30px; height: 30px; border-radius: 50%; object-fit: cover; margin-right: 8px;\"\r\n                onerror=\"this.style.display='none'\"\r\n              />\r\n              <h3 style=\"margin: 0;\">${marker.nombre}</h3>\r\n            </div>\r\n            <div class=\"popup-content\">\r\n              <div class=\"popup-data\">\r\n                <strong>Marca:</strong> ${marker.Marca}<br />\r\n                <strong>PBL:</strong> ${marker.pbl || '-'}<br />\r\n                <strong>Region:</strong> ${marker.Region}<br />\r\n                <strong>Comuna:</strong> ${marker.Comuna}<br />\r\n                ${marker.direccion ? `<strong>Direcci√≥n:</strong> ${marker.direccion}<br />` : ''}\r\n                ${marker.eds ? `<strong>EDS:</strong> ${marker.eds}<br />` : ''}\r\n              </div>\r\n              <hr style=\"margin: 10px 0; border: none; border-top: 1px solid #e0e0e0\" />\r\n              <div class=\"popup-data\">\r\n                <strong>Precios:</strong><br />\r\n                G93: ${marker.precio_g93 ? `$${marker.precio_g93}` : 'N/A'}<br />\r\n                G95: ${marker.precio_g95 ? `$${marker.precio_g95}` : 'N/A'}<br />\r\n                Diesel: ${marker.precio_diesel ? `$${marker.precio_diesel}` : 'N/A'}<br />\r\n              </div>\r\n              ${marker.Guerra_Precio === 'Si' ? `\r\n                <hr style=\"margin: 10px 0; border: none; border-top: 1px solid #e0e0e0\" />\r\n                <div class=\"popup-data\" style=\"color: #d32f2f; font-weight: bold;\">\r\n                  ‚ö†Ô∏è Guerra de Precio Activa\r\n                </div>\r\n              ` : ''}\r\n              <hr style=\"margin: 10px 0; border: none; border-top: 1px solid #e0e0e0\" />\r\n              <div id=\"competencia-${uniqueId}\"></div>\r\n            </div>\r\n          </div>\r\n        `;\r\n\r\n        const popup = L.popup({\r\n          maxWidth: 400,\r\n          minWidth: 300,\r\n          autoClose: false,\r\n          closeOnClick: false\r\n        }).setContent(popupContent);\r\n\r\n        leafletMarker.bindPopup(popup);\r\n\r\n        // Hacer draggable al abrir\r\n        leafletMarker.on('popupopen', () => {\r\n          makeDraggable(leafletMarker.getPopup());\r\n          \r\n          setTimeout(() => {\r\n            const btn = document.getElementById(`btn-comp-${uniqueId}`);\r\n            if (btn) {\r\n              btn.addEventListener('click', () => {\r\n                handleShowCompetencia(marker.pbl);\r\n              });\r\n            }\r\n          }, 100);\r\n        });\r\n\r\n        leafletMarker.on('click', function() {\r\n          leafletMarker.openPopup();\r\n        });\r\n\r\n        leafletMarker.addTo(map);\r\n        markersRef.current[markerId] = leafletMarker;\r\n\r\n        // Insertar bot√≥n despu√©s de crear el popup\r\n        setTimeout(() => {\r\n          const container = document.getElementById(`competencia-${uniqueId}`);\r\n          if (container) {\r\n            const btnText = showingCompetencia && currentPbl === marker.pbl ? 'Ocultar Competencia' : 'Ver Competencia';\r\n            container.innerHTML = `\r\n              <button id=\"btn-comp-${uniqueId}\" class=\"btn-competencia\">\r\n                üîç ${btnText}\r\n              </button>\r\n            `;\r\n            \r\n            const btn = document.getElementById(`btn-comp-${uniqueId}`);\r\n            if (btn) {\r\n              btn.addEventListener('click', () => {\r\n                handleShowCompetencia(marker.pbl);\r\n              });\r\n            }\r\n          }\r\n        }, 150);\r\n\r\n      } catch (error) {\r\n        console.error(`Error agregando marcador:`, error);\r\n      }\r\n    });\r\n\r\n    updateInProgressRef.current = false;\r\n  };\r\n\r\n  // Actualizar cuando cambian los marcadores\r\n  useEffect(() => {\r\n    if (!map || !markers || markers.length === 0) {\r\n      Object.values(markersRef.current).forEach(marker => {\r\n        try {\r\n          if (map.hasLayer(marker)) {\r\n            map.removeLayer(marker);\r\n          }\r\n        } catch (error) {\r\n          console.error('Error removiendo marcador:', error);\r\n        }\r\n      });\r\n      markersRef.current = {};\r\n      clearCompetenciaMarkers();\r\n      return;\r\n    }\r\n\r\n    console.log(`‚úÖ Actualizando ${markers.length} marcadores para regi√≥n: ${selectedRegion}`);\r\n    updateMarkers(markers);\r\n\r\n  }, [markers, selectedRegion, map]);\r\n\r\n  return null;\r\n};\r\n\r\nexport default IconMarkersLayer;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}