{"ast":null,"code":"import _objectSpread from\"C:/Users/e08f/Desktop/Proyectos/Resumen/mapa-v2/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useEffect,useRef,useState,useCallback}from'react';import{useMap}from'react-leaflet';import L from'leaflet';import ReactDOM from'react-dom/client';import{createCustomIcon}from'../utils/iconHelpers';import{guardarCoordenadaCorregida}from'../services/apiService';import TrendChart from'../components/TrendChart';import'../styles/iconMarkersLayer.css';// --- Utilidad para obtener la última fila por nivel ---\nfunction obtenerUltimaFilaPorNivel(nivel,data){const filas=data.filter(f=>f.nivel&&f.nivel.toString().toLowerCase()===nivel.toLowerCase()).sort((a,b)=>new Date(b.fecha_aplicacion||b.Fecha)-new Date(a.fecha_aplicacion||a.Fecha));return filas[0]||null;}const IconMarkersLayer=_ref=>{let{markers,markersForMercado=null,selectedRegion,baseCompData=[]}=_ref;const map=useMap();const markersRef=useRef({});const guerraMarkersRef=useRef({});const cacheRef=useRef({});const updateInProgressRef=useRef(false);const zoomUpdateRef=useRef(null);const[showingAssociated,setShowingAssociated]=useState(false);const[originalPopupMarker,setOriginalPopupMarker]=useState(null);const[activeMercadoPbl,setActiveMercadoPbl]=useState(null);const competenciaMarkersRef=useRef([]);const polylineRef=useRef([]);const[debugTable,setDebugTable]=useState(null);const[maxHeight,setMaxHeight]=useState(500);const[activeTab,setActiveTab]=useState('precios');const[modoCorreccion,setModoCorreccion]=useState(null);// --- Esto se pone DENTRO de IconMarkersLayer pero FUERA de cualquier función ---\n/*\r\n * baseHistorico: tu arreglo de datos históricos filtrado (usas markersForMercado || markers, por ejemplo)\r\n * marker: el marcador que se está usando para el popup actual\r\n */function obtenerDiferenciasNiveles(marker,baseHistorico){const filaNivel1=obtenerUltimaFilaPorNivel('Nivel 1',baseHistorico.filter(m=>m.id===marker.id));const filaNivel2=obtenerUltimaFilaPorNivel('Nivel 2',baseHistorico.filter(m=>m.id===marker.id));if(!filaNivel1||!filaNivel2)return null;return{g93:filaNivel2.g93-filaNivel1.g93,g95:filaNivel2.g95-filaNivel1.g95,g97:filaNivel2.g97-filaNivel1.g97,diesel:filaNivel2.diesel-filaNivel1.diesel,kero:filaNivel2.kero-filaNivel1.kero};}// Hacer popup draggable\nconst makeDraggable=useCallback(popup=>{if(!map||!popup||!popup._container)return;try{const pos=map.latLngToLayerPoint(popup.getLatLng());L.DomUtil.setPosition(popup._wrapper.parentNode,pos);const draggable=new L.Draggable(popup._container,popup._wrapper);draggable.enable();}catch(error){console.error('Error draggable:',error);}},[map]);const clearCompetenciaMarkers=useCallback(()=>{competenciaMarkersRef.current.forEach(marker=>{try{if(map&&map.hasLayer(marker)){map.removeLayer(marker);}}catch(e){console.error('Error limpiando competencia:',e);}});competenciaMarkersRef.current=[];},[map]);const clearPolylines=useCallback(()=>{polylineRef.current.forEach(line=>{try{if(map&&map.hasLayer(line)){map.removeLayer(line);}}catch(e){console.error('Error limpiando polyline:',e);}});polylineRef.current=[];},[map]);const clearGuerraMarkers=useCallback(()=>{Object.values(guerraMarkersRef.current).forEach(marker=>{try{if(map&&map.hasLayer(marker)){map.removeLayer(marker);}}catch(e){console.error('Error limpiando guerra markers:',e);}});guerraMarkersRef.current={};},[map]);const generarTablaPrecios=useCallback(function(datos){let variant=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'primary';if(!datos||datos.length===0){return'<div style=\"padding: 12px; text-align: center; font-size: 12px; color: #999; font-style: italic;\">Sin datos disponibles</div>';}const variantClass=variant==='primary'?'':'secondary';let html=\"<div class=\\\"popup-table-wrapper \".concat(variantClass,\"\\\">\\n      <table class=\\\"popup-table \").concat(variantClass,\"\\\">\\n        <thead>\\n          <tr>\\n            <th>Fecha</th>\\n            <th>G93</th>\\n            <th>G95</th>\\n            <th>G97</th>\\n            <th>Diesel</th>\\n            <th>Kero</th>\\n          </tr>\\n        </thead>\\n        <tbody>\");datos.forEach(fila=>{html+=\"\\n        <tr>\\n          <td>\".concat(fila.fecha,\"</td>\\n          <td>\").concat(fila.g93,\"</td>\\n          <td>\").concat(fila.g95,\"</td>\\n          <td>\").concat(fila.g97,\"</td>\\n          <td>\").concat(fila.diesel,\"</td>\\n          <td>\").concat(fila.kero,\"</td>\\n        </tr>\");});html+=\"</tbody></table></div>\";return html;},[]);// Normaliza histórico del marker con filtro de nivel\nconst obtenerHistoricoMarker=useCallback(function(markerId,dataArray){let nivel=arguments.length>2&&arguments[2]!==undefined?arguments[2]:\"Nivel 1\";const datos=dataArray.filter(m=>m.id===markerId&&m.nivel&&m.nivel.toLowerCase()===nivel.toLowerCase());return datos.sort((a,b)=>{const fechaA=a.fecha_aplicacion?new Date(a.fecha_aplicacion):new Date(0);const fechaB=b.fecha_aplicacion?new Date(b.fecha_aplicacion):new Date(0);return fechaB-fechaA;}).map(item=>({fecha:item.fecha_aplicacion||item.Fecha||'S/F',g93:item.precio_g93||item.G93||'-',g95:item.precio_g95||item.G95||'-',g97:item.precio_g97||item.G97||'-',diesel:item.precio_diesel||item.Diesel||'-',kero:item.precio_kero||item.Kero||'-'}));},[]);// Popup HTML con pestañas y botones de nivel\nconst generarPopupContent=useCallback(function(marker,datosTabla,tablaPreciosHtml){let variant=arguments.length>3&&arguments[3]!==undefined?arguments[3]:'primary';const logoUrl=marker.logo?marker.logo.startsWith('http')?marker.logo:\"https://api.bencinaenlinea.cl\".concat(marker.logo):'';return\"\\n      <div class=\\\"icon-markers-popup-content\\\">\\n        <div class=\\\"popup-info-header\\\">\\n          \".concat(logoUrl?\"<img src=\\\"\".concat(logoUrl,\"\\\" alt=\\\"Logo \").concat(marker.Marca,\"\\\" class=\\\"popup-logo\\\" onerror=\\\"this.style.display='none';\\\"/>\"):'',\"\\n          <div class=\\\"popup-info-row\\\"><span class=\\\"popup-label\\\">PBL: </span><span class=\\\"popup-value-alerta\\\">\").concat(marker.pbl||'-',\"</span></div>\\n          <div class=\\\"popup-info-row\\\"><span class=\\\"popup-label\\\">EESS: </span><span class=\\\"popup-value\\\">\").concat(marker.eds||'-',\"</span></div><br>\\n          <div class=\\\"popup-info-row\\\"><span class=\\\"popup-label\\\">JZ: </span><span class=\\\"popup-value\\\">\").concat(marker.nombre||'-',\"</span></div>\\n          <div class=\\\"popup-info-row\\\"><span class=\\\"popup-label\\\">OP: </span><span class=\\\"popup-value\\\">\").concat(marker.operacion||'-',\"</span></div>\\n        </div>\\n\\n        <div class=\\\"popup-tabs-container\\\">\\n          <div class=\\\"popup-tabs-header\\\">\\n            <button class=\\\"popup-tab-button active\\\" data-tab=\\\"precios\\\">Precios</button>\\n            <button class=\\\"popup-tab-button\\\" data-tab=\\\"tendencias\\\">Tendencias</button>\\n            <button class=\\\"popup-tab-button\\\" data-tab=\\\"coordenadas\\\">Coordenadas</button>\\n            <button class=\\\"popup-tab-button\\\" data-tab=\\\"informacion\\\">Informaci\\xF3n</button>\\n          </div>\\n\\n          <div class=\\\"popup-tabs-content\\\">\\n            <div class=\\\"popup-tab-pane active\\\" data-tab=\\\"precios\\\">\\n              <div class=\\\"nivel-toggle-container\\\" >\\n                <button class=\\\"nivel-toggle-btn active\\\" data-nivel=\\\"Nivel 1\\\" data-marker-id=\\\"\").concat(marker.id,\"\\\">\\n                  Nivel 1\\n                </button>\\n                <button class=\\\"nivel-toggle-btn\\\" data-nivel=\\\"Nivel 2\\\" data-marker-id=\\\"\").concat(marker.id,\"\\\">\\n                  Nivel 2\\n                </button>\\n              </div>\\n              <div id=\\\"tabla-precios-\").concat(marker.id,\"\\\">\\n                \").concat(tablaPreciosHtml,\"\\n              </div>\\n            </div>\\n            <div class=\\\"popup-tab-pane\\\" data-tab=\\\"tendencias\\\">\\n              <div id=\\\"trend-root-\").concat(marker.id,\"\\\" style=\\\"width:100%;min-height:160px;padding-top:6px;\\\"></div>\\n            </div>\\n            <div class=\\\"popup-tab-pane\\\" data-tab=\\\"coordenadas\\\">\\n              <div class=\\\"popup-info-box\\\">\\n                <p><strong>Lat corregida:</strong> <span id=\\\"lat-actual-\").concat(marker.pbl||marker.id,\"\\\">\").concat(marker.lat.toFixed(6),\"</span></p>\\n                <p><strong>Lon corregida:</strong> <span id=\\\"lon-actual-\").concat(marker.pbl||marker.id,\"\\\">\").concat(marker.lng.toFixed(6),\"</span></p>\\n                <hr style=\\\"margin: 8px 0; border: none; border-top: 1px solid #dee2e6;\\\">\\n                <p><strong>Regi\\xF3n:</strong> \").concat(marker.Region||'-',\"</p>\\n                <p><strong>Comuna:</strong> \").concat(marker.Comuna||'-',\"</p>\\n              </div>\\n              <div style=\\\"display: flex; gap: 8px; margin-top: 10px;\\\">\\n                <button id=\\\"activar-coord-\").concat(marker.pbl||marker.id,\"\\\" style=\\\"flex: 1; padding: 8px; background: #17a2b8; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 11px; font-weight: 600;\\\" onclick=\\\"window.activarCorreccionCoordenadas('\").concat(marker.pbl||'',\"', '\").concat(marker.id||'',\"', '\").concat(marker.eds,\"', '\").concat(marker.Marca,\"')\\\">Activar Coord</button>\\n                <button id=\\\"guardar-coord-\").concat(marker.pbl||marker.id,\"\\\" style=\\\"flex: 1; padding: 8px; background: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 11px; font-weight: 600; opacity: 0.5;\\\" onclick=\\\"window.guardarCorreccionCoordenadas('\").concat(marker.pbl||'',\"', '\").concat(marker.id||'',\"', '\").concat(marker.eds,\"', '\").concat(marker.Marca,\"')\\\" disabled>Guardar</button>\\n              </div>\\n            </div>\\n            <div class=\\\"popup-tab-pane\\\" data-tab=\\\"informacion\\\">\\n              <div class=\\\"popup-info-box\\\">\\n                <p><strong>Direcci\\xF3n:</strong> \").concat(marker.direccion||'-',\"</p>\\n                <p><strong>Surtidores PES:</strong> \").concat(marker.Surtidores_Autoservicio||'-',\"</p>\\n                <p><strong>Posici\\xF3n Surtidor:</strong> \").concat(marker.Posicion_Surtidor||'-',\"</p>\\n                <p><strong>Tipo Isla:</strong> \").concat(marker.Tipo_Isla||'-',\"</p>\\n                \").concat(marker.Guerra_Precio==='Si'?\"<hr style=\\\"margin: 8px 0; border: none; border-top: 1px solid #dee2e6;\\\"><p><strong style=\\\"color: #d9534f;\\\">\\u26A0\\uFE0F Guerra de Precio Activa</strong></p>\":'',\"\\n              </div>\\n            </div>\\n          </div>\\n        </div>\\n\\n        \").concat(marker.pbl&&(marker.Marca==='Aramco'||marker.Marca==='Petrobras')?\"<button class=\\\"popup-button-mercado\\\" onclick=\\\"window.showAssociatedIds && window.showAssociatedIds(\".concat(marker.pbl,\", \").concat(marker.lat,\", \").concat(marker.lng,\", '\").concat(marker.id,\"')\\\">Mercado</button>\"):'',\"\\n      </div>\\n    \");},[]);// Crear grip en el wrapper del popup\nconst crearGripEnWrapper=useCallback(popupContainer=>{const wrapper=popupContainer.querySelector('.leaflet-popup-content-wrapper');const content=popupContainer.querySelector('.leaflet-popup-content');if(!wrapper||!content)return;content===null||content===void 0?void 0:content.querySelectorAll('.popup-resize-grip').forEach(n=>n.remove());const handleWheel=e=>{e.preventDefault();const scrollSpeed=0.5;const scrollAmount=e.deltaY*scrollSpeed;content.scrollTop+=scrollAmount;};content.addEventListener('wheel',handleWheel,{passive:false});let grip=wrapper.querySelector('.popup-resize-grip');if(!grip){grip=document.createElement('div');grip.className='popup-resize-grip';wrapper.appendChild(grip);let isResizing=false;const startResize=e=>{isResizing=true;document.body.classList.add('is-resizing-popup');document.body.style.cursor='nwse-resize';document.body.style.userSelect='none';e.preventDefault();e.stopPropagation();};const doResize=e=>{if(!isResizing)return;const clientX=e.clientX||e.touches&&e.touches[0].clientX;const clientY=e.clientY||e.touches&&e.touches[0].clientY;const gripRect=grip.getBoundingClientRect();const gripCenterX=gripRect.left+gripRect.width/2;const gripCenterY=gripRect.top+gripRect.height/2;const deltaX=clientX-gripCenterX;const deltaY=clientY-gripCenterY;if(Math.abs(deltaX)>5||Math.abs(deltaY)>5){const currentRect=content.getBoundingClientRect();const newWidth=Math.max(240,currentRect.width+deltaX);const newHeight=Math.max(180,currentRect.height+deltaY);content.style.width=newWidth+'px';content.style.height=newHeight+'px';}e.preventDefault();};const stopResize=()=>{if(!isResizing)return;isResizing=false;document.body.classList.remove('is-resizing-popup');document.body.style.cursor='';document.body.style.userSelect='';};grip.addEventListener('mousedown',startResize);document.addEventListener('mousemove',doResize);document.addEventListener('mouseup',stopResize);grip.addEventListener('touchstart',startResize,{passive:false});document.addEventListener('touchmove',doResize,{passive:false});document.addEventListener('touchend',stopResize);const cleanup=()=>{content.removeEventListener('wheel',handleWheel);document.removeEventListener('mousemove',doResize);document.removeEventListener('mouseup',stopResize);document.removeEventListener('touchmove',doResize);document.removeEventListener('touchend',stopResize);document.body.classList.remove('is-resizing-popup');};grip._cleanup=cleanup;}},[]);// Listener toggle niveles\nconst setupNivelToggle=useCallback((popupContainer,marker,allMarkers,variant)=>{const nivelButtons=popupContainer.querySelectorAll('.nivel-toggle-btn');if(nivelButtons.length===0)return;nivelButtons.forEach(btn=>{btn.addEventListener('click',function(event){event.stopPropagation();event.preventDefault();const nivel=this.getAttribute('data-nivel');const markerId=this.getAttribute('data-marker-id');popupContainer.querySelectorAll('.nivel-toggle-btn').forEach(b=>b.classList.remove('active'));this.classList.add('active');const datosTabla=obtenerHistoricoMarker(marker.id,allMarkers,nivel);const nuevaTablaHtml=generarTablaPrecios(datosTabla,variant);const tablaContainer=popupContainer.querySelector(\"#tabla-precios-\".concat(markerId));if(tablaContainer){tablaContainer.innerHTML=nuevaTablaHtml;}});});},[obtenerHistoricoMarker,generarTablaPrecios]);// Tabs popup \nconst setupTabsListener=useCallback((popupContainer,marker,datosTabla)=>{const handleGlobalClick=event=>{if(!popupContainer.contains(event.target))return;const btn=event.target.closest('.popup-tab-button');if(!btn)return;event.stopPropagation();event.preventDefault();const tabName=btn.getAttribute('data-tab');if(!tabName)return;popupContainer.querySelectorAll('.popup-tab-button').forEach(b=>b.classList.remove('active'));popupContainer.querySelectorAll('.popup-tab-pane').forEach(pane=>pane.classList.remove('active'));btn.classList.add('active');const targetPane=popupContainer.querySelector(\".popup-tab-pane[data-tab=\\\"\".concat(tabName,\"\\\"]\"));if(targetPane){targetPane.classList.add('active');}if(tabName==='tendencias'){const el=popupContainer.querySelector(\"#trend-root-\".concat(marker.id));if(el&&!el.__mounted){const root=ReactDOM.createRoot(el);root.render(/*#__PURE__*/React.createElement(TrendChart,{dataRows:datosTabla,maxPoints:7,height:170,compact:true}));el.__mounted=true;el.__root=root;}}};if(popupContainer.__globalClickHandler){document.removeEventListener('click',popupContainer.__globalClickHandler,true);}document.addEventListener('click',handleGlobalClick,true);popupContainer.__globalClickHandler=handleGlobalClick;},[]);const setupPopupListeners=useCallback((popup,popupContainer,marker,allMarkers,variant)=>{crearGripEnWrapper(popupContainer);const datosTabla=obtenerHistoricoMarker(marker.id,allMarkers,\"Nivel 1\");setupTabsListener(popupContainer,marker,datosTabla);setupNivelToggle(popupContainer,marker,allMarkers,variant);},[crearGripEnWrapper,obtenerHistoricoMarker,setupTabsListener,setupNivelToggle]);// Crear marcador con popup y eventos\nconst createMarkerWithPopup=useCallback(function(marker,allMarkers){let variant=arguments.length>2&&arguments[2]!==undefined?arguments[2]:'primary';const lat=parseFloat(marker.lat);const lng=parseFloat(marker.lng);if(isNaN(lat)||isNaN(lng))return null;const iconUrl=createCustomIcon(marker.Marca);const leafletMarker=L.marker([lat,lng],{icon:iconUrl});const datosTabla=obtenerHistoricoMarker(marker.id,allMarkers,\"Nivel 1\");const tablaPreciosHtml=generarTablaPrecios(datosTabla,variant);const popupContent=generarPopupContent(marker,datosTabla,tablaPreciosHtml,variant);const popup=L.popup({autoClose:false,closeOnClick:false,keepInView:true,autoPan:false,maxWidth:450,className:'custom-popup'}).setContent(popupContent);leafletMarker.bindPopup(popup);leafletMarker.on('popupopen',e=>{makeDraggable(popup);setTimeout(()=>{const popupContainer=e.popup._container;if(!popupContainer)return;setupPopupListeners(popup,popupContainer,marker,allMarkers,variant);},50);});leafletMarker.on('popupclose',e=>{var _e$popup;const container=(_e$popup=e.popup)===null||_e$popup===void 0?void 0:_e$popup._container;if(!container)return;const el=container.querySelector(\"#trend-root-\".concat(marker.id));if(el&&el.__root){el.__root.unmount();el.__mounted=false;el.__root=null;}if(container.__globalClickHandler){document.removeEventListener('click',container.__globalClickHandler,true);container.__globalClickHandler=null;}const wrapper=container.querySelector('.leaflet-popup-content-wrapper');const grip=wrapper===null||wrapper===void 0?void 0:wrapper.querySelector('.popup-resize-grip');if(grip&&grip._cleanup){grip._cleanup();}});leafletMarker.on('click',()=>{leafletMarker.openPopup();});return leafletMarker;},[makeDraggable,obtenerHistoricoMarker,generarTablaPrecios,generarPopupContent,setupPopupListeners]);// Renderizar marcadores principales (histórico completo)\nuseEffect(()=>{if(!map||!markers||markers.length===0)return;clearCompetenciaMarkers();clearPolylines();setShowingAssociated(false);setActiveMercadoPbl(null);Object.values(markersRef.current).forEach(marker=>{try{if(map&&map.hasLayer(marker))map.removeLayer(marker);}catch(e){}});markersRef.current={};clearGuerraMarkers();// CAMBIO: usando markersForMercado || markers\nmarkers.forEach(marker=>{const leafletMarker=createMarkerWithPopup(marker,markersForMercado||markers,'primary');if(leafletMarker){map.addLayer(leafletMarker);markersRef.current[marker.id]=leafletMarker;if(marker.Guerra_Precio==='Si'){const guerraIcon=L.icon({iconUrl:\"\".concat(process.env.PUBLIC_URL,\"/iconos/calavera.jpg\"),iconSize:[15,15],iconAnchor:[7.5,7.5],className:'icono-guerra'});const guerraMarker=L.marker([marker.lat,marker.lng],{icon:guerraIcon,interactive:false});map.addLayer(guerraMarker);guerraMarkersRef.current[marker.id]=guerraMarker;}}});// MEJORA AGREGADA: abrir popup automáticamente si solo hay una estación\nif(markers.length===1&&markersRef.current[markers[0].id]){markersRef.current[markers[0].id].openPopup();}},[map,markers,markersForMercado,selectedRegion,clearCompetenciaMarkers,clearPolylines,clearGuerraMarkers,createMarkerWithPopup]);const showAssociatedIds=useCallback((pbl,lat,lng,originalMarkerId)=>{const searchArray=markersForMercado&&markersForMercado.length>0?markersForMercado:markers;if(showingAssociated&&activeMercadoPbl===pbl){clearCompetenciaMarkers();clearPolylines();setShowingAssociated(false);setActiveMercadoPbl(null);Object.values(markersRef.current).forEach(marker=>{try{if(map&&map.hasLayer(marker)){map.removeLayer(marker);}}catch(e){console.error('Error removiendo marcador:',e);}});markersRef.current={};markers.forEach(marker=>{const leafletMarker=createMarkerWithPopup(marker,markersForMercado||markers,'primary');if(leafletMarker){map.addLayer(leafletMarker);markersRef.current[marker.id]=leafletMarker;if(marker.Guerra_Precio==='Si'){const guerraIcon=L.icon({iconUrl:\"\".concat(process.env.PUBLIC_URL,\"/iconos/calavera.jpg\"),iconSize:[15,15],iconAnchor:[7.5,7.5],className:'icono-guerra'});const guerraMarker=L.marker([marker.lat,marker.lng],{icon:guerraIcon,interactive:false});map.addLayer(guerraMarker);guerraMarkersRef.current[marker.id]=guerraMarker;}}});return;}clearCompetenciaMarkers();clearPolylines();const associatedData=baseCompData.filter(item=>String(item.pbl).trim()===String(pbl).trim());if(associatedData.length===0)return;const ids=associatedData.map(item=>item.id);Object.values(markersRef.current).forEach(marker=>{try{if(map&&map.hasLayer(marker)){map.removeLayer(marker);}}catch(e){console.error('Error removiendo marcador:',e);}});markersRef.current={};clearGuerraMarkers();const originalMarker=markers.find(m=>m.id===originalMarkerId);if(originalMarker){const leafletMarker=createMarkerWithPopup(originalMarker,markersForMercado||markers,'primary');if(leafletMarker){map.addLayer(leafletMarker);markersRef.current[originalMarker.id]=leafletMarker;if(originalMarker.Guerra_Precio==='Si'){const guerraIcon=L.icon({iconUrl:\"\".concat(process.env.PUBLIC_URL,\"/iconos/calavera.jpg\"),iconSize:[15,15],iconAnchor:[7.5,7.5],className:'icono-guerra'});const guerraMarker=L.marker([originalMarker.lat,originalMarker.lng],{icon:guerraIcon,interactive:false});map.addLayer(guerraMarker);guerraMarkersRef.current[originalMarker.id]=guerraMarker;}}}// DEDUPLICAR marcadores de competencia\nconst associatedMarkers=searchArray.filter(item=>ids.includes(item.id));const uniqueAssociatedMarkers=[];const seenIds=new Set();associatedMarkers.forEach(marker=>{if(!seenIds.has(marker.id)){seenIds.add(marker.id);uniqueAssociatedMarkers.push(marker);}});uniqueAssociatedMarkers.forEach(marker=>{const leafletMarker=createMarkerWithPopup(marker,markersForMercado||baseCompData,'secondary');if(leafletMarker){map.addLayer(leafletMarker);competenciaMarkersRef.current.push(leafletMarker);if(marker.Guerra_Precio==='Si'){const guerraIcon=L.icon({iconUrl:\"\".concat(process.env.PUBLIC_URL,\"/iconos/calavera.jpg\"),iconSize:[15,15],iconAnchor:[7.5,7.5],className:'icono-guerra'});const guerraMarker=L.marker([marker.lat,marker.lng],{icon:guerraIcon,interactive:false});map.addLayer(guerraMarker);}}});const mainMarkersData=associatedData.filter(m=>m.Marcador_Principal==='Si');mainMarkersData.forEach(mainMarker=>{const markerWithCoords=searchArray.find(m=>m.id===mainMarker.id);if(!markerWithCoords)return;const mainLat=parseFloat(markerWithCoords.lat);const mainLng=parseFloat(markerWithCoords.lng);if(isNaN(mainLat)||isNaN(mainLng))return;const currentLat=parseFloat(lat);const currentLng=parseFloat(lng);const polyline=L.polyline([[currentLat,currentLng],[mainLat,mainLng]],{color:'#FF6B6B',weight:3,opacity:0.8,dashArray:'5, 5'}).addTo(map);polylineRef.current.push(polyline);});setShowingAssociated(true);setActiveMercadoPbl(pbl);},[baseCompData,markers,markersForMercado,map,showingAssociated,activeMercadoPbl,clearCompetenciaMarkers,clearPolylines,clearGuerraMarkers,createMarkerWithPopup]);useEffect(()=>{window.showAssociatedIds=showAssociatedIds;},[showAssociatedIds]);useEffect(()=>{window.activarCorreccionCoordenadas=(pbl,id,eds,marca)=>{const identifier=pbl||id;if(map)map.getContainer().style.cursor='crosshair';setModoCorreccion({pbl,id,eds,marca,lat:null,lng:null});};window.guardarCorreccionCoordenadas=async(pbl,id,eds,marca)=>{if(!modoCorreccion||!modoCorreccion.lat||!modoCorreccion.lng)return;let marker=markers.find(m=>m.pbl===pbl)||(markersForMercado===null||markersForMercado===void 0?void 0:markersForMercado.find(m=>m.pbl===pbl))||(baseCompData===null||baseCompData===void 0?void 0:baseCompData.find(m=>m.pbl===pbl));if(!marker&&id)marker=markers.find(m=>m.id===id)||(markersForMercado===null||markersForMercado===void 0?void 0:markersForMercado.find(m=>m.id===id))||(baseCompData===null||baseCompData===void 0?void 0:baseCompData.find(m=>m.id===id));if(!marker)return;try{const coordenada={id:id||marker.id||pbl,pbl:pbl||marker.pbl||id,eds:eds||marker.eds||'',marca:marca||marker.Marca||'',comuna:marker.Comuna||'',lat_corregida:modoCorreccion.lat,lon_corregida:modoCorreccion.lng};await guardarCoordenadaCorregida(coordenada);marker.lat=modoCorreccion.lat;marker.lng=modoCorreccion.lng;Object.values(markersRef.current).forEach(m=>{if(map.hasLayer(m))map.removeLayer(m);});markersRef.current={};clearGuerraMarkers();// CAMBIO aquí\nmarkers.forEach(m=>{const leafletMarker=createMarkerWithPopup(m,markersForMercado||markers,'primary');if(leafletMarker){map.addLayer(leafletMarker);markersRef.current[m.id]=leafletMarker;}});}catch(error){}};return()=>{delete window.activarCorreccionCoordenadas;delete window.guardarCorreccionCoordenadas;};},[map,modoCorreccion,markers,markersForMercado,baseCompData,clearGuerraMarkers,createMarkerWithPopup]);useEffect(()=>{if(!map||!modoCorreccion)return;const handleMapClick=e=>{const{lat,lng}=e.latlng;setModoCorreccion(prev=>_objectSpread(_objectSpread({},prev),{},{lat,lng}));// ...el resto de lógica de coordenadas...\n};map.on('click',handleMapClick);return()=>{map.off('click',handleMapClick);};},[map,modoCorreccion]);return null;};export default IconMarkersLayer;","map":{"version":3,"names":["React","useEffect","useRef","useState","useCallback","useMap","L","ReactDOM","createCustomIcon","guardarCoordenadaCorregida","TrendChart","obtenerUltimaFilaPorNivel","nivel","data","filas","filter","f","toString","toLowerCase","sort","a","b","Date","fecha_aplicacion","Fecha","IconMarkersLayer","_ref","markers","markersForMercado","selectedRegion","baseCompData","map","markersRef","guerraMarkersRef","cacheRef","updateInProgressRef","zoomUpdateRef","showingAssociated","setShowingAssociated","originalPopupMarker","setOriginalPopupMarker","activeMercadoPbl","setActiveMercadoPbl","competenciaMarkersRef","polylineRef","debugTable","setDebugTable","maxHeight","setMaxHeight","activeTab","setActiveTab","modoCorreccion","setModoCorreccion","obtenerDiferenciasNiveles","marker","baseHistorico","filaNivel1","m","id","filaNivel2","g93","g95","g97","diesel","kero","makeDraggable","popup","_container","pos","latLngToLayerPoint","getLatLng","DomUtil","setPosition","_wrapper","parentNode","draggable","Draggable","enable","error","console","clearCompetenciaMarkers","current","forEach","hasLayer","removeLayer","e","clearPolylines","line","clearGuerraMarkers","Object","values","generarTablaPrecios","datos","variant","arguments","length","undefined","variantClass","html","concat","fila","fecha","obtenerHistoricoMarker","markerId","dataArray","fechaA","fechaB","item","precio_g93","G93","precio_g95","G95","precio_g97","G97","precio_diesel","Diesel","precio_kero","Kero","generarPopupContent","datosTabla","tablaPreciosHtml","logoUrl","logo","startsWith","Marca","pbl","eds","nombre","operacion","lat","toFixed","lng","Region","Comuna","direccion","Surtidores_Autoservicio","Posicion_Surtidor","Tipo_Isla","Guerra_Precio","crearGripEnWrapper","popupContainer","wrapper","querySelector","content","querySelectorAll","n","remove","handleWheel","preventDefault","scrollSpeed","scrollAmount","deltaY","scrollTop","addEventListener","passive","grip","document","createElement","className","appendChild","isResizing","startResize","body","classList","add","style","cursor","userSelect","stopPropagation","doResize","clientX","touches","clientY","gripRect","getBoundingClientRect","gripCenterX","left","width","gripCenterY","top","height","deltaX","Math","abs","currentRect","newWidth","max","newHeight","stopResize","cleanup","removeEventListener","_cleanup","setupNivelToggle","allMarkers","nivelButtons","btn","event","getAttribute","nuevaTablaHtml","tablaContainer","innerHTML","setupTabsListener","handleGlobalClick","contains","target","closest","tabName","pane","targetPane","el","__mounted","root","createRoot","render","dataRows","maxPoints","compact","__root","__globalClickHandler","setupPopupListeners","createMarkerWithPopup","parseFloat","isNaN","iconUrl","leafletMarker","icon","popupContent","autoClose","closeOnClick","keepInView","autoPan","maxWidth","setContent","bindPopup","on","setTimeout","_e$popup","container","unmount","openPopup","addLayer","guerraIcon","process","env","PUBLIC_URL","iconSize","iconAnchor","guerraMarker","interactive","showAssociatedIds","originalMarkerId","searchArray","associatedData","String","trim","ids","originalMarker","find","associatedMarkers","includes","uniqueAssociatedMarkers","seenIds","Set","has","push","mainMarkersData","Marcador_Principal","mainMarker","markerWithCoords","mainLat","mainLng","currentLat","currentLng","polyline","color","weight","opacity","dashArray","addTo","window","activarCorreccionCoordenadas","marca","identifier","getContainer","guardarCorreccionCoordenadas","coordenada","comuna","lat_corregida","lon_corregida","handleMapClick","latlng","prev","_objectSpread","off"],"sources":["C:/Users/e08f/Desktop/Proyectos/Resumen/mapa-v2/src/components/IconMarkersLayer.jsx"],"sourcesContent":["import React, { useEffect, useRef, useState, useCallback } from 'react';\r\nimport { useMap } from 'react-leaflet';\r\nimport L from 'leaflet';\r\nimport ReactDOM from 'react-dom/client';\r\nimport { createCustomIcon } from '../utils/iconHelpers';\r\nimport { guardarCoordenadaCorregida } from '../services/apiService';\r\nimport TrendChart from '../components/TrendChart';\r\nimport '../styles/iconMarkersLayer.css';\r\n\r\n// --- Utilidad para obtener la última fila por nivel ---\r\nfunction obtenerUltimaFilaPorNivel(nivel, data) {\r\n  const filas = data\r\n    .filter(f => f.nivel && f.nivel.toString().toLowerCase() === nivel.toLowerCase())\r\n    .sort((a, b) => new Date(b.fecha_aplicacion || b.Fecha) - new Date(a.fecha_aplicacion || a.Fecha));\r\n  return filas[0] || null;\r\n}\r\n\r\n\r\n\r\n\r\nconst IconMarkersLayer = ({ markers, markersForMercado = null, selectedRegion, baseCompData = [] }) => {\r\n  const map = useMap();\r\n  const markersRef = useRef({});\r\n  const guerraMarkersRef = useRef({});\r\n  const cacheRef = useRef({});\r\n  const updateInProgressRef = useRef(false);\r\n  const zoomUpdateRef = useRef(null);\r\n\r\n  const [showingAssociated, setShowingAssociated] = useState(false);\r\n  const [originalPopupMarker, setOriginalPopupMarker] = useState(null);\r\n  const [activeMercadoPbl, setActiveMercadoPbl] = useState(null);\r\n\r\n  const competenciaMarkersRef = useRef([]);\r\n  const polylineRef = useRef([]);\r\n\r\n  const [debugTable, setDebugTable] = useState(null);\r\n  const [maxHeight, setMaxHeight] = useState(500);\r\n  const [activeTab, setActiveTab] = useState('precios');\r\n  const [modoCorreccion, setModoCorreccion] = useState(null);\r\n\r\n// --- Esto se pone DENTRO de IconMarkersLayer pero FUERA de cualquier función ---\r\n/*\r\n * baseHistorico: tu arreglo de datos históricos filtrado (usas markersForMercado || markers, por ejemplo)\r\n * marker: el marcador que se está usando para el popup actual\r\n */\r\nfunction obtenerDiferenciasNiveles(marker, baseHistorico) {\r\n  const filaNivel1 = obtenerUltimaFilaPorNivel('Nivel 1', baseHistorico.filter(m => m.id === marker.id));\r\n  const filaNivel2 = obtenerUltimaFilaPorNivel('Nivel 2', baseHistorico.filter(m => m.id === marker.id));\r\n  if (!filaNivel1 || !filaNivel2) return null;\r\n  return {\r\n    g93: filaNivel2.g93 - filaNivel1.g93,\r\n    g95: filaNivel2.g95 - filaNivel1.g95,\r\n    g97: filaNivel2.g97 - filaNivel1.g97,\r\n    diesel: filaNivel2.diesel - filaNivel1.diesel,\r\n    kero: filaNivel2.kero - filaNivel1.kero\r\n  };\r\n}\r\n\r\n\r\n\r\n\r\n\r\n  // Hacer popup draggable\r\n  const makeDraggable = useCallback((popup) => {\r\n    if (!map || !popup || !popup._container) return;\r\n    try {\r\n      const pos = map.latLngToLayerPoint(popup.getLatLng());\r\n      L.DomUtil.setPosition(popup._wrapper.parentNode, pos);\r\n      const draggable = new L.Draggable(popup._container, popup._wrapper);\r\n      draggable.enable();\r\n    } catch (error) {\r\n      console.error('Error draggable:', error);\r\n    }\r\n  }, [map]);\r\n\r\n  const clearCompetenciaMarkers = useCallback(() => {\r\n    competenciaMarkersRef.current.forEach(marker => {\r\n      try {\r\n        if (map && map.hasLayer(marker)) {\r\n          map.removeLayer(marker);\r\n        }\r\n      } catch (e) {\r\n        console.error('Error limpiando competencia:', e);\r\n      }\r\n    });\r\n    competenciaMarkersRef.current = [];\r\n  }, [map]);\r\n\r\n  const clearPolylines = useCallback(() => {\r\n    polylineRef.current.forEach(line => {\r\n      try {\r\n        if (map && map.hasLayer(line)) {\r\n          map.removeLayer(line);\r\n        }\r\n      } catch (e) {\r\n        console.error('Error limpiando polyline:', e);\r\n      }\r\n    });\r\n    polylineRef.current = [];\r\n  }, [map]);\r\n\r\n  const clearGuerraMarkers = useCallback(() => {\r\n    Object.values(guerraMarkersRef.current).forEach(marker => {\r\n      try {\r\n        if (map && map.hasLayer(marker)) {\r\n          map.removeLayer(marker);\r\n        }\r\n      } catch (e) {\r\n        console.error('Error limpiando guerra markers:', e);\r\n      }\r\n    });\r\n    guerraMarkersRef.current = {};\r\n  }, [map]);\r\n\r\n  const generarTablaPrecios = useCallback((datos, variant = 'primary') => {\r\n    if (!datos || datos.length === 0) {\r\n      return '<div style=\"padding: 12px; text-align: center; font-size: 12px; color: #999; font-style: italic;\">Sin datos disponibles</div>';\r\n    }\r\n    const variantClass = variant === 'primary' ? '' : 'secondary';\r\n    let html = `<div class=\"popup-table-wrapper ${variantClass}\">\r\n      <table class=\"popup-table ${variantClass}\">\r\n        <thead>\r\n          <tr>\r\n            <th>Fecha</th>\r\n            <th>G93</th>\r\n            <th>G95</th>\r\n            <th>G97</th>\r\n            <th>Diesel</th>\r\n            <th>Kero</th>\r\n          </tr>\r\n        </thead>\r\n        <tbody>`;\r\n    datos.forEach((fila) => {\r\n      html += `\r\n        <tr>\r\n          <td>${fila.fecha}</td>\r\n          <td>${fila.g93}</td>\r\n          <td>${fila.g95}</td>\r\n          <td>${fila.g97}</td>\r\n          <td>${fila.diesel}</td>\r\n          <td>${fila.kero}</td>\r\n        </tr>`;\r\n    });\r\n    html += `</tbody></table></div>`;\r\n    return html;\r\n  }, []);\r\n\r\n  // Normaliza histórico del marker con filtro de nivel\r\n  const obtenerHistoricoMarker = useCallback((markerId, dataArray, nivel = \"Nivel 1\") => {\r\n    const datos = dataArray.filter(m => \r\n      m.id === markerId && \r\n      m.nivel && \r\n      m.nivel.toLowerCase() === nivel.toLowerCase()\r\n    );\r\n    \r\n    return datos\r\n      .sort((a, b) => {\r\n        const fechaA = a.fecha_aplicacion ? new Date(a.fecha_aplicacion) : new Date(0);\r\n        const fechaB = b.fecha_aplicacion ? new Date(b.fecha_aplicacion) : new Date(0);\r\n        return fechaB - fechaA;\r\n      })\r\n      .map(item => ({\r\n        fecha: item.fecha_aplicacion || item.Fecha || 'S/F',\r\n        g93: item.precio_g93 || item.G93 || '-',\r\n        g95: item.precio_g95 || item.G95 || '-',\r\n        g97: item.precio_g97 || item.G97 || '-',\r\n        diesel: item.precio_diesel || item.Diesel || '-',\r\n        kero: item.precio_kero || item.Kero || '-'\r\n      }));\r\n  }, []);\r\n\r\n   // Popup HTML con pestañas y botones de nivel\r\n  const generarPopupContent = useCallback((marker, datosTabla, tablaPreciosHtml, variant = 'primary') => {\r\n    const logoUrl = marker.logo\r\n      ? (marker.logo.startsWith('http') ? marker.logo : `https://api.bencinaenlinea.cl${marker.logo}`)\r\n      : '';\r\n    return `\r\n      <div class=\"icon-markers-popup-content\">\r\n        <div class=\"popup-info-header\">\r\n          ${logoUrl ? `<img src=\"${logoUrl}\" alt=\"Logo ${marker.Marca}\" class=\"popup-logo\" onerror=\"this.style.display='none';\"/>` : ''}\r\n          <div class=\"popup-info-row\"><span class=\"popup-label\">PBL: </span><span class=\"popup-value-alerta\">${marker.pbl || '-'}</span></div>\r\n          <div class=\"popup-info-row\"><span class=\"popup-label\">EESS: </span><span class=\"popup-value\">${marker.eds || '-'}</span></div><br>\r\n          <div class=\"popup-info-row\"><span class=\"popup-label\">JZ: </span><span class=\"popup-value\">${marker.nombre || '-'}</span></div>\r\n          <div class=\"popup-info-row\"><span class=\"popup-label\">OP: </span><span class=\"popup-value\">${marker.operacion || '-'}</span></div>\r\n        </div>\r\n\r\n        <div class=\"popup-tabs-container\">\r\n          <div class=\"popup-tabs-header\">\r\n            <button class=\"popup-tab-button active\" data-tab=\"precios\">Precios</button>\r\n            <button class=\"popup-tab-button\" data-tab=\"tendencias\">Tendencias</button>\r\n            <button class=\"popup-tab-button\" data-tab=\"coordenadas\">Coordenadas</button>\r\n            <button class=\"popup-tab-button\" data-tab=\"informacion\">Información</button>\r\n          </div>\r\n\r\n          <div class=\"popup-tabs-content\">\r\n            <div class=\"popup-tab-pane active\" data-tab=\"precios\">\r\n              <div class=\"nivel-toggle-container\" >\r\n                <button class=\"nivel-toggle-btn active\" data-nivel=\"Nivel 1\" data-marker-id=\"${marker.id}\">\r\n                  Nivel 1\r\n                </button>\r\n                <button class=\"nivel-toggle-btn\" data-nivel=\"Nivel 2\" data-marker-id=\"${marker.id}\">\r\n                  Nivel 2\r\n                </button>\r\n              </div>\r\n              <div id=\"tabla-precios-${marker.id}\">\r\n                ${tablaPreciosHtml}\r\n              </div>\r\n            </div>\r\n            <div class=\"popup-tab-pane\" data-tab=\"tendencias\">\r\n              <div id=\"trend-root-${marker.id}\" style=\"width:100%;min-height:160px;padding-top:6px;\"></div>\r\n            </div>\r\n            <div class=\"popup-tab-pane\" data-tab=\"coordenadas\">\r\n              <div class=\"popup-info-box\">\r\n                <p><strong>Lat corregida:</strong> <span id=\"lat-actual-${marker.pbl || marker.id}\">${marker.lat.toFixed(6)}</span></p>\r\n                <p><strong>Lon corregida:</strong> <span id=\"lon-actual-${marker.pbl || marker.id}\">${marker.lng.toFixed(6)}</span></p>\r\n                <hr style=\"margin: 8px 0; border: none; border-top: 1px solid #dee2e6;\">\r\n                <p><strong>Región:</strong> ${marker.Region || '-'}</p>\r\n                <p><strong>Comuna:</strong> ${marker.Comuna || '-'}</p>\r\n              </div>\r\n              <div style=\"display: flex; gap: 8px; margin-top: 10px;\">\r\n                <button id=\"activar-coord-${marker.pbl || marker.id}\" style=\"flex: 1; padding: 8px; background: #17a2b8; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 11px; font-weight: 600;\" onclick=\"window.activarCorreccionCoordenadas('${marker.pbl || ''}', '${marker.id || ''}', '${marker.eds}', '${marker.Marca}')\">Activar Coord</button>\r\n                <button id=\"guardar-coord-${marker.pbl || marker.id}\" style=\"flex: 1; padding: 8px; background: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 11px; font-weight: 600; opacity: 0.5;\" onclick=\"window.guardarCorreccionCoordenadas('${marker.pbl || ''}', '${marker.id || ''}', '${marker.eds}', '${marker.Marca}')\" disabled>Guardar</button>\r\n              </div>\r\n            </div>\r\n            <div class=\"popup-tab-pane\" data-tab=\"informacion\">\r\n              <div class=\"popup-info-box\">\r\n                <p><strong>Dirección:</strong> ${marker.direccion || '-'}</p>\r\n                <p><strong>Surtidores PES:</strong> ${marker.Surtidores_Autoservicio || '-'}</p>\r\n                <p><strong>Posición Surtidor:</strong> ${marker.Posicion_Surtidor || '-'}</p>\r\n                <p><strong>Tipo Isla:</strong> ${marker.Tipo_Isla || '-'}</p>\r\n                ${marker.Guerra_Precio === 'Si' ? `<hr style=\"margin: 8px 0; border: none; border-top: 1px solid #dee2e6;\"><p><strong style=\"color: #d9534f;\">⚠️ Guerra de Precio Activa</strong></p>` : ''}\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        ${marker.pbl && (marker.Marca === 'Aramco' || marker.Marca === 'Petrobras')\r\n        ? `<button class=\"popup-button-mercado\" onclick=\"window.showAssociatedIds && window.showAssociatedIds(${marker.pbl}, ${marker.lat}, ${marker.lng}, '${marker.id}')\">Mercado</button>`\r\n        : ''\r\n      }\r\n      </div>\r\n    `;\r\n  }, []);\r\n\r\n   // Crear grip en el wrapper del popup\r\n  const crearGripEnWrapper = useCallback((popupContainer) => {\r\n    const wrapper = popupContainer.querySelector('.leaflet-popup-content-wrapper');\r\n    const content = popupContainer.querySelector('.leaflet-popup-content');\r\n    if (!wrapper || !content) return;\r\n\r\n    content?.querySelectorAll('.popup-resize-grip').forEach(n => n.remove());\r\n\r\n    const handleWheel = (e) => {\r\n      e.preventDefault();\r\n      const scrollSpeed = 0.5;\r\n      const scrollAmount = e.deltaY * scrollSpeed;\r\n      content.scrollTop += scrollAmount;\r\n    };\r\n    \r\n    content.addEventListener('wheel', handleWheel, { passive: false });\r\n\r\n    let grip = wrapper.querySelector('.popup-resize-grip');\r\n    if (!grip) {\r\n      grip = document.createElement('div');\r\n      grip.className = 'popup-resize-grip';\r\n      wrapper.appendChild(grip);\r\n      \r\n      let isResizing = false;\r\n      \r\n      const startResize = (e) => {\r\n        isResizing = true;\r\n        document.body.classList.add('is-resizing-popup');\r\n        document.body.style.cursor = 'nwse-resize';\r\n        document.body.style.userSelect = 'none';\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n      };\r\n      \r\n      const doResize = (e) => {\r\n        if (!isResizing) return;\r\n        \r\n        const clientX = e.clientX || (e.touches && e.touches[0].clientX);\r\n        const clientY = e.clientY || (e.touches && e.touches[0].clientY);\r\n        \r\n        const gripRect = grip.getBoundingClientRect();\r\n        const gripCenterX = gripRect.left + gripRect.width / 2;\r\n        const gripCenterY = gripRect.top + gripRect.height / 2;\r\n        \r\n        const deltaX = clientX - gripCenterX;\r\n        const deltaY = clientY - gripCenterY;\r\n        \r\n        if (Math.abs(deltaX) > 5 || Math.abs(deltaY) > 5) {\r\n          const currentRect = content.getBoundingClientRect();\r\n          const newWidth = Math.max(240, currentRect.width + deltaX);\r\n          const newHeight = Math.max(180, currentRect.height + deltaY);\r\n          \r\n          content.style.width = newWidth + 'px';\r\n          content.style.height = newHeight + 'px';\r\n        }\r\n        \r\n        e.preventDefault();\r\n      };\r\n      \r\n      const stopResize = () => {\r\n        if (!isResizing) return;\r\n        isResizing = false;\r\n        document.body.classList.remove('is-resizing-popup');\r\n        document.body.style.cursor = '';\r\n        document.body.style.userSelect = '';\r\n      };\r\n      \r\n      grip.addEventListener('mousedown', startResize);\r\n      document.addEventListener('mousemove', doResize);\r\n      document.addEventListener('mouseup', stopResize);\r\n      \r\n      grip.addEventListener('touchstart', startResize, { passive: false });\r\n      document.addEventListener('touchmove', doResize, { passive: false });\r\n      document.addEventListener('touchend', stopResize);\r\n      \r\n      const cleanup = () => {\r\n        content.removeEventListener('wheel', handleWheel);\r\n        document.removeEventListener('mousemove', doResize);\r\n        document.removeEventListener('mouseup', stopResize);\r\n        document.removeEventListener('touchmove', doResize);\r\n        document.removeEventListener('touchend', stopResize);\r\n        document.body.classList.remove('is-resizing-popup');\r\n      };\r\n      \r\n      grip._cleanup = cleanup;\r\n    }\r\n  }, []);\r\n\r\n  // Listener toggle niveles\r\n  const setupNivelToggle = useCallback((popupContainer, marker, allMarkers, variant) => {\r\n    const nivelButtons = popupContainer.querySelectorAll('.nivel-toggle-btn');\r\n    if (nivelButtons.length === 0) return;\r\n    \r\n    nivelButtons.forEach(btn => {\r\n      btn.addEventListener('click', function(event) {\r\n        event.stopPropagation();\r\n        event.preventDefault();\r\n        \r\n        const nivel = this.getAttribute('data-nivel');\r\n        const markerId = this.getAttribute('data-marker-id');\r\n        \r\n        popupContainer.querySelectorAll('.nivel-toggle-btn').forEach(b => b.classList.remove('active'));\r\n        this.classList.add('active');\r\n        \r\n        const datosTabla = obtenerHistoricoMarker(marker.id, allMarkers, nivel);\r\n        const nuevaTablaHtml = generarTablaPrecios(datosTabla, variant);\r\n        \r\n        const tablaContainer = popupContainer.querySelector(`#tabla-precios-${markerId}`);\r\n        if (tablaContainer) {\r\n          tablaContainer.innerHTML = nuevaTablaHtml;\r\n        }\r\n      });\r\n    });\r\n  }, [obtenerHistoricoMarker, generarTablaPrecios]);\r\n\r\n  // Tabs popup \r\n  const setupTabsListener = useCallback((popupContainer, marker, datosTabla) => {\r\n    const handleGlobalClick = (event) => {\r\n      if (!popupContainer.contains(event.target)) return;\r\n      \r\n      const btn = event.target.closest('.popup-tab-button');\r\n      if (!btn) return;\r\n\r\n      event.stopPropagation();\r\n      event.preventDefault();\r\n      \r\n      const tabName = btn.getAttribute('data-tab');\r\n      if (!tabName) return;\r\n      popupContainer.querySelectorAll('.popup-tab-button').forEach(b => b.classList.remove('active'));\r\n      popupContainer.querySelectorAll('.popup-tab-pane').forEach(pane => pane.classList.remove('active'));\r\n      \r\n      btn.classList.add('active');\r\n      const targetPane = popupContainer.querySelector(`.popup-tab-pane[data-tab=\"${tabName}\"]`);\r\n      if (targetPane) {\r\n        targetPane.classList.add('active');\r\n      }\r\n\r\n      if (tabName === 'tendencias') {\r\n        const el = popupContainer.querySelector(`#trend-root-${marker.id}`);\r\n        if (el && !el.__mounted) {\r\n          const root = ReactDOM.createRoot(el);\r\n          root.render(React.createElement(TrendChart, {\r\n            dataRows: datosTabla,\r\n            maxPoints: 7,\r\n            height: 170,\r\n            compact: true\r\n          }));\r\n          el.__mounted = true;\r\n          el.__root = root;\r\n        }\r\n      }\r\n    };\r\n\r\n    if (popupContainer.__globalClickHandler) {\r\n      document.removeEventListener('click', popupContainer.__globalClickHandler, true);\r\n    }\r\n\r\n    document.addEventListener('click', handleGlobalClick, true);\r\n    popupContainer.__globalClickHandler = handleGlobalClick;\r\n  }, []);\r\n\r\n  const setupPopupListeners = useCallback((popup, popupContainer, marker, allMarkers, variant) => {\r\n    crearGripEnWrapper(popupContainer);\r\n    const datosTabla = obtenerHistoricoMarker(marker.id, allMarkers, \"Nivel 1\");\r\n    setupTabsListener(popupContainer, marker, datosTabla);\r\n    setupNivelToggle(popupContainer, marker, allMarkers, variant);\r\n  }, [crearGripEnWrapper, obtenerHistoricoMarker, setupTabsListener, setupNivelToggle]);\r\n\r\n  // Crear marcador con popup y eventos\r\n  const createMarkerWithPopup = useCallback((marker, allMarkers, variant = 'primary') => {\r\n    const lat = parseFloat(marker.lat);\r\n    const lng = parseFloat(marker.lng);\r\n    if (isNaN(lat) || isNaN(lng)) return null;\r\n\r\n    const iconUrl = createCustomIcon(marker.Marca);\r\n    const leafletMarker = L.marker([lat, lng], { icon: iconUrl });\r\n\r\n    const datosTabla = obtenerHistoricoMarker(marker.id, allMarkers, \"Nivel 1\");\r\n    const tablaPreciosHtml = generarTablaPrecios(datosTabla, variant);\r\n    const popupContent = generarPopupContent(marker, datosTabla, tablaPreciosHtml, variant);\r\n\r\n    const popup = L.popup({\r\n      autoClose: false,\r\n      closeOnClick: false,\r\n      keepInView: true,\r\n      autoPan: false,\r\n      maxWidth: 450,\r\n      className: 'custom-popup'\r\n    }).setContent(popupContent);\r\n\r\n    leafletMarker.bindPopup(popup);\r\n\r\n    leafletMarker.on('popupopen', (e) => {\r\n      makeDraggable(popup);\r\n      setTimeout(() => {\r\n        const popupContainer = e.popup._container;\r\n        if (!popupContainer) return;\r\n        setupPopupListeners(popup, popupContainer, marker, allMarkers, variant);\r\n      }, 50);\r\n    });\r\n\r\n    leafletMarker.on('popupclose', (e) => {\r\n      const container = e.popup?._container;\r\n      if (!container) return;\r\n\r\n      const el = container.querySelector(`#trend-root-${marker.id}`);\r\n      if (el && el.__root) {\r\n        el.__root.unmount();\r\n        el.__mounted = false;\r\n        el.__root = null;\r\n      }\r\n\r\n      if (container.__globalClickHandler) {\r\n        document.removeEventListener('click', container.__globalClickHandler, true);\r\n        container.__globalClickHandler = null;\r\n      }\r\n\r\n      const wrapper = container.querySelector('.leaflet-popup-content-wrapper');\r\n      const grip = wrapper?.querySelector('.popup-resize-grip');\r\n      if (grip && grip._cleanup) {\r\n        grip._cleanup();\r\n      }\r\n    });\r\n\r\n    leafletMarker.on('click', () => {\r\n      leafletMarker.openPopup();\r\n    });\r\n\r\n    return leafletMarker;\r\n  }, [makeDraggable, obtenerHistoricoMarker, generarTablaPrecios, generarPopupContent, setupPopupListeners]);\r\n\r\n  // Renderizar marcadores principales (histórico completo)\r\n useEffect(() => {\r\n  if (!map || !markers || markers.length === 0) return;\r\n  clearCompetenciaMarkers();\r\n  clearPolylines();\r\n  setShowingAssociated(false);\r\n  setActiveMercadoPbl(null);\r\n\r\n  Object.values(markersRef.current).forEach(marker => {\r\n    try { if (map && map.hasLayer(marker)) map.removeLayer(marker); } catch (e) { }\r\n  });\r\n  markersRef.current = {};\r\n  clearGuerraMarkers();\r\n\r\n  // CAMBIO: usando markersForMercado || markers\r\n  markers.forEach(marker => {\r\n    const leafletMarker = createMarkerWithPopup(\r\n      marker,\r\n      markersForMercado || markers,\r\n      'primary'\r\n    );\r\n    if (leafletMarker) {\r\n      map.addLayer(leafletMarker);\r\n      markersRef.current[marker.id] = leafletMarker;\r\n      if (marker.Guerra_Precio === 'Si') {\r\n        const guerraIcon = L.icon({\r\n          iconUrl: `${process.env.PUBLIC_URL}/iconos/calavera.jpg`,\r\n          iconSize: [15, 15],\r\n          iconAnchor: [7.5, 7.5],\r\n          className: 'icono-guerra'\r\n        });\r\n        const guerraMarker = L.marker([marker.lat, marker.lng], { icon: guerraIcon, interactive: false });\r\n        map.addLayer(guerraMarker);\r\n        guerraMarkersRef.current[marker.id] = guerraMarker;\r\n      }\r\n    }\r\n  });\r\n\r\n  // MEJORA AGREGADA: abrir popup automáticamente si solo hay una estación\r\n  if (markers.length === 1 && markersRef.current[markers[0].id]) {\r\n    markersRef.current[markers[0].id].openPopup();\r\n  }\r\n\r\n}, [map, markers, markersForMercado, selectedRegion, clearCompetenciaMarkers, clearPolylines, clearGuerraMarkers, createMarkerWithPopup]);\r\n\r\n  const showAssociatedIds = useCallback((pbl, lat, lng, originalMarkerId) => {\r\n  const searchArray = markersForMercado && markersForMercado.length > 0 ? markersForMercado : markers;\r\n\r\n  if (showingAssociated && activeMercadoPbl === pbl) {\r\n    clearCompetenciaMarkers();\r\n    clearPolylines();\r\n    setShowingAssociated(false);\r\n    setActiveMercadoPbl(null);\r\n\r\n    Object.values(markersRef.current).forEach(marker => {\r\n      try {\r\n        if (map && map.hasLayer(marker)) {\r\n          map.removeLayer(marker);\r\n        }\r\n      } catch (e) {\r\n        console.error('Error removiendo marcador:', e);\r\n      }\r\n    });\r\n    markersRef.current = {};\r\n\r\n    markers.forEach(marker => {\r\n      const leafletMarker = createMarkerWithPopup(\r\n        marker,\r\n        markersForMercado || markers,\r\n        'primary'\r\n      );\r\n      if (leafletMarker) {\r\n        map.addLayer(leafletMarker);\r\n        markersRef.current[marker.id] = leafletMarker;\r\n\r\n        if (marker.Guerra_Precio === 'Si') {\r\n          const guerraIcon = L.icon({\r\n            iconUrl: `${process.env.PUBLIC_URL}/iconos/calavera.jpg`,\r\n            iconSize: [15, 15],\r\n            iconAnchor: [7.5, 7.5],\r\n            className: 'icono-guerra'\r\n          });\r\n          const guerraMarker = L.marker([marker.lat, marker.lng], { icon: guerraIcon, interactive: false });\r\n          map.addLayer(guerraMarker);\r\n          guerraMarkersRef.current[marker.id] = guerraMarker;\r\n        }\r\n      }\r\n    });\r\n    return;\r\n  }\r\n\r\n  clearCompetenciaMarkers();\r\n  clearPolylines();\r\n\r\n  const associatedData = baseCompData.filter(item => String(item.pbl).trim() === String(pbl).trim());\r\n  if (associatedData.length === 0) return;\r\n\r\n  const ids = associatedData.map(item => item.id);\r\n\r\n  Object.values(markersRef.current).forEach(marker => {\r\n    try {\r\n      if (map && map.hasLayer(marker)) {\r\n        map.removeLayer(marker);\r\n      }\r\n    } catch (e) {\r\n      console.error('Error removiendo marcador:', e);\r\n    }\r\n  });\r\n  markersRef.current = {};\r\n  clearGuerraMarkers();\r\n\r\n  const originalMarker = markers.find(m => m.id === originalMarkerId);\r\n  if (originalMarker) {\r\n    const leafletMarker = createMarkerWithPopup(\r\n      originalMarker,\r\n      markersForMercado || markers,\r\n      'primary'\r\n    );\r\n    if (leafletMarker) {\r\n      map.addLayer(leafletMarker);\r\n      markersRef.current[originalMarker.id] = leafletMarker;\r\n\r\n      if (originalMarker.Guerra_Precio === 'Si') {\r\n        const guerraIcon = L.icon({\r\n          iconUrl: `${process.env.PUBLIC_URL}/iconos/calavera.jpg`,\r\n          iconSize: [15, 15],\r\n          iconAnchor: [7.5, 7.5],\r\n          className: 'icono-guerra'\r\n        });\r\n        const guerraMarker = L.marker([originalMarker.lat, originalMarker.lng], { icon: guerraIcon, interactive: false });\r\n        map.addLayer(guerraMarker);\r\n        guerraMarkersRef.current[originalMarker.id] = guerraMarker;\r\n      }\r\n    }\r\n  }\r\n\r\n  // DEDUPLICAR marcadores de competencia\r\n  const associatedMarkers = searchArray.filter(item => ids.includes(item.id));\r\n  const uniqueAssociatedMarkers = [];\r\n  const seenIds = new Set();\r\n\r\n  associatedMarkers.forEach(marker => {\r\n    if (!seenIds.has(marker.id)) {\r\n      seenIds.add(marker.id);\r\n      uniqueAssociatedMarkers.push(marker);\r\n    }\r\n  });\r\n\r\n  uniqueAssociatedMarkers.forEach(marker => {\r\n    const leafletMarker = createMarkerWithPopup(\r\n      marker,\r\n      markersForMercado || baseCompData,\r\n      'secondary'\r\n    );\r\n    if (leafletMarker) {\r\n      map.addLayer(leafletMarker);\r\n      competenciaMarkersRef.current.push(leafletMarker);\r\n\r\n      if (marker.Guerra_Precio === 'Si') {\r\n        const guerraIcon = L.icon({\r\n          iconUrl: `${process.env.PUBLIC_URL}/iconos/calavera.jpg`,\r\n          iconSize: [15, 15],\r\n          iconAnchor: [7.5, 7.5],\r\n          className: 'icono-guerra'\r\n        });\r\n        const guerraMarker = L.marker([marker.lat, marker.lng], { icon: guerraIcon, interactive: false });\r\n        map.addLayer(guerraMarker);\r\n      }\r\n    }\r\n  });\r\n\r\n  const mainMarkersData = associatedData.filter(m => m.Marcador_Principal === 'Si');\r\n  mainMarkersData.forEach(mainMarker => {\r\n    const markerWithCoords = searchArray.find(m => m.id === mainMarker.id);\r\n    if (!markerWithCoords) return;\r\n\r\n    const mainLat = parseFloat(markerWithCoords.lat);\r\n    const mainLng = parseFloat(markerWithCoords.lng);\r\n    if (isNaN(mainLat) || isNaN(mainLng)) return;\r\n\r\n    const currentLat = parseFloat(lat);\r\n    const currentLng = parseFloat(lng);\r\n\r\n    const polyline = L.polyline(\r\n      [[currentLat, currentLng], [mainLat, mainLng]],\r\n      { color: '#FF6B6B', weight: 3, opacity: 0.8, dashArray: '5, 5' }\r\n    ).addTo(map);\r\n\r\n    polylineRef.current.push(polyline);\r\n  });\r\n\r\n  setShowingAssociated(true);\r\n  setActiveMercadoPbl(pbl);\r\n}, [baseCompData, markers, markersForMercado, map, showingAssociated, activeMercadoPbl, clearCompetenciaMarkers, clearPolylines, clearGuerraMarkers, createMarkerWithPopup]);\r\n\r\n  useEffect(() => {\r\n    window.showAssociatedIds = showAssociatedIds;\r\n  }, [showAssociatedIds]);\r\n\r\n  useEffect(() => {\r\n    window.activarCorreccionCoordenadas = (pbl, id, eds, marca) => {\r\n      const identifier = pbl || id;\r\n      if (map) map.getContainer().style.cursor = 'crosshair';\r\n      setModoCorreccion({ pbl, id, eds, marca, lat: null, lng: null });\r\n    };\r\n\r\n    window.guardarCorreccionCoordenadas = async (pbl, id, eds, marca) => {\r\n      if (!modoCorreccion || !modoCorreccion.lat || !modoCorreccion.lng) return;\r\n      let marker = markers.find(m => m.pbl === pbl) || markersForMercado?.find(m => m.pbl === pbl) || baseCompData?.find(m => m.pbl === pbl);\r\n      if (!marker && id) marker = markers.find(m => m.id === id) || markersForMercado?.find(m => m.id === id) || baseCompData?.find(m => m.id === id);\r\n      if (!marker) return;\r\n\r\n      try {\r\n        const coordenada = {\r\n          id: id || marker.id || pbl,\r\n          pbl: pbl || marker.pbl || id,\r\n          eds: eds || marker.eds || '',\r\n          marca: marca || marker.Marca || '',\r\n          comuna: marker.Comuna || '',\r\n          lat_corregida: modoCorreccion.lat,\r\n          lon_corregida: modoCorreccion.lng\r\n        };\r\n        await guardarCoordenadaCorregida(coordenada);\r\n        marker.lat = modoCorreccion.lat;\r\n        marker.lng = modoCorreccion.lng;\r\n\r\n        Object.values(markersRef.current).forEach(m => {\r\n          if (map.hasLayer(m)) map.removeLayer(m);\r\n        });\r\n        markersRef.current = {};\r\n        clearGuerraMarkers();\r\n\r\n        // CAMBIO aquí\r\n        markers.forEach(m => {\r\n          const leafletMarker = createMarkerWithPopup(\r\n            m,\r\n            markersForMercado || markers,\r\n            'primary'\r\n          );\r\n          if (leafletMarker) {\r\n            map.addLayer(leafletMarker);\r\n            markersRef.current[m.id] = leafletMarker;\r\n          }\r\n        });\r\n      } catch (error) {}\r\n    };\r\n    return () => {\r\n      delete window.activarCorreccionCoordenadas;\r\n      delete window.guardarCorreccionCoordenadas;\r\n    };\r\n  }, [map, modoCorreccion, markers, markersForMercado, baseCompData, clearGuerraMarkers, createMarkerWithPopup]);\r\n\r\n  useEffect(() => {\r\n    if (!map || !modoCorreccion) return;\r\n    const handleMapClick = (e) => {\r\n      const { lat, lng } = e.latlng;\r\n      setModoCorreccion(prev => ({ ...prev, lat, lng }));\r\n      // ...el resto de lógica de coordenadas...\r\n    };\r\n    map.on('click', handleMapClick);\r\n    return () => { map.off('click', handleMapClick); };\r\n  }, [map, modoCorreccion]);\r\n\r\n  return null;\r\n};\r\n\r\nexport default IconMarkersLayer;\r\n\r\n\r\n\r\n"],"mappings":"oIAAA,MAAO,CAAAA,KAAK,EAAIC,SAAS,CAAEC,MAAM,CAAEC,QAAQ,CAAEC,WAAW,KAAQ,OAAO,CACvE,OAASC,MAAM,KAAQ,eAAe,CACtC,MAAO,CAAAC,CAAC,KAAM,SAAS,CACvB,MAAO,CAAAC,QAAQ,KAAM,kBAAkB,CACvC,OAASC,gBAAgB,KAAQ,sBAAsB,CACvD,OAASC,0BAA0B,KAAQ,wBAAwB,CACnE,MAAO,CAAAC,UAAU,KAAM,0BAA0B,CACjD,MAAO,gCAAgC,CAEvC;AACA,QAAS,CAAAC,yBAAyBA,CAACC,KAAK,CAAEC,IAAI,CAAE,CAC9C,KAAM,CAAAC,KAAK,CAAGD,IAAI,CACfE,MAAM,CAACC,CAAC,EAAIA,CAAC,CAACJ,KAAK,EAAII,CAAC,CAACJ,KAAK,CAACK,QAAQ,CAAC,CAAC,CAACC,WAAW,CAAC,CAAC,GAAKN,KAAK,CAACM,WAAW,CAAC,CAAC,CAAC,CAChFC,IAAI,CAAC,CAACC,CAAC,CAAEC,CAAC,GAAK,GAAI,CAAAC,IAAI,CAACD,CAAC,CAACE,gBAAgB,EAAIF,CAAC,CAACG,KAAK,CAAC,CAAG,GAAI,CAAAF,IAAI,CAACF,CAAC,CAACG,gBAAgB,EAAIH,CAAC,CAACI,KAAK,CAAC,CAAC,CACpG,MAAO,CAAAV,KAAK,CAAC,CAAC,CAAC,EAAI,IAAI,CACzB,CAKA,KAAM,CAAAW,gBAAgB,CAAGC,IAAA,EAA8E,IAA7E,CAAEC,OAAO,CAAEC,iBAAiB,CAAG,IAAI,CAAEC,cAAc,CAAEC,YAAY,CAAG,EAAG,CAAC,CAAAJ,IAAA,CAChG,KAAM,CAAAK,GAAG,CAAG1B,MAAM,CAAC,CAAC,CACpB,KAAM,CAAA2B,UAAU,CAAG9B,MAAM,CAAC,CAAC,CAAC,CAAC,CAC7B,KAAM,CAAA+B,gBAAgB,CAAG/B,MAAM,CAAC,CAAC,CAAC,CAAC,CACnC,KAAM,CAAAgC,QAAQ,CAAGhC,MAAM,CAAC,CAAC,CAAC,CAAC,CAC3B,KAAM,CAAAiC,mBAAmB,CAAGjC,MAAM,CAAC,KAAK,CAAC,CACzC,KAAM,CAAAkC,aAAa,CAAGlC,MAAM,CAAC,IAAI,CAAC,CAElC,KAAM,CAACmC,iBAAiB,CAAEC,oBAAoB,CAAC,CAAGnC,QAAQ,CAAC,KAAK,CAAC,CACjE,KAAM,CAACoC,mBAAmB,CAAEC,sBAAsB,CAAC,CAAGrC,QAAQ,CAAC,IAAI,CAAC,CACpE,KAAM,CAACsC,gBAAgB,CAAEC,mBAAmB,CAAC,CAAGvC,QAAQ,CAAC,IAAI,CAAC,CAE9D,KAAM,CAAAwC,qBAAqB,CAAGzC,MAAM,CAAC,EAAE,CAAC,CACxC,KAAM,CAAA0C,WAAW,CAAG1C,MAAM,CAAC,EAAE,CAAC,CAE9B,KAAM,CAAC2C,UAAU,CAAEC,aAAa,CAAC,CAAG3C,QAAQ,CAAC,IAAI,CAAC,CAClD,KAAM,CAAC4C,SAAS,CAAEC,YAAY,CAAC,CAAG7C,QAAQ,CAAC,GAAG,CAAC,CAC/C,KAAM,CAAC8C,SAAS,CAAEC,YAAY,CAAC,CAAG/C,QAAQ,CAAC,SAAS,CAAC,CACrD,KAAM,CAACgD,cAAc,CAAEC,iBAAiB,CAAC,CAAGjD,QAAQ,CAAC,IAAI,CAAC,CAE5D;AACA;AACA;AACA;AACA,GACA,QAAS,CAAAkD,yBAAyBA,CAACC,MAAM,CAAEC,aAAa,CAAE,CACxD,KAAM,CAAAC,UAAU,CAAG7C,yBAAyB,CAAC,SAAS,CAAE4C,aAAa,CAACxC,MAAM,CAAC0C,CAAC,EAAIA,CAAC,CAACC,EAAE,GAAKJ,MAAM,CAACI,EAAE,CAAC,CAAC,CACtG,KAAM,CAAAC,UAAU,CAAGhD,yBAAyB,CAAC,SAAS,CAAE4C,aAAa,CAACxC,MAAM,CAAC0C,CAAC,EAAIA,CAAC,CAACC,EAAE,GAAKJ,MAAM,CAACI,EAAE,CAAC,CAAC,CACtG,GAAI,CAACF,UAAU,EAAI,CAACG,UAAU,CAAE,MAAO,KAAI,CAC3C,MAAO,CACLC,GAAG,CAAED,UAAU,CAACC,GAAG,CAAGJ,UAAU,CAACI,GAAG,CACpCC,GAAG,CAAEF,UAAU,CAACE,GAAG,CAAGL,UAAU,CAACK,GAAG,CACpCC,GAAG,CAAEH,UAAU,CAACG,GAAG,CAAGN,UAAU,CAACM,GAAG,CACpCC,MAAM,CAAEJ,UAAU,CAACI,MAAM,CAAGP,UAAU,CAACO,MAAM,CAC7CC,IAAI,CAAEL,UAAU,CAACK,IAAI,CAAGR,UAAU,CAACQ,IACrC,CAAC,CACH,CAME;AACA,KAAM,CAAAC,aAAa,CAAG7D,WAAW,CAAE8D,KAAK,EAAK,CAC3C,GAAI,CAACnC,GAAG,EAAI,CAACmC,KAAK,EAAI,CAACA,KAAK,CAACC,UAAU,CAAE,OACzC,GAAI,CACF,KAAM,CAAAC,GAAG,CAAGrC,GAAG,CAACsC,kBAAkB,CAACH,KAAK,CAACI,SAAS,CAAC,CAAC,CAAC,CACrDhE,CAAC,CAACiE,OAAO,CAACC,WAAW,CAACN,KAAK,CAACO,QAAQ,CAACC,UAAU,CAAEN,GAAG,CAAC,CACrD,KAAM,CAAAO,SAAS,CAAG,GAAI,CAAArE,CAAC,CAACsE,SAAS,CAACV,KAAK,CAACC,UAAU,CAAED,KAAK,CAACO,QAAQ,CAAC,CACnEE,SAAS,CAACE,MAAM,CAAC,CAAC,CACpB,CAAE,MAAOC,KAAK,CAAE,CACdC,OAAO,CAACD,KAAK,CAAC,kBAAkB,CAAEA,KAAK,CAAC,CAC1C,CACF,CAAC,CAAE,CAAC/C,GAAG,CAAC,CAAC,CAET,KAAM,CAAAiD,uBAAuB,CAAG5E,WAAW,CAAC,IAAM,CAChDuC,qBAAqB,CAACsC,OAAO,CAACC,OAAO,CAAC5B,MAAM,EAAI,CAC9C,GAAI,CACF,GAAIvB,GAAG,EAAIA,GAAG,CAACoD,QAAQ,CAAC7B,MAAM,CAAC,CAAE,CAC/BvB,GAAG,CAACqD,WAAW,CAAC9B,MAAM,CAAC,CACzB,CACF,CAAE,MAAO+B,CAAC,CAAE,CACVN,OAAO,CAACD,KAAK,CAAC,8BAA8B,CAAEO,CAAC,CAAC,CAClD,CACF,CAAC,CAAC,CACF1C,qBAAqB,CAACsC,OAAO,CAAG,EAAE,CACpC,CAAC,CAAE,CAAClD,GAAG,CAAC,CAAC,CAET,KAAM,CAAAuD,cAAc,CAAGlF,WAAW,CAAC,IAAM,CACvCwC,WAAW,CAACqC,OAAO,CAACC,OAAO,CAACK,IAAI,EAAI,CAClC,GAAI,CACF,GAAIxD,GAAG,EAAIA,GAAG,CAACoD,QAAQ,CAACI,IAAI,CAAC,CAAE,CAC7BxD,GAAG,CAACqD,WAAW,CAACG,IAAI,CAAC,CACvB,CACF,CAAE,MAAOF,CAAC,CAAE,CACVN,OAAO,CAACD,KAAK,CAAC,2BAA2B,CAAEO,CAAC,CAAC,CAC/C,CACF,CAAC,CAAC,CACFzC,WAAW,CAACqC,OAAO,CAAG,EAAE,CAC1B,CAAC,CAAE,CAAClD,GAAG,CAAC,CAAC,CAET,KAAM,CAAAyD,kBAAkB,CAAGpF,WAAW,CAAC,IAAM,CAC3CqF,MAAM,CAACC,MAAM,CAACzD,gBAAgB,CAACgD,OAAO,CAAC,CAACC,OAAO,CAAC5B,MAAM,EAAI,CACxD,GAAI,CACF,GAAIvB,GAAG,EAAIA,GAAG,CAACoD,QAAQ,CAAC7B,MAAM,CAAC,CAAE,CAC/BvB,GAAG,CAACqD,WAAW,CAAC9B,MAAM,CAAC,CACzB,CACF,CAAE,MAAO+B,CAAC,CAAE,CACVN,OAAO,CAACD,KAAK,CAAC,iCAAiC,CAAEO,CAAC,CAAC,CACrD,CACF,CAAC,CAAC,CACFpD,gBAAgB,CAACgD,OAAO,CAAG,CAAC,CAAC,CAC/B,CAAC,CAAE,CAAClD,GAAG,CAAC,CAAC,CAET,KAAM,CAAA4D,mBAAmB,CAAGvF,WAAW,CAAC,SAACwF,KAAK,CAA0B,IAAxB,CAAAC,OAAO,CAAAC,SAAA,CAAAC,MAAA,IAAAD,SAAA,MAAAE,SAAA,CAAAF,SAAA,IAAG,SAAS,CACjE,GAAI,CAACF,KAAK,EAAIA,KAAK,CAACG,MAAM,GAAK,CAAC,CAAE,CAChC,MAAO,+HAA+H,CACxI,CACA,KAAM,CAAAE,YAAY,CAAGJ,OAAO,GAAK,SAAS,CAAG,EAAE,CAAG,WAAW,CAC7D,GAAI,CAAAK,IAAI,qCAAAC,MAAA,CAAsCF,YAAY,2CAAAE,MAAA,CAC5BF,YAAY,8PAW9B,CACZL,KAAK,CAACV,OAAO,CAAEkB,IAAI,EAAK,CACtBF,IAAI,mCAAAC,MAAA,CAEMC,IAAI,CAACC,KAAK,0BAAAF,MAAA,CACVC,IAAI,CAACxC,GAAG,0BAAAuC,MAAA,CACRC,IAAI,CAACvC,GAAG,0BAAAsC,MAAA,CACRC,IAAI,CAACtC,GAAG,0BAAAqC,MAAA,CACRC,IAAI,CAACrC,MAAM,0BAAAoC,MAAA,CACXC,IAAI,CAACpC,IAAI,wBACX,CACV,CAAC,CAAC,CACFkC,IAAI,0BAA4B,CAChC,MAAO,CAAAA,IAAI,CACb,CAAC,CAAE,EAAE,CAAC,CAEN;AACA,KAAM,CAAAI,sBAAsB,CAAGlG,WAAW,CAAC,SAACmG,QAAQ,CAAEC,SAAS,CAAwB,IAAtB,CAAA5F,KAAK,CAAAkF,SAAA,CAAAC,MAAA,IAAAD,SAAA,MAAAE,SAAA,CAAAF,SAAA,IAAG,SAAS,CAChF,KAAM,CAAAF,KAAK,CAAGY,SAAS,CAACzF,MAAM,CAAC0C,CAAC,EAC9BA,CAAC,CAACC,EAAE,GAAK6C,QAAQ,EACjB9C,CAAC,CAAC7C,KAAK,EACP6C,CAAC,CAAC7C,KAAK,CAACM,WAAW,CAAC,CAAC,GAAKN,KAAK,CAACM,WAAW,CAAC,CAC9C,CAAC,CAED,MAAO,CAAA0E,KAAK,CACTzE,IAAI,CAAC,CAACC,CAAC,CAAEC,CAAC,GAAK,CACd,KAAM,CAAAoF,MAAM,CAAGrF,CAAC,CAACG,gBAAgB,CAAG,GAAI,CAAAD,IAAI,CAACF,CAAC,CAACG,gBAAgB,CAAC,CAAG,GAAI,CAAAD,IAAI,CAAC,CAAC,CAAC,CAC9E,KAAM,CAAAoF,MAAM,CAAGrF,CAAC,CAACE,gBAAgB,CAAG,GAAI,CAAAD,IAAI,CAACD,CAAC,CAACE,gBAAgB,CAAC,CAAG,GAAI,CAAAD,IAAI,CAAC,CAAC,CAAC,CAC9E,MAAO,CAAAoF,MAAM,CAAGD,MAAM,CACxB,CAAC,CAAC,CACD1E,GAAG,CAAC4E,IAAI,GAAK,CACZN,KAAK,CAAEM,IAAI,CAACpF,gBAAgB,EAAIoF,IAAI,CAACnF,KAAK,EAAI,KAAK,CACnDoC,GAAG,CAAE+C,IAAI,CAACC,UAAU,EAAID,IAAI,CAACE,GAAG,EAAI,GAAG,CACvChD,GAAG,CAAE8C,IAAI,CAACG,UAAU,EAAIH,IAAI,CAACI,GAAG,EAAI,GAAG,CACvCjD,GAAG,CAAE6C,IAAI,CAACK,UAAU,EAAIL,IAAI,CAACM,GAAG,EAAI,GAAG,CACvClD,MAAM,CAAE4C,IAAI,CAACO,aAAa,EAAIP,IAAI,CAACQ,MAAM,EAAI,GAAG,CAChDnD,IAAI,CAAE2C,IAAI,CAACS,WAAW,EAAIT,IAAI,CAACU,IAAI,EAAI,GACzC,CAAC,CAAC,CAAC,CACP,CAAC,CAAE,EAAE,CAAC,CAEL;AACD,KAAM,CAAAC,mBAAmB,CAAGlH,WAAW,CAAC,SAACkD,MAAM,CAAEiE,UAAU,CAAEC,gBAAgB,CAA0B,IAAxB,CAAA3B,OAAO,CAAAC,SAAA,CAAAC,MAAA,IAAAD,SAAA,MAAAE,SAAA,CAAAF,SAAA,IAAG,SAAS,CAChG,KAAM,CAAA2B,OAAO,CAAGnE,MAAM,CAACoE,IAAI,CACtBpE,MAAM,CAACoE,IAAI,CAACC,UAAU,CAAC,MAAM,CAAC,CAAGrE,MAAM,CAACoE,IAAI,iCAAAvB,MAAA,CAAmC7C,MAAM,CAACoE,IAAI,CAAE,CAC7F,EAAE,CACN,kHAAAvB,MAAA,CAGQsB,OAAO,eAAAtB,MAAA,CAAgBsB,OAAO,mBAAAtB,MAAA,CAAe7C,MAAM,CAACsE,KAAK,qEAAgE,EAAE,0HAAAzB,MAAA,CACxB7C,MAAM,CAACuE,GAAG,EAAI,GAAG,iIAAA1B,MAAA,CACvB7C,MAAM,CAACwE,GAAG,EAAI,GAAG,mIAAA3B,MAAA,CACnB7C,MAAM,CAACyE,MAAM,EAAI,GAAG,+HAAA5B,MAAA,CACpB7C,MAAM,CAAC0E,SAAS,EAAI,GAAG,4xBAAA7B,MAAA,CAc/B7C,MAAM,CAACI,EAAE,2JAAAyC,MAAA,CAGhB7C,MAAM,CAACI,EAAE,4HAAAyC,MAAA,CAI1D7C,MAAM,CAACI,EAAE,0BAAAyC,MAAA,CAC9BqB,gBAAgB,wJAAArB,MAAA,CAIE7C,MAAM,CAACI,EAAE,uRAAAyC,MAAA,CAI6B7C,MAAM,CAACuE,GAAG,EAAIvE,MAAM,CAACI,EAAE,QAAAyC,MAAA,CAAK7C,MAAM,CAAC2E,GAAG,CAACC,OAAO,CAAC,CAAC,CAAC,2FAAA/B,MAAA,CACjD7C,MAAM,CAACuE,GAAG,EAAIvE,MAAM,CAACI,EAAE,QAAAyC,MAAA,CAAK7C,MAAM,CAAC6E,GAAG,CAACD,OAAO,CAAC,CAAC,CAAC,6JAAA/B,MAAA,CAE7E7C,MAAM,CAAC8E,MAAM,EAAI,GAAG,uDAAAjC,MAAA,CACpB7C,MAAM,CAAC+E,MAAM,EAAI,GAAG,sJAAAlC,MAAA,CAGtB7C,MAAM,CAACuE,GAAG,EAAIvE,MAAM,CAACI,EAAE,iNAAAyC,MAAA,CAA2M7C,MAAM,CAACuE,GAAG,EAAI,EAAE,SAAA1B,MAAA,CAAO7C,MAAM,CAACI,EAAE,EAAI,EAAE,SAAAyC,MAAA,CAAO7C,MAAM,CAACwE,GAAG,SAAA3B,MAAA,CAAO7C,MAAM,CAACsE,KAAK,6EAAAzB,MAAA,CAC5S7C,MAAM,CAACuE,GAAG,EAAIvE,MAAM,CAACI,EAAE,+NAAAyC,MAAA,CAAyN7C,MAAM,CAACuE,GAAG,EAAI,EAAE,SAAA1B,MAAA,CAAO7C,MAAM,CAACI,EAAE,EAAI,EAAE,SAAAyC,MAAA,CAAO7C,MAAM,CAACwE,GAAG,SAAA3B,MAAA,CAAO7C,MAAM,CAACsE,KAAK,oPAAAzB,MAAA,CAKrT7C,MAAM,CAACgF,SAAS,EAAI,GAAG,+DAAAnC,MAAA,CAClB7C,MAAM,CAACiF,uBAAuB,EAAI,GAAG,qEAAApC,MAAA,CAClC7C,MAAM,CAACkF,iBAAiB,EAAI,GAAG,0DAAArC,MAAA,CACvC7C,MAAM,CAACmF,SAAS,EAAI,GAAG,2BAAAtC,MAAA,CACtD7C,MAAM,CAACoF,aAAa,GAAK,IAAI,oKAA0J,EAAE,6FAAAvC,MAAA,CAMjM7C,MAAM,CAACuE,GAAG,GAAKvE,MAAM,CAACsE,KAAK,GAAK,QAAQ,EAAItE,MAAM,CAACsE,KAAK,GAAK,WAAW,CAAC,0GAAAzB,MAAA,CAC6B7C,MAAM,CAACuE,GAAG,OAAA1B,MAAA,CAAK7C,MAAM,CAAC2E,GAAG,OAAA9B,MAAA,CAAK7C,MAAM,CAAC6E,GAAG,QAAAhC,MAAA,CAAM7C,MAAM,CAACI,EAAE,0BAC7J,EAAE,yBAIV,CAAC,CAAE,EAAE,CAAC,CAEL;AACD,KAAM,CAAAiF,kBAAkB,CAAGvI,WAAW,CAAEwI,cAAc,EAAK,CACzD,KAAM,CAAAC,OAAO,CAAGD,cAAc,CAACE,aAAa,CAAC,gCAAgC,CAAC,CAC9E,KAAM,CAAAC,OAAO,CAAGH,cAAc,CAACE,aAAa,CAAC,wBAAwB,CAAC,CACtE,GAAI,CAACD,OAAO,EAAI,CAACE,OAAO,CAAE,OAE1BA,OAAO,SAAPA,OAAO,iBAAPA,OAAO,CAAEC,gBAAgB,CAAC,oBAAoB,CAAC,CAAC9D,OAAO,CAAC+D,CAAC,EAAIA,CAAC,CAACC,MAAM,CAAC,CAAC,CAAC,CAExE,KAAM,CAAAC,WAAW,CAAI9D,CAAC,EAAK,CACzBA,CAAC,CAAC+D,cAAc,CAAC,CAAC,CAClB,KAAM,CAAAC,WAAW,CAAG,GAAG,CACvB,KAAM,CAAAC,YAAY,CAAGjE,CAAC,CAACkE,MAAM,CAAGF,WAAW,CAC3CN,OAAO,CAACS,SAAS,EAAIF,YAAY,CACnC,CAAC,CAEDP,OAAO,CAACU,gBAAgB,CAAC,OAAO,CAAEN,WAAW,CAAE,CAAEO,OAAO,CAAE,KAAM,CAAC,CAAC,CAElE,GAAI,CAAAC,IAAI,CAAGd,OAAO,CAACC,aAAa,CAAC,oBAAoB,CAAC,CACtD,GAAI,CAACa,IAAI,CAAE,CACTA,IAAI,CAAGC,QAAQ,CAACC,aAAa,CAAC,KAAK,CAAC,CACpCF,IAAI,CAACG,SAAS,CAAG,mBAAmB,CACpCjB,OAAO,CAACkB,WAAW,CAACJ,IAAI,CAAC,CAEzB,GAAI,CAAAK,UAAU,CAAG,KAAK,CAEtB,KAAM,CAAAC,WAAW,CAAI5E,CAAC,EAAK,CACzB2E,UAAU,CAAG,IAAI,CACjBJ,QAAQ,CAACM,IAAI,CAACC,SAAS,CAACC,GAAG,CAAC,mBAAmB,CAAC,CAChDR,QAAQ,CAACM,IAAI,CAACG,KAAK,CAACC,MAAM,CAAG,aAAa,CAC1CV,QAAQ,CAACM,IAAI,CAACG,KAAK,CAACE,UAAU,CAAG,MAAM,CACvClF,CAAC,CAAC+D,cAAc,CAAC,CAAC,CAClB/D,CAAC,CAACmF,eAAe,CAAC,CAAC,CACrB,CAAC,CAED,KAAM,CAAAC,QAAQ,CAAIpF,CAAC,EAAK,CACtB,GAAI,CAAC2E,UAAU,CAAE,OAEjB,KAAM,CAAAU,OAAO,CAAGrF,CAAC,CAACqF,OAAO,EAAKrF,CAAC,CAACsF,OAAO,EAAItF,CAAC,CAACsF,OAAO,CAAC,CAAC,CAAC,CAACD,OAAQ,CAChE,KAAM,CAAAE,OAAO,CAAGvF,CAAC,CAACuF,OAAO,EAAKvF,CAAC,CAACsF,OAAO,EAAItF,CAAC,CAACsF,OAAO,CAAC,CAAC,CAAC,CAACC,OAAQ,CAEhE,KAAM,CAAAC,QAAQ,CAAGlB,IAAI,CAACmB,qBAAqB,CAAC,CAAC,CAC7C,KAAM,CAAAC,WAAW,CAAGF,QAAQ,CAACG,IAAI,CAAGH,QAAQ,CAACI,KAAK,CAAG,CAAC,CACtD,KAAM,CAAAC,WAAW,CAAGL,QAAQ,CAACM,GAAG,CAAGN,QAAQ,CAACO,MAAM,CAAG,CAAC,CAEtD,KAAM,CAAAC,MAAM,CAAGX,OAAO,CAAGK,WAAW,CACpC,KAAM,CAAAxB,MAAM,CAAGqB,OAAO,CAAGM,WAAW,CAEpC,GAAII,IAAI,CAACC,GAAG,CAACF,MAAM,CAAC,CAAG,CAAC,EAAIC,IAAI,CAACC,GAAG,CAAChC,MAAM,CAAC,CAAG,CAAC,CAAE,CAChD,KAAM,CAAAiC,WAAW,CAAGzC,OAAO,CAAC+B,qBAAqB,CAAC,CAAC,CACnD,KAAM,CAAAW,QAAQ,CAAGH,IAAI,CAACI,GAAG,CAAC,GAAG,CAAEF,WAAW,CAACP,KAAK,CAAGI,MAAM,CAAC,CAC1D,KAAM,CAAAM,SAAS,CAAGL,IAAI,CAACI,GAAG,CAAC,GAAG,CAAEF,WAAW,CAACJ,MAAM,CAAG7B,MAAM,CAAC,CAE5DR,OAAO,CAACsB,KAAK,CAACY,KAAK,CAAGQ,QAAQ,CAAG,IAAI,CACrC1C,OAAO,CAACsB,KAAK,CAACe,MAAM,CAAGO,SAAS,CAAG,IAAI,CACzC,CAEAtG,CAAC,CAAC+D,cAAc,CAAC,CAAC,CACpB,CAAC,CAED,KAAM,CAAAwC,UAAU,CAAGA,CAAA,GAAM,CACvB,GAAI,CAAC5B,UAAU,CAAE,OACjBA,UAAU,CAAG,KAAK,CAClBJ,QAAQ,CAACM,IAAI,CAACC,SAAS,CAACjB,MAAM,CAAC,mBAAmB,CAAC,CACnDU,QAAQ,CAACM,IAAI,CAACG,KAAK,CAACC,MAAM,CAAG,EAAE,CAC/BV,QAAQ,CAACM,IAAI,CAACG,KAAK,CAACE,UAAU,CAAG,EAAE,CACrC,CAAC,CAEDZ,IAAI,CAACF,gBAAgB,CAAC,WAAW,CAAEQ,WAAW,CAAC,CAC/CL,QAAQ,CAACH,gBAAgB,CAAC,WAAW,CAAEgB,QAAQ,CAAC,CAChDb,QAAQ,CAACH,gBAAgB,CAAC,SAAS,CAAEmC,UAAU,CAAC,CAEhDjC,IAAI,CAACF,gBAAgB,CAAC,YAAY,CAAEQ,WAAW,CAAE,CAAEP,OAAO,CAAE,KAAM,CAAC,CAAC,CACpEE,QAAQ,CAACH,gBAAgB,CAAC,WAAW,CAAEgB,QAAQ,CAAE,CAAEf,OAAO,CAAE,KAAM,CAAC,CAAC,CACpEE,QAAQ,CAACH,gBAAgB,CAAC,UAAU,CAAEmC,UAAU,CAAC,CAEjD,KAAM,CAAAC,OAAO,CAAGA,CAAA,GAAM,CACpB9C,OAAO,CAAC+C,mBAAmB,CAAC,OAAO,CAAE3C,WAAW,CAAC,CACjDS,QAAQ,CAACkC,mBAAmB,CAAC,WAAW,CAAErB,QAAQ,CAAC,CACnDb,QAAQ,CAACkC,mBAAmB,CAAC,SAAS,CAAEF,UAAU,CAAC,CACnDhC,QAAQ,CAACkC,mBAAmB,CAAC,WAAW,CAAErB,QAAQ,CAAC,CACnDb,QAAQ,CAACkC,mBAAmB,CAAC,UAAU,CAAEF,UAAU,CAAC,CACpDhC,QAAQ,CAACM,IAAI,CAACC,SAAS,CAACjB,MAAM,CAAC,mBAAmB,CAAC,CACrD,CAAC,CAEDS,IAAI,CAACoC,QAAQ,CAAGF,OAAO,CACzB,CACF,CAAC,CAAE,EAAE,CAAC,CAEN;AACA,KAAM,CAAAG,gBAAgB,CAAG5L,WAAW,CAAC,CAACwI,cAAc,CAAEtF,MAAM,CAAE2I,UAAU,CAAEpG,OAAO,GAAK,CACpF,KAAM,CAAAqG,YAAY,CAAGtD,cAAc,CAACI,gBAAgB,CAAC,mBAAmB,CAAC,CACzE,GAAIkD,YAAY,CAACnG,MAAM,GAAK,CAAC,CAAE,OAE/BmG,YAAY,CAAChH,OAAO,CAACiH,GAAG,EAAI,CAC1BA,GAAG,CAAC1C,gBAAgB,CAAC,OAAO,CAAE,SAAS2C,KAAK,CAAE,CAC5CA,KAAK,CAAC5B,eAAe,CAAC,CAAC,CACvB4B,KAAK,CAAChD,cAAc,CAAC,CAAC,CAEtB,KAAM,CAAAxI,KAAK,CAAG,IAAI,CAACyL,YAAY,CAAC,YAAY,CAAC,CAC7C,KAAM,CAAA9F,QAAQ,CAAG,IAAI,CAAC8F,YAAY,CAAC,gBAAgB,CAAC,CAEpDzD,cAAc,CAACI,gBAAgB,CAAC,mBAAmB,CAAC,CAAC9D,OAAO,CAAC7D,CAAC,EAAIA,CAAC,CAAC8I,SAAS,CAACjB,MAAM,CAAC,QAAQ,CAAC,CAAC,CAC/F,IAAI,CAACiB,SAAS,CAACC,GAAG,CAAC,QAAQ,CAAC,CAE5B,KAAM,CAAA7C,UAAU,CAAGjB,sBAAsB,CAAChD,MAAM,CAACI,EAAE,CAAEuI,UAAU,CAAErL,KAAK,CAAC,CACvE,KAAM,CAAA0L,cAAc,CAAG3G,mBAAmB,CAAC4B,UAAU,CAAE1B,OAAO,CAAC,CAE/D,KAAM,CAAA0G,cAAc,CAAG3D,cAAc,CAACE,aAAa,mBAAA3C,MAAA,CAAmBI,QAAQ,CAAE,CAAC,CACjF,GAAIgG,cAAc,CAAE,CAClBA,cAAc,CAACC,SAAS,CAAGF,cAAc,CAC3C,CACF,CAAC,CAAC,CACJ,CAAC,CAAC,CACJ,CAAC,CAAE,CAAChG,sBAAsB,CAAEX,mBAAmB,CAAC,CAAC,CAEjD;AACA,KAAM,CAAA8G,iBAAiB,CAAGrM,WAAW,CAAC,CAACwI,cAAc,CAAEtF,MAAM,CAAEiE,UAAU,GAAK,CAC5E,KAAM,CAAAmF,iBAAiB,CAAIN,KAAK,EAAK,CACnC,GAAI,CAACxD,cAAc,CAAC+D,QAAQ,CAACP,KAAK,CAACQ,MAAM,CAAC,CAAE,OAE5C,KAAM,CAAAT,GAAG,CAAGC,KAAK,CAACQ,MAAM,CAACC,OAAO,CAAC,mBAAmB,CAAC,CACrD,GAAI,CAACV,GAAG,CAAE,OAEVC,KAAK,CAAC5B,eAAe,CAAC,CAAC,CACvB4B,KAAK,CAAChD,cAAc,CAAC,CAAC,CAEtB,KAAM,CAAA0D,OAAO,CAAGX,GAAG,CAACE,YAAY,CAAC,UAAU,CAAC,CAC5C,GAAI,CAACS,OAAO,CAAE,OACdlE,cAAc,CAACI,gBAAgB,CAAC,mBAAmB,CAAC,CAAC9D,OAAO,CAAC7D,CAAC,EAAIA,CAAC,CAAC8I,SAAS,CAACjB,MAAM,CAAC,QAAQ,CAAC,CAAC,CAC/FN,cAAc,CAACI,gBAAgB,CAAC,iBAAiB,CAAC,CAAC9D,OAAO,CAAC6H,IAAI,EAAIA,IAAI,CAAC5C,SAAS,CAACjB,MAAM,CAAC,QAAQ,CAAC,CAAC,CAEnGiD,GAAG,CAAChC,SAAS,CAACC,GAAG,CAAC,QAAQ,CAAC,CAC3B,KAAM,CAAA4C,UAAU,CAAGpE,cAAc,CAACE,aAAa,+BAAA3C,MAAA,CAA8B2G,OAAO,OAAI,CAAC,CACzF,GAAIE,UAAU,CAAE,CACdA,UAAU,CAAC7C,SAAS,CAACC,GAAG,CAAC,QAAQ,CAAC,CACpC,CAEA,GAAI0C,OAAO,GAAK,YAAY,CAAE,CAC5B,KAAM,CAAAG,EAAE,CAAGrE,cAAc,CAACE,aAAa,gBAAA3C,MAAA,CAAgB7C,MAAM,CAACI,EAAE,CAAE,CAAC,CACnE,GAAIuJ,EAAE,EAAI,CAACA,EAAE,CAACC,SAAS,CAAE,CACvB,KAAM,CAAAC,IAAI,CAAG5M,QAAQ,CAAC6M,UAAU,CAACH,EAAE,CAAC,CACpCE,IAAI,CAACE,MAAM,cAACrN,KAAK,CAAC6J,aAAa,CAACnJ,UAAU,CAAE,CAC1C4M,QAAQ,CAAE/F,UAAU,CACpBgG,SAAS,CAAE,CAAC,CACZnC,MAAM,CAAE,GAAG,CACXoC,OAAO,CAAE,IACX,CAAC,CAAC,CAAC,CACHP,EAAE,CAACC,SAAS,CAAG,IAAI,CACnBD,EAAE,CAACQ,MAAM,CAAGN,IAAI,CAClB,CACF,CACF,CAAC,CAED,GAAIvE,cAAc,CAAC8E,oBAAoB,CAAE,CACvC9D,QAAQ,CAACkC,mBAAmB,CAAC,OAAO,CAAElD,cAAc,CAAC8E,oBAAoB,CAAE,IAAI,CAAC,CAClF,CAEA9D,QAAQ,CAACH,gBAAgB,CAAC,OAAO,CAAEiD,iBAAiB,CAAE,IAAI,CAAC,CAC3D9D,cAAc,CAAC8E,oBAAoB,CAAGhB,iBAAiB,CACzD,CAAC,CAAE,EAAE,CAAC,CAEN,KAAM,CAAAiB,mBAAmB,CAAGvN,WAAW,CAAC,CAAC8D,KAAK,CAAE0E,cAAc,CAAEtF,MAAM,CAAE2I,UAAU,CAAEpG,OAAO,GAAK,CAC9F8C,kBAAkB,CAACC,cAAc,CAAC,CAClC,KAAM,CAAArB,UAAU,CAAGjB,sBAAsB,CAAChD,MAAM,CAACI,EAAE,CAAEuI,UAAU,CAAE,SAAS,CAAC,CAC3EQ,iBAAiB,CAAC7D,cAAc,CAAEtF,MAAM,CAAEiE,UAAU,CAAC,CACrDyE,gBAAgB,CAACpD,cAAc,CAAEtF,MAAM,CAAE2I,UAAU,CAAEpG,OAAO,CAAC,CAC/D,CAAC,CAAE,CAAC8C,kBAAkB,CAAErC,sBAAsB,CAAEmG,iBAAiB,CAAET,gBAAgB,CAAC,CAAC,CAErF;AACA,KAAM,CAAA4B,qBAAqB,CAAGxN,WAAW,CAAC,SAACkD,MAAM,CAAE2I,UAAU,CAA0B,IAAxB,CAAApG,OAAO,CAAAC,SAAA,CAAAC,MAAA,IAAAD,SAAA,MAAAE,SAAA,CAAAF,SAAA,IAAG,SAAS,CAChF,KAAM,CAAAmC,GAAG,CAAG4F,UAAU,CAACvK,MAAM,CAAC2E,GAAG,CAAC,CAClC,KAAM,CAAAE,GAAG,CAAG0F,UAAU,CAACvK,MAAM,CAAC6E,GAAG,CAAC,CAClC,GAAI2F,KAAK,CAAC7F,GAAG,CAAC,EAAI6F,KAAK,CAAC3F,GAAG,CAAC,CAAE,MAAO,KAAI,CAEzC,KAAM,CAAA4F,OAAO,CAAGvN,gBAAgB,CAAC8C,MAAM,CAACsE,KAAK,CAAC,CAC9C,KAAM,CAAAoG,aAAa,CAAG1N,CAAC,CAACgD,MAAM,CAAC,CAAC2E,GAAG,CAAEE,GAAG,CAAC,CAAE,CAAE8F,IAAI,CAAEF,OAAQ,CAAC,CAAC,CAE7D,KAAM,CAAAxG,UAAU,CAAGjB,sBAAsB,CAAChD,MAAM,CAACI,EAAE,CAAEuI,UAAU,CAAE,SAAS,CAAC,CAC3E,KAAM,CAAAzE,gBAAgB,CAAG7B,mBAAmB,CAAC4B,UAAU,CAAE1B,OAAO,CAAC,CACjE,KAAM,CAAAqI,YAAY,CAAG5G,mBAAmB,CAAChE,MAAM,CAAEiE,UAAU,CAAEC,gBAAgB,CAAE3B,OAAO,CAAC,CAEvF,KAAM,CAAA3B,KAAK,CAAG5D,CAAC,CAAC4D,KAAK,CAAC,CACpBiK,SAAS,CAAE,KAAK,CAChBC,YAAY,CAAE,KAAK,CACnBC,UAAU,CAAE,IAAI,CAChBC,OAAO,CAAE,KAAK,CACdC,QAAQ,CAAE,GAAG,CACbzE,SAAS,CAAE,cACb,CAAC,CAAC,CAAC0E,UAAU,CAACN,YAAY,CAAC,CAE3BF,aAAa,CAACS,SAAS,CAACvK,KAAK,CAAC,CAE9B8J,aAAa,CAACU,EAAE,CAAC,WAAW,CAAGrJ,CAAC,EAAK,CACnCpB,aAAa,CAACC,KAAK,CAAC,CACpByK,UAAU,CAAC,IAAM,CACf,KAAM,CAAA/F,cAAc,CAAGvD,CAAC,CAACnB,KAAK,CAACC,UAAU,CACzC,GAAI,CAACyE,cAAc,CAAE,OACrB+E,mBAAmB,CAACzJ,KAAK,CAAE0E,cAAc,CAAEtF,MAAM,CAAE2I,UAAU,CAAEpG,OAAO,CAAC,CACzE,CAAC,CAAE,EAAE,CAAC,CACR,CAAC,CAAC,CAEFmI,aAAa,CAACU,EAAE,CAAC,YAAY,CAAGrJ,CAAC,EAAK,KAAAuJ,QAAA,CACpC,KAAM,CAAAC,SAAS,EAAAD,QAAA,CAAGvJ,CAAC,CAACnB,KAAK,UAAA0K,QAAA,iBAAPA,QAAA,CAASzK,UAAU,CACrC,GAAI,CAAC0K,SAAS,CAAE,OAEhB,KAAM,CAAA5B,EAAE,CAAG4B,SAAS,CAAC/F,aAAa,gBAAA3C,MAAA,CAAgB7C,MAAM,CAACI,EAAE,CAAE,CAAC,CAC9D,GAAIuJ,EAAE,EAAIA,EAAE,CAACQ,MAAM,CAAE,CACnBR,EAAE,CAACQ,MAAM,CAACqB,OAAO,CAAC,CAAC,CACnB7B,EAAE,CAACC,SAAS,CAAG,KAAK,CACpBD,EAAE,CAACQ,MAAM,CAAG,IAAI,CAClB,CAEA,GAAIoB,SAAS,CAACnB,oBAAoB,CAAE,CAClC9D,QAAQ,CAACkC,mBAAmB,CAAC,OAAO,CAAE+C,SAAS,CAACnB,oBAAoB,CAAE,IAAI,CAAC,CAC3EmB,SAAS,CAACnB,oBAAoB,CAAG,IAAI,CACvC,CAEA,KAAM,CAAA7E,OAAO,CAAGgG,SAAS,CAAC/F,aAAa,CAAC,gCAAgC,CAAC,CACzE,KAAM,CAAAa,IAAI,CAAGd,OAAO,SAAPA,OAAO,iBAAPA,OAAO,CAAEC,aAAa,CAAC,oBAAoB,CAAC,CACzD,GAAIa,IAAI,EAAIA,IAAI,CAACoC,QAAQ,CAAE,CACzBpC,IAAI,CAACoC,QAAQ,CAAC,CAAC,CACjB,CACF,CAAC,CAAC,CAEFiC,aAAa,CAACU,EAAE,CAAC,OAAO,CAAE,IAAM,CAC9BV,aAAa,CAACe,SAAS,CAAC,CAAC,CAC3B,CAAC,CAAC,CAEF,MAAO,CAAAf,aAAa,CACtB,CAAC,CAAE,CAAC/J,aAAa,CAAEqC,sBAAsB,CAAEX,mBAAmB,CAAE2B,mBAAmB,CAAEqG,mBAAmB,CAAC,CAAC,CAE1G;AACD1N,SAAS,CAAC,IAAM,CACf,GAAI,CAAC8B,GAAG,EAAI,CAACJ,OAAO,EAAIA,OAAO,CAACoE,MAAM,GAAK,CAAC,CAAE,OAC9Cf,uBAAuB,CAAC,CAAC,CACzBM,cAAc,CAAC,CAAC,CAChBhD,oBAAoB,CAAC,KAAK,CAAC,CAC3BI,mBAAmB,CAAC,IAAI,CAAC,CAEzB+C,MAAM,CAACC,MAAM,CAAC1D,UAAU,CAACiD,OAAO,CAAC,CAACC,OAAO,CAAC5B,MAAM,EAAI,CAClD,GAAI,CAAE,GAAIvB,GAAG,EAAIA,GAAG,CAACoD,QAAQ,CAAC7B,MAAM,CAAC,CAAEvB,GAAG,CAACqD,WAAW,CAAC9B,MAAM,CAAC,CAAE,CAAE,MAAO+B,CAAC,CAAE,CAAE,CAChF,CAAC,CAAC,CACFrD,UAAU,CAACiD,OAAO,CAAG,CAAC,CAAC,CACvBO,kBAAkB,CAAC,CAAC,CAEpB;AACA7D,OAAO,CAACuD,OAAO,CAAC5B,MAAM,EAAI,CACxB,KAAM,CAAA0K,aAAa,CAAGJ,qBAAqB,CACzCtK,MAAM,CACN1B,iBAAiB,EAAID,OAAO,CAC5B,SACF,CAAC,CACD,GAAIqM,aAAa,CAAE,CACjBjM,GAAG,CAACiN,QAAQ,CAAChB,aAAa,CAAC,CAC3BhM,UAAU,CAACiD,OAAO,CAAC3B,MAAM,CAACI,EAAE,CAAC,CAAGsK,aAAa,CAC7C,GAAI1K,MAAM,CAACoF,aAAa,GAAK,IAAI,CAAE,CACjC,KAAM,CAAAuG,UAAU,CAAG3O,CAAC,CAAC2N,IAAI,CAAC,CACxBF,OAAO,IAAA5H,MAAA,CAAK+I,OAAO,CAACC,GAAG,CAACC,UAAU,wBAAsB,CACxDC,QAAQ,CAAE,CAAC,EAAE,CAAE,EAAE,CAAC,CAClBC,UAAU,CAAE,CAAC,GAAG,CAAE,GAAG,CAAC,CACtBxF,SAAS,CAAE,cACb,CAAC,CAAC,CACF,KAAM,CAAAyF,YAAY,CAAGjP,CAAC,CAACgD,MAAM,CAAC,CAACA,MAAM,CAAC2E,GAAG,CAAE3E,MAAM,CAAC6E,GAAG,CAAC,CAAE,CAAE8F,IAAI,CAAEgB,UAAU,CAAEO,WAAW,CAAE,KAAM,CAAC,CAAC,CACjGzN,GAAG,CAACiN,QAAQ,CAACO,YAAY,CAAC,CAC1BtN,gBAAgB,CAACgD,OAAO,CAAC3B,MAAM,CAACI,EAAE,CAAC,CAAG6L,YAAY,CACpD,CACF,CACF,CAAC,CAAC,CAEF;AACA,GAAI5N,OAAO,CAACoE,MAAM,GAAK,CAAC,EAAI/D,UAAU,CAACiD,OAAO,CAACtD,OAAO,CAAC,CAAC,CAAC,CAAC+B,EAAE,CAAC,CAAE,CAC7D1B,UAAU,CAACiD,OAAO,CAACtD,OAAO,CAAC,CAAC,CAAC,CAAC+B,EAAE,CAAC,CAACqL,SAAS,CAAC,CAAC,CAC/C,CAEF,CAAC,CAAE,CAAChN,GAAG,CAAEJ,OAAO,CAAEC,iBAAiB,CAAEC,cAAc,CAAEmD,uBAAuB,CAAEM,cAAc,CAAEE,kBAAkB,CAAEoI,qBAAqB,CAAC,CAAC,CAEvI,KAAM,CAAA6B,iBAAiB,CAAGrP,WAAW,CAAC,CAACyH,GAAG,CAAEI,GAAG,CAAEE,GAAG,CAAEuH,gBAAgB,GAAK,CAC3E,KAAM,CAAAC,WAAW,CAAG/N,iBAAiB,EAAIA,iBAAiB,CAACmE,MAAM,CAAG,CAAC,CAAGnE,iBAAiB,CAAGD,OAAO,CAEnG,GAAIU,iBAAiB,EAAII,gBAAgB,GAAKoF,GAAG,CAAE,CACjD7C,uBAAuB,CAAC,CAAC,CACzBM,cAAc,CAAC,CAAC,CAChBhD,oBAAoB,CAAC,KAAK,CAAC,CAC3BI,mBAAmB,CAAC,IAAI,CAAC,CAEzB+C,MAAM,CAACC,MAAM,CAAC1D,UAAU,CAACiD,OAAO,CAAC,CAACC,OAAO,CAAC5B,MAAM,EAAI,CAClD,GAAI,CACF,GAAIvB,GAAG,EAAIA,GAAG,CAACoD,QAAQ,CAAC7B,MAAM,CAAC,CAAE,CAC/BvB,GAAG,CAACqD,WAAW,CAAC9B,MAAM,CAAC,CACzB,CACF,CAAE,MAAO+B,CAAC,CAAE,CACVN,OAAO,CAACD,KAAK,CAAC,4BAA4B,CAAEO,CAAC,CAAC,CAChD,CACF,CAAC,CAAC,CACFrD,UAAU,CAACiD,OAAO,CAAG,CAAC,CAAC,CAEvBtD,OAAO,CAACuD,OAAO,CAAC5B,MAAM,EAAI,CACxB,KAAM,CAAA0K,aAAa,CAAGJ,qBAAqB,CACzCtK,MAAM,CACN1B,iBAAiB,EAAID,OAAO,CAC5B,SACF,CAAC,CACD,GAAIqM,aAAa,CAAE,CACjBjM,GAAG,CAACiN,QAAQ,CAAChB,aAAa,CAAC,CAC3BhM,UAAU,CAACiD,OAAO,CAAC3B,MAAM,CAACI,EAAE,CAAC,CAAGsK,aAAa,CAE7C,GAAI1K,MAAM,CAACoF,aAAa,GAAK,IAAI,CAAE,CACjC,KAAM,CAAAuG,UAAU,CAAG3O,CAAC,CAAC2N,IAAI,CAAC,CACxBF,OAAO,IAAA5H,MAAA,CAAK+I,OAAO,CAACC,GAAG,CAACC,UAAU,wBAAsB,CACxDC,QAAQ,CAAE,CAAC,EAAE,CAAE,EAAE,CAAC,CAClBC,UAAU,CAAE,CAAC,GAAG,CAAE,GAAG,CAAC,CACtBxF,SAAS,CAAE,cACb,CAAC,CAAC,CACF,KAAM,CAAAyF,YAAY,CAAGjP,CAAC,CAACgD,MAAM,CAAC,CAACA,MAAM,CAAC2E,GAAG,CAAE3E,MAAM,CAAC6E,GAAG,CAAC,CAAE,CAAE8F,IAAI,CAAEgB,UAAU,CAAEO,WAAW,CAAE,KAAM,CAAC,CAAC,CACjGzN,GAAG,CAACiN,QAAQ,CAACO,YAAY,CAAC,CAC1BtN,gBAAgB,CAACgD,OAAO,CAAC3B,MAAM,CAACI,EAAE,CAAC,CAAG6L,YAAY,CACpD,CACF,CACF,CAAC,CAAC,CACF,OACF,CAEAvK,uBAAuB,CAAC,CAAC,CACzBM,cAAc,CAAC,CAAC,CAEhB,KAAM,CAAAsK,cAAc,CAAG9N,YAAY,CAACf,MAAM,CAAC4F,IAAI,EAAIkJ,MAAM,CAAClJ,IAAI,CAACkB,GAAG,CAAC,CAACiI,IAAI,CAAC,CAAC,GAAKD,MAAM,CAAChI,GAAG,CAAC,CAACiI,IAAI,CAAC,CAAC,CAAC,CAClG,GAAIF,cAAc,CAAC7J,MAAM,GAAK,CAAC,CAAE,OAEjC,KAAM,CAAAgK,GAAG,CAAGH,cAAc,CAAC7N,GAAG,CAAC4E,IAAI,EAAIA,IAAI,CAACjD,EAAE,CAAC,CAE/C+B,MAAM,CAACC,MAAM,CAAC1D,UAAU,CAACiD,OAAO,CAAC,CAACC,OAAO,CAAC5B,MAAM,EAAI,CAClD,GAAI,CACF,GAAIvB,GAAG,EAAIA,GAAG,CAACoD,QAAQ,CAAC7B,MAAM,CAAC,CAAE,CAC/BvB,GAAG,CAACqD,WAAW,CAAC9B,MAAM,CAAC,CACzB,CACF,CAAE,MAAO+B,CAAC,CAAE,CACVN,OAAO,CAACD,KAAK,CAAC,4BAA4B,CAAEO,CAAC,CAAC,CAChD,CACF,CAAC,CAAC,CACFrD,UAAU,CAACiD,OAAO,CAAG,CAAC,CAAC,CACvBO,kBAAkB,CAAC,CAAC,CAEpB,KAAM,CAAAwK,cAAc,CAAGrO,OAAO,CAACsO,IAAI,CAACxM,CAAC,EAAIA,CAAC,CAACC,EAAE,GAAKgM,gBAAgB,CAAC,CACnE,GAAIM,cAAc,CAAE,CAClB,KAAM,CAAAhC,aAAa,CAAGJ,qBAAqB,CACzCoC,cAAc,CACdpO,iBAAiB,EAAID,OAAO,CAC5B,SACF,CAAC,CACD,GAAIqM,aAAa,CAAE,CACjBjM,GAAG,CAACiN,QAAQ,CAAChB,aAAa,CAAC,CAC3BhM,UAAU,CAACiD,OAAO,CAAC+K,cAAc,CAACtM,EAAE,CAAC,CAAGsK,aAAa,CAErD,GAAIgC,cAAc,CAACtH,aAAa,GAAK,IAAI,CAAE,CACzC,KAAM,CAAAuG,UAAU,CAAG3O,CAAC,CAAC2N,IAAI,CAAC,CACxBF,OAAO,IAAA5H,MAAA,CAAK+I,OAAO,CAACC,GAAG,CAACC,UAAU,wBAAsB,CACxDC,QAAQ,CAAE,CAAC,EAAE,CAAE,EAAE,CAAC,CAClBC,UAAU,CAAE,CAAC,GAAG,CAAE,GAAG,CAAC,CACtBxF,SAAS,CAAE,cACb,CAAC,CAAC,CACF,KAAM,CAAAyF,YAAY,CAAGjP,CAAC,CAACgD,MAAM,CAAC,CAAC0M,cAAc,CAAC/H,GAAG,CAAE+H,cAAc,CAAC7H,GAAG,CAAC,CAAE,CAAE8F,IAAI,CAAEgB,UAAU,CAAEO,WAAW,CAAE,KAAM,CAAC,CAAC,CACjHzN,GAAG,CAACiN,QAAQ,CAACO,YAAY,CAAC,CAC1BtN,gBAAgB,CAACgD,OAAO,CAAC+K,cAAc,CAACtM,EAAE,CAAC,CAAG6L,YAAY,CAC5D,CACF,CACF,CAEA;AACA,KAAM,CAAAW,iBAAiB,CAAGP,WAAW,CAAC5O,MAAM,CAAC4F,IAAI,EAAIoJ,GAAG,CAACI,QAAQ,CAACxJ,IAAI,CAACjD,EAAE,CAAC,CAAC,CAC3E,KAAM,CAAA0M,uBAAuB,CAAG,EAAE,CAClC,KAAM,CAAAC,OAAO,CAAG,GAAI,CAAAC,GAAG,CAAC,CAAC,CAEzBJ,iBAAiB,CAAChL,OAAO,CAAC5B,MAAM,EAAI,CAClC,GAAI,CAAC+M,OAAO,CAACE,GAAG,CAACjN,MAAM,CAACI,EAAE,CAAC,CAAE,CAC3B2M,OAAO,CAACjG,GAAG,CAAC9G,MAAM,CAACI,EAAE,CAAC,CACtB0M,uBAAuB,CAACI,IAAI,CAAClN,MAAM,CAAC,CACtC,CACF,CAAC,CAAC,CAEF8M,uBAAuB,CAAClL,OAAO,CAAC5B,MAAM,EAAI,CACxC,KAAM,CAAA0K,aAAa,CAAGJ,qBAAqB,CACzCtK,MAAM,CACN1B,iBAAiB,EAAIE,YAAY,CACjC,WACF,CAAC,CACD,GAAIkM,aAAa,CAAE,CACjBjM,GAAG,CAACiN,QAAQ,CAAChB,aAAa,CAAC,CAC3BrL,qBAAqB,CAACsC,OAAO,CAACuL,IAAI,CAACxC,aAAa,CAAC,CAEjD,GAAI1K,MAAM,CAACoF,aAAa,GAAK,IAAI,CAAE,CACjC,KAAM,CAAAuG,UAAU,CAAG3O,CAAC,CAAC2N,IAAI,CAAC,CACxBF,OAAO,IAAA5H,MAAA,CAAK+I,OAAO,CAACC,GAAG,CAACC,UAAU,wBAAsB,CACxDC,QAAQ,CAAE,CAAC,EAAE,CAAE,EAAE,CAAC,CAClBC,UAAU,CAAE,CAAC,GAAG,CAAE,GAAG,CAAC,CACtBxF,SAAS,CAAE,cACb,CAAC,CAAC,CACF,KAAM,CAAAyF,YAAY,CAAGjP,CAAC,CAACgD,MAAM,CAAC,CAACA,MAAM,CAAC2E,GAAG,CAAE3E,MAAM,CAAC6E,GAAG,CAAC,CAAE,CAAE8F,IAAI,CAAEgB,UAAU,CAAEO,WAAW,CAAE,KAAM,CAAC,CAAC,CACjGzN,GAAG,CAACiN,QAAQ,CAACO,YAAY,CAAC,CAC5B,CACF,CACF,CAAC,CAAC,CAEF,KAAM,CAAAkB,eAAe,CAAGb,cAAc,CAAC7O,MAAM,CAAC0C,CAAC,EAAIA,CAAC,CAACiN,kBAAkB,GAAK,IAAI,CAAC,CACjFD,eAAe,CAACvL,OAAO,CAACyL,UAAU,EAAI,CACpC,KAAM,CAAAC,gBAAgB,CAAGjB,WAAW,CAACM,IAAI,CAACxM,CAAC,EAAIA,CAAC,CAACC,EAAE,GAAKiN,UAAU,CAACjN,EAAE,CAAC,CACtE,GAAI,CAACkN,gBAAgB,CAAE,OAEvB,KAAM,CAAAC,OAAO,CAAGhD,UAAU,CAAC+C,gBAAgB,CAAC3I,GAAG,CAAC,CAChD,KAAM,CAAA6I,OAAO,CAAGjD,UAAU,CAAC+C,gBAAgB,CAACzI,GAAG,CAAC,CAChD,GAAI2F,KAAK,CAAC+C,OAAO,CAAC,EAAI/C,KAAK,CAACgD,OAAO,CAAC,CAAE,OAEtC,KAAM,CAAAC,UAAU,CAAGlD,UAAU,CAAC5F,GAAG,CAAC,CAClC,KAAM,CAAA+I,UAAU,CAAGnD,UAAU,CAAC1F,GAAG,CAAC,CAElC,KAAM,CAAA8I,QAAQ,CAAG3Q,CAAC,CAAC2Q,QAAQ,CACzB,CAAC,CAACF,UAAU,CAAEC,UAAU,CAAC,CAAE,CAACH,OAAO,CAAEC,OAAO,CAAC,CAAC,CAC9C,CAAEI,KAAK,CAAE,SAAS,CAAEC,MAAM,CAAE,CAAC,CAAEC,OAAO,CAAE,GAAG,CAAEC,SAAS,CAAE,MAAO,CACjE,CAAC,CAACC,KAAK,CAACvP,GAAG,CAAC,CAEZa,WAAW,CAACqC,OAAO,CAACuL,IAAI,CAACS,QAAQ,CAAC,CACpC,CAAC,CAAC,CAEF3O,oBAAoB,CAAC,IAAI,CAAC,CAC1BI,mBAAmB,CAACmF,GAAG,CAAC,CAC1B,CAAC,CAAE,CAAC/F,YAAY,CAAEH,OAAO,CAAEC,iBAAiB,CAAEG,GAAG,CAAEM,iBAAiB,CAAEI,gBAAgB,CAAEuC,uBAAuB,CAAEM,cAAc,CAAEE,kBAAkB,CAAEoI,qBAAqB,CAAC,CAAC,CAE1K3N,SAAS,CAAC,IAAM,CACdsR,MAAM,CAAC9B,iBAAiB,CAAGA,iBAAiB,CAC9C,CAAC,CAAE,CAACA,iBAAiB,CAAC,CAAC,CAEvBxP,SAAS,CAAC,IAAM,CACdsR,MAAM,CAACC,4BAA4B,CAAG,CAAC3J,GAAG,CAAEnE,EAAE,CAAEoE,GAAG,CAAE2J,KAAK,GAAK,CAC7D,KAAM,CAAAC,UAAU,CAAG7J,GAAG,EAAInE,EAAE,CAC5B,GAAI3B,GAAG,CAAEA,GAAG,CAAC4P,YAAY,CAAC,CAAC,CAACtH,KAAK,CAACC,MAAM,CAAG,WAAW,CACtDlH,iBAAiB,CAAC,CAAEyE,GAAG,CAAEnE,EAAE,CAAEoE,GAAG,CAAE2J,KAAK,CAAExJ,GAAG,CAAE,IAAI,CAAEE,GAAG,CAAE,IAAK,CAAC,CAAC,CAClE,CAAC,CAEDoJ,MAAM,CAACK,4BAA4B,CAAG,MAAO/J,GAAG,CAAEnE,EAAE,CAAEoE,GAAG,CAAE2J,KAAK,GAAK,CACnE,GAAI,CAACtO,cAAc,EAAI,CAACA,cAAc,CAAC8E,GAAG,EAAI,CAAC9E,cAAc,CAACgF,GAAG,CAAE,OACnE,GAAI,CAAA7E,MAAM,CAAG3B,OAAO,CAACsO,IAAI,CAACxM,CAAC,EAAIA,CAAC,CAACoE,GAAG,GAAKA,GAAG,CAAC,GAAIjG,iBAAiB,SAAjBA,iBAAiB,iBAAjBA,iBAAiB,CAAEqO,IAAI,CAACxM,CAAC,EAAIA,CAAC,CAACoE,GAAG,GAAKA,GAAG,CAAC,IAAI/F,YAAY,SAAZA,YAAY,iBAAZA,YAAY,CAAEmO,IAAI,CAACxM,CAAC,EAAIA,CAAC,CAACoE,GAAG,GAAKA,GAAG,CAAC,EACtI,GAAI,CAACvE,MAAM,EAAII,EAAE,CAAEJ,MAAM,CAAG3B,OAAO,CAACsO,IAAI,CAACxM,CAAC,EAAIA,CAAC,CAACC,EAAE,GAAKA,EAAE,CAAC,GAAI9B,iBAAiB,SAAjBA,iBAAiB,iBAAjBA,iBAAiB,CAAEqO,IAAI,CAACxM,CAAC,EAAIA,CAAC,CAACC,EAAE,GAAKA,EAAE,CAAC,IAAI5B,YAAY,SAAZA,YAAY,iBAAZA,YAAY,CAAEmO,IAAI,CAACxM,CAAC,EAAIA,CAAC,CAACC,EAAE,GAAKA,EAAE,CAAC,EAC/I,GAAI,CAACJ,MAAM,CAAE,OAEb,GAAI,CACF,KAAM,CAAAuO,UAAU,CAAG,CACjBnO,EAAE,CAAEA,EAAE,EAAIJ,MAAM,CAACI,EAAE,EAAImE,GAAG,CAC1BA,GAAG,CAAEA,GAAG,EAAIvE,MAAM,CAACuE,GAAG,EAAInE,EAAE,CAC5BoE,GAAG,CAAEA,GAAG,EAAIxE,MAAM,CAACwE,GAAG,EAAI,EAAE,CAC5B2J,KAAK,CAAEA,KAAK,EAAInO,MAAM,CAACsE,KAAK,EAAI,EAAE,CAClCkK,MAAM,CAAExO,MAAM,CAAC+E,MAAM,EAAI,EAAE,CAC3B0J,aAAa,CAAE5O,cAAc,CAAC8E,GAAG,CACjC+J,aAAa,CAAE7O,cAAc,CAACgF,GAChC,CAAC,CACD,KAAM,CAAA1H,0BAA0B,CAACoR,UAAU,CAAC,CAC5CvO,MAAM,CAAC2E,GAAG,CAAG9E,cAAc,CAAC8E,GAAG,CAC/B3E,MAAM,CAAC6E,GAAG,CAAGhF,cAAc,CAACgF,GAAG,CAE/B1C,MAAM,CAACC,MAAM,CAAC1D,UAAU,CAACiD,OAAO,CAAC,CAACC,OAAO,CAACzB,CAAC,EAAI,CAC7C,GAAI1B,GAAG,CAACoD,QAAQ,CAAC1B,CAAC,CAAC,CAAE1B,GAAG,CAACqD,WAAW,CAAC3B,CAAC,CAAC,CACzC,CAAC,CAAC,CACFzB,UAAU,CAACiD,OAAO,CAAG,CAAC,CAAC,CACvBO,kBAAkB,CAAC,CAAC,CAEpB;AACA7D,OAAO,CAACuD,OAAO,CAACzB,CAAC,EAAI,CACnB,KAAM,CAAAuK,aAAa,CAAGJ,qBAAqB,CACzCnK,CAAC,CACD7B,iBAAiB,EAAID,OAAO,CAC5B,SACF,CAAC,CACD,GAAIqM,aAAa,CAAE,CACjBjM,GAAG,CAACiN,QAAQ,CAAChB,aAAa,CAAC,CAC3BhM,UAAU,CAACiD,OAAO,CAACxB,CAAC,CAACC,EAAE,CAAC,CAAGsK,aAAa,CAC1C,CACF,CAAC,CAAC,CACJ,CAAE,MAAOlJ,KAAK,CAAE,CAAC,CACnB,CAAC,CACD,MAAO,IAAM,CACX,MAAO,CAAAyM,MAAM,CAACC,4BAA4B,CAC1C,MAAO,CAAAD,MAAM,CAACK,4BAA4B,CAC5C,CAAC,CACH,CAAC,CAAE,CAAC7P,GAAG,CAAEoB,cAAc,CAAExB,OAAO,CAAEC,iBAAiB,CAAEE,YAAY,CAAE0D,kBAAkB,CAAEoI,qBAAqB,CAAC,CAAC,CAE9G3N,SAAS,CAAC,IAAM,CACd,GAAI,CAAC8B,GAAG,EAAI,CAACoB,cAAc,CAAE,OAC7B,KAAM,CAAA8O,cAAc,CAAI5M,CAAC,EAAK,CAC5B,KAAM,CAAE4C,GAAG,CAAEE,GAAI,CAAC,CAAG9C,CAAC,CAAC6M,MAAM,CAC7B9O,iBAAiB,CAAC+O,IAAI,EAAAC,aAAA,CAAAA,aAAA,IAAUD,IAAI,MAAElK,GAAG,CAAEE,GAAG,EAAG,CAAC,CAClD;AACF,CAAC,CACDpG,GAAG,CAAC2M,EAAE,CAAC,OAAO,CAAEuD,cAAc,CAAC,CAC/B,MAAO,IAAM,CAAElQ,GAAG,CAACsQ,GAAG,CAAC,OAAO,CAAEJ,cAAc,CAAC,CAAE,CAAC,CACpD,CAAC,CAAE,CAAClQ,GAAG,CAAEoB,cAAc,CAAC,CAAC,CAEzB,MAAO,KAAI,CACb,CAAC,CAED,cAAe,CAAA1B,gBAAgB","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}