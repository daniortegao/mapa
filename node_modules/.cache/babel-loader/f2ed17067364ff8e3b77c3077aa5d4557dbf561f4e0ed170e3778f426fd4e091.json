{"ast":null,"code":"import _objectSpread from\"C:/Users/e08f/Desktop/Proyectos/Resumen/mapa-v2/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useEffect,useRef,useState,useCallback}from'react';import{useMap}from'react-leaflet';import L from'leaflet';import ReactDOM from'react-dom/client';import{createCustomIcon}from'../utils/iconHelpers';import{guardarCoordenadaCorregida}from'../services/apiService';import MapPopup from'./MapPopup';import'../styles/iconMarkersLayer.css';import{jsx as _jsx}from\"react/jsx-runtime\";const IconMarkersLayer=_ref=>{var _markers$;let{markers,markersForMercado=null,selectedRegion,baseCompData=[],nivel2EnNivel1Stations=[],onToggleNivel2EnNivel1}=_ref;const map=useMap();const markersRef=useRef({});const guerraMarkersRef=useRef({});const competenciaMarkersRef=useRef([]);const polylineRef=useRef([]);console.log(' IconMarkersLayer RENDER:',{markersCount:markers===null||markers===void 0?void 0:markers.length,markersRefCount:Object.keys(markersRef.current).length,selectedRegion,firstMarkerComuna:markers===null||markers===void 0?void 0:(_markers$=markers[0])===null||_markers$===void 0?void 0:_markers$.Comuna,uniqueComunas:[...new Set((markers||[]).map(m=>m.Comuna))]});const[showingAssociated,setShowingAssociated]=useState(false);const[activeMercadoPbl,setActiveMercadoPbl]=useState(null);const[modoCorreccion,setModoCorreccion]=useState(null);// --- Helpers de UI (Draggable & Resize) ---\nconst makeDraggable=useCallback(popup=>{if(!map||!popup||!popup._container)return;try{const pos=map.latLngToLayerPoint(popup.getLatLng());L.DomUtil.setPosition(popup._wrapper.parentNode,pos);const draggable=new L.Draggable(popup._container,popup._wrapper);draggable.enable();}catch(error){console.error('Error draggable:',error);}},[map]);const crearGripEnWrapper=useCallback(popupContainer=>{const wrapper=popupContainer.querySelector('.leaflet-popup-content-wrapper');const content=popupContainer.querySelector('.leaflet-popup-content');if(!wrapper||!content)return;content===null||content===void 0?void 0:content.querySelectorAll('.popup-resize-grip').forEach(n=>n.remove());const handleWheel=e=>{e.preventDefault();const scrollSpeed=0.5;const scrollAmount=e.deltaY*scrollSpeed;content.scrollTop+=scrollAmount;};content.addEventListener('wheel',handleWheel,{passive:false});let grip=wrapper.querySelector('.popup-resize-grip');if(!grip){grip=document.createElement('div');grip.className='popup-resize-grip';wrapper.appendChild(grip);let isResizing=false;const doResize=e=>{if(!isResizing)return;const clientX=e.clientX||e.touches&&e.touches[0].clientX;const clientY=e.clientY||e.touches&&e.touches[0].clientY;const gripRect=grip.getBoundingClientRect();const gripCenterX=gripRect.left+gripRect.width/2;const gripCenterY=gripRect.top+gripRect.height/2;const deltaX=clientX-gripCenterX;const deltaY=clientY-gripCenterY;if(Math.abs(deltaX)>5||Math.abs(deltaY)>5){const currentRect=content.getBoundingClientRect();const newWidth=Math.max(240,currentRect.width+deltaX);const newHeight=Math.max(180,currentRect.height+deltaY);content.style.width=newWidth+'px';content.style.height=newHeight+'px';}e.preventDefault();};const stopResize=()=>{if(!isResizing)return;isResizing=false;document.body.classList.remove('is-resizing-popup');document.body.style.cursor='';document.body.style.userSelect='';// Remove listeners when resize stops\ndocument.removeEventListener('mousemove',doResize);document.removeEventListener('mouseup',stopResize);document.removeEventListener('touchmove',doResize);document.removeEventListener('touchend',stopResize);};const startResize=e=>{isResizing=true;document.body.classList.add('is-resizing-popup');document.body.style.cursor='nwse-resize';document.body.style.userSelect='none';e.preventDefault();e.stopPropagation();// Add listeners only when resize starts\ndocument.addEventListener('mousemove',doResize);document.addEventListener('mouseup',stopResize);document.addEventListener('touchmove',doResize,{passive:false});document.addEventListener('touchend',stopResize);};// Only add mousedown/touchstart listeners to the grip\ngrip.addEventListener('mousedown',startResize);grip.addEventListener('touchstart',startResize,{passive:false});const cleanup=()=>{content.removeEventListener('wheel',handleWheel);grip.removeEventListener('mousedown',startResize);grip.removeEventListener('touchstart',startResize);// Clean up any active resize listeners\ndocument.removeEventListener('mousemove',doResize);document.removeEventListener('mouseup',stopResize);document.removeEventListener('touchmove',doResize);document.removeEventListener('touchend',stopResize);document.body.classList.remove('is-resizing-popup');};grip._cleanup=cleanup;}},[]);// --- Helpers de limpieza ---\nconst clearCompetenciaMarkers=useCallback(()=>{competenciaMarkersRef.current.forEach(marker=>{try{if(map&&map.hasLayer(marker))map.removeLayer(marker);}catch(e){}});competenciaMarkersRef.current=[];},[map]);const clearPolylines=useCallback(()=>{polylineRef.current.forEach(line=>{try{if(map&&map.hasLayer(line))map.removeLayer(line);}catch(e){}});polylineRef.current=[];},[map]);const clearGuerraMarkers=useCallback(()=>{Object.values(guerraMarkersRef.current).forEach(marker=>{try{if(map&&map.hasLayer(marker))map.removeLayer(marker);}catch(e){}});guerraMarkersRef.current={};},[map]);// --- Handlers ---\nconst handleActivateCoords=useCallback(marker=>{if(modoCorreccion&&(modoCorreccion.id===marker.id||modoCorreccion.pbl===marker.pbl)){// Si ya est谩 activo para este marcador, lo desactivamos (cancelar)\nsetModoCorreccion(null);if(map)map.getContainer().style.cursor='';return;}if(map)map.getContainer().style.cursor='crosshair';setModoCorreccion({pbl:marker.pbl,id:marker.id,eds:marker.eds,marca:marker.Marca,lat:null,lng:null});},[map,modoCorreccion]);const handleSaveCoords=useCallback(async marker=>{if(!modoCorreccion||!modoCorreccion.lat||!modoCorreccion.lng)return;try{const coordenada={id:marker.id||marker.pbl,pbl:marker.pbl||marker.id,eds:marker.eds||'',marca:marker.Marca||'',comuna:marker.Comuna||'',lat_corregida:modoCorreccion.lat,lon_corregida:modoCorreccion.lng};await guardarCoordenadaCorregida(coordenada);// Actualizar marcador localmente\nmarker.lat=modoCorreccion.lat;marker.lng=modoCorreccion.lng;// Resetear modo correcci贸n\nsetModoCorreccion(null);if(map)map.getContainer().style.cursor='';// Actualizar marcador en el mapa\nconst leafletMarker=markersRef.current[marker.id];if(leafletMarker){const newLatLng=new L.LatLng(modoCorreccion.lat,modoCorreccion.lng);leafletMarker.setLatLng(newLatLng);}}catch(error){console.error(\"Error guardando coordenadas:\",error);}},[modoCorreccion,map,clearGuerraMarkers]);// --- Refs para romper ciclo de dependencias ---\nconst showAssociatedIdsRef=useRef(null);const handleActivateCoordsRef=useRef(handleActivateCoords);const handleSaveCoordsRef=useRef(handleSaveCoords);const modoCorreccionRef=useRef(modoCorreccion);const nivel2EnNivel1StationsRef=useRef(nivel2EnNivel1Stations);const onToggleNivel2EnNivel1Ref=useRef(onToggleNivel2EnNivel1);useEffect(()=>{handleActivateCoordsRef.current=handleActivateCoords;handleSaveCoordsRef.current=handleSaveCoords;modoCorreccionRef.current=modoCorreccion;nivel2EnNivel1StationsRef.current=nivel2EnNivel1Stations;onToggleNivel2EnNivel1Ref.current=onToggleNivel2EnNivel1;});// Helper para Guerra Marker\nconst addGuerraMarker=useCallback(marker=>{if(marker.Guerra_Precio==='Si'){const guerraIcon=L.icon({iconUrl:\"\".concat(process.env.PUBLIC_URL,\"/iconos/calavera.jpg\"),iconSize:[15,15],iconAnchor:[7.5,7.5],className:'icono-guerra'});const guerraMarker=L.marker([marker.lat,marker.lng],{icon:guerraIcon,interactive:false,isAppMarker:true// Tag for cleanup\n});map.addLayer(guerraMarker);guerraMarkersRef.current[marker.id]=guerraMarker;}},[map]);// --- Crear Marcador con Popup React ---\nconst createMarkerWithPopup=useCallback(function(marker,allMarkers){let variant=arguments.length>2&&arguments[2]!==undefined?arguments[2]:'primary';const lat=parseFloat(marker.lat);const lng=parseFloat(marker.lng);if(isNaN(lat)||isNaN(lng))return null;const iconUrl=createCustomIcon(marker.Marca);const leafletMarker=L.marker([lat,lng],{icon:iconUrl,isAppMarker:true// Tag for cleanup\n});// Popup vac铆o inicial\nconst popup=L.popup({autoClose:false,closeOnClick:false,keepInView:true,autoPan:false,maxWidth:450,className:'custom-popup'}).setContent('<div id=\"popup-root-'+marker.id+'\"></div>');leafletMarker.bindPopup(popup);leafletMarker.on('popupopen',e=>{makeDraggable(popup);const container=e.popup._contentNode;const wrapperContainer=e.popup._container;if(wrapperContainer){crearGripEnWrapper(wrapperContainer);}setTimeout(()=>{const rootDiv=document.getElementById('popup-root-'+marker.id);if(rootDiv&&!rootDiv._reactRoot){const root=ReactDOM.createRoot(rootDiv);rootDiv._reactRoot=root;root.render(/*#__PURE__*/_jsx(MapPopup,{marker:marker,allMarkers:allMarkers,onShowAssociated:function(){return showAssociatedIdsRef.current&&showAssociatedIdsRef.current(...arguments);},onActivateCoords:function(){return handleActivateCoordsRef.current&&handleActivateCoordsRef.current(...arguments);},onSaveCoords:function(){return handleSaveCoordsRef.current&&handleSaveCoordsRef.current(...arguments);},modoCorreccion:modoCorreccionRef.current,variant:variant,nivel2EnNivel1Stations:nivel2EnNivel1StationsRef.current,onToggleNivel2EnNivel1:function(){return onToggleNivel2EnNivel1Ref.current&&onToggleNivel2EnNivel1Ref.current(...arguments);}}));}},0);});leafletMarker.on('popupclose',e=>{var _e$popup;const container=(_e$popup=e.popup)===null||_e$popup===void 0?void 0:_e$popup._container;if(container){const wrapper=container.querySelector('.leaflet-popup-content-wrapper');const grip=wrapper===null||wrapper===void 0?void 0:wrapper.querySelector('.popup-resize-grip');if(grip&&grip._cleanup){grip._cleanup();}}const rootDiv=document.getElementById('popup-root-'+marker.id);if(rootDiv&&rootDiv._reactRoot){setTimeout(()=>{if(rootDiv._reactRoot){rootDiv._reactRoot.unmount();rootDiv._reactRoot=null;}},0);}});return leafletMarker;},[makeDraggable,crearGripEnWrapper]);// --- L贸gica de Mercado (Show Associated) ---\nconst showAssociatedIds=useCallback((pbl,lat,lng,originalMarkerId)=>{const searchArray=markersForMercado&&markersForMercado.length>0?markersForMercado:markers;console.log(' MERCADO BUTTON CLICKED:',{pbl,searchArrayLength:searchArray.length,markersForMercadoLength:markersForMercado===null||markersForMercado===void 0?void 0:markersForMercado.length,markersLength:markers.length,baseCompDataLength:baseCompData.length});// Toggle ON (o cambio de PBL)\n// Definir associatedData aqu铆\nconst associatedData=baseCompData.filter(item=>String(item.pbl).trim()===String(pbl).trim());console.log(' ASSOCIATED DATA:',{pbl,associatedDataLength:associatedData.length,associatedIds:associatedData.map(item=>item.id),sampleAssociatedData:associatedData.slice(0,3)});if(showingAssociated&&activeMercadoPbl===pbl){// Toggle OFF\nclearCompetenciaMarkers();clearPolylines();setShowingAssociated(false);setActiveMercadoPbl(null);// Restaurar marcadores originales\nObject.values(markersRef.current).forEach(marker=>{try{if(map&&map.hasLayer(marker))map.removeLayer(marker);}catch(e){}});markersRef.current={};// Re-crear todos\nmarkers.forEach(marker=>{const leafletMarker=createMarkerWithPopup(marker,markersForMercado||markers,'primary');if(leafletMarker){map.addLayer(leafletMarker);markersRef.current[marker.id]=leafletMarker;addGuerraMarker(marker);}});return;}// Si no hay datos asociados, no hacemos nada\nif(associatedData.length===0){console.warn('锔 NO ASSOCIATED DATA FOUND for PBL:',pbl);return;}// Toggle ON\n// 1. Limpiar TODOS los marcadores actuales del mapa\nObject.values(markersRef.current).forEach(marker=>{try{if(map&&map.hasLayer(marker))map.removeLayer(marker);}catch(e){}});markersRef.current={};// Reiniciar referencia de marcadores\n// Limpiar otros elementos\nclearCompetenciaMarkers();clearPolylines();Object.values(guerraMarkersRef.current).forEach(marker=>{try{if(map&&map.hasLayer(marker))map.removeLayer(marker);}catch(e){}});guerraMarkersRef.current={};const ids=associatedData.map(item=>item.id);// Get unique IDs from associatedData\nconst uniqueIds=[...new Set(ids)];// Encontrar estaci贸n principal y competencia\nconst mainStation=searchArray.find(m=>String(m.pbl).trim()===String(pbl).trim());const associatedMarkers=searchArray.filter(item=>ids.includes(item.id));console.log(' MERCADO MODE ACTIVATED:',{mainStation:mainStation?mainStation.id:'Not Found',competitorsFound:associatedMarkers.length,uniqueCompetitorsIds:uniqueIds});// Lista final de marcadores a mostrar (Principal + Competencia)\nconst markersToShow=[];const seenIds=new Set();// Agregar estaci贸n principal primero (si existe)\nif(mainStation){markersToShow.push(_objectSpread(_objectSpread({},mainStation),{},{isMain:true}));seenIds.add(mainStation.id);}// Agregar competencia\nassociatedMarkers.forEach(marker=>{if(!seenIds.has(marker.id)){seenIds.add(marker.id);markersToShow.push(_objectSpread(_objectSpread({},marker),{},{isMain:false}));}});// Renderizar los marcadores filtrados\nmarkersToShow.forEach(marker=>{// Usar 'primary' para la principal, 'secondary' para competencia\nconst variant=marker.isMain?'primary':'secondary';// Usar markersForMercado o baseCompData como fuente de datos para el popup\nconst dataSource=markersForMercado||baseCompData;const leafletMarker=createMarkerWithPopup(marker,dataSource,variant);if(leafletMarker){map.addLayer(leafletMarker);// Guardar en markersRef para que funcionen como marcadores normales (popup, drag, etc)\nmarkersRef.current[marker.id]=leafletMarker;// Agregar marcador de guerra si corresponde\naddGuerraMarker(marker);}});// Polylines (L铆neas de conexi贸n)\nconst mainMarkersData=associatedData.filter(m=>m.Marcador_Principal==='Si');mainMarkersData.forEach(mainMarker=>{const markerWithCoords=searchArray.find(m=>m.id===mainMarker.id);if(!markerWithCoords)return;const mainLat=parseFloat(markerWithCoords.lat);const mainLng=parseFloat(markerWithCoords.lng);if(isNaN(mainLat)||isNaN(mainLng))return;const polyline=L.polyline([[parseFloat(lat),parseFloat(lng)],[mainLat,mainLng]],{color:'#FF6B6B',weight:3,opacity:0.8,dashArray:'5, 5'}).addTo(map);polylineRef.current.push(polyline);});setShowingAssociated(true);setActiveMercadoPbl(pbl);},[baseCompData,markers,markersForMercado,map,showingAssociated,activeMercadoPbl,clearCompetenciaMarkers,clearPolylines,clearGuerraMarkers,createMarkerWithPopup,addGuerraMarker]);useEffect(()=>{showAssociatedIdsRef.current=showAssociatedIds;},[showAssociatedIds]);// --- Efecto Principal de Renderizado ---\nuseEffect(()=>{if(!map||!markers||markers.length===0)return;// Robust Cleanup: Remove ALL markers tagged as isAppMarker\n// This ensures we don't leave zombie markers if refs are lost\nmap.eachLayer(layer=>{if(layer.options&&layer.options.isAppMarker){map.removeLayer(layer);}});// Reset refs\nmarkersRef.current={};guerraMarkersRef.current={};competenciaMarkersRef.current=[];polylineRef.current=[];// Polylines might need tagging too if they persist, but let's clear them via ref for now or tag them\nclearCompetenciaMarkers();clearPolylines();setShowingAssociated(false);setActiveMercadoPbl(null);markers.forEach(marker=>{const leafletMarker=createMarkerWithPopup(marker,markersForMercado||markers,'primary');if(leafletMarker){map.addLayer(leafletMarker);markersRef.current[marker.id]=leafletMarker;addGuerraMarker(marker);}});if(markers.length===1&&markersRef.current[markers[0].id]){markersRef.current[markers[0].id].openPopup();}},[map,markers,markersForMercado,selectedRegion,clearCompetenciaMarkers,clearPolylines,clearGuerraMarkers,createMarkerWithPopup,addGuerraMarker]);// --- Efecto para Click en Mapa (Correcci贸n Coordenadas) ---\nuseEffect(()=>{if(!map||!modoCorreccion)return;const handleMapClick=e=>{const{lat,lng}=e.latlng;setModoCorreccion(prev=>_objectSpread(_objectSpread({},prev),{},{lat,lng}));};map.on('click',handleMapClick);return()=>{map.off('click',handleMapClick);};},[map,modoCorreccion]);// --- Efecto para Actualizar Popups cuando cambia modoCorreccion ---\nuseEffect(()=>{if(!map)return;// Iterar sobre los popups abiertos y re-renderizarlos con el nuevo estado\nmap.eachLayer(layer=>{if(layer.getPopup&&layer.getPopup()&&layer.getPopup().isOpen()){const markerId=Object.keys(markersRef.current).find(key=>markersRef.current[key]===layer);if(markerId){const marker=markers.find(m=>m.id===markerId)||(markersForMercado||[]).find(m=>m.id===markerId);if(marker){const rootDiv=document.getElementById('popup-root-'+marker.id);if(rootDiv&&rootDiv._reactRoot){rootDiv._reactRoot.render(/*#__PURE__*/_jsx(MapPopup,{marker:marker,allMarkers:markersForMercado||markers,onShowAssociated:function(){return showAssociatedIdsRef.current&&showAssociatedIdsRef.current(...arguments);},onActivateCoords:function(){return handleActivateCoordsRef.current&&handleActivateCoordsRef.current(...arguments);},onSaveCoords:function(){return handleSaveCoordsRef.current&&handleSaveCoordsRef.current(...arguments);},modoCorreccion:modoCorreccion// Usamos el valor actual del estado\n,variant:markersForMercado&&markersForMercado.includes(marker)?'secondary':'primary',nivel2EnNivel1Stations:nivel2EnNivel1Stations// En el efecto usamos el valor directo porque el efecto depende de 茅l\n,onToggleNivel2EnNivel1:onToggleNivel2EnNivel1}));}}}}});},[modoCorreccion,map,markers,markersForMercado,nivel2EnNivel1Stations,onToggleNivel2EnNivel1]);// Re-render open popups when markers data updates (auto-refresh)\nuseEffect(()=>{if(!map)return;map.eachLayer(layer=>{if(layer instanceof L.Marker&&layer.getPopup&&layer.getPopup()){const popup=layer.getPopup();if(popup.isOpen()){const markerData=layer.options.markerData;if(markerData&&markerData.pbl){// Find updated marker data\nconst updatedMarker=markers.find(m=>m.pbl===markerData.pbl);if(updatedMarker){var _popup$getElement;const rootDiv=(_popup$getElement=popup.getElement())===null||_popup$getElement===void 0?void 0:_popup$getElement.querySelector('.popup-root');if(rootDiv&&rootDiv._reactRoot){// Re-render with updated data\nrootDiv._reactRoot.render(/*#__PURE__*/_jsx(MapPopup,{marker:updatedMarker,allMarkers:markersForMercado||markers,onShowAssociated:function(){return showAssociatedIdsRef.current&&showAssociatedIdsRef.current(...arguments);},onActivateCoords:function(){return handleActivateCoordsRef.current&&handleActivateCoordsRef.current(...arguments);},onSaveCoords:function(){return handleSaveCoordsRef.current&&handleSaveCoordsRef.current(...arguments);},modoCorreccion:modoCorreccion,variant:markersForMercado&&markersForMercado.includes(updatedMarker)?'secondary':'primary',nivel2EnNivel1Stations:nivel2EnNivel1Stations// En el efecto usamos el valor directo\n,onToggleNivel2EnNivel1:onToggleNivel2EnNivel1}));}}}}}});},[markers,map,markersForMercado,modoCorreccion,nivel2EnNivel1Stations,onToggleNivel2EnNivel1]);return null;};export default IconMarkersLayer;","map":{"version":3,"names":["React","useEffect","useRef","useState","useCallback","useMap","L","ReactDOM","createCustomIcon","guardarCoordenadaCorregida","MapPopup","jsx","_jsx","IconMarkersLayer","_ref","_markers$","markers","markersForMercado","selectedRegion","baseCompData","nivel2EnNivel1Stations","onToggleNivel2EnNivel1","map","markersRef","guerraMarkersRef","competenciaMarkersRef","polylineRef","console","log","markersCount","length","markersRefCount","Object","keys","current","firstMarkerComuna","Comuna","uniqueComunas","Set","m","showingAssociated","setShowingAssociated","activeMercadoPbl","setActiveMercadoPbl","modoCorreccion","setModoCorreccion","makeDraggable","popup","_container","pos","latLngToLayerPoint","getLatLng","DomUtil","setPosition","_wrapper","parentNode","draggable","Draggable","enable","error","crearGripEnWrapper","popupContainer","wrapper","querySelector","content","querySelectorAll","forEach","n","remove","handleWheel","e","preventDefault","scrollSpeed","scrollAmount","deltaY","scrollTop","addEventListener","passive","grip","document","createElement","className","appendChild","isResizing","doResize","clientX","touches","clientY","gripRect","getBoundingClientRect","gripCenterX","left","width","gripCenterY","top","height","deltaX","Math","abs","currentRect","newWidth","max","newHeight","style","stopResize","body","classList","cursor","userSelect","removeEventListener","startResize","add","stopPropagation","cleanup","_cleanup","clearCompetenciaMarkers","marker","hasLayer","removeLayer","clearPolylines","line","clearGuerraMarkers","values","handleActivateCoords","id","pbl","getContainer","eds","marca","Marca","lat","lng","handleSaveCoords","coordenada","comuna","lat_corregida","lon_corregida","leafletMarker","newLatLng","LatLng","setLatLng","showAssociatedIdsRef","handleActivateCoordsRef","handleSaveCoordsRef","modoCorreccionRef","nivel2EnNivel1StationsRef","onToggleNivel2EnNivel1Ref","addGuerraMarker","Guerra_Precio","guerraIcon","icon","iconUrl","concat","process","env","PUBLIC_URL","iconSize","iconAnchor","guerraMarker","interactive","isAppMarker","addLayer","createMarkerWithPopup","allMarkers","variant","arguments","undefined","parseFloat","isNaN","autoClose","closeOnClick","keepInView","autoPan","maxWidth","setContent","bindPopup","on","container","_contentNode","wrapperContainer","setTimeout","rootDiv","getElementById","_reactRoot","root","createRoot","render","onShowAssociated","onActivateCoords","onSaveCoords","_e$popup","unmount","showAssociatedIds","originalMarkerId","searchArray","searchArrayLength","markersForMercadoLength","markersLength","baseCompDataLength","associatedData","filter","item","String","trim","associatedDataLength","associatedIds","sampleAssociatedData","slice","warn","ids","uniqueIds","mainStation","find","associatedMarkers","includes","competitorsFound","uniqueCompetitorsIds","markersToShow","seenIds","push","_objectSpread","isMain","has","dataSource","mainMarkersData","Marcador_Principal","mainMarker","markerWithCoords","mainLat","mainLng","polyline","color","weight","opacity","dashArray","addTo","eachLayer","layer","options","openPopup","handleMapClick","latlng","prev","off","getPopup","isOpen","markerId","key","Marker","markerData","updatedMarker","_popup$getElement","getElement"],"sources":["C:/Users/e08f/Desktop/Proyectos/Resumen/mapa-v2/src/components/IconMarkersLayer.jsx"],"sourcesContent":["import React, { useEffect, useRef, useState, useCallback } from 'react';\r\nimport { useMap } from 'react-leaflet';\r\nimport L from 'leaflet';\r\nimport ReactDOM from 'react-dom/client';\r\nimport { createCustomIcon } from '../utils/iconHelpers';\r\nimport { guardarCoordenadaCorregida } from '../services/apiService';\r\nimport MapPopup from './MapPopup';\r\nimport '../styles/iconMarkersLayer.css';\r\n\r\nconst IconMarkersLayer = ({ markers, markersForMercado = null, selectedRegion, baseCompData = [], nivel2EnNivel1Stations = [], onToggleNivel2EnNivel1 }) => {\r\n  const map = useMap();\r\n  const markersRef = useRef({});\r\n  const guerraMarkersRef = useRef({});\r\n  const competenciaMarkersRef = useRef([]);\r\n  const polylineRef = useRef([]);\r\n\r\n  console.log(' IconMarkersLayer RENDER:', {\r\n    markersCount: markers?.length,\r\n    markersRefCount: Object.keys(markersRef.current).length,\r\n    selectedRegion,\r\n    firstMarkerComuna: markers?.[0]?.Comuna,\r\n    uniqueComunas: [...new Set((markers || []).map(m => m.Comuna))]\r\n  });\r\n\r\n  const [showingAssociated, setShowingAssociated] = useState(false);\r\n  const [activeMercadoPbl, setActiveMercadoPbl] = useState(null);\r\n  const [modoCorreccion, setModoCorreccion] = useState(null);\r\n\r\n  // --- Helpers de UI (Draggable & Resize) ---\r\n  const makeDraggable = useCallback((popup) => {\r\n    if (!map || !popup || !popup._container) return;\r\n    try {\r\n      const pos = map.latLngToLayerPoint(popup.getLatLng());\r\n      L.DomUtil.setPosition(popup._wrapper.parentNode, pos);\r\n      const draggable = new L.Draggable(popup._container, popup._wrapper);\r\n      draggable.enable();\r\n    } catch (error) {\r\n      console.error('Error draggable:', error);\r\n    }\r\n  }, [map]);\r\n\r\n  const crearGripEnWrapper = useCallback((popupContainer) => {\r\n    const wrapper = popupContainer.querySelector('.leaflet-popup-content-wrapper');\r\n    const content = popupContainer.querySelector('.leaflet-popup-content');\r\n    if (!wrapper || !content) return;\r\n\r\n    content?.querySelectorAll('.popup-resize-grip').forEach(n => n.remove());\r\n\r\n    const handleWheel = (e) => {\r\n      e.preventDefault();\r\n      const scrollSpeed = 0.5;\r\n      const scrollAmount = e.deltaY * scrollSpeed;\r\n      content.scrollTop += scrollAmount;\r\n    };\r\n\r\n    content.addEventListener('wheel', handleWheel, { passive: false });\r\n\r\n    let grip = wrapper.querySelector('.popup-resize-grip');\r\n    if (!grip) {\r\n      grip = document.createElement('div');\r\n      grip.className = 'popup-resize-grip';\r\n      wrapper.appendChild(grip);\r\n\r\n      let isResizing = false;\r\n\r\n      const doResize = (e) => {\r\n        if (!isResizing) return;\r\n\r\n        const clientX = e.clientX || (e.touches && e.touches[0].clientX);\r\n        const clientY = e.clientY || (e.touches && e.touches[0].clientY);\r\n\r\n        const gripRect = grip.getBoundingClientRect();\r\n        const gripCenterX = gripRect.left + gripRect.width / 2;\r\n        const gripCenterY = gripRect.top + gripRect.height / 2;\r\n\r\n        const deltaX = clientX - gripCenterX;\r\n        const deltaY = clientY - gripCenterY;\r\n\r\n        if (Math.abs(deltaX) > 5 || Math.abs(deltaY) > 5) {\r\n          const currentRect = content.getBoundingClientRect();\r\n          const newWidth = Math.max(240, currentRect.width + deltaX);\r\n          const newHeight = Math.max(180, currentRect.height + deltaY);\r\n\r\n          content.style.width = newWidth + 'px';\r\n          content.style.height = newHeight + 'px';\r\n        }\r\n\r\n        e.preventDefault();\r\n      };\r\n\r\n      const stopResize = () => {\r\n        if (!isResizing) return;\r\n        isResizing = false;\r\n        document.body.classList.remove('is-resizing-popup');\r\n        document.body.style.cursor = '';\r\n        document.body.style.userSelect = '';\r\n\r\n        // Remove listeners when resize stops\r\n        document.removeEventListener('mousemove', doResize);\r\n        document.removeEventListener('mouseup', stopResize);\r\n        document.removeEventListener('touchmove', doResize);\r\n        document.removeEventListener('touchend', stopResize);\r\n      };\r\n\r\n      const startResize = (e) => {\r\n        isResizing = true;\r\n        document.body.classList.add('is-resizing-popup');\r\n        document.body.style.cursor = 'nwse-resize';\r\n        document.body.style.userSelect = 'none';\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n\r\n        // Add listeners only when resize starts\r\n        document.addEventListener('mousemove', doResize);\r\n        document.addEventListener('mouseup', stopResize);\r\n        document.addEventListener('touchmove', doResize, { passive: false });\r\n        document.addEventListener('touchend', stopResize);\r\n      };\r\n\r\n      // Only add mousedown/touchstart listeners to the grip\r\n      grip.addEventListener('mousedown', startResize);\r\n      grip.addEventListener('touchstart', startResize, { passive: false });\r\n\r\n      const cleanup = () => {\r\n        content.removeEventListener('wheel', handleWheel);\r\n        grip.removeEventListener('mousedown', startResize);\r\n        grip.removeEventListener('touchstart', startResize);\r\n        // Clean up any active resize listeners\r\n        document.removeEventListener('mousemove', doResize);\r\n        document.removeEventListener('mouseup', stopResize);\r\n        document.removeEventListener('touchmove', doResize);\r\n        document.removeEventListener('touchend', stopResize);\r\n        document.body.classList.remove('is-resizing-popup');\r\n      };\r\n\r\n      grip._cleanup = cleanup;\r\n    }\r\n  }, []);\r\n\r\n  // --- Helpers de limpieza ---\r\n  const clearCompetenciaMarkers = useCallback(() => {\r\n    competenciaMarkersRef.current.forEach(marker => {\r\n      try { if (map && map.hasLayer(marker)) map.removeLayer(marker); } catch (e) { }\r\n    });\r\n    competenciaMarkersRef.current = [];\r\n  }, [map]);\r\n\r\n  const clearPolylines = useCallback(() => {\r\n    polylineRef.current.forEach(line => {\r\n      try { if (map && map.hasLayer(line)) map.removeLayer(line); } catch (e) { }\r\n    });\r\n    polylineRef.current = [];\r\n  }, [map]);\r\n\r\n  const clearGuerraMarkers = useCallback(() => {\r\n    Object.values(guerraMarkersRef.current).forEach(marker => {\r\n      try { if (map && map.hasLayer(marker)) map.removeLayer(marker); } catch (e) { }\r\n    });\r\n    guerraMarkersRef.current = {};\r\n  }, [map]);\r\n\r\n  // --- Handlers ---\r\n  const handleActivateCoords = useCallback((marker) => {\r\n    if (modoCorreccion && (modoCorreccion.id === marker.id || modoCorreccion.pbl === marker.pbl)) {\r\n      // Si ya est谩 activo para este marcador, lo desactivamos (cancelar)\r\n      setModoCorreccion(null);\r\n      if (map) map.getContainer().style.cursor = '';\r\n      return;\r\n    }\r\n\r\n    if (map) map.getContainer().style.cursor = 'crosshair';\r\n    setModoCorreccion({\r\n      pbl: marker.pbl,\r\n      id: marker.id,\r\n      eds: marker.eds,\r\n      marca: marker.Marca,\r\n      lat: null,\r\n      lng: null\r\n    });\r\n  }, [map, modoCorreccion]);\r\n\r\n  const handleSaveCoords = useCallback(async (marker) => {\r\n    if (!modoCorreccion || !modoCorreccion.lat || !modoCorreccion.lng) return;\r\n\r\n    try {\r\n      const coordenada = {\r\n        id: marker.id || marker.pbl,\r\n        pbl: marker.pbl || marker.id,\r\n        eds: marker.eds || '',\r\n        marca: marker.Marca || '',\r\n        comuna: marker.Comuna || '',\r\n        lat_corregida: modoCorreccion.lat,\r\n        lon_corregida: modoCorreccion.lng\r\n      };\r\n      await guardarCoordenadaCorregida(coordenada);\r\n\r\n      // Actualizar marcador localmente\r\n      marker.lat = modoCorreccion.lat;\r\n      marker.lng = modoCorreccion.lng;\r\n\r\n      // Resetear modo correcci贸n\r\n      setModoCorreccion(null);\r\n      if (map) map.getContainer().style.cursor = '';\r\n\r\n      // Actualizar marcador en el mapa\r\n      const leafletMarker = markersRef.current[marker.id];\r\n      if (leafletMarker) {\r\n        const newLatLng = new L.LatLng(modoCorreccion.lat, modoCorreccion.lng);\r\n        leafletMarker.setLatLng(newLatLng);\r\n      }\r\n\r\n    } catch (error) {\r\n      console.error(\"Error guardando coordenadas:\", error);\r\n    }\r\n  }, [modoCorreccion, map, clearGuerraMarkers]);\r\n\r\n  // --- Refs para romper ciclo de dependencias ---\r\n  const showAssociatedIdsRef = useRef(null);\r\n  const handleActivateCoordsRef = useRef(handleActivateCoords);\r\n  const handleSaveCoordsRef = useRef(handleSaveCoords);\r\n  const modoCorreccionRef = useRef(modoCorreccion);\r\n  const nivel2EnNivel1StationsRef = useRef(nivel2EnNivel1Stations);\r\n  const onToggleNivel2EnNivel1Ref = useRef(onToggleNivel2EnNivel1);\r\n\r\n  useEffect(() => {\r\n    handleActivateCoordsRef.current = handleActivateCoords;\r\n    handleSaveCoordsRef.current = handleSaveCoords;\r\n    modoCorreccionRef.current = modoCorreccion;\r\n    nivel2EnNivel1StationsRef.current = nivel2EnNivel1Stations;\r\n    onToggleNivel2EnNivel1Ref.current = onToggleNivel2EnNivel1;\r\n  });\r\n\r\n  // Helper para Guerra Marker\r\n  const addGuerraMarker = useCallback((marker) => {\r\n    if (marker.Guerra_Precio === 'Si') {\r\n      const guerraIcon = L.icon({\r\n        iconUrl: `${process.env.PUBLIC_URL}/iconos/calavera.jpg`,\r\n        iconSize: [15, 15],\r\n        iconAnchor: [7.5, 7.5],\r\n        className: 'icono-guerra'\r\n      });\r\n      const guerraMarker = L.marker([marker.lat, marker.lng], {\r\n        icon: guerraIcon,\r\n        interactive: false,\r\n        isAppMarker: true // Tag for cleanup\r\n      });\r\n      map.addLayer(guerraMarker);\r\n      guerraMarkersRef.current[marker.id] = guerraMarker;\r\n    }\r\n  }, [map]);\r\n\r\n  // --- Crear Marcador con Popup React ---\r\n  const createMarkerWithPopup = useCallback((marker, allMarkers, variant = 'primary') => {\r\n    const lat = parseFloat(marker.lat);\r\n    const lng = parseFloat(marker.lng);\r\n    if (isNaN(lat) || isNaN(lng)) return null;\r\n\r\n    const iconUrl = createCustomIcon(marker.Marca);\r\n    const leafletMarker = L.marker([lat, lng], {\r\n      icon: iconUrl,\r\n      isAppMarker: true // Tag for cleanup\r\n    });\r\n\r\n    // Popup vac铆o inicial\r\n    const popup = L.popup({\r\n      autoClose: false,\r\n      closeOnClick: false,\r\n      keepInView: true,\r\n      autoPan: false,\r\n      maxWidth: 450,\r\n      className: 'custom-popup'\r\n    }).setContent('<div id=\"popup-root-' + marker.id + '\"></div>');\r\n\r\n    leafletMarker.bindPopup(popup);\r\n\r\n    leafletMarker.on('popupopen', (e) => {\r\n      makeDraggable(popup);\r\n      const container = e.popup._contentNode;\r\n      const wrapperContainer = e.popup._container;\r\n      if (wrapperContainer) {\r\n        crearGripEnWrapper(wrapperContainer);\r\n      }\r\n\r\n      setTimeout(() => {\r\n        const rootDiv = document.getElementById('popup-root-' + marker.id);\r\n        if (rootDiv && !rootDiv._reactRoot) {\r\n          const root = ReactDOM.createRoot(rootDiv);\r\n          rootDiv._reactRoot = root;\r\n          root.render(\r\n            <MapPopup\r\n              marker={marker}\r\n              allMarkers={allMarkers}\r\n              onShowAssociated={(...args) => showAssociatedIdsRef.current && showAssociatedIdsRef.current(...args)}\r\n              onActivateCoords={(...args) => handleActivateCoordsRef.current && handleActivateCoordsRef.current(...args)}\r\n              onSaveCoords={(...args) => handleSaveCoordsRef.current && handleSaveCoordsRef.current(...args)}\r\n              modoCorreccion={modoCorreccionRef.current}\r\n              variant={variant}\r\n              nivel2EnNivel1Stations={nivel2EnNivel1StationsRef.current}\r\n              onToggleNivel2EnNivel1={(...args) => onToggleNivel2EnNivel1Ref.current && onToggleNivel2EnNivel1Ref.current(...args)}\r\n            />\r\n          );\r\n        }\r\n      }, 0);\r\n    });\r\n\r\n    leafletMarker.on('popupclose', (e) => {\r\n      const container = e.popup?._container;\r\n      if (container) {\r\n        const wrapper = container.querySelector('.leaflet-popup-content-wrapper');\r\n        const grip = wrapper?.querySelector('.popup-resize-grip');\r\n        if (grip && grip._cleanup) {\r\n          grip._cleanup();\r\n        }\r\n      }\r\n\r\n      const rootDiv = document.getElementById('popup-root-' + marker.id);\r\n      if (rootDiv && rootDiv._reactRoot) {\r\n        setTimeout(() => {\r\n          if (rootDiv._reactRoot) {\r\n            rootDiv._reactRoot.unmount();\r\n            rootDiv._reactRoot = null;\r\n          }\r\n        }, 0);\r\n      }\r\n    });\r\n\r\n    return leafletMarker;\r\n  }, [makeDraggable, crearGripEnWrapper]);\r\n\r\n  // --- L贸gica de Mercado (Show Associated) ---\r\n  const showAssociatedIds = useCallback((pbl, lat, lng, originalMarkerId) => {\r\n    const searchArray = markersForMercado && markersForMercado.length > 0 ? markersForMercado : markers;\r\n\r\n    console.log(' MERCADO BUTTON CLICKED:', {\r\n      pbl,\r\n      searchArrayLength: searchArray.length,\r\n      markersForMercadoLength: markersForMercado?.length,\r\n      markersLength: markers.length,\r\n      baseCompDataLength: baseCompData.length\r\n    });\r\n\r\n    // Toggle ON (o cambio de PBL)\r\n    // Definir associatedData aqu铆\r\n    const associatedData = baseCompData.filter(item => String(item.pbl).trim() === String(pbl).trim());\r\n\r\n    console.log(' ASSOCIATED DATA:', {\r\n      pbl,\r\n      associatedDataLength: associatedData.length,\r\n      associatedIds: associatedData.map(item => item.id),\r\n      sampleAssociatedData: associatedData.slice(0, 3)\r\n    });\r\n\r\n    if (showingAssociated && activeMercadoPbl === pbl) {\r\n      // Toggle OFF\r\n      clearCompetenciaMarkers();\r\n      clearPolylines();\r\n      setShowingAssociated(false);\r\n      setActiveMercadoPbl(null);\r\n\r\n      // Restaurar marcadores originales\r\n      Object.values(markersRef.current).forEach(marker => {\r\n        try { if (map && map.hasLayer(marker)) map.removeLayer(marker); } catch (e) { }\r\n      });\r\n      markersRef.current = {};\r\n\r\n      // Re-crear todos\r\n      markers.forEach(marker => {\r\n        const leafletMarker = createMarkerWithPopup(marker, markersForMercado || markers, 'primary');\r\n        if (leafletMarker) {\r\n          map.addLayer(leafletMarker);\r\n          markersRef.current[marker.id] = leafletMarker;\r\n          addGuerraMarker(marker);\r\n        }\r\n      });\r\n      return;\r\n    }\r\n\r\n    // Si no hay datos asociados, no hacemos nada\r\n    if (associatedData.length === 0) {\r\n      console.warn('锔 NO ASSOCIATED DATA FOUND for PBL:', pbl);\r\n      return;\r\n    }\r\n\r\n    // Toggle ON\r\n\r\n    // 1. Limpiar TODOS los marcadores actuales del mapa\r\n    Object.values(markersRef.current).forEach(marker => {\r\n      try { if (map && map.hasLayer(marker)) map.removeLayer(marker); } catch (e) { }\r\n    });\r\n    markersRef.current = {}; // Reiniciar referencia de marcadores\r\n\r\n    // Limpiar otros elementos\r\n    clearCompetenciaMarkers();\r\n    clearPolylines();\r\n    Object.values(guerraMarkersRef.current).forEach(marker => {\r\n      try { if (map && map.hasLayer(marker)) map.removeLayer(marker); } catch (e) { }\r\n    });\r\n    guerraMarkersRef.current = {};\r\n\r\n    const ids = associatedData.map(item => item.id);\r\n\r\n    // Get unique IDs from associatedData\r\n    const uniqueIds = [...new Set(ids)];\r\n\r\n    // Encontrar estaci贸n principal y competencia\r\n    const mainStation = searchArray.find(m => String(m.pbl).trim() === String(pbl).trim());\r\n    const associatedMarkers = searchArray.filter(item => ids.includes(item.id));\r\n\r\n    console.log(' MERCADO MODE ACTIVATED:', {\r\n      mainStation: mainStation ? mainStation.id : 'Not Found',\r\n      competitorsFound: associatedMarkers.length,\r\n      uniqueCompetitorsIds: uniqueIds\r\n    });\r\n\r\n    // Lista final de marcadores a mostrar (Principal + Competencia)\r\n    const markersToShow = [];\r\n    const seenIds = new Set();\r\n\r\n    // Agregar estaci贸n principal primero (si existe)\r\n    if (mainStation) {\r\n      markersToShow.push({ ...mainStation, isMain: true });\r\n      seenIds.add(mainStation.id);\r\n    }\r\n\r\n    // Agregar competencia\r\n    associatedMarkers.forEach(marker => {\r\n      if (!seenIds.has(marker.id)) {\r\n        seenIds.add(marker.id);\r\n        markersToShow.push({ ...marker, isMain: false });\r\n      }\r\n    });\r\n\r\n    // Renderizar los marcadores filtrados\r\n    markersToShow.forEach(marker => {\r\n      // Usar 'primary' para la principal, 'secondary' para competencia\r\n      const variant = marker.isMain ? 'primary' : 'secondary';\r\n      // Usar markersForMercado o baseCompData como fuente de datos para el popup\r\n      const dataSource = markersForMercado || baseCompData;\r\n\r\n      const leafletMarker = createMarkerWithPopup(marker, dataSource, variant);\r\n\r\n      if (leafletMarker) {\r\n        map.addLayer(leafletMarker);\r\n        // Guardar en markersRef para que funcionen como marcadores normales (popup, drag, etc)\r\n        markersRef.current[marker.id] = leafletMarker;\r\n\r\n        // Agregar marcador de guerra si corresponde\r\n        addGuerraMarker(marker);\r\n      }\r\n    });\r\n\r\n    // Polylines (L铆neas de conexi贸n)\r\n    const mainMarkersData = associatedData.filter(m => m.Marcador_Principal === 'Si');\r\n    mainMarkersData.forEach(mainMarker => {\r\n      const markerWithCoords = searchArray.find(m => m.id === mainMarker.id);\r\n      if (!markerWithCoords) return;\r\n      const mainLat = parseFloat(markerWithCoords.lat);\r\n      const mainLng = parseFloat(markerWithCoords.lng);\r\n      if (isNaN(mainLat) || isNaN(mainLng)) return;\r\n\r\n      const polyline = L.polyline(\r\n        [[parseFloat(lat), parseFloat(lng)], [mainLat, mainLng]],\r\n        { color: '#FF6B6B', weight: 3, opacity: 0.8, dashArray: '5, 5' }\r\n      ).addTo(map);\r\n      polylineRef.current.push(polyline);\r\n    });\r\n\r\n    setShowingAssociated(true);\r\n    setActiveMercadoPbl(pbl);\r\n\r\n  }, [baseCompData, markers, markersForMercado, map, showingAssociated, activeMercadoPbl, clearCompetenciaMarkers, clearPolylines, clearGuerraMarkers, createMarkerWithPopup, addGuerraMarker]);\r\n\r\n  useEffect(() => {\r\n    showAssociatedIdsRef.current = showAssociatedIds;\r\n  }, [showAssociatedIds]);\r\n\r\n  // --- Efecto Principal de Renderizado ---\r\n  useEffect(() => {\r\n    if (!map || !markers || markers.length === 0) return;\r\n\r\n    // Robust Cleanup: Remove ALL markers tagged as isAppMarker\r\n    // This ensures we don't leave zombie markers if refs are lost\r\n    map.eachLayer(layer => {\r\n      if (layer.options && layer.options.isAppMarker) {\r\n        map.removeLayer(layer);\r\n      }\r\n    });\r\n\r\n    // Reset refs\r\n    markersRef.current = {};\r\n    guerraMarkersRef.current = {};\r\n    competenciaMarkersRef.current = [];\r\n    polylineRef.current = []; // Polylines might need tagging too if they persist, but let's clear them via ref for now or tag them\r\n\r\n    clearCompetenciaMarkers();\r\n    clearPolylines();\r\n    setShowingAssociated(false);\r\n    setActiveMercadoPbl(null);\r\n\r\n    markers.forEach(marker => {\r\n      const leafletMarker = createMarkerWithPopup(\r\n        marker,\r\n        markersForMercado || markers,\r\n        'primary'\r\n      );\r\n      if (leafletMarker) {\r\n        map.addLayer(leafletMarker);\r\n        markersRef.current[marker.id] = leafletMarker;\r\n        addGuerraMarker(marker);\r\n      }\r\n    });\r\n\r\n    if (markers.length === 1 && markersRef.current[markers[0].id]) {\r\n      markersRef.current[markers[0].id].openPopup();\r\n    }\r\n\r\n  }, [map, markers, markersForMercado, selectedRegion, clearCompetenciaMarkers, clearPolylines, clearGuerraMarkers, createMarkerWithPopup, addGuerraMarker]);\r\n\r\n\r\n  // --- Efecto para Click en Mapa (Correcci贸n Coordenadas) ---\r\n  useEffect(() => {\r\n    if (!map || !modoCorreccion) return;\r\n\r\n    const handleMapClick = (e) => {\r\n      const { lat, lng } = e.latlng;\r\n      setModoCorreccion(prev => ({ ...prev, lat, lng }));\r\n    };\r\n\r\n    map.on('click', handleMapClick);\r\n    return () => { map.off('click', handleMapClick); };\r\n  }, [map, modoCorreccion]);\r\n\r\n  // --- Efecto para Actualizar Popups cuando cambia modoCorreccion ---\r\n  useEffect(() => {\r\n    if (!map) return;\r\n\r\n    // Iterar sobre los popups abiertos y re-renderizarlos con el nuevo estado\r\n    map.eachLayer(layer => {\r\n      if (layer.getPopup && layer.getPopup() && layer.getPopup().isOpen()) {\r\n        const markerId = Object.keys(markersRef.current).find(key => markersRef.current[key] === layer);\r\n        if (markerId) {\r\n          const marker = markers.find(m => m.id === markerId) || (markersForMercado || []).find(m => m.id === markerId);\r\n          if (marker) {\r\n            const rootDiv = document.getElementById('popup-root-' + marker.id);\r\n            if (rootDiv && rootDiv._reactRoot) {\r\n              rootDiv._reactRoot.render(\r\n                <MapPopup\r\n                  marker={marker}\r\n                  allMarkers={markersForMercado || markers}\r\n                  onShowAssociated={(...args) => showAssociatedIdsRef.current && showAssociatedIdsRef.current(...args)}\r\n                  onActivateCoords={(...args) => handleActivateCoordsRef.current && handleActivateCoordsRef.current(...args)}\r\n                  onSaveCoords={(...args) => handleSaveCoordsRef.current && handleSaveCoordsRef.current(...args)}\r\n                  modoCorreccion={modoCorreccion} // Usamos el valor actual del estado\r\n                  variant={markersForMercado && markersForMercado.includes(marker) ? 'secondary' : 'primary'}\r\n                  nivel2EnNivel1Stations={nivel2EnNivel1Stations} // En el efecto usamos el valor directo porque el efecto depende de 茅l\r\n                  onToggleNivel2EnNivel1={onToggleNivel2EnNivel1}\r\n                />\r\n              );\r\n            }\r\n          }\r\n        }\r\n      }\r\n    });\r\n  }, [modoCorreccion, map, markers, markersForMercado, nivel2EnNivel1Stations, onToggleNivel2EnNivel1]);\r\n\r\n  // Re-render open popups when markers data updates (auto-refresh)\r\n  useEffect(() => {\r\n    if (!map) return;\r\n\r\n    map.eachLayer((layer) => {\r\n      if (layer instanceof L.Marker && layer.getPopup && layer.getPopup()) {\r\n        const popup = layer.getPopup();\r\n        if (popup.isOpen()) {\r\n          const markerData = layer.options.markerData;\r\n          if (markerData && markerData.pbl) {\r\n            // Find updated marker data\r\n            const updatedMarker = markers.find(m => m.pbl === markerData.pbl);\r\n            if (updatedMarker) {\r\n              const rootDiv = popup.getElement()?.querySelector('.popup-root');\r\n              if (rootDiv && rootDiv._reactRoot) {\r\n                // Re-render with updated data\r\n                rootDiv._reactRoot.render(\r\n                  <MapPopup\r\n                    marker={updatedMarker}\r\n                    allMarkers={markersForMercado || markers}\r\n                    onShowAssociated={(...args) => showAssociatedIdsRef.current && showAssociatedIdsRef.current(...args)}\r\n                    onActivateCoords={(...args) => handleActivateCoordsRef.current && handleActivateCoordsRef.current(...args)}\r\n                    onSaveCoords={(...args) => handleSaveCoordsRef.current && handleSaveCoordsRef.current(...args)}\r\n                    modoCorreccion={modoCorreccion}\r\n                    variant={markersForMercado && markersForMercado.includes(updatedMarker) ? 'secondary' : 'primary'}\r\n                    nivel2EnNivel1Stations={nivel2EnNivel1Stations} // En el efecto usamos el valor directo\r\n                    onToggleNivel2EnNivel1={onToggleNivel2EnNivel1}\r\n                  />\r\n                );\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    });\r\n  }, [markers, map, markersForMercado, modoCorreccion, nivel2EnNivel1Stations, onToggleNivel2EnNivel1]);\r\n\r\n\r\n  return null;\r\n};\r\n\r\nexport default IconMarkersLayer;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}