{"ast":null,"code":"import React,{useMemo}from'react';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const VolatilityStats=_ref=>{let{markers}=_ref;const volatilityData=useMemo(()=>{if(!markers||markers.length===0){console.log('VolatilityStats: No markers');return null;}console.log('VolatilityStats: Processing',markers.length,'markers');const brandPriceHistory={};// Group markers by brand and PBL to track price changes over time\nmarkers.forEach(m=>{const brand=m.Marca||'Otras';const pbl=m.pbl;const fecha=m.fecha_aplicacion;if(!brandPriceHistory[brand]){brandPriceHistory[brand]={};}if(!brandPriceHistory[brand][pbl]){brandPriceHistory[brand][pbl]=[];}brandPriceHistory[brand][pbl].push({fecha,g93:parseFloat(m.precio_g93||m.G93)||null});});console.log('VolatilityStats: Brand history:',Object.keys(brandPriceHistory));// Calculate volatility metrics for each brand\nconst volatilityStats={};Object.keys(brandPriceHistory).forEach(brand=>{const stations=brandPriceHistory[brand];let totalChanges=0;let totalMagnitude=0;let allPrices=[];let stationCount=0;let stationsWithHistory=0;Object.keys(stations).forEach(pbl=>{const history=stations[pbl].sort((a,b)=>new Date(a.fecha)-new Date(b.fecha));// Count all stations, not just those with multiple entries\nstationCount++;// Collect all prices for std dev calculation\nhistory.forEach(h=>{if(h.g93!==null){allPrices.push(h.g93);}});// Count price changes only if there's history\nif(history.length>1){stationsWithHistory++;for(let i=1;i<history.length;i++){if(history[i].g93!==null&&history[i-1].g93!==null){const change=Math.abs(history[i].g93-history[i-1].g93);if(change>0.5){// Consider changes > 0.5 as significant\ntotalChanges++;totalMagnitude+=change;}}}}});if(stationCount>0&&allPrices.length>0){// Calculate standard deviation\nconst mean=allPrices.reduce((sum,p)=>sum+p,0)/allPrices.length;const variance=allPrices.reduce((sum,p)=>sum+Math.pow(p-mean,2),0)/allPrices.length;const stdDev=Math.sqrt(variance);volatilityStats[brand]={changeFrequency:stationsWithHistory>0?totalChanges/stationsWithHistory:0,avgMagnitude:totalChanges>0?totalMagnitude/totalChanges:0,stdDev:stdDev,stationCount:stationCount,stationsWithHistory:stationsWithHistory};}});console.log('VolatilityStats: Final stats:',volatilityStats);return volatilityStats;},[markers]);if(!volatilityData||Object.keys(volatilityData).length===0){return/*#__PURE__*/_jsx(\"div\",{className:\"stats-empty\",children:\"Sin datos de volatilidad\"});}return/*#__PURE__*/_jsxs(\"div\",{className:\"volatility-container\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"stats-title\",children:\"Volatilidad de Precios (G93)\"}),/*#__PURE__*/_jsx(\"div\",{className:\"volatility-grid\",children:Object.keys(volatilityData).sort((a,b)=>volatilityData[b].changeFrequency-volatilityData[a].changeFrequency).map(brand=>{const vol=volatilityData[brand];return/*#__PURE__*/_jsxs(\"div\",{className:\"volatility-card\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"volatility-brand\",children:brand}),/*#__PURE__*/_jsxs(\"div\",{className:\"volatility-metrics\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"volatility-metric\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"metric-label\",children:\"Cambios/Estaci\\xF3n:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"metric-value\",children:vol.changeFrequency.toFixed(1)})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"volatility-metric\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"metric-label\",children:\"Magnitud Prom:\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"metric-value\",children:[\"$\",vol.avgMagnitude.toFixed(0)]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"volatility-metric\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"metric-label\",children:\"Desv. Est\\xE1ndar:\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"metric-value\",children:[\"$\",vol.stdDev.toFixed(0)]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"volatility-metric\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"metric-label\",children:\"Estaciones:\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"metric-value\",children:[vol.stationCount,\" (\",vol.stationsWithHistory,\" con historial)\"]})]})]})]},brand);})})]});};export default VolatilityStats;","map":{"version":3,"names":["React","useMemo","jsx","_jsx","jsxs","_jsxs","VolatilityStats","_ref","markers","volatilityData","length","console","log","brandPriceHistory","forEach","m","brand","Marca","pbl","fecha","fecha_aplicacion","push","g93","parseFloat","precio_g93","G93","Object","keys","volatilityStats","stations","totalChanges","totalMagnitude","allPrices","stationCount","stationsWithHistory","history","sort","a","b","Date","h","i","change","Math","abs","mean","reduce","sum","p","variance","pow","stdDev","sqrt","changeFrequency","avgMagnitude","className","children","map","vol","toFixed"],"sources":["C:/Users/e08f/Desktop/Proyectos/Resumen/mapa-v2/src/components/VolatilityStats.jsx"],"sourcesContent":["import React, { useMemo } from 'react';\r\n\r\nconst VolatilityStats = ({ markers }) => {\r\n    const volatilityData = useMemo(() => {\r\n        if (!markers || markers.length === 0) {\r\n            console.log('VolatilityStats: No markers');\r\n            return null;\r\n        }\r\n\r\n        console.log('VolatilityStats: Processing', markers.length, 'markers');\r\n        const brandPriceHistory = {};\r\n\r\n        // Group markers by brand and PBL to track price changes over time\r\n        markers.forEach(m => {\r\n            const brand = m.Marca || 'Otras';\r\n            const pbl = m.pbl;\r\n            const fecha = m.fecha_aplicacion;\r\n\r\n            if (!brandPriceHistory[brand]) {\r\n                brandPriceHistory[brand] = {};\r\n            }\r\n            if (!brandPriceHistory[brand][pbl]) {\r\n                brandPriceHistory[brand][pbl] = [];\r\n            }\r\n\r\n            brandPriceHistory[brand][pbl].push({\r\n                fecha,\r\n                g93: parseFloat(m.precio_g93 || m.G93) || null\r\n            });\r\n        });\r\n\r\n        console.log('VolatilityStats: Brand history:', Object.keys(brandPriceHistory));\r\n\r\n        // Calculate volatility metrics for each brand\r\n        const volatilityStats = {};\r\n        Object.keys(brandPriceHistory).forEach(brand => {\r\n            const stations = brandPriceHistory[brand];\r\n            let totalChanges = 0;\r\n            let totalMagnitude = 0;\r\n            let allPrices = [];\r\n            let stationCount = 0;\r\n            let stationsWithHistory = 0;\r\n\r\n            Object.keys(stations).forEach(pbl => {\r\n                const history = stations[pbl].sort((a, b) => new Date(a.fecha) - new Date(b.fecha));\r\n\r\n                // Count all stations, not just those with multiple entries\r\n                stationCount++;\r\n\r\n                // Collect all prices for std dev calculation\r\n                history.forEach(h => {\r\n                    if (h.g93 !== null) {\r\n                        allPrices.push(h.g93);\r\n                    }\r\n                });\r\n\r\n                // Count price changes only if there's history\r\n                if (history.length > 1) {\r\n                    stationsWithHistory++;\r\n                    for (let i = 1; i < history.length; i++) {\r\n                        if (history[i].g93 !== null && history[i - 1].g93 !== null) {\r\n                            const change = Math.abs(history[i].g93 - history[i - 1].g93);\r\n                            if (change > 0.5) { // Consider changes > 0.5 as significant\r\n                                totalChanges++;\r\n                                totalMagnitude += change;\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n\r\n            if (stationCount > 0 && allPrices.length > 0) {\r\n                // Calculate standard deviation\r\n                const mean = allPrices.reduce((sum, p) => sum + p, 0) / allPrices.length;\r\n                const variance = allPrices.reduce((sum, p) => sum + Math.pow(p - mean, 2), 0) / allPrices.length;\r\n                const stdDev = Math.sqrt(variance);\r\n\r\n                volatilityStats[brand] = {\r\n                    changeFrequency: stationsWithHistory > 0 ? totalChanges / stationsWithHistory : 0,\r\n                    avgMagnitude: totalChanges > 0 ? totalMagnitude / totalChanges : 0,\r\n                    stdDev: stdDev,\r\n                    stationCount: stationCount,\r\n                    stationsWithHistory: stationsWithHistory\r\n                };\r\n            }\r\n        });\r\n\r\n        console.log('VolatilityStats: Final stats:', volatilityStats);\r\n        return volatilityStats;\r\n    }, [markers]);\r\n\r\n    if (!volatilityData || Object.keys(volatilityData).length === 0) {\r\n        return <div className=\"stats-empty\">Sin datos de volatilidad</div>;\r\n    }\r\n\r\n    return (\r\n        <div className=\"volatility-container\">\r\n            <h4 className=\"stats-title\">Volatilidad de Precios (G93)</h4>\r\n            <div className=\"volatility-grid\">\r\n                {Object.keys(volatilityData)\r\n                    .sort((a, b) => volatilityData[b].changeFrequency - volatilityData[a].changeFrequency)\r\n                    .map(brand => {\r\n                        const vol = volatilityData[brand];\r\n                        return (\r\n                            <div key={brand} className=\"volatility-card\">\r\n                                <div className=\"volatility-brand\">{brand}</div>\r\n                                <div className=\"volatility-metrics\">\r\n                                    <div className=\"volatility-metric\">\r\n                                        <span className=\"metric-label\">Cambios/Estación:</span>\r\n                                        <span className=\"metric-value\">{vol.changeFrequency.toFixed(1)}</span>\r\n                                    </div>\r\n                                    <div className=\"volatility-metric\">\r\n                                        <span className=\"metric-label\">Magnitud Prom:</span>\r\n                                        <span className=\"metric-value\">${vol.avgMagnitude.toFixed(0)}</span>\r\n                                    </div>\r\n                                    <div className=\"volatility-metric\">\r\n                                        <span className=\"metric-label\">Desv. Estándar:</span>\r\n                                        <span className=\"metric-value\">${vol.stdDev.toFixed(0)}</span>\r\n                                    </div>\r\n                                    <div className=\"volatility-metric\">\r\n                                        <span className=\"metric-label\">Estaciones:</span>\r\n                                        <span className=\"metric-value\">{vol.stationCount} ({vol.stationsWithHistory} con historial)</span>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        );\r\n                    })}\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default VolatilityStats;\r\n"],"mappings":"AAAA,MAAO,CAAAA,KAAK,EAAIC,OAAO,KAAQ,OAAO,CAAC,OAAAC,GAAA,IAAAC,IAAA,CAAAC,IAAA,IAAAC,KAAA,yBAEvC,KAAM,CAAAC,eAAe,CAAGC,IAAA,EAAiB,IAAhB,CAAEC,OAAQ,CAAC,CAAAD,IAAA,CAChC,KAAM,CAAAE,cAAc,CAAGR,OAAO,CAAC,IAAM,CACjC,GAAI,CAACO,OAAO,EAAIA,OAAO,CAACE,MAAM,GAAK,CAAC,CAAE,CAClCC,OAAO,CAACC,GAAG,CAAC,6BAA6B,CAAC,CAC1C,MAAO,KAAI,CACf,CAEAD,OAAO,CAACC,GAAG,CAAC,6BAA6B,CAAEJ,OAAO,CAACE,MAAM,CAAE,SAAS,CAAC,CACrE,KAAM,CAAAG,iBAAiB,CAAG,CAAC,CAAC,CAE5B;AACAL,OAAO,CAACM,OAAO,CAACC,CAAC,EAAI,CACjB,KAAM,CAAAC,KAAK,CAAGD,CAAC,CAACE,KAAK,EAAI,OAAO,CAChC,KAAM,CAAAC,GAAG,CAAGH,CAAC,CAACG,GAAG,CACjB,KAAM,CAAAC,KAAK,CAAGJ,CAAC,CAACK,gBAAgB,CAEhC,GAAI,CAACP,iBAAiB,CAACG,KAAK,CAAC,CAAE,CAC3BH,iBAAiB,CAACG,KAAK,CAAC,CAAG,CAAC,CAAC,CACjC,CACA,GAAI,CAACH,iBAAiB,CAACG,KAAK,CAAC,CAACE,GAAG,CAAC,CAAE,CAChCL,iBAAiB,CAACG,KAAK,CAAC,CAACE,GAAG,CAAC,CAAG,EAAE,CACtC,CAEAL,iBAAiB,CAACG,KAAK,CAAC,CAACE,GAAG,CAAC,CAACG,IAAI,CAAC,CAC/BF,KAAK,CACLG,GAAG,CAAEC,UAAU,CAACR,CAAC,CAACS,UAAU,EAAIT,CAAC,CAACU,GAAG,CAAC,EAAI,IAC9C,CAAC,CAAC,CACN,CAAC,CAAC,CAEFd,OAAO,CAACC,GAAG,CAAC,iCAAiC,CAAEc,MAAM,CAACC,IAAI,CAACd,iBAAiB,CAAC,CAAC,CAE9E;AACA,KAAM,CAAAe,eAAe,CAAG,CAAC,CAAC,CAC1BF,MAAM,CAACC,IAAI,CAACd,iBAAiB,CAAC,CAACC,OAAO,CAACE,KAAK,EAAI,CAC5C,KAAM,CAAAa,QAAQ,CAAGhB,iBAAiB,CAACG,KAAK,CAAC,CACzC,GAAI,CAAAc,YAAY,CAAG,CAAC,CACpB,GAAI,CAAAC,cAAc,CAAG,CAAC,CACtB,GAAI,CAAAC,SAAS,CAAG,EAAE,CAClB,GAAI,CAAAC,YAAY,CAAG,CAAC,CACpB,GAAI,CAAAC,mBAAmB,CAAG,CAAC,CAE3BR,MAAM,CAACC,IAAI,CAACE,QAAQ,CAAC,CAACf,OAAO,CAACI,GAAG,EAAI,CACjC,KAAM,CAAAiB,OAAO,CAAGN,QAAQ,CAACX,GAAG,CAAC,CAACkB,IAAI,CAAC,CAACC,CAAC,CAAEC,CAAC,GAAK,GAAI,CAAAC,IAAI,CAACF,CAAC,CAAClB,KAAK,CAAC,CAAG,GAAI,CAAAoB,IAAI,CAACD,CAAC,CAACnB,KAAK,CAAC,CAAC,CAEnF;AACAc,YAAY,EAAE,CAEd;AACAE,OAAO,CAACrB,OAAO,CAAC0B,CAAC,EAAI,CACjB,GAAIA,CAAC,CAAClB,GAAG,GAAK,IAAI,CAAE,CAChBU,SAAS,CAACX,IAAI,CAACmB,CAAC,CAAClB,GAAG,CAAC,CACzB,CACJ,CAAC,CAAC,CAEF;AACA,GAAIa,OAAO,CAACzB,MAAM,CAAG,CAAC,CAAE,CACpBwB,mBAAmB,EAAE,CACrB,IAAK,GAAI,CAAAO,CAAC,CAAG,CAAC,CAAEA,CAAC,CAAGN,OAAO,CAACzB,MAAM,CAAE+B,CAAC,EAAE,CAAE,CACrC,GAAIN,OAAO,CAACM,CAAC,CAAC,CAACnB,GAAG,GAAK,IAAI,EAAIa,OAAO,CAACM,CAAC,CAAG,CAAC,CAAC,CAACnB,GAAG,GAAK,IAAI,CAAE,CACxD,KAAM,CAAAoB,MAAM,CAAGC,IAAI,CAACC,GAAG,CAACT,OAAO,CAACM,CAAC,CAAC,CAACnB,GAAG,CAAGa,OAAO,CAACM,CAAC,CAAG,CAAC,CAAC,CAACnB,GAAG,CAAC,CAC5D,GAAIoB,MAAM,CAAG,GAAG,CAAE,CAAE;AAChBZ,YAAY,EAAE,CACdC,cAAc,EAAIW,MAAM,CAC5B,CACJ,CACJ,CACJ,CACJ,CAAC,CAAC,CAEF,GAAIT,YAAY,CAAG,CAAC,EAAID,SAAS,CAACtB,MAAM,CAAG,CAAC,CAAE,CAC1C;AACA,KAAM,CAAAmC,IAAI,CAAGb,SAAS,CAACc,MAAM,CAAC,CAACC,GAAG,CAAEC,CAAC,GAAKD,GAAG,CAAGC,CAAC,CAAE,CAAC,CAAC,CAAGhB,SAAS,CAACtB,MAAM,CACxE,KAAM,CAAAuC,QAAQ,CAAGjB,SAAS,CAACc,MAAM,CAAC,CAACC,GAAG,CAAEC,CAAC,GAAKD,GAAG,CAAGJ,IAAI,CAACO,GAAG,CAACF,CAAC,CAAGH,IAAI,CAAE,CAAC,CAAC,CAAE,CAAC,CAAC,CAAGb,SAAS,CAACtB,MAAM,CAChG,KAAM,CAAAyC,MAAM,CAAGR,IAAI,CAACS,IAAI,CAACH,QAAQ,CAAC,CAElCrB,eAAe,CAACZ,KAAK,CAAC,CAAG,CACrBqC,eAAe,CAAEnB,mBAAmB,CAAG,CAAC,CAAGJ,YAAY,CAAGI,mBAAmB,CAAG,CAAC,CACjFoB,YAAY,CAAExB,YAAY,CAAG,CAAC,CAAGC,cAAc,CAAGD,YAAY,CAAG,CAAC,CAClEqB,MAAM,CAAEA,MAAM,CACdlB,YAAY,CAAEA,YAAY,CAC1BC,mBAAmB,CAAEA,mBACzB,CAAC,CACL,CACJ,CAAC,CAAC,CAEFvB,OAAO,CAACC,GAAG,CAAC,+BAA+B,CAAEgB,eAAe,CAAC,CAC7D,MAAO,CAAAA,eAAe,CAC1B,CAAC,CAAE,CAACpB,OAAO,CAAC,CAAC,CAEb,GAAI,CAACC,cAAc,EAAIiB,MAAM,CAACC,IAAI,CAAClB,cAAc,CAAC,CAACC,MAAM,GAAK,CAAC,CAAE,CAC7D,mBAAOP,IAAA,QAAKoD,SAAS,CAAC,aAAa,CAAAC,QAAA,CAAC,0BAAwB,CAAK,CAAC,CACtE,CAEA,mBACInD,KAAA,QAAKkD,SAAS,CAAC,sBAAsB,CAAAC,QAAA,eACjCrD,IAAA,OAAIoD,SAAS,CAAC,aAAa,CAAAC,QAAA,CAAC,8BAA4B,CAAI,CAAC,cAC7DrD,IAAA,QAAKoD,SAAS,CAAC,iBAAiB,CAAAC,QAAA,CAC3B9B,MAAM,CAACC,IAAI,CAAClB,cAAc,CAAC,CACvB2B,IAAI,CAAC,CAACC,CAAC,CAAEC,CAAC,GAAK7B,cAAc,CAAC6B,CAAC,CAAC,CAACe,eAAe,CAAG5C,cAAc,CAAC4B,CAAC,CAAC,CAACgB,eAAe,CAAC,CACrFI,GAAG,CAACzC,KAAK,EAAI,CACV,KAAM,CAAA0C,GAAG,CAAGjD,cAAc,CAACO,KAAK,CAAC,CACjC,mBACIX,KAAA,QAAiBkD,SAAS,CAAC,iBAAiB,CAAAC,QAAA,eACxCrD,IAAA,QAAKoD,SAAS,CAAC,kBAAkB,CAAAC,QAAA,CAAExC,KAAK,CAAM,CAAC,cAC/CX,KAAA,QAAKkD,SAAS,CAAC,oBAAoB,CAAAC,QAAA,eAC/BnD,KAAA,QAAKkD,SAAS,CAAC,mBAAmB,CAAAC,QAAA,eAC9BrD,IAAA,SAAMoD,SAAS,CAAC,cAAc,CAAAC,QAAA,CAAC,sBAAiB,CAAM,CAAC,cACvDrD,IAAA,SAAMoD,SAAS,CAAC,cAAc,CAAAC,QAAA,CAAEE,GAAG,CAACL,eAAe,CAACM,OAAO,CAAC,CAAC,CAAC,CAAO,CAAC,EACrE,CAAC,cACNtD,KAAA,QAAKkD,SAAS,CAAC,mBAAmB,CAAAC,QAAA,eAC9BrD,IAAA,SAAMoD,SAAS,CAAC,cAAc,CAAAC,QAAA,CAAC,gBAAc,CAAM,CAAC,cACpDnD,KAAA,SAAMkD,SAAS,CAAC,cAAc,CAAAC,QAAA,EAAC,GAAC,CAACE,GAAG,CAACJ,YAAY,CAACK,OAAO,CAAC,CAAC,CAAC,EAAO,CAAC,EACnE,CAAC,cACNtD,KAAA,QAAKkD,SAAS,CAAC,mBAAmB,CAAAC,QAAA,eAC9BrD,IAAA,SAAMoD,SAAS,CAAC,cAAc,CAAAC,QAAA,CAAC,oBAAe,CAAM,CAAC,cACrDnD,KAAA,SAAMkD,SAAS,CAAC,cAAc,CAAAC,QAAA,EAAC,GAAC,CAACE,GAAG,CAACP,MAAM,CAACQ,OAAO,CAAC,CAAC,CAAC,EAAO,CAAC,EAC7D,CAAC,cACNtD,KAAA,QAAKkD,SAAS,CAAC,mBAAmB,CAAAC,QAAA,eAC9BrD,IAAA,SAAMoD,SAAS,CAAC,cAAc,CAAAC,QAAA,CAAC,aAAW,CAAM,CAAC,cACjDnD,KAAA,SAAMkD,SAAS,CAAC,cAAc,CAAAC,QAAA,EAAEE,GAAG,CAACzB,YAAY,CAAC,IAAE,CAACyB,GAAG,CAACxB,mBAAmB,CAAC,iBAAe,EAAM,CAAC,EACjG,CAAC,EACL,CAAC,GAnBAlB,KAoBL,CAAC,CAEd,CAAC,CAAC,CACL,CAAC,EACL,CAAC,CAEd,CAAC,CAED,cAAe,CAAAV,eAAe","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}