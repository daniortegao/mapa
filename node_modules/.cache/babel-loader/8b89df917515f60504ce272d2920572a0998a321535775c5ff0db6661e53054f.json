{"ast":null,"code":"import _objectSpread from\"C:/Users/e08f/Desktop/Proyectos/Resumen/mapa-v2/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useEffect,useRef,useState,useCallback}from'react';import{useMap}from'react-leaflet';import L from'leaflet';import ReactDOM from'react-dom/client';import{createCustomIcon}from'../utils/iconHelpers';import{guardarCoordenadaCorregida}from'../services/apiService';import TrendChart from'../components/TrendChart';import'../styles/iconMarkersLayer.css';const IconMarkersLayer=_ref=>{let{markers,markersForMercado=null,selectedRegion,baseCompData=[]}=_ref;const map=useMap();const markersRef=useRef({});const guerraMarkersRef=useRef({});const cacheRef=useRef({});const updateInProgressRef=useRef(false);const zoomUpdateRef=useRef(null);const[showingAssociated,setShowingAssociated]=useState(false);const[originalPopupMarker,setOriginalPopupMarker]=useState(null);const[activeMercadoPbl,setActiveMercadoPbl]=useState(null);const competenciaMarkersRef=useRef([]);const polylineRef=useRef([]);const[debugTable,setDebugTable]=useState(null);const[maxHeight,setMaxHeight]=useState(500);const[activeTab,setActiveTab]=useState('precios');const[modoCorreccion,setModoCorreccion]=useState(null);// Hacer popup draggable\nconst makeDraggable=useCallback(popup=>{if(!map||!popup||!popup._container)return;try{const pos=map.latLngToLayerPoint(popup.getLatLng());L.DomUtil.setPosition(popup._wrapper.parentNode,pos);const draggable=new L.Draggable(popup._container,popup._wrapper);draggable.enable();}catch(error){console.error('Error draggable:',error);}},[map]);const clearCompetenciaMarkers=useCallback(()=>{competenciaMarkersRef.current.forEach(marker=>{try{if(map&&map.hasLayer(marker)){map.removeLayer(marker);}}catch(e){console.error('Error limpiando competencia:',e);}});competenciaMarkersRef.current=[];},[map]);const clearPolylines=useCallback(()=>{polylineRef.current.forEach(line=>{try{if(map&&map.hasLayer(line)){map.removeLayer(line);}}catch(e){console.error('Error limpiando polyline:',e);}});polylineRef.current=[];},[map]);const clearGuerraMarkers=useCallback(()=>{Object.values(guerraMarkersRef.current).forEach(marker=>{try{if(map&&map.hasLayer(marker)){map.removeLayer(marker);}}catch(e){console.error('Error limpiando guerra markers:',e);}});guerraMarkersRef.current={};},[map]);// Genera HTML de tabla de precios (sin gráfico)\nconst generarTablaPrecios=useCallback(function(datos){let variant=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'primary';if(!datos||datos.length===0){return'<div style=\"padding: 12px; text-align: center; font-size: 12px; color: #999; font-style: italic;\">Sin datos disponibles</div>';}const variantClass=variant==='primary'?'':'secondary';let html=\"<div class=\\\"popup-table-wrapper \".concat(variantClass,\"\\\">\\n      <table class=\\\"popup-table \").concat(variantClass,\"\\\">\\n        <thead>\\n          <tr>\\n            <th>Fecha</th>\\n            <th>G93</th>\\n            <th>G95</th>\\n            <th>G97</th>\\n            <th>Diesel</th>\\n            <th>Kero</th>\\n          </tr>\\n        </thead>\\n        <tbody>\");datos.forEach(fila=>{html+=\"\\n        <tr>\\n          <td>\".concat(fila.fecha,\"</td>\\n          <td>\").concat(fila.g93,\"</td>\\n          <td>\").concat(fila.g95,\"</td>\\n          <td>\").concat(fila.g97,\"</td>\\n          <td>\").concat(fila.diesel,\"</td>\\n          <td>\").concat(fila.kero,\"</td>\\n        </tr>\");});html+=\"</tbody></table></div>\";return html;},[]);// Normaliza histórico del marker\nconst obtenerHistoricoMarker=useCallback((markerId,dataArray)=>{const datos=dataArray.filter(m=>m.id===markerId);return datos.sort((a,b)=>{const fechaA=a.fecha_aplicacion?new Date(a.fecha_aplicacion):new Date(0);const fechaB=b.fecha_aplicacion?new Date(b.fecha_aplicacion):new Date(0);return fechaB-fechaA;}).map(item=>({fecha:item.fecha_aplicacion||'S/F',g93:item.precio_g93||'-',g95:item.precio_g95||'-',g97:item.precio_g97||'-',diesel:item.precio_diesel||'-',kero:item.precio_kero||'-'}));},[]);// Popup HTML con pestañas y placeholder para el gráfico React\nconst generarPopupContent=useCallback(function(marker,datosTabla,tablaPreciosHtml){let variant=arguments.length>3&&arguments[3]!==undefined?arguments[3]:'primary';const logoUrl=marker.logo?marker.logo.startsWith('http')?marker.logo:\"https://api.bencinaenlinea.cl\".concat(marker.logo):'';return\"\\n      <div class=\\\"icon-markers-popup-content\\\">\\n        <div class=\\\"popup-info-header\\\">\\n          \".concat(logoUrl?\"<img src=\\\"\".concat(logoUrl,\"\\\" alt=\\\"Logo \").concat(marker.Marca,\"\\\" class=\\\"popup-logo\\\" onerror=\\\"this.style.display='none';\\\"/>\"):'',\"\\n          <div class=\\\"popup-info-row\\\"><span class=\\\"popup-label\\\">PBL:</span><span class=\\\"popup-value\\\">\").concat(marker.pbl||'-',\"</span></div>\\n          <div class=\\\"popup-info-row\\\"><span class=\\\"popup-label\\\">Estaci\\xF3n:</span><span class=\\\"popup-value\\\">\").concat(marker.eds||'-',\"</span></div>\\n          <div class=\\\"popup-info-row\\\"><span class=\\\"popup-label\\\">Jefe Zona:</span><span class=\\\"popup-value\\\">\").concat(marker.nombre||'-',\"</span></div>\\n          <div class=\\\"popup-info-row\\\"><span class=\\\"popup-label\\\">Operaci\\xF3n:</span><span class=\\\"popup-value\\\">\").concat(marker.operacion||'Comisionista',\"</span></div>\\n        </div>\\n\\n        <div class=\\\"popup-tabs-container\\\">\\n          <div class=\\\"popup-tabs-header\\\">\\n            <button class=\\\"popup-tab-button active\\\" data-tab=\\\"precios\\\">Precios</button>\\n            <button class=\\\"popup-tab-button\\\" data-tab=\\\"tendencias\\\">Tendencias</button>\\n            <button class=\\\"popup-tab-button\\\" data-tab=\\\"coordenadas\\\">Coordenadas</button>\\n            <button class=\\\"popup-tab-button\\\" data-tab=\\\"informacion\\\">Informaci\\xF3n</button>\\n          </div>\\n\\n          <div class=\\\"popup-tabs-content\\\">\\n            <div class=\\\"popup-tab-pane active\\\" data-tab=\\\"precios\\\">\").concat(tablaPreciosHtml,\"</div>\\n\\n            <div class=\\\"popup-tab-pane\\\" data-tab=\\\"tendencias\\\">\\n              <div id=\\\"trend-root-\").concat(marker.id,\"\\\" style=\\\"min-width:320px;min-height:170px;padding-top:6px;\\\"></div>\\n            </div>\\n\\n            <div class=\\\"popup-tab-pane\\\" data-tab=\\\"coordenadas\\\">\\n              <div class=\\\"popup-info-box\\\">\\n                <p><strong>Lat corregida:</strong> <span id=\\\"lat-actual-\").concat(marker.pbl||marker.id,\"\\\">\").concat(marker.lat.toFixed(6),\"</span></p>\\n                <p><strong>Lon corregida:</strong> <span id=\\\"lon-actual-\").concat(marker.pbl||marker.id,\"\\\">\").concat(marker.lng.toFixed(6),\"</span></p>\\n                <hr style=\\\"margin: 8px 0; border: none; border-top: 1px solid #dee2e6;\\\">\\n                <p><strong>Regi\\xF3n:</strong> \").concat(marker.Region||'-',\"</p>\\n                <p><strong>Comuna:</strong> \").concat(marker.Comuna||'-',\"</p>\\n              </div>\\n              <div style=\\\"display: flex; gap: 8px; margin-top: 10px;\\\">\\n                <button id=\\\"activar-coord-\").concat(marker.pbl||marker.id,\"\\\" style=\\\"flex: 1; padding: 8px; background: #17a2b8; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 11px; font-weight: 600;\\\" onclick=\\\"window.activarCorreccionCoordenadas('\").concat(marker.pbl||'',\"', '\").concat(marker.id||'',\"', '\").concat(marker.eds,\"', '\").concat(marker.Marca,\"')\\\">Activar Coord</button>\\n                <button id=\\\"guardar-coord-\").concat(marker.pbl||marker.id,\"\\\" style=\\\"flex: 1; padding: 8px; background: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 11px; font-weight: 600; opacity: 0.5;\\\" onclick=\\\"window.guardarCorreccionCoordenadas('\").concat(marker.pbl||'',\"', '\").concat(marker.id||'',\"', '\").concat(marker.eds,\"', '\").concat(marker.Marca,\"')\\\" disabled>Guardar</button>\\n              </div>\\n            </div>\\n\\n            <div class=\\\"popup-tab-pane\\\" data-tab=\\\"informacion\\\">\\n              <div class=\\\"popup-info-box\\\">\\n                <p><strong>Direcci\\xF3n:</strong> \").concat(marker.direccion||'-',\"</p>\\n                <p><strong>Surtidores PES:</strong> \").concat(marker.Surtidores_Autoservicio||'-',\"</p>\\n                <p><strong>Posici\\xF3n Surtidor:</strong> \").concat(marker.Posicion_Surtidor||'-',\"</p>\\n                <p><strong>Tipo Isla:</strong> \").concat(marker.Tipo_Isla||'-',\"</p>\\n                \").concat(marker.Guerra_Precio==='Si'?\"<hr style=\\\"margin: 8px 0; border: none; border-top: 1px solid #dee2e6;\\\"><p><strong style=\\\"color: #d9534f;\\\">\\u26A0\\uFE0F Guerra de Precio Activa</strong></p>\":'',\"\\n              </div>\\n            </div>\\n          </div>\\n        </div>\\n\\n        \").concat(marker.pbl&&(marker.Marca==='Aramco'||marker.Marca==='Petrobras')?\"<button class=\\\"popup-button-mercado\\\" onclick=\\\"window.showAssociatedIds && window.showAssociatedIds(\".concat(marker.pbl,\", \").concat(marker.lat,\", \").concat(marker.lng,\", '\").concat(marker.id,\"')\\\">Mercado</button>\"):'',\"\\n      </div>\\n    \");},[]);// Dibuja íconos visibles y arma popups con montaje diferido del gráfico\nconst updateIconsInViewport=useCallback(function(allMarkers){let clearFirst=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;if(!map||updateInProgressRef.current)return;updateInProgressRef.current=true;const bounds=map.getBounds();const visibleMarkers=allMarkers.filter(marker=>bounds.contains([marker.lat,marker.lng]));if(clearFirst){Object.values(markersRef.current).forEach(marker=>{try{if(map.hasLayer(marker))map.removeLayer(marker);}catch(error){console.error('Error removiendo:',error);}});markersRef.current={};clearGuerraMarkers();map.eachLayer(layer=>{if(layer instanceof L.Marker&&!map.hasLayer(layer)){try{map.removeLayer(layer);}catch(e){}}});}if(visibleMarkers.length===0){updateInProgressRef.current=false;return;}const markersByBrand={};visibleMarkers.forEach(marker=>{if(!markersByBrand[marker.Marca])markersByBrand[marker.Marca]=[];markersByBrand[marker.Marca].push(marker);});const brandOrder=['Aramco','Petrobras','Copec','Shell','Blanco','Gulf','Petroprix'];let delayOffset=0;const cacheKey=selectedRegion;let totalBrands=brandOrder.filter(b=>markersByBrand[b]).length;let brandsProcessed=0;brandOrder.forEach(brand=>{if(!markersByBrand[brand]||markersByBrand[brand].length===0)return;const brandMarkers=markersByBrand[brand];setTimeout(()=>{brandMarkers.forEach(marker=>{try{const markerId=\"\".concat(cacheKey,\"-\").concat(marker.id);if(markersRef.current[markerId])return;const lat=parseFloat(marker.lat);const lng=parseFloat(marker.lng);if(isNaN(lat)||isNaN(lng))return;// Marker principal\nconst iconUrl=createCustomIcon(marker.Marca);const leafletMarker=L.marker([lat,lng],{icon:iconUrl}).addTo(map);// Overlay de guerra\nconst tieneGuerra=marker.Guerra_Precio==='Si'||marker.guerraPrecios===true;if(tieneGuerra){const guerraIcon=L.icon({iconUrl:\"\".concat(process.env.PUBLIC_URL,\"/iconos/calavera.jpg\"),iconSize:[15,15],iconAnchor:[7.5,7.5],className:'icono-guerra'});const guerraMarker=L.marker([lat,lng],{icon:guerraIcon,interactive:false}).addTo(map);guerraMarkersRef.current[markerId]=guerraMarker;}// Datos de tabla/histórico\nconst datosTabla=obtenerHistoricoMarker(marker.id,allMarkers);const tablaPreciosHtml=generarTablaPrecios(datosTabla,'primary');leafletMarker.on('popupopen',e=>{setDebugTable({titulo:\"\".concat(marker.Marca,\" - \").concat(marker.nombre),registros:datosTabla.length,html:tablaPreciosHtml});setActiveTab('precios');});const popupContent=generarPopupContent(marker,datosTabla,tablaPreciosHtml,'primary');const popup=L.popup({autoClose:false,closeOnClick:false,keepInView:true,autoPan:false,maxWidth:450,className:'custom-popup'}).setContent(popupContent);leafletMarker.bindPopup(popup);// Manejo de tabs + montaje del TrendChart al abrir\nleafletMarker.on('popupopen',e=>{makeDraggable(popup);setTimeout(()=>{const popupContainer=e.popup._container;const tabButtons=popupContainer.querySelectorAll('.popup-tab-button');tabButtons.forEach(btn=>{btn.addEventListener('click',function(){const tabName=this.getAttribute('data-tab');// Toggle visual\npopupContainer.querySelectorAll('.popup-tab-button').forEach(b=>b.classList.remove('active'));popupContainer.querySelectorAll('.popup-tab-pane').forEach(pane=>pane.classList.remove('active'));this.classList.add('active');popupContainer.querySelector(\".popup-tab-pane[data-tab=\\\"\".concat(tabName,\"\\\"]\")).classList.add('active');// Montar gráfico cuando se elige \"tendencias\"\nif(tabName==='tendencias'){const el=popupContainer.querySelector(\"#trend-root-\".concat(marker.id));if(el&&!el.__mounted){const root=ReactDOM.createRoot(el);root.render(/*#__PURE__*/React.createElement(TrendChart,{dataRows:datosTabla,maxPoints:7,height:170,compact:true}));el.__mounted=true;el.__root=root;}}});});},0);});// Limpieza: desmontar gráfico al cerrar\nleafletMarker.on('popupclose',e=>{var _e$popup;const container=(_e$popup=e.popup)===null||_e$popup===void 0?void 0:_e$popup._container;if(!container)return;const el=container.querySelector(\"#trend-root-\".concat(marker.id));if(el&&el.__root){el.__root.unmount();el.__mounted=false;el.__root=null;}});leafletMarker.on('click',()=>{leafletMarker.openPopup();});markersRef.current[markerId]=leafletMarker;cacheRef.current[markerId]={lat:marker.lat,lng:marker.lng,marca:marker.Marca,nombre:marker.nombre,region:marker.Region};}catch(error){console.error('Error:',error);}});brandsProcessed++;localStorage.setItem('markersCache',JSON.stringify(cacheRef.current));if(brandsProcessed===totalBrands){updateInProgressRef.current=false;}},delayOffset);delayOffset+=60;});},[map,makeDraggable,selectedRegion,generarTablaPrecios,obtenerHistoricoMarker,generarPopupContent,clearGuerraMarkers]);// Mostrar IDs asociados (Mercado)\nconst showAssociatedIds=useCallback((pbl,lat,lng,originalMarkerId)=>{const searchArray=markersForMercado&&markersForMercado.length>0?markersForMercado:markers;if(showingAssociated&&activeMercadoPbl===pbl){clearCompetenciaMarkers();clearPolylines();clearGuerraMarkers();Object.values(markersRef.current).forEach(marker=>{try{if(map.hasLayer(marker))map.removeLayer(marker);}catch(error){console.error('Error removiendo:',error);}});markersRef.current={};setShowingAssociated(false);setActiveMercadoPbl(null);setOriginalPopupMarker(null);const markersToShow=markersForMercado&&markersForMercado.length>0?markersForMercado:markers;if(map&&markersToShow&&markersToShow.length>0){updateIconsInViewport(markersToShow,true);}return;}clearCompetenciaMarkers();clearPolylines();const associatedData=baseCompData.filter(item=>String(item.pbl).trim()===String(pbl).trim());if(associatedData.length===0)return;const ids=associatedData.map(item=>item.id);if(map){let openPopup=null;map.eachLayer(layer=>{if(layer instanceof L.Marker&&layer._popup&&layer._popup.isOpen()){openPopup=layer._popup;}});map.eachLayer(layer=>{if(layer instanceof L.Marker){const mLatLng=layer.getLatLng();const shouldKeep=ids.some(id=>{const marker=searchArray.find(m=>m.id===id);return marker&&marker.lat===mLatLng.lat&&marker.lng===mLatLng.lng;})||mLatLng.lat===lat&&mLatLng.lng===lng;if(!shouldKeep){map.removeLayer(layer);}}});Object.values(markersRef.current).forEach(marker=>{const mLatLng=marker.getLatLng();const shouldKeep=ids.some(id=>{const m=searchArray.find(x=>x.id===id);return m&&m.lat===mLatLng.lat&&m.lng===mLatLng.lng;})||mLatLng.lat===lat&&mLatLng.lng===lng;if(!shouldKeep){try{if(map.hasLayer(marker))map.removeLayer(marker);}catch(error){console.error('Error:',error);}}});const associatedMarkers=searchArray.filter(item=>ids.includes(item.id));associatedMarkers.forEach(marker=>{const markerLat=parseFloat(marker.lat);const markerLng=parseFloat(marker.lng);if(isNaN(markerLat)||isNaN(markerLng))return;let exists=false;map.eachLayer(layer=>{if(layer instanceof L.Marker){const mLatLng=layer.getLatLng();if(mLatLng.lat===markerLat&&mLatLng.lng===markerLng)exists=true;}});if(!exists){const iconUrl=createCustomIcon(marker.Marca);const leafletMarker=L.marker([markerLat,markerLng],{icon:iconUrl}).addTo(map);const tieneGuerra=marker.Guerra_Precio==='Si'||marker.guerraPrecios===true;if(tieneGuerra){const guerraIcon=L.icon({iconUrl:\"\".concat(process.env.PUBLIC_URL,\"/iconos/calavera.jpg\"),iconSize:[15,15],iconAnchor:[7.5,7.5],className:'icono-guerra'});L.marker([markerLat,markerLng],{icon:guerraIcon,interactive:false}).addTo(map);}competenciaMarkersRef.current.push(leafletMarker);const datosTabla=obtenerHistoricoMarker(marker.id,baseCompData);const tablaPreciosHtml=generarTablaPrecios(datosTabla,'secondary');leafletMarker.on('popupopen',()=>{setDebugTable({titulo:\"\".concat(marker.Marca,\" - \").concat(marker.nombre),registros:datosTabla.length,html:tablaPreciosHtml});setActiveTab('precios');});const popupContent=generarPopupContent(marker,datosTabla,tablaPreciosHtml,'secondary');const popup=L.popup({autoClose:false,closeOnClick:false,keepInView:true,autoPan:false,maxWidth:450,className:'custom-popup'}).setContent(popupContent);leafletMarker.bindPopup(popup);leafletMarker.on('popupopen',e=>{makeDraggable(popup);setTimeout(()=>{const popupContainer=e.popup._container;const tabButtons=popupContainer.querySelectorAll('.popup-tab-button');tabButtons.forEach(btn=>{btn.addEventListener('click',function(){const tabName=this.getAttribute('data-tab');popupContainer.querySelectorAll('.popup-tab-button').forEach(b=>b.classList.remove('active'));popupContainer.querySelectorAll('.popup-tab-pane').forEach(pane=>pane.classList.remove('active'));this.classList.add('active');popupContainer.querySelector(\".popup-tab-pane[data-tab=\\\"\".concat(tabName,\"\\\"]\")).classList.add('active');if(tabName==='tendencias'){const el=popupContainer.querySelector(\"#trend-root-\".concat(marker.id));if(el&&!el.__mounted){const root=ReactDOM.createRoot(el);root.render(/*#__PURE__*/React.createElement(TrendChart,{dataRows:datosTabla,maxPoints:7,height:170,compact:true}));el.__mounted=true;el.__root=root;}}});});},0);});leafletMarker.on('popupclose',e=>{var _e$popup2;const container=(_e$popup2=e.popup)===null||_e$popup2===void 0?void 0:_e$popup2._container;if(!container)return;const el=container.querySelector(\"#trend-root-\".concat(marker.id));if(el&&el.__root){el.__root.unmount();el.__mounted=false;el.__root=null;}});leafletMarker.on('click',()=>leafletMarker.openPopup());}});const mainMarkersData=associatedData.filter(m=>m.Marcador_Principal==='Si');mainMarkersData.forEach(mainMarker=>{const markerWithCoords=searchArray.find(m=>m.id===mainMarker.id);if(!markerWithCoords)return;const mainLat=parseFloat(markerWithCoords.lat);const mainLng=parseFloat(markerWithCoords.lng);if(isNaN(mainLat)||isNaN(mainLng))return;const currentLat=parseFloat(lat);const currentLng=parseFloat(lng);const polyline=L.polyline([[currentLat,currentLng],[mainLat,mainLng]],{color:'#FF6B6B',weight:3,opacity:0.8,dashArray:'5, 5'}).addTo(map);polylineRef.current.push(polyline);});if(openPopup){setTimeout(()=>{try{openPopup._map=map;openPopup.update();}catch(e){/* noop */}},50);}setShowingAssociated(true);setActiveMercadoPbl(pbl);}},[baseCompData,markers,markersForMercado,map,makeDraggable,showingAssociated,activeMercadoPbl,updateIconsInViewport,clearCompetenciaMarkers,clearPolylines,clearGuerraMarkers,generarTablaPrecios,obtenerHistoricoMarker,generarPopupContent]);useEffect(()=>{window.showAssociatedIds=showAssociatedIds;},[showAssociatedIds]);// When markers or region change\nuseEffect(()=>{if(!map||!markers||markers.length===0)return;clearCompetenciaMarkers();clearPolylines();clearGuerraMarkers();setShowingAssociated(false);setActiveMercadoPbl(null);setOriginalPopupMarker(null);updateIconsInViewport(markers,true);},[map,markers,selectedRegion,updateIconsInViewport,clearCompetenciaMarkers,clearPolylines,clearGuerraMarkers]);// Zoom handler\nuseEffect(()=>{if(!map)return;const handleZoomEnd=()=>{if(zoomUpdateRef.current)clearTimeout(zoomUpdateRef.current);zoomUpdateRef.current=setTimeout(()=>{if(showingAssociated){// Mantener vista en modo competencia\n}else if(markers&&markers.length>0){updateIconsInViewport(markers,false);}},400);};map.on('zoomend',handleZoomEnd);return()=>{map.off('zoomend',handleZoomEnd);};},[map,markers,updateIconsInViewport,showingAssociated]);// Modo corrección de coordenadas\nuseEffect(()=>{window.activarCorreccionCoordenadas=(pbl,id,eds,marca)=>{const identifier=pbl||id;if(map)map.getContainer().style.cursor='crosshair';setModoCorreccion({pbl,id,eds,marca,lat:null,lng:null});const btnGuardar=document.getElementById(\"guardar-coord-\".concat(identifier));if(btnGuardar){btnGuardar.disabled=true;btnGuardar.style.opacity='0.5';}const btnActivar=document.getElementById(\"activar-coord-\".concat(identifier));if(btnActivar){btnActivar.textContent='Click en mapa...';btnActivar.style.background='#ffc107';}};window.guardarCorreccionCoordenadas=async(pbl,id,eds,marca)=>{if(!modoCorreccion||!modoCorreccion.lat||!modoCorreccion.lng){alert('⚠️ Primero selecciona una ubicación');return;}const identifier=pbl||id;let marker=null;if(pbl){marker=markers.find(m=>m.pbl===pbl)||(markersForMercado===null||markersForMercado===void 0?void 0:markersForMercado.find(m=>m.pbl===pbl))||(baseCompData===null||baseCompData===void 0?void 0:baseCompData.find(m=>m.pbl===pbl));}if(!marker&&id){marker=markers.find(m=>m.id===id)||(markersForMercado===null||markersForMercado===void 0?void 0:markersForMercado.find(m=>m.id===id))||(baseCompData===null||baseCompData===void 0?void 0:baseCompData.find(m=>m.id===id));}if(!marker){alert('❌ Error: No se encontró el marcador');return;}try{const coordenada={id:id||marker.id||pbl,pbl:pbl||marker.pbl||id,eds:eds||marker.eds||'',marca:marca||marker.Marca||'',comuna:marker.Comuna||'',lat_corregida:modoCorreccion.lat,lon_corregida:modoCorreccion.lng};await guardarCoordenadaCorregida(coordenada);const cacheKey=selectedRegion;const markerId=\"\".concat(cacheKey,\"-\").concat(marker.id);let leafletMarker=markersRef.current[markerId];if(!leafletMarker&&competenciaMarkersRef.current.length>0){leafletMarker=competenciaMarkersRef.current.find(m=>{const latLng=m.getLatLng();return latLng.lat===marker.lat&&latLng.lng===marker.lng;});}if(leafletMarker&&map){const newLatLng=L.latLng(modoCorreccion.lat,modoCorreccion.lng);leafletMarker.setLatLng(newLatLng);if(guerraMarkersRef.current[markerId]){guerraMarkersRef.current[markerId].setLatLng(newLatLng);}map.setView(newLatLng,map.getZoom());if(leafletMarker.isPopupOpen()){leafletMarker.closePopup();setTimeout(()=>{leafletMarker.openPopup();},100);}}marker.lat=modoCorreccion.lat;marker.lng=modoCorreccion.lng;setModoCorreccion(null);if(map)map.getContainer().style.cursor='';}catch(error){alert('❌ Error al guardar: '+error.message);}};return()=>{delete window.activarCorreccionCoordenadas;delete window.guardarCorreccionCoordenadas;};},[map,modoCorreccion,markers,markersForMercado,baseCompData,selectedRegion]);useEffect(()=>{if(!map||!modoCorreccion)return;const handleMapClick=e=>{const{lat,lng}=e.latlng;setModoCorreccion(prev=>_objectSpread(_objectSpread({},prev),{},{lat,lng}));const identifier=modoCorreccion.pbl||modoCorreccion.id;const latSpan=document.getElementById(\"lat-actual-\".concat(identifier));const lngSpan=document.getElementById(\"lon-actual-\".concat(identifier));if(latSpan)latSpan.textContent=lat.toFixed(6);if(lngSpan)lngSpan.textContent=lng.toFixed(6);const btnGuardar=document.getElementById(\"guardar-coord-\".concat(identifier));if(btnGuardar){btnGuardar.disabled=false;btnGuardar.style.opacity='1';}const btnActivar=document.getElementById(\"activar-coord-\".concat(identifier));if(btnActivar){btnActivar.textContent='Coord. Seleccionada ✓';btnActivar.style.background='#28a745';}map.getContainer().style.cursor='';};map.on('click',handleMapClick);return()=>{map.off('click',handleMapClick);};},[map,modoCorreccion]);return null;};export default IconMarkersLayer;","map":{"version":3,"names":["React","useEffect","useRef","useState","useCallback","useMap","L","ReactDOM","createCustomIcon","guardarCoordenadaCorregida","TrendChart","IconMarkersLayer","_ref","markers","markersForMercado","selectedRegion","baseCompData","map","markersRef","guerraMarkersRef","cacheRef","updateInProgressRef","zoomUpdateRef","showingAssociated","setShowingAssociated","originalPopupMarker","setOriginalPopupMarker","activeMercadoPbl","setActiveMercadoPbl","competenciaMarkersRef","polylineRef","debugTable","setDebugTable","maxHeight","setMaxHeight","activeTab","setActiveTab","modoCorreccion","setModoCorreccion","makeDraggable","popup","_container","pos","latLngToLayerPoint","getLatLng","DomUtil","setPosition","_wrapper","parentNode","draggable","Draggable","enable","error","console","clearCompetenciaMarkers","current","forEach","marker","hasLayer","removeLayer","e","clearPolylines","line","clearGuerraMarkers","Object","values","generarTablaPrecios","datos","variant","arguments","length","undefined","variantClass","html","concat","fila","fecha","g93","g95","g97","diesel","kero","obtenerHistoricoMarker","markerId","dataArray","filter","m","id","sort","a","b","fechaA","fecha_aplicacion","Date","fechaB","item","precio_g93","precio_g95","precio_g97","precio_diesel","precio_kero","generarPopupContent","datosTabla","tablaPreciosHtml","logoUrl","logo","startsWith","Marca","pbl","eds","nombre","operacion","lat","toFixed","lng","Region","Comuna","direccion","Surtidores_Autoservicio","Posicion_Surtidor","Tipo_Isla","Guerra_Precio","updateIconsInViewport","allMarkers","clearFirst","bounds","getBounds","visibleMarkers","contains","eachLayer","layer","Marker","markersByBrand","push","brandOrder","delayOffset","cacheKey","totalBrands","brandsProcessed","brand","brandMarkers","setTimeout","parseFloat","isNaN","iconUrl","leafletMarker","icon","addTo","tieneGuerra","guerraPrecios","guerraIcon","process","env","PUBLIC_URL","iconSize","iconAnchor","className","guerraMarker","interactive","on","titulo","registros","popupContent","autoClose","closeOnClick","keepInView","autoPan","maxWidth","setContent","bindPopup","popupContainer","tabButtons","querySelectorAll","btn","addEventListener","tabName","getAttribute","classList","remove","pane","add","querySelector","el","__mounted","root","createRoot","render","createElement","dataRows","maxPoints","height","compact","__root","_e$popup","container","unmount","openPopup","marca","region","localStorage","setItem","JSON","stringify","showAssociatedIds","originalMarkerId","searchArray","markersToShow","associatedData","String","trim","ids","_popup","isOpen","mLatLng","shouldKeep","some","find","x","associatedMarkers","includes","markerLat","markerLng","exists","_e$popup2","mainMarkersData","Marcador_Principal","mainMarker","markerWithCoords","mainLat","mainLng","currentLat","currentLng","polyline","color","weight","opacity","dashArray","_map","update","window","handleZoomEnd","clearTimeout","off","activarCorreccionCoordenadas","identifier","getContainer","style","cursor","btnGuardar","document","getElementById","disabled","btnActivar","textContent","background","guardarCorreccionCoordenadas","alert","coordenada","comuna","lat_corregida","lon_corregida","latLng","newLatLng","setLatLng","setView","getZoom","isPopupOpen","closePopup","message","handleMapClick","latlng","prev","_objectSpread","latSpan","lngSpan"],"sources":["C:/Users/e08f/Desktop/Proyectos/Resumen/mapa-v2/src/components/IconMarkersLayer.jsx"],"sourcesContent":["import React, { useEffect, useRef, useState, useCallback } from 'react';\r\nimport { useMap } from 'react-leaflet';\r\nimport L from 'leaflet';\r\nimport ReactDOM from 'react-dom/client';\r\nimport { createCustomIcon } from '../utils/iconHelpers';\r\nimport { guardarCoordenadaCorregida } from '../services/apiService';\r\nimport TrendChart from '../components/TrendChart';\r\nimport '../styles/iconMarkersLayer.css';\r\n\r\nconst IconMarkersLayer = ({ markers, markersForMercado = null, selectedRegion, baseCompData = [] }) => {\r\n  const map = useMap();\r\n  const markersRef = useRef({});\r\n  const guerraMarkersRef = useRef({});\r\n  const cacheRef = useRef({});\r\n  const updateInProgressRef = useRef(false);\r\n  const zoomUpdateRef = useRef(null);\r\n\r\n  const [showingAssociated, setShowingAssociated] = useState(false);\r\n  const [originalPopupMarker, setOriginalPopupMarker] = useState(null);\r\n  const [activeMercadoPbl, setActiveMercadoPbl] = useState(null);\r\n\r\n  const competenciaMarkersRef = useRef([]);\r\n  const polylineRef = useRef([]);\r\n\r\n  const [debugTable, setDebugTable] = useState(null);\r\n  const [maxHeight, setMaxHeight] = useState(500);\r\n  const [activeTab, setActiveTab] = useState('precios');\r\n  const [modoCorreccion, setModoCorreccion] = useState(null);\r\n\r\n  // Hacer popup draggable\r\n  const makeDraggable = useCallback((popup) => {\r\n    if (!map || !popup || !popup._container) return;\r\n    try {\r\n      const pos = map.latLngToLayerPoint(popup.getLatLng());\r\n      L.DomUtil.setPosition(popup._wrapper.parentNode, pos);\r\n      const draggable = new L.Draggable(popup._container, popup._wrapper);\r\n      draggable.enable();\r\n    } catch (error) {\r\n      console.error('Error draggable:', error);\r\n    }\r\n  }, [map]);\r\n\r\n  const clearCompetenciaMarkers = useCallback(() => {\r\n    competenciaMarkersRef.current.forEach(marker => {\r\n      try {\r\n        if (map && map.hasLayer(marker)) {\r\n          map.removeLayer(marker);\r\n        }\r\n      } catch (e) {\r\n        console.error('Error limpiando competencia:', e);\r\n      }\r\n    });\r\n    competenciaMarkersRef.current = [];\r\n  }, [map]);\r\n\r\n  const clearPolylines = useCallback(() => {\r\n    polylineRef.current.forEach(line => {\r\n      try {\r\n        if (map && map.hasLayer(line)) {\r\n          map.removeLayer(line);\r\n        }\r\n      } catch (e) {\r\n        console.error('Error limpiando polyline:', e);\r\n      }\r\n    });\r\n    polylineRef.current = [];\r\n  }, [map]);\r\n\r\n  const clearGuerraMarkers = useCallback(() => {\r\n    Object.values(guerraMarkersRef.current).forEach(marker => {\r\n      try {\r\n        if (map && map.hasLayer(marker)) {\r\n          map.removeLayer(marker);\r\n        }\r\n      } catch (e) {\r\n        console.error('Error limpiando guerra markers:', e);\r\n      }\r\n    });\r\n    guerraMarkersRef.current = {};\r\n  }, [map]);\r\n\r\n  // Genera HTML de tabla de precios (sin gráfico)\r\n  const generarTablaPrecios = useCallback((datos, variant = 'primary') => {\r\n    if (!datos || datos.length === 0) {\r\n      return '<div style=\"padding: 12px; text-align: center; font-size: 12px; color: #999; font-style: italic;\">Sin datos disponibles</div>';\r\n    }\r\n    const variantClass = variant === 'primary' ? '' : 'secondary';\r\n    let html = `<div class=\"popup-table-wrapper ${variantClass}\">\r\n      <table class=\"popup-table ${variantClass}\">\r\n        <thead>\r\n          <tr>\r\n            <th>Fecha</th>\r\n            <th>G93</th>\r\n            <th>G95</th>\r\n            <th>G97</th>\r\n            <th>Diesel</th>\r\n            <th>Kero</th>\r\n          </tr>\r\n        </thead>\r\n        <tbody>`;\r\n    datos.forEach((fila) => {\r\n      html += `\r\n        <tr>\r\n          <td>${fila.fecha}</td>\r\n          <td>${fila.g93}</td>\r\n          <td>${fila.g95}</td>\r\n          <td>${fila.g97}</td>\r\n          <td>${fila.diesel}</td>\r\n          <td>${fila.kero}</td>\r\n        </tr>`;\r\n    });\r\n    html += `</tbody></table></div>`;\r\n    return html;\r\n  }, []);\r\n\r\n  // Normaliza histórico del marker\r\n  const obtenerHistoricoMarker = useCallback((markerId, dataArray) => {\r\n    const datos = dataArray.filter(m => m.id === markerId);\r\n    return datos\r\n      .sort((a, b) => {\r\n        const fechaA = a.fecha_aplicacion ? new Date(a.fecha_aplicacion) : new Date(0);\r\n        const fechaB = b.fecha_aplicacion ? new Date(b.fecha_aplicacion) : new Date(0);\r\n        return fechaB - fechaA;\r\n      })\r\n      .map(item => ({\r\n        fecha: item.fecha_aplicacion || 'S/F',\r\n        g93: item.precio_g93 || '-',\r\n        g95: item.precio_g95 || '-',\r\n        g97: item.precio_g97 || '-',\r\n        diesel: item.precio_diesel || '-',\r\n        kero: item.precio_kero || '-'\r\n      }));\r\n  }, []);\r\n\r\n  // Popup HTML con pestañas y placeholder para el gráfico React\r\n  const generarPopupContent = useCallback((marker, datosTabla, tablaPreciosHtml, variant = 'primary') => {\r\n    const logoUrl = marker.logo\r\n      ? (marker.logo.startsWith('http') ? marker.logo : `https://api.bencinaenlinea.cl${marker.logo}`)\r\n      : '';\r\n    return `\r\n      <div class=\"icon-markers-popup-content\">\r\n        <div class=\"popup-info-header\">\r\n          ${logoUrl ? `<img src=\"${logoUrl}\" alt=\"Logo ${marker.Marca}\" class=\"popup-logo\" onerror=\"this.style.display='none';\"/>` : ''}\r\n          <div class=\"popup-info-row\"><span class=\"popup-label\">PBL:</span><span class=\"popup-value\">${marker.pbl || '-'}</span></div>\r\n          <div class=\"popup-info-row\"><span class=\"popup-label\">Estación:</span><span class=\"popup-value\">${marker.eds || '-'}</span></div>\r\n          <div class=\"popup-info-row\"><span class=\"popup-label\">Jefe Zona:</span><span class=\"popup-value\">${marker.nombre || '-'}</span></div>\r\n          <div class=\"popup-info-row\"><span class=\"popup-label\">Operación:</span><span class=\"popup-value\">${marker.operacion || 'Comisionista'}</span></div>\r\n        </div>\r\n\r\n        <div class=\"popup-tabs-container\">\r\n          <div class=\"popup-tabs-header\">\r\n            <button class=\"popup-tab-button active\" data-tab=\"precios\">Precios</button>\r\n            <button class=\"popup-tab-button\" data-tab=\"tendencias\">Tendencias</button>\r\n            <button class=\"popup-tab-button\" data-tab=\"coordenadas\">Coordenadas</button>\r\n            <button class=\"popup-tab-button\" data-tab=\"informacion\">Información</button>\r\n          </div>\r\n\r\n          <div class=\"popup-tabs-content\">\r\n            <div class=\"popup-tab-pane active\" data-tab=\"precios\">${tablaPreciosHtml}</div>\r\n\r\n            <div class=\"popup-tab-pane\" data-tab=\"tendencias\">\r\n              <div id=\"trend-root-${marker.id}\" style=\"min-width:320px;min-height:170px;padding-top:6px;\"></div>\r\n            </div>\r\n\r\n            <div class=\"popup-tab-pane\" data-tab=\"coordenadas\">\r\n              <div class=\"popup-info-box\">\r\n                <p><strong>Lat corregida:</strong> <span id=\"lat-actual-${marker.pbl || marker.id}\">${marker.lat.toFixed(6)}</span></p>\r\n                <p><strong>Lon corregida:</strong> <span id=\"lon-actual-${marker.pbl || marker.id}\">${marker.lng.toFixed(6)}</span></p>\r\n                <hr style=\"margin: 8px 0; border: none; border-top: 1px solid #dee2e6;\">\r\n                <p><strong>Región:</strong> ${marker.Region || '-'}</p>\r\n                <p><strong>Comuna:</strong> ${marker.Comuna || '-'}</p>\r\n              </div>\r\n              <div style=\"display: flex; gap: 8px; margin-top: 10px;\">\r\n                <button id=\"activar-coord-${marker.pbl || marker.id}\" style=\"flex: 1; padding: 8px; background: #17a2b8; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 11px; font-weight: 600;\" onclick=\"window.activarCorreccionCoordenadas('${marker.pbl || ''}', '${marker.id || ''}', '${marker.eds}', '${marker.Marca}')\">Activar Coord</button>\r\n                <button id=\"guardar-coord-${marker.pbl || marker.id}\" style=\"flex: 1; padding: 8px; background: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 11px; font-weight: 600; opacity: 0.5;\" onclick=\"window.guardarCorreccionCoordenadas('${marker.pbl || ''}', '${marker.id || ''}', '${marker.eds}', '${marker.Marca}')\" disabled>Guardar</button>\r\n              </div>\r\n            </div>\r\n\r\n            <div class=\"popup-tab-pane\" data-tab=\"informacion\">\r\n              <div class=\"popup-info-box\">\r\n                <p><strong>Dirección:</strong> ${marker.direccion || '-'}</p>\r\n                <p><strong>Surtidores PES:</strong> ${marker.Surtidores_Autoservicio || '-'}</p>\r\n                <p><strong>Posición Surtidor:</strong> ${marker.Posicion_Surtidor || '-'}</p>\r\n                <p><strong>Tipo Isla:</strong> ${marker.Tipo_Isla || '-'}</p>\r\n                ${marker.Guerra_Precio === 'Si' ? `<hr style=\"margin: 8px 0; border: none; border-top: 1px solid #dee2e6;\"><p><strong style=\"color: #d9534f;\">⚠️ Guerra de Precio Activa</strong></p>` : ''}\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        ${marker.pbl && (marker.Marca === 'Aramco' || marker.Marca === 'Petrobras')\r\n          ? `<button class=\"popup-button-mercado\" onclick=\"window.showAssociatedIds && window.showAssociatedIds(${marker.pbl}, ${marker.lat}, ${marker.lng}, '${marker.id}')\">Mercado</button>`\r\n          : ''\r\n        }\r\n      </div>\r\n    `;\r\n  }, []);\r\n\r\n  // Dibuja íconos visibles y arma popups con montaje diferido del gráfico\r\n  const updateIconsInViewport = useCallback((allMarkers, clearFirst = true) => {\r\n    if (!map || updateInProgressRef.current) return;\r\n\r\n    updateInProgressRef.current = true;\r\n\r\n    const bounds = map.getBounds();\r\n    const visibleMarkers = allMarkers.filter(marker => bounds.contains([marker.lat, marker.lng]));\r\n\r\n    if (clearFirst) {\r\n      Object.values(markersRef.current).forEach(marker => {\r\n        try {\r\n          if (map.hasLayer(marker)) map.removeLayer(marker);\r\n        } catch (error) {\r\n          console.error('Error removiendo:', error);\r\n        }\r\n      });\r\n      markersRef.current = {};\r\n      clearGuerraMarkers();\r\n\r\n      map.eachLayer((layer) => {\r\n        if (layer instanceof L.Marker && !map.hasLayer(layer)) {\r\n          try { map.removeLayer(layer); } catch (e) {}\r\n        }\r\n      });\r\n    }\r\n\r\n    if (visibleMarkers.length === 0) {\r\n      updateInProgressRef.current = false;\r\n      return;\r\n    }\r\n\r\n    const markersByBrand = {};\r\n    visibleMarkers.forEach(marker => {\r\n      if (!markersByBrand[marker.Marca]) markersByBrand[marker.Marca] = [];\r\n      markersByBrand[marker.Marca].push(marker);\r\n    });\r\n\r\n    const brandOrder = ['Aramco', 'Petrobras', 'Copec', 'Shell', 'Blanco', 'Gulf', 'Petroprix'];\r\n    let delayOffset = 0;\r\n    const cacheKey = selectedRegion;\r\n    let totalBrands = brandOrder.filter(b => markersByBrand[b]).length;\r\n    let brandsProcessed = 0;\r\n\r\n    brandOrder.forEach((brand) => {\r\n      if (!markersByBrand[brand] || markersByBrand[brand].length === 0) return;\r\n\r\n      const brandMarkers = markersByBrand[brand];\r\n\r\n      setTimeout(() => {\r\n        brandMarkers.forEach((marker) => {\r\n          try {\r\n            const markerId = `${cacheKey}-${marker.id}`;\r\n            if (markersRef.current[markerId]) return;\r\n\r\n            const lat = parseFloat(marker.lat);\r\n            const lng = parseFloat(marker.lng);\r\n            if (isNaN(lat) || isNaN(lng)) return;\r\n\r\n            // Marker principal\r\n            const iconUrl = createCustomIcon(marker.Marca);\r\n            const leafletMarker = L.marker([lat, lng], { icon: iconUrl }).addTo(map);\r\n\r\n            // Overlay de guerra\r\n            const tieneGuerra = marker.Guerra_Precio === 'Si' || marker.guerraPrecios === true;\r\n            if (tieneGuerra) {\r\n              const guerraIcon = L.icon({\r\n                iconUrl: `${process.env.PUBLIC_URL}/iconos/calavera.jpg`,\r\n                iconSize: [15, 15],\r\n                iconAnchor: [7.5, 7.5],\r\n                className: 'icono-guerra'\r\n              });\r\n              const guerraMarker = L.marker([lat, lng], { icon: guerraIcon, interactive: false }).addTo(map);\r\n              guerraMarkersRef.current[markerId] = guerraMarker;\r\n            }\r\n\r\n            // Datos de tabla/histórico\r\n            const datosTabla = obtenerHistoricoMarker(marker.id, allMarkers);\r\n            const tablaPreciosHtml = generarTablaPrecios(datosTabla, 'primary');\r\n\r\n            leafletMarker.on('popupopen', (e) => {\r\n              setDebugTable({\r\n                titulo: `${marker.Marca} - ${marker.nombre}`,\r\n                registros: datosTabla.length,\r\n                html: tablaPreciosHtml\r\n              });\r\n              setActiveTab('precios');\r\n            });\r\n\r\n            const popupContent = generarPopupContent(marker, datosTabla, tablaPreciosHtml, 'primary');\r\n\r\n            const popup = L.popup({\r\n              autoClose: false,\r\n              closeOnClick: false,\r\n              keepInView: true,\r\n              autoPan: false,\r\n              maxWidth: 450,\r\n              className: 'custom-popup'\r\n            }).setContent(popupContent);\r\n\r\n            leafletMarker.bindPopup(popup);\r\n\r\n            // Manejo de tabs + montaje del TrendChart al abrir\r\n            leafletMarker.on('popupopen', (e) => {\r\n              makeDraggable(popup);\r\n              setTimeout(() => {\r\n                const popupContainer = e.popup._container;\r\n\r\n                const tabButtons = popupContainer.querySelectorAll('.popup-tab-button');\r\n                tabButtons.forEach(btn => {\r\n                  btn.addEventListener('click', function () {\r\n                    const tabName = this.getAttribute('data-tab');\r\n\r\n                    // Toggle visual\r\n                    popupContainer.querySelectorAll('.popup-tab-button').forEach(b => b.classList.remove('active'));\r\n                    popupContainer.querySelectorAll('.popup-tab-pane').forEach(pane => pane.classList.remove('active'));\r\n                    this.classList.add('active');\r\n                    popupContainer.querySelector(`.popup-tab-pane[data-tab=\"${tabName}\"]`).classList.add('active');\r\n\r\n                    // Montar gráfico cuando se elige \"tendencias\"\r\n                    if (tabName === 'tendencias') {\r\n                      const el = popupContainer.querySelector(`#trend-root-${marker.id}`);\r\n                      if (el && !el.__mounted) {\r\n                        const root = ReactDOM.createRoot(el);\r\n                        root.render(React.createElement(TrendChart, {\r\n                          dataRows: datosTabla,\r\n                          maxPoints: 7,\r\n                          height: 170,\r\n                          compact: true\r\n                        }));\r\n                        el.__mounted = true;\r\n                        el.__root = root;\r\n                      }\r\n                    }\r\n                  });\r\n                });\r\n              }, 0);\r\n            });\r\n\r\n            // Limpieza: desmontar gráfico al cerrar\r\n            leafletMarker.on('popupclose', (e) => {\r\n              const container = e.popup?._container;\r\n              if (!container) return;\r\n              const el = container.querySelector(`#trend-root-${marker.id}`);\r\n              if (el && el.__root) {\r\n                el.__root.unmount();\r\n                el.__mounted = false;\r\n                el.__root = null;\r\n              }\r\n            });\r\n\r\n            leafletMarker.on('click', () => {\r\n              leafletMarker.openPopup();\r\n            });\r\n\r\n            markersRef.current[markerId] = leafletMarker;\r\n\r\n            cacheRef.current[markerId] = {\r\n              lat: marker.lat,\r\n              lng: marker.lng,\r\n              marca: marker.Marca,\r\n              nombre: marker.nombre,\r\n              region: marker.Region\r\n            };\r\n          } catch (error) {\r\n            console.error('Error:', error);\r\n          }\r\n        });\r\n\r\n        brandsProcessed++;\r\n        localStorage.setItem('markersCache', JSON.stringify(cacheRef.current));\r\n        if (brandsProcessed === totalBrands) {\r\n          updateInProgressRef.current = false;\r\n        }\r\n      }, delayOffset);\r\n\r\n      delayOffset += 60;\r\n    });\r\n  }, [map, makeDraggable, selectedRegion, generarTablaPrecios, obtenerHistoricoMarker, generarPopupContent, clearGuerraMarkers]);\r\n\r\n  // Mostrar IDs asociados (Mercado)\r\n  const showAssociatedIds = useCallback((pbl, lat, lng, originalMarkerId) => {\r\n    const searchArray = markersForMercado && markersForMercado.length > 0 ? markersForMercado : markers;\r\n\r\n    if (showingAssociated && activeMercadoPbl === pbl) {\r\n      clearCompetenciaMarkers();\r\n      clearPolylines();\r\n      clearGuerraMarkers();\r\n\r\n      Object.values(markersRef.current).forEach(marker => {\r\n        try { if (map.hasLayer(marker)) map.removeLayer(marker); } catch (error) { console.error('Error removiendo:', error); }\r\n      });\r\n      markersRef.current = {};\r\n\r\n      setShowingAssociated(false);\r\n      setActiveMercadoPbl(null);\r\n      setOriginalPopupMarker(null);\r\n\r\n      const markersToShow = markersForMercado && markersForMercado.length > 0 ? markersForMercado : markers;\r\n      if (map && markersToShow && markersToShow.length > 0) {\r\n        updateIconsInViewport(markersToShow, true);\r\n      }\r\n      return;\r\n    }\r\n\r\n    clearCompetenciaMarkers();\r\n    clearPolylines();\r\n\r\n    const associatedData = baseCompData.filter(item => String(item.pbl).trim() === String(pbl).trim());\r\n    if (associatedData.length === 0) return;\r\n\r\n    const ids = associatedData.map(item => item.id);\r\n\r\n    if (map) {\r\n      let openPopup = null;\r\n      map.eachLayer((layer) => {\r\n        if (layer instanceof L.Marker && layer._popup && layer._popup.isOpen()) {\r\n          openPopup = layer._popup;\r\n        }\r\n      });\r\n\r\n      map.eachLayer((layer) => {\r\n        if (layer instanceof L.Marker) {\r\n          const mLatLng = layer.getLatLng();\r\n          const shouldKeep = ids.some(id => {\r\n            const marker = searchArray.find(m => m.id === id);\r\n            return marker && marker.lat === mLatLng.lat && marker.lng === mLatLng.lng;\r\n          }) || (mLatLng.lat === lat && mLatLng.lng === lng);\r\n\r\n          if (!shouldKeep) {\r\n            map.removeLayer(layer);\r\n          }\r\n        }\r\n      });\r\n\r\n      Object.values(markersRef.current).forEach(marker => {\r\n        const mLatLng = marker.getLatLng();\r\n        const shouldKeep = ids.some(id => {\r\n          const m = searchArray.find(x => x.id === id);\r\n          return m && m.lat === mLatLng.lat && m.lng === mLatLng.lng;\r\n        }) || (mLatLng.lat === lat && mLatLng.lng === lng);\r\n\r\n        if (!shouldKeep) {\r\n          try { if (map.hasLayer(marker)) map.removeLayer(marker); } catch (error) { console.error('Error:', error); }\r\n        }\r\n      });\r\n\r\n      const associatedMarkers = searchArray.filter(item => ids.includes(item.id));\r\n      associatedMarkers.forEach(marker => {\r\n        const markerLat = parseFloat(marker.lat);\r\n        const markerLng = parseFloat(marker.lng);\r\n        if (isNaN(markerLat) || isNaN(markerLng)) return;\r\n\r\n        let exists = false;\r\n        map.eachLayer((layer) => {\r\n          if (layer instanceof L.Marker) {\r\n            const mLatLng = layer.getLatLng();\r\n            if (mLatLng.lat === markerLat && mLatLng.lng === markerLng) exists = true;\r\n          }\r\n        });\r\n\r\n        if (!exists) {\r\n          const iconUrl = createCustomIcon(marker.Marca);\r\n          const leafletMarker = L.marker([markerLat, markerLng], { icon: iconUrl }).addTo(map);\r\n\r\n          const tieneGuerra = marker.Guerra_Precio === 'Si' || marker.guerraPrecios === true;\r\n          if (tieneGuerra) {\r\n            const guerraIcon = L.icon({\r\n              iconUrl: `${process.env.PUBLIC_URL}/iconos/calavera.jpg`,\r\n              iconSize: [15, 15],\r\n              iconAnchor: [7.5, 7.5],\r\n              className: 'icono-guerra'\r\n            });\r\n            L.marker([markerLat, markerLng], { icon: guerraIcon, interactive: false }).addTo(map);\r\n          }\r\n\r\n          competenciaMarkersRef.current.push(leafletMarker);\r\n\r\n          const datosTabla = obtenerHistoricoMarker(marker.id, baseCompData);\r\n          const tablaPreciosHtml = generarTablaPrecios(datosTabla, 'secondary');\r\n\r\n          leafletMarker.on('popupopen', () => {\r\n            setDebugTable({\r\n              titulo: `${marker.Marca} - ${marker.nombre}`,\r\n              registros: datosTabla.length,\r\n              html: tablaPreciosHtml\r\n            });\r\n            setActiveTab('precios');\r\n          });\r\n\r\n          const popupContent = generarPopupContent(marker, datosTabla, tablaPreciosHtml, 'secondary');\r\n\r\n          const popup = L.popup({\r\n            autoClose: false,\r\n            closeOnClick: false,\r\n            keepInView: true,\r\n            autoPan: false,\r\n            maxWidth: 450,\r\n            className: 'custom-popup'\r\n          }).setContent(popupContent);\r\n\r\n          leafletMarker.bindPopup(popup);\r\n\r\n          leafletMarker.on('popupopen', (e) => {\r\n            makeDraggable(popup);\r\n            setTimeout(() => {\r\n              const popupContainer = e.popup._container;\r\n\r\n              const tabButtons = popupContainer.querySelectorAll('.popup-tab-button');\r\n              tabButtons.forEach(btn => {\r\n                btn.addEventListener('click', function () {\r\n                  const tabName = this.getAttribute('data-tab');\r\n\r\n                  popupContainer.querySelectorAll('.popup-tab-button').forEach(b => b.classList.remove('active'));\r\n                  popupContainer.querySelectorAll('.popup-tab-pane').forEach(pane => pane.classList.remove('active'));\r\n                  this.classList.add('active');\r\n                  popupContainer.querySelector(`.popup-tab-pane[data-tab=\"${tabName}\"]`).classList.add('active');\r\n\r\n                  if (tabName === 'tendencias') {\r\n                    const el = popupContainer.querySelector(`#trend-root-${marker.id}`);\r\n                    if (el && !el.__mounted) {\r\n                      const root = ReactDOM.createRoot(el);\r\n                      root.render(React.createElement(TrendChart, {\r\n                        dataRows: datosTabla,\r\n                        maxPoints: 7,\r\n                        height: 170,\r\n                        compact: true\r\n                      }));\r\n                      el.__mounted = true;\r\n                      el.__root = root;\r\n                    }\r\n                  }\r\n                });\r\n              });\r\n            }, 0);\r\n          });\r\n\r\n          leafletMarker.on('popupclose', (e) => {\r\n            const container = e.popup?._container;\r\n            if (!container) return;\r\n            const el = container.querySelector(`#trend-root-${marker.id}`);\r\n            if (el && el.__root) {\r\n              el.__root.unmount();\r\n              el.__mounted = false;\r\n              el.__root = null;\r\n            }\r\n          });\r\n\r\n          leafletMarker.on('click', () => leafletMarker.openPopup());\r\n        }\r\n      });\r\n\r\n      const mainMarkersData = associatedData.filter(m => m.Marcador_Principal === 'Si');\r\n      mainMarkersData.forEach(mainMarker => {\r\n        const markerWithCoords = searchArray.find(m => m.id === mainMarker.id);\r\n        if (!markerWithCoords) return;\r\n\r\n        const mainLat = parseFloat(markerWithCoords.lat);\r\n        const mainLng = parseFloat(markerWithCoords.lng);\r\n        if (isNaN(mainLat) || isNaN(mainLng)) return;\r\n\r\n        const currentLat = parseFloat(lat);\r\n        const currentLng = parseFloat(lng);\r\n\r\n        const polyline = L.polyline(\r\n          [[currentLat, currentLng], [mainLat, mainLng]],\r\n          { color: '#FF6B6B', weight: 3, opacity: 0.8, dashArray: '5, 5' }\r\n        ).addTo(map);\r\n\r\n        polylineRef.current.push(polyline);\r\n      });\r\n\r\n      if (openPopup) {\r\n        setTimeout(() => {\r\n          try { openPopup._map = map; openPopup.update(); } catch (e) { /* noop */ }\r\n        }, 50);\r\n      }\r\n\r\n      setShowingAssociated(true);\r\n      setActiveMercadoPbl(pbl);\r\n    }\r\n  }, [baseCompData, markers, markersForMercado, map, makeDraggable, showingAssociated, activeMercadoPbl, updateIconsInViewport, clearCompetenciaMarkers, clearPolylines, clearGuerraMarkers, generarTablaPrecios, obtenerHistoricoMarker, generarPopupContent]);\r\n\r\n  useEffect(() => {\r\n    window.showAssociatedIds = showAssociatedIds;\r\n  }, [showAssociatedIds]);\r\n\r\n  // When markers or region change\r\n  useEffect(() => {\r\n    if (!map || !markers || markers.length === 0) return;\r\n\r\n    clearCompetenciaMarkers();\r\n    clearPolylines();\r\n    clearGuerraMarkers();\r\n    setShowingAssociated(false);\r\n    setActiveMercadoPbl(null);\r\n    setOriginalPopupMarker(null);\r\n\r\n    updateIconsInViewport(markers, true);\r\n  }, [map, markers, selectedRegion, updateIconsInViewport, clearCompetenciaMarkers, clearPolylines, clearGuerraMarkers]);\r\n\r\n  // Zoom handler\r\n  useEffect(() => {\r\n    if (!map) return;\r\n\r\n    const handleZoomEnd = () => {\r\n      if (zoomUpdateRef.current) clearTimeout(zoomUpdateRef.current);\r\n      zoomUpdateRef.current = setTimeout(() => {\r\n        if (showingAssociated) {\r\n          // Mantener vista en modo competencia\r\n        } else if (markers && markers.length > 0) {\r\n          updateIconsInViewport(markers, false);\r\n        }\r\n      }, 400);\r\n    };\r\n\r\n    map.on('zoomend', handleZoomEnd);\r\n    return () => { map.off('zoomend', handleZoomEnd); };\r\n  }, [map, markers, updateIconsInViewport, showingAssociated]);\r\n\r\n  // Modo corrección de coordenadas\r\n  useEffect(() => {\r\n    window.activarCorreccionCoordenadas = (pbl, id, eds, marca) => {\r\n      const identifier = pbl || id;\r\n      if (map) map.getContainer().style.cursor = 'crosshair';\r\n      setModoCorreccion({ pbl, id, eds, marca, lat: null, lng: null });\r\n\r\n      const btnGuardar = document.getElementById(`guardar-coord-${identifier}`);\r\n      if (btnGuardar) { btnGuardar.disabled = true; btnGuardar.style.opacity = '0.5'; }\r\n\r\n      const btnActivar = document.getElementById(`activar-coord-${identifier}`);\r\n      if (btnActivar) { btnActivar.textContent = 'Click en mapa...'; btnActivar.style.background = '#ffc107'; }\r\n    };\r\n\r\n    window.guardarCorreccionCoordenadas = async (pbl, id, eds, marca) => {\r\n      if (!modoCorreccion || !modoCorreccion.lat || !modoCorreccion.lng) {\r\n        alert('⚠️ Primero selecciona una ubicación');\r\n        return;\r\n      }\r\n\r\n      const identifier = pbl || id;\r\n\r\n      let marker = null;\r\n      if (pbl) {\r\n        marker = markers.find(m => m.pbl === pbl) || markersForMercado?.find(m => m.pbl === pbl) || baseCompData?.find(m => m.pbl === pbl);\r\n      }\r\n      if (!marker && id) {\r\n        marker = markers.find(m => m.id === id) || markersForMercado?.find(m => m.id === id) || baseCompData?.find(m => m.id === id);\r\n      }\r\n      if (!marker) {\r\n        alert('❌ Error: No se encontró el marcador');\r\n        return;\r\n      }\r\n\r\n      try {\r\n        const coordenada = {\r\n          id: id || marker.id || pbl,\r\n          pbl: pbl || marker.pbl || id,\r\n          eds: eds || marker.eds || '',\r\n          marca: marca || marker.Marca || '',\r\n          comuna: marker.Comuna || '',\r\n          lat_corregida: modoCorreccion.lat,\r\n          lon_corregida: modoCorreccion.lng\r\n        };\r\n\r\n        await guardarCoordenadaCorregida(coordenada);\r\n\r\n        const cacheKey = selectedRegion;\r\n        const markerId = `${cacheKey}-${marker.id}`;\r\n        let leafletMarker = markersRef.current[markerId];\r\n\r\n        if (!leafletMarker && competenciaMarkersRef.current.length > 0) {\r\n          leafletMarker = competenciaMarkersRef.current.find(m => {\r\n            const latLng = m.getLatLng();\r\n            return latLng.lat === marker.lat && latLng.lng === marker.lng;\r\n          });\r\n        }\r\n\r\n        if (leafletMarker && map) {\r\n          const newLatLng = L.latLng(modoCorreccion.lat, modoCorreccion.lng);\r\n          leafletMarker.setLatLng(newLatLng);\r\n\r\n          if (guerraMarkersRef.current[markerId]) {\r\n            guerraMarkersRef.current[markerId].setLatLng(newLatLng);\r\n          }\r\n\r\n          map.setView(newLatLng, map.getZoom());\r\n\r\n          if (leafletMarker.isPopupOpen()) {\r\n            leafletMarker.closePopup();\r\n            setTimeout(() => { leafletMarker.openPopup(); }, 100);\r\n          }\r\n        }\r\n\r\n        marker.lat = modoCorreccion.lat;\r\n        marker.lng = modoCorreccion.lng;\r\n\r\n        setModoCorreccion(null);\r\n        if (map) map.getContainer().style.cursor = '';\r\n      } catch (error) {\r\n        alert('❌ Error al guardar: ' + error.message);\r\n      }\r\n    };\r\n\r\n    return () => {\r\n      delete window.activarCorreccionCoordenadas;\r\n      delete window.guardarCorreccionCoordenadas;\r\n    };\r\n  }, [map, modoCorreccion, markers, markersForMercado, baseCompData, selectedRegion]);\r\n\r\n  useEffect(() => {\r\n    if (!map || !modoCorreccion) return;\r\n\r\n    const handleMapClick = (e) => {\r\n      const { lat, lng } = e.latlng;\r\n      setModoCorreccion(prev => ({ ...prev, lat, lng }));\r\n\r\n      const identifier = modoCorreccion.pbl || modoCorreccion.id;\r\n      const latSpan = document.getElementById(`lat-actual-${identifier}`);\r\n      const lngSpan = document.getElementById(`lon-actual-${identifier}`);\r\n      if (latSpan) latSpan.textContent = lat.toFixed(6);\r\n      if (lngSpan) lngSpan.textContent = lng.toFixed(6);\r\n\r\n      const btnGuardar = document.getElementById(`guardar-coord-${identifier}`);\r\n      if (btnGuardar) { btnGuardar.disabled = false; btnGuardar.style.opacity = '1'; }\r\n\r\n      const btnActivar = document.getElementById(`activar-coord-${identifier}`);\r\n      if (btnActivar) { btnActivar.textContent = 'Coord. Seleccionada ✓'; btnActivar.style.background = '#28a745'; }\r\n\r\n      map.getContainer().style.cursor = '';\r\n    };\r\n\r\n    map.on('click', handleMapClick);\r\n    return () => { map.off('click', handleMapClick); };\r\n  }, [map, modoCorreccion]);\r\n\r\n  return null;\r\n};\r\n\r\nexport default IconMarkersLayer;\r\n"],"mappings":"oIAAA,MAAO,CAAAA,KAAK,EAAIC,SAAS,CAAEC,MAAM,CAAEC,QAAQ,CAAEC,WAAW,KAAQ,OAAO,CACvE,OAASC,MAAM,KAAQ,eAAe,CACtC,MAAO,CAAAC,CAAC,KAAM,SAAS,CACvB,MAAO,CAAAC,QAAQ,KAAM,kBAAkB,CACvC,OAASC,gBAAgB,KAAQ,sBAAsB,CACvD,OAASC,0BAA0B,KAAQ,wBAAwB,CACnE,MAAO,CAAAC,UAAU,KAAM,0BAA0B,CACjD,MAAO,gCAAgC,CAEvC,KAAM,CAAAC,gBAAgB,CAAGC,IAAA,EAA8E,IAA7E,CAAEC,OAAO,CAAEC,iBAAiB,CAAG,IAAI,CAAEC,cAAc,CAAEC,YAAY,CAAG,EAAG,CAAC,CAAAJ,IAAA,CAChG,KAAM,CAAAK,GAAG,CAAGZ,MAAM,CAAC,CAAC,CACpB,KAAM,CAAAa,UAAU,CAAGhB,MAAM,CAAC,CAAC,CAAC,CAAC,CAC7B,KAAM,CAAAiB,gBAAgB,CAAGjB,MAAM,CAAC,CAAC,CAAC,CAAC,CACnC,KAAM,CAAAkB,QAAQ,CAAGlB,MAAM,CAAC,CAAC,CAAC,CAAC,CAC3B,KAAM,CAAAmB,mBAAmB,CAAGnB,MAAM,CAAC,KAAK,CAAC,CACzC,KAAM,CAAAoB,aAAa,CAAGpB,MAAM,CAAC,IAAI,CAAC,CAElC,KAAM,CAACqB,iBAAiB,CAAEC,oBAAoB,CAAC,CAAGrB,QAAQ,CAAC,KAAK,CAAC,CACjE,KAAM,CAACsB,mBAAmB,CAAEC,sBAAsB,CAAC,CAAGvB,QAAQ,CAAC,IAAI,CAAC,CACpE,KAAM,CAACwB,gBAAgB,CAAEC,mBAAmB,CAAC,CAAGzB,QAAQ,CAAC,IAAI,CAAC,CAE9D,KAAM,CAAA0B,qBAAqB,CAAG3B,MAAM,CAAC,EAAE,CAAC,CACxC,KAAM,CAAA4B,WAAW,CAAG5B,MAAM,CAAC,EAAE,CAAC,CAE9B,KAAM,CAAC6B,UAAU,CAAEC,aAAa,CAAC,CAAG7B,QAAQ,CAAC,IAAI,CAAC,CAClD,KAAM,CAAC8B,SAAS,CAAEC,YAAY,CAAC,CAAG/B,QAAQ,CAAC,GAAG,CAAC,CAC/C,KAAM,CAACgC,SAAS,CAAEC,YAAY,CAAC,CAAGjC,QAAQ,CAAC,SAAS,CAAC,CACrD,KAAM,CAACkC,cAAc,CAAEC,iBAAiB,CAAC,CAAGnC,QAAQ,CAAC,IAAI,CAAC,CAE1D;AACA,KAAM,CAAAoC,aAAa,CAAGnC,WAAW,CAAEoC,KAAK,EAAK,CAC3C,GAAI,CAACvB,GAAG,EAAI,CAACuB,KAAK,EAAI,CAACA,KAAK,CAACC,UAAU,CAAE,OACzC,GAAI,CACF,KAAM,CAAAC,GAAG,CAAGzB,GAAG,CAAC0B,kBAAkB,CAACH,KAAK,CAACI,SAAS,CAAC,CAAC,CAAC,CACrDtC,CAAC,CAACuC,OAAO,CAACC,WAAW,CAACN,KAAK,CAACO,QAAQ,CAACC,UAAU,CAAEN,GAAG,CAAC,CACrD,KAAM,CAAAO,SAAS,CAAG,GAAI,CAAA3C,CAAC,CAAC4C,SAAS,CAACV,KAAK,CAACC,UAAU,CAAED,KAAK,CAACO,QAAQ,CAAC,CACnEE,SAAS,CAACE,MAAM,CAAC,CAAC,CACpB,CAAE,MAAOC,KAAK,CAAE,CACdC,OAAO,CAACD,KAAK,CAAC,kBAAkB,CAAEA,KAAK,CAAC,CAC1C,CACF,CAAC,CAAE,CAACnC,GAAG,CAAC,CAAC,CAET,KAAM,CAAAqC,uBAAuB,CAAGlD,WAAW,CAAC,IAAM,CAChDyB,qBAAqB,CAAC0B,OAAO,CAACC,OAAO,CAACC,MAAM,EAAI,CAC9C,GAAI,CACF,GAAIxC,GAAG,EAAIA,GAAG,CAACyC,QAAQ,CAACD,MAAM,CAAC,CAAE,CAC/BxC,GAAG,CAAC0C,WAAW,CAACF,MAAM,CAAC,CACzB,CACF,CAAE,MAAOG,CAAC,CAAE,CACVP,OAAO,CAACD,KAAK,CAAC,8BAA8B,CAAEQ,CAAC,CAAC,CAClD,CACF,CAAC,CAAC,CACF/B,qBAAqB,CAAC0B,OAAO,CAAG,EAAE,CACpC,CAAC,CAAE,CAACtC,GAAG,CAAC,CAAC,CAET,KAAM,CAAA4C,cAAc,CAAGzD,WAAW,CAAC,IAAM,CACvC0B,WAAW,CAACyB,OAAO,CAACC,OAAO,CAACM,IAAI,EAAI,CAClC,GAAI,CACF,GAAI7C,GAAG,EAAIA,GAAG,CAACyC,QAAQ,CAACI,IAAI,CAAC,CAAE,CAC7B7C,GAAG,CAAC0C,WAAW,CAACG,IAAI,CAAC,CACvB,CACF,CAAE,MAAOF,CAAC,CAAE,CACVP,OAAO,CAACD,KAAK,CAAC,2BAA2B,CAAEQ,CAAC,CAAC,CAC/C,CACF,CAAC,CAAC,CACF9B,WAAW,CAACyB,OAAO,CAAG,EAAE,CAC1B,CAAC,CAAE,CAACtC,GAAG,CAAC,CAAC,CAET,KAAM,CAAA8C,kBAAkB,CAAG3D,WAAW,CAAC,IAAM,CAC3C4D,MAAM,CAACC,MAAM,CAAC9C,gBAAgB,CAACoC,OAAO,CAAC,CAACC,OAAO,CAACC,MAAM,EAAI,CACxD,GAAI,CACF,GAAIxC,GAAG,EAAIA,GAAG,CAACyC,QAAQ,CAACD,MAAM,CAAC,CAAE,CAC/BxC,GAAG,CAAC0C,WAAW,CAACF,MAAM,CAAC,CACzB,CACF,CAAE,MAAOG,CAAC,CAAE,CACVP,OAAO,CAACD,KAAK,CAAC,iCAAiC,CAAEQ,CAAC,CAAC,CACrD,CACF,CAAC,CAAC,CACFzC,gBAAgB,CAACoC,OAAO,CAAG,CAAC,CAAC,CAC/B,CAAC,CAAE,CAACtC,GAAG,CAAC,CAAC,CAET;AACA,KAAM,CAAAiD,mBAAmB,CAAG9D,WAAW,CAAC,SAAC+D,KAAK,CAA0B,IAAxB,CAAAC,OAAO,CAAAC,SAAA,CAAAC,MAAA,IAAAD,SAAA,MAAAE,SAAA,CAAAF,SAAA,IAAG,SAAS,CACjE,GAAI,CAACF,KAAK,EAAIA,KAAK,CAACG,MAAM,GAAK,CAAC,CAAE,CAChC,MAAO,+HAA+H,CACxI,CACA,KAAM,CAAAE,YAAY,CAAGJ,OAAO,GAAK,SAAS,CAAG,EAAE,CAAG,WAAW,CAC7D,GAAI,CAAAK,IAAI,qCAAAC,MAAA,CAAsCF,YAAY,2CAAAE,MAAA,CAC5BF,YAAY,8PAW9B,CACZL,KAAK,CAACX,OAAO,CAAEmB,IAAI,EAAK,CACtBF,IAAI,mCAAAC,MAAA,CAEMC,IAAI,CAACC,KAAK,0BAAAF,MAAA,CACVC,IAAI,CAACE,GAAG,0BAAAH,MAAA,CACRC,IAAI,CAACG,GAAG,0BAAAJ,MAAA,CACRC,IAAI,CAACI,GAAG,0BAAAL,MAAA,CACRC,IAAI,CAACK,MAAM,0BAAAN,MAAA,CACXC,IAAI,CAACM,IAAI,wBACX,CACV,CAAC,CAAC,CACFR,IAAI,0BAA4B,CAChC,MAAO,CAAAA,IAAI,CACb,CAAC,CAAE,EAAE,CAAC,CAEN;AACA,KAAM,CAAAS,sBAAsB,CAAG9E,WAAW,CAAC,CAAC+E,QAAQ,CAAEC,SAAS,GAAK,CAClE,KAAM,CAAAjB,KAAK,CAAGiB,SAAS,CAACC,MAAM,CAACC,CAAC,EAAIA,CAAC,CAACC,EAAE,GAAKJ,QAAQ,CAAC,CACtD,MAAO,CAAAhB,KAAK,CACTqB,IAAI,CAAC,CAACC,CAAC,CAAEC,CAAC,GAAK,CACd,KAAM,CAAAC,MAAM,CAAGF,CAAC,CAACG,gBAAgB,CAAG,GAAI,CAAAC,IAAI,CAACJ,CAAC,CAACG,gBAAgB,CAAC,CAAG,GAAI,CAAAC,IAAI,CAAC,CAAC,CAAC,CAC9E,KAAM,CAAAC,MAAM,CAAGJ,CAAC,CAACE,gBAAgB,CAAG,GAAI,CAAAC,IAAI,CAACH,CAAC,CAACE,gBAAgB,CAAC,CAAG,GAAI,CAAAC,IAAI,CAAC,CAAC,CAAC,CAC9E,MAAO,CAAAC,MAAM,CAAGH,MAAM,CACxB,CAAC,CAAC,CACD1E,GAAG,CAAC8E,IAAI,GAAK,CACZnB,KAAK,CAAEmB,IAAI,CAACH,gBAAgB,EAAI,KAAK,CACrCf,GAAG,CAAEkB,IAAI,CAACC,UAAU,EAAI,GAAG,CAC3BlB,GAAG,CAAEiB,IAAI,CAACE,UAAU,EAAI,GAAG,CAC3BlB,GAAG,CAAEgB,IAAI,CAACG,UAAU,EAAI,GAAG,CAC3BlB,MAAM,CAAEe,IAAI,CAACI,aAAa,EAAI,GAAG,CACjClB,IAAI,CAAEc,IAAI,CAACK,WAAW,EAAI,GAC5B,CAAC,CAAC,CAAC,CACP,CAAC,CAAE,EAAE,CAAC,CAEN;AACA,KAAM,CAAAC,mBAAmB,CAAGjG,WAAW,CAAC,SAACqD,MAAM,CAAE6C,UAAU,CAAEC,gBAAgB,CAA0B,IAAxB,CAAAnC,OAAO,CAAAC,SAAA,CAAAC,MAAA,IAAAD,SAAA,MAAAE,SAAA,CAAAF,SAAA,IAAG,SAAS,CAChG,KAAM,CAAAmC,OAAO,CAAG/C,MAAM,CAACgD,IAAI,CACtBhD,MAAM,CAACgD,IAAI,CAACC,UAAU,CAAC,MAAM,CAAC,CAAGjD,MAAM,CAACgD,IAAI,iCAAA/B,MAAA,CAAmCjB,MAAM,CAACgD,IAAI,CAAE,CAC7F,EAAE,CACN,kHAAA/B,MAAA,CAGQ8B,OAAO,eAAA9B,MAAA,CAAgB8B,OAAO,mBAAA9B,MAAA,CAAejB,MAAM,CAACkD,KAAK,qEAAgE,EAAE,kHAAAjC,MAAA,CAChCjB,MAAM,CAACmD,GAAG,EAAI,GAAG,uIAAAlC,MAAA,CACZjB,MAAM,CAACoD,GAAG,EAAI,GAAG,qIAAAnC,MAAA,CAChBjB,MAAM,CAACqD,MAAM,EAAI,GAAG,wIAAApC,MAAA,CACpBjB,MAAM,CAACsD,SAAS,EAAI,cAAc,ioBAAArC,MAAA,CAY3E6B,gBAAgB,sHAAA7B,MAAA,CAGhDjB,MAAM,CAAC8B,EAAE,8RAAAb,MAAA,CAK6BjB,MAAM,CAACmD,GAAG,EAAInD,MAAM,CAAC8B,EAAE,QAAAb,MAAA,CAAKjB,MAAM,CAACuD,GAAG,CAACC,OAAO,CAAC,CAAC,CAAC,2FAAAvC,MAAA,CACjDjB,MAAM,CAACmD,GAAG,EAAInD,MAAM,CAAC8B,EAAE,QAAAb,MAAA,CAAKjB,MAAM,CAACyD,GAAG,CAACD,OAAO,CAAC,CAAC,CAAC,6JAAAvC,MAAA,CAE7EjB,MAAM,CAAC0D,MAAM,EAAI,GAAG,uDAAAzC,MAAA,CACpBjB,MAAM,CAAC2D,MAAM,EAAI,GAAG,sJAAA1C,MAAA,CAGtBjB,MAAM,CAACmD,GAAG,EAAInD,MAAM,CAAC8B,EAAE,iNAAAb,MAAA,CAA2MjB,MAAM,CAACmD,GAAG,EAAI,EAAE,SAAAlC,MAAA,CAAOjB,MAAM,CAAC8B,EAAE,EAAI,EAAE,SAAAb,MAAA,CAAOjB,MAAM,CAACoD,GAAG,SAAAnC,MAAA,CAAOjB,MAAM,CAACkD,KAAK,6EAAAjC,MAAA,CAC5SjB,MAAM,CAACmD,GAAG,EAAInD,MAAM,CAAC8B,EAAE,+NAAAb,MAAA,CAAyNjB,MAAM,CAACmD,GAAG,EAAI,EAAE,SAAAlC,MAAA,CAAOjB,MAAM,CAAC8B,EAAE,EAAI,EAAE,SAAAb,MAAA,CAAOjB,MAAM,CAACoD,GAAG,SAAAnC,MAAA,CAAOjB,MAAM,CAACkD,KAAK,sPAAAjC,MAAA,CAMrTjB,MAAM,CAAC4D,SAAS,EAAI,GAAG,+DAAA3C,MAAA,CAClBjB,MAAM,CAAC6D,uBAAuB,EAAI,GAAG,qEAAA5C,MAAA,CAClCjB,MAAM,CAAC8D,iBAAiB,EAAI,GAAG,0DAAA7C,MAAA,CACvCjB,MAAM,CAAC+D,SAAS,EAAI,GAAG,2BAAA9C,MAAA,CACtDjB,MAAM,CAACgE,aAAa,GAAK,IAAI,oKAA0J,EAAE,6FAAA/C,MAAA,CAMjMjB,MAAM,CAACmD,GAAG,GAAKnD,MAAM,CAACkD,KAAK,GAAK,QAAQ,EAAIlD,MAAM,CAACkD,KAAK,GAAK,WAAW,CAAC,0GAAAjC,MAAA,CAC+BjB,MAAM,CAACmD,GAAG,OAAAlC,MAAA,CAAKjB,MAAM,CAACuD,GAAG,OAAAtC,MAAA,CAAKjB,MAAM,CAACyD,GAAG,QAAAxC,MAAA,CAAMjB,MAAM,CAAC8B,EAAE,0BAC7J,EAAE,yBAIZ,CAAC,CAAE,EAAE,CAAC,CAEN;AACA,KAAM,CAAAmC,qBAAqB,CAAGtH,WAAW,CAAC,SAACuH,UAAU,CAAwB,IAAtB,CAAAC,UAAU,CAAAvD,SAAA,CAAAC,MAAA,IAAAD,SAAA,MAAAE,SAAA,CAAAF,SAAA,IAAG,IAAI,CACtE,GAAI,CAACpD,GAAG,EAAII,mBAAmB,CAACkC,OAAO,CAAE,OAEzClC,mBAAmB,CAACkC,OAAO,CAAG,IAAI,CAElC,KAAM,CAAAsE,MAAM,CAAG5G,GAAG,CAAC6G,SAAS,CAAC,CAAC,CAC9B,KAAM,CAAAC,cAAc,CAAGJ,UAAU,CAACtC,MAAM,CAAC5B,MAAM,EAAIoE,MAAM,CAACG,QAAQ,CAAC,CAACvE,MAAM,CAACuD,GAAG,CAAEvD,MAAM,CAACyD,GAAG,CAAC,CAAC,CAAC,CAE7F,GAAIU,UAAU,CAAE,CACd5D,MAAM,CAACC,MAAM,CAAC/C,UAAU,CAACqC,OAAO,CAAC,CAACC,OAAO,CAACC,MAAM,EAAI,CAClD,GAAI,CACF,GAAIxC,GAAG,CAACyC,QAAQ,CAACD,MAAM,CAAC,CAAExC,GAAG,CAAC0C,WAAW,CAACF,MAAM,CAAC,CACnD,CAAE,MAAOL,KAAK,CAAE,CACdC,OAAO,CAACD,KAAK,CAAC,mBAAmB,CAAEA,KAAK,CAAC,CAC3C,CACF,CAAC,CAAC,CACFlC,UAAU,CAACqC,OAAO,CAAG,CAAC,CAAC,CACvBQ,kBAAkB,CAAC,CAAC,CAEpB9C,GAAG,CAACgH,SAAS,CAAEC,KAAK,EAAK,CACvB,GAAIA,KAAK,WAAY,CAAA5H,CAAC,CAAC6H,MAAM,EAAI,CAAClH,GAAG,CAACyC,QAAQ,CAACwE,KAAK,CAAC,CAAE,CACrD,GAAI,CAAEjH,GAAG,CAAC0C,WAAW,CAACuE,KAAK,CAAC,CAAE,CAAE,MAAOtE,CAAC,CAAE,CAAC,CAC7C,CACF,CAAC,CAAC,CACJ,CAEA,GAAImE,cAAc,CAACzD,MAAM,GAAK,CAAC,CAAE,CAC/BjD,mBAAmB,CAACkC,OAAO,CAAG,KAAK,CACnC,OACF,CAEA,KAAM,CAAA6E,cAAc,CAAG,CAAC,CAAC,CACzBL,cAAc,CAACvE,OAAO,CAACC,MAAM,EAAI,CAC/B,GAAI,CAAC2E,cAAc,CAAC3E,MAAM,CAACkD,KAAK,CAAC,CAAEyB,cAAc,CAAC3E,MAAM,CAACkD,KAAK,CAAC,CAAG,EAAE,CACpEyB,cAAc,CAAC3E,MAAM,CAACkD,KAAK,CAAC,CAAC0B,IAAI,CAAC5E,MAAM,CAAC,CAC3C,CAAC,CAAC,CAEF,KAAM,CAAA6E,UAAU,CAAG,CAAC,QAAQ,CAAE,WAAW,CAAE,OAAO,CAAE,OAAO,CAAE,QAAQ,CAAE,MAAM,CAAE,WAAW,CAAC,CAC3F,GAAI,CAAAC,WAAW,CAAG,CAAC,CACnB,KAAM,CAAAC,QAAQ,CAAGzH,cAAc,CAC/B,GAAI,CAAA0H,WAAW,CAAGH,UAAU,CAACjD,MAAM,CAACK,CAAC,EAAI0C,cAAc,CAAC1C,CAAC,CAAC,CAAC,CAACpB,MAAM,CAClE,GAAI,CAAAoE,eAAe,CAAG,CAAC,CAEvBJ,UAAU,CAAC9E,OAAO,CAAEmF,KAAK,EAAK,CAC5B,GAAI,CAACP,cAAc,CAACO,KAAK,CAAC,EAAIP,cAAc,CAACO,KAAK,CAAC,CAACrE,MAAM,GAAK,CAAC,CAAE,OAElE,KAAM,CAAAsE,YAAY,CAAGR,cAAc,CAACO,KAAK,CAAC,CAE1CE,UAAU,CAAC,IAAM,CACfD,YAAY,CAACpF,OAAO,CAAEC,MAAM,EAAK,CAC/B,GAAI,CACF,KAAM,CAAA0B,QAAQ,IAAAT,MAAA,CAAM8D,QAAQ,MAAA9D,MAAA,CAAIjB,MAAM,CAAC8B,EAAE,CAAE,CAC3C,GAAIrE,UAAU,CAACqC,OAAO,CAAC4B,QAAQ,CAAC,CAAE,OAElC,KAAM,CAAA6B,GAAG,CAAG8B,UAAU,CAACrF,MAAM,CAACuD,GAAG,CAAC,CAClC,KAAM,CAAAE,GAAG,CAAG4B,UAAU,CAACrF,MAAM,CAACyD,GAAG,CAAC,CAClC,GAAI6B,KAAK,CAAC/B,GAAG,CAAC,EAAI+B,KAAK,CAAC7B,GAAG,CAAC,CAAE,OAE9B;AACA,KAAM,CAAA8B,OAAO,CAAGxI,gBAAgB,CAACiD,MAAM,CAACkD,KAAK,CAAC,CAC9C,KAAM,CAAAsC,aAAa,CAAG3I,CAAC,CAACmD,MAAM,CAAC,CAACuD,GAAG,CAAEE,GAAG,CAAC,CAAE,CAAEgC,IAAI,CAAEF,OAAQ,CAAC,CAAC,CAACG,KAAK,CAAClI,GAAG,CAAC,CAExE;AACA,KAAM,CAAAmI,WAAW,CAAG3F,MAAM,CAACgE,aAAa,GAAK,IAAI,EAAIhE,MAAM,CAAC4F,aAAa,GAAK,IAAI,CAClF,GAAID,WAAW,CAAE,CACf,KAAM,CAAAE,UAAU,CAAGhJ,CAAC,CAAC4I,IAAI,CAAC,CACxBF,OAAO,IAAAtE,MAAA,CAAK6E,OAAO,CAACC,GAAG,CAACC,UAAU,wBAAsB,CACxDC,QAAQ,CAAE,CAAC,EAAE,CAAE,EAAE,CAAC,CAClBC,UAAU,CAAE,CAAC,GAAG,CAAE,GAAG,CAAC,CACtBC,SAAS,CAAE,cACb,CAAC,CAAC,CACF,KAAM,CAAAC,YAAY,CAAGvJ,CAAC,CAACmD,MAAM,CAAC,CAACuD,GAAG,CAAEE,GAAG,CAAC,CAAE,CAAEgC,IAAI,CAAEI,UAAU,CAAEQ,WAAW,CAAE,KAAM,CAAC,CAAC,CAACX,KAAK,CAAClI,GAAG,CAAC,CAC9FE,gBAAgB,CAACoC,OAAO,CAAC4B,QAAQ,CAAC,CAAG0E,YAAY,CACnD,CAEA;AACA,KAAM,CAAAvD,UAAU,CAAGpB,sBAAsB,CAACzB,MAAM,CAAC8B,EAAE,CAAEoC,UAAU,CAAC,CAChE,KAAM,CAAApB,gBAAgB,CAAGrC,mBAAmB,CAACoC,UAAU,CAAE,SAAS,CAAC,CAEnE2C,aAAa,CAACc,EAAE,CAAC,WAAW,CAAGnG,CAAC,EAAK,CACnC5B,aAAa,CAAC,CACZgI,MAAM,IAAAtF,MAAA,CAAKjB,MAAM,CAACkD,KAAK,QAAAjC,MAAA,CAAMjB,MAAM,CAACqD,MAAM,CAAE,CAC5CmD,SAAS,CAAE3D,UAAU,CAAChC,MAAM,CAC5BG,IAAI,CAAE8B,gBACR,CAAC,CAAC,CACFnE,YAAY,CAAC,SAAS,CAAC,CACzB,CAAC,CAAC,CAEF,KAAM,CAAA8H,YAAY,CAAG7D,mBAAmB,CAAC5C,MAAM,CAAE6C,UAAU,CAAEC,gBAAgB,CAAE,SAAS,CAAC,CAEzF,KAAM,CAAA/D,KAAK,CAAGlC,CAAC,CAACkC,KAAK,CAAC,CACpB2H,SAAS,CAAE,KAAK,CAChBC,YAAY,CAAE,KAAK,CACnBC,UAAU,CAAE,IAAI,CAChBC,OAAO,CAAE,KAAK,CACdC,QAAQ,CAAE,GAAG,CACbX,SAAS,CAAE,cACb,CAAC,CAAC,CAACY,UAAU,CAACN,YAAY,CAAC,CAE3BjB,aAAa,CAACwB,SAAS,CAACjI,KAAK,CAAC,CAE9B;AACAyG,aAAa,CAACc,EAAE,CAAC,WAAW,CAAGnG,CAAC,EAAK,CACnCrB,aAAa,CAACC,KAAK,CAAC,CACpBqG,UAAU,CAAC,IAAM,CACf,KAAM,CAAA6B,cAAc,CAAG9G,CAAC,CAACpB,KAAK,CAACC,UAAU,CAEzC,KAAM,CAAAkI,UAAU,CAAGD,cAAc,CAACE,gBAAgB,CAAC,mBAAmB,CAAC,CACvED,UAAU,CAACnH,OAAO,CAACqH,GAAG,EAAI,CACxBA,GAAG,CAACC,gBAAgB,CAAC,OAAO,CAAE,UAAY,CACxC,KAAM,CAAAC,OAAO,CAAG,IAAI,CAACC,YAAY,CAAC,UAAU,CAAC,CAE7C;AACAN,cAAc,CAACE,gBAAgB,CAAC,mBAAmB,CAAC,CAACpH,OAAO,CAACkC,CAAC,EAAIA,CAAC,CAACuF,SAAS,CAACC,MAAM,CAAC,QAAQ,CAAC,CAAC,CAC/FR,cAAc,CAACE,gBAAgB,CAAC,iBAAiB,CAAC,CAACpH,OAAO,CAAC2H,IAAI,EAAIA,IAAI,CAACF,SAAS,CAACC,MAAM,CAAC,QAAQ,CAAC,CAAC,CACnG,IAAI,CAACD,SAAS,CAACG,GAAG,CAAC,QAAQ,CAAC,CAC5BV,cAAc,CAACW,aAAa,+BAAA3G,MAAA,CAA8BqG,OAAO,OAAI,CAAC,CAACE,SAAS,CAACG,GAAG,CAAC,QAAQ,CAAC,CAE9F;AACA,GAAIL,OAAO,GAAK,YAAY,CAAE,CAC5B,KAAM,CAAAO,EAAE,CAAGZ,cAAc,CAACW,aAAa,gBAAA3G,MAAA,CAAgBjB,MAAM,CAAC8B,EAAE,CAAE,CAAC,CACnE,GAAI+F,EAAE,EAAI,CAACA,EAAE,CAACC,SAAS,CAAE,CACvB,KAAM,CAAAC,IAAI,CAAGjL,QAAQ,CAACkL,UAAU,CAACH,EAAE,CAAC,CACpCE,IAAI,CAACE,MAAM,cAAC1L,KAAK,CAAC2L,aAAa,CAACjL,UAAU,CAAE,CAC1CkL,QAAQ,CAAEtF,UAAU,CACpBuF,SAAS,CAAE,CAAC,CACZC,MAAM,CAAE,GAAG,CACXC,OAAO,CAAE,IACX,CAAC,CAAC,CAAC,CACHT,EAAE,CAACC,SAAS,CAAG,IAAI,CACnBD,EAAE,CAACU,MAAM,CAAGR,IAAI,CAClB,CACF,CACF,CAAC,CAAC,CACJ,CAAC,CAAC,CACJ,CAAC,CAAE,CAAC,CAAC,CACP,CAAC,CAAC,CAEF;AACAvC,aAAa,CAACc,EAAE,CAAC,YAAY,CAAGnG,CAAC,EAAK,KAAAqI,QAAA,CACpC,KAAM,CAAAC,SAAS,EAAAD,QAAA,CAAGrI,CAAC,CAACpB,KAAK,UAAAyJ,QAAA,iBAAPA,QAAA,CAASxJ,UAAU,CACrC,GAAI,CAACyJ,SAAS,CAAE,OAChB,KAAM,CAAAZ,EAAE,CAAGY,SAAS,CAACb,aAAa,gBAAA3G,MAAA,CAAgBjB,MAAM,CAAC8B,EAAE,CAAE,CAAC,CAC9D,GAAI+F,EAAE,EAAIA,EAAE,CAACU,MAAM,CAAE,CACnBV,EAAE,CAACU,MAAM,CAACG,OAAO,CAAC,CAAC,CACnBb,EAAE,CAACC,SAAS,CAAG,KAAK,CACpBD,EAAE,CAACU,MAAM,CAAG,IAAI,CAClB,CACF,CAAC,CAAC,CAEF/C,aAAa,CAACc,EAAE,CAAC,OAAO,CAAE,IAAM,CAC9Bd,aAAa,CAACmD,SAAS,CAAC,CAAC,CAC3B,CAAC,CAAC,CAEFlL,UAAU,CAACqC,OAAO,CAAC4B,QAAQ,CAAC,CAAG8D,aAAa,CAE5C7H,QAAQ,CAACmC,OAAO,CAAC4B,QAAQ,CAAC,CAAG,CAC3B6B,GAAG,CAAEvD,MAAM,CAACuD,GAAG,CACfE,GAAG,CAAEzD,MAAM,CAACyD,GAAG,CACfmF,KAAK,CAAE5I,MAAM,CAACkD,KAAK,CACnBG,MAAM,CAAErD,MAAM,CAACqD,MAAM,CACrBwF,MAAM,CAAE7I,MAAM,CAAC0D,MACjB,CAAC,CACH,CAAE,MAAO/D,KAAK,CAAE,CACdC,OAAO,CAACD,KAAK,CAAC,QAAQ,CAAEA,KAAK,CAAC,CAChC,CACF,CAAC,CAAC,CAEFsF,eAAe,EAAE,CACjB6D,YAAY,CAACC,OAAO,CAAC,cAAc,CAAEC,IAAI,CAACC,SAAS,CAACtL,QAAQ,CAACmC,OAAO,CAAC,CAAC,CACtE,GAAImF,eAAe,GAAKD,WAAW,CAAE,CACnCpH,mBAAmB,CAACkC,OAAO,CAAG,KAAK,CACrC,CACF,CAAC,CAAEgF,WAAW,CAAC,CAEfA,WAAW,EAAI,EAAE,CACnB,CAAC,CAAC,CACJ,CAAC,CAAE,CAACtH,GAAG,CAAEsB,aAAa,CAAExB,cAAc,CAAEmD,mBAAmB,CAAEgB,sBAAsB,CAAEmB,mBAAmB,CAAEtC,kBAAkB,CAAC,CAAC,CAE9H;AACA,KAAM,CAAA4I,iBAAiB,CAAGvM,WAAW,CAAC,CAACwG,GAAG,CAAEI,GAAG,CAAEE,GAAG,CAAE0F,gBAAgB,GAAK,CACzE,KAAM,CAAAC,WAAW,CAAG/L,iBAAiB,EAAIA,iBAAiB,CAACwD,MAAM,CAAG,CAAC,CAAGxD,iBAAiB,CAAGD,OAAO,CAEnG,GAAIU,iBAAiB,EAAII,gBAAgB,GAAKiF,GAAG,CAAE,CACjDtD,uBAAuB,CAAC,CAAC,CACzBO,cAAc,CAAC,CAAC,CAChBE,kBAAkB,CAAC,CAAC,CAEpBC,MAAM,CAACC,MAAM,CAAC/C,UAAU,CAACqC,OAAO,CAAC,CAACC,OAAO,CAACC,MAAM,EAAI,CAClD,GAAI,CAAE,GAAIxC,GAAG,CAACyC,QAAQ,CAACD,MAAM,CAAC,CAAExC,GAAG,CAAC0C,WAAW,CAACF,MAAM,CAAC,CAAE,CAAE,MAAOL,KAAK,CAAE,CAAEC,OAAO,CAACD,KAAK,CAAC,mBAAmB,CAAEA,KAAK,CAAC,CAAE,CACxH,CAAC,CAAC,CACFlC,UAAU,CAACqC,OAAO,CAAG,CAAC,CAAC,CAEvB/B,oBAAoB,CAAC,KAAK,CAAC,CAC3BI,mBAAmB,CAAC,IAAI,CAAC,CACzBF,sBAAsB,CAAC,IAAI,CAAC,CAE5B,KAAM,CAAAoL,aAAa,CAAGhM,iBAAiB,EAAIA,iBAAiB,CAACwD,MAAM,CAAG,CAAC,CAAGxD,iBAAiB,CAAGD,OAAO,CACrG,GAAII,GAAG,EAAI6L,aAAa,EAAIA,aAAa,CAACxI,MAAM,CAAG,CAAC,CAAE,CACpDoD,qBAAqB,CAACoF,aAAa,CAAE,IAAI,CAAC,CAC5C,CACA,OACF,CAEAxJ,uBAAuB,CAAC,CAAC,CACzBO,cAAc,CAAC,CAAC,CAEhB,KAAM,CAAAkJ,cAAc,CAAG/L,YAAY,CAACqE,MAAM,CAACU,IAAI,EAAIiH,MAAM,CAACjH,IAAI,CAACa,GAAG,CAAC,CAACqG,IAAI,CAAC,CAAC,GAAKD,MAAM,CAACpG,GAAG,CAAC,CAACqG,IAAI,CAAC,CAAC,CAAC,CAClG,GAAIF,cAAc,CAACzI,MAAM,GAAK,CAAC,CAAE,OAEjC,KAAM,CAAA4I,GAAG,CAAGH,cAAc,CAAC9L,GAAG,CAAC8E,IAAI,EAAIA,IAAI,CAACR,EAAE,CAAC,CAE/C,GAAItE,GAAG,CAAE,CACP,GAAI,CAAAmL,SAAS,CAAG,IAAI,CACpBnL,GAAG,CAACgH,SAAS,CAAEC,KAAK,EAAK,CACvB,GAAIA,KAAK,WAAY,CAAA5H,CAAC,CAAC6H,MAAM,EAAID,KAAK,CAACiF,MAAM,EAAIjF,KAAK,CAACiF,MAAM,CAACC,MAAM,CAAC,CAAC,CAAE,CACtEhB,SAAS,CAAGlE,KAAK,CAACiF,MAAM,CAC1B,CACF,CAAC,CAAC,CAEFlM,GAAG,CAACgH,SAAS,CAAEC,KAAK,EAAK,CACvB,GAAIA,KAAK,WAAY,CAAA5H,CAAC,CAAC6H,MAAM,CAAE,CAC7B,KAAM,CAAAkF,OAAO,CAAGnF,KAAK,CAACtF,SAAS,CAAC,CAAC,CACjC,KAAM,CAAA0K,UAAU,CAAGJ,GAAG,CAACK,IAAI,CAAChI,EAAE,EAAI,CAChC,KAAM,CAAA9B,MAAM,CAAGoJ,WAAW,CAACW,IAAI,CAAClI,CAAC,EAAIA,CAAC,CAACC,EAAE,GAAKA,EAAE,CAAC,CACjD,MAAO,CAAA9B,MAAM,EAAIA,MAAM,CAACuD,GAAG,GAAKqG,OAAO,CAACrG,GAAG,EAAIvD,MAAM,CAACyD,GAAG,GAAKmG,OAAO,CAACnG,GAAG,CAC3E,CAAC,CAAC,EAAKmG,OAAO,CAACrG,GAAG,GAAKA,GAAG,EAAIqG,OAAO,CAACnG,GAAG,GAAKA,GAAI,CAElD,GAAI,CAACoG,UAAU,CAAE,CACfrM,GAAG,CAAC0C,WAAW,CAACuE,KAAK,CAAC,CACxB,CACF,CACF,CAAC,CAAC,CAEFlE,MAAM,CAACC,MAAM,CAAC/C,UAAU,CAACqC,OAAO,CAAC,CAACC,OAAO,CAACC,MAAM,EAAI,CAClD,KAAM,CAAA4J,OAAO,CAAG5J,MAAM,CAACb,SAAS,CAAC,CAAC,CAClC,KAAM,CAAA0K,UAAU,CAAGJ,GAAG,CAACK,IAAI,CAAChI,EAAE,EAAI,CAChC,KAAM,CAAAD,CAAC,CAAGuH,WAAW,CAACW,IAAI,CAACC,CAAC,EAAIA,CAAC,CAAClI,EAAE,GAAKA,EAAE,CAAC,CAC5C,MAAO,CAAAD,CAAC,EAAIA,CAAC,CAAC0B,GAAG,GAAKqG,OAAO,CAACrG,GAAG,EAAI1B,CAAC,CAAC4B,GAAG,GAAKmG,OAAO,CAACnG,GAAG,CAC5D,CAAC,CAAC,EAAKmG,OAAO,CAACrG,GAAG,GAAKA,GAAG,EAAIqG,OAAO,CAACnG,GAAG,GAAKA,GAAI,CAElD,GAAI,CAACoG,UAAU,CAAE,CACf,GAAI,CAAE,GAAIrM,GAAG,CAACyC,QAAQ,CAACD,MAAM,CAAC,CAAExC,GAAG,CAAC0C,WAAW,CAACF,MAAM,CAAC,CAAE,CAAE,MAAOL,KAAK,CAAE,CAAEC,OAAO,CAACD,KAAK,CAAC,QAAQ,CAAEA,KAAK,CAAC,CAAE,CAC7G,CACF,CAAC,CAAC,CAEF,KAAM,CAAAsK,iBAAiB,CAAGb,WAAW,CAACxH,MAAM,CAACU,IAAI,EAAImH,GAAG,CAACS,QAAQ,CAAC5H,IAAI,CAACR,EAAE,CAAC,CAAC,CAC3EmI,iBAAiB,CAAClK,OAAO,CAACC,MAAM,EAAI,CAClC,KAAM,CAAAmK,SAAS,CAAG9E,UAAU,CAACrF,MAAM,CAACuD,GAAG,CAAC,CACxC,KAAM,CAAA6G,SAAS,CAAG/E,UAAU,CAACrF,MAAM,CAACyD,GAAG,CAAC,CACxC,GAAI6B,KAAK,CAAC6E,SAAS,CAAC,EAAI7E,KAAK,CAAC8E,SAAS,CAAC,CAAE,OAE1C,GAAI,CAAAC,MAAM,CAAG,KAAK,CAClB7M,GAAG,CAACgH,SAAS,CAAEC,KAAK,EAAK,CACvB,GAAIA,KAAK,WAAY,CAAA5H,CAAC,CAAC6H,MAAM,CAAE,CAC7B,KAAM,CAAAkF,OAAO,CAAGnF,KAAK,CAACtF,SAAS,CAAC,CAAC,CACjC,GAAIyK,OAAO,CAACrG,GAAG,GAAK4G,SAAS,EAAIP,OAAO,CAACnG,GAAG,GAAK2G,SAAS,CAAEC,MAAM,CAAG,IAAI,CAC3E,CACF,CAAC,CAAC,CAEF,GAAI,CAACA,MAAM,CAAE,CACX,KAAM,CAAA9E,OAAO,CAAGxI,gBAAgB,CAACiD,MAAM,CAACkD,KAAK,CAAC,CAC9C,KAAM,CAAAsC,aAAa,CAAG3I,CAAC,CAACmD,MAAM,CAAC,CAACmK,SAAS,CAAEC,SAAS,CAAC,CAAE,CAAE3E,IAAI,CAAEF,OAAQ,CAAC,CAAC,CAACG,KAAK,CAAClI,GAAG,CAAC,CAEpF,KAAM,CAAAmI,WAAW,CAAG3F,MAAM,CAACgE,aAAa,GAAK,IAAI,EAAIhE,MAAM,CAAC4F,aAAa,GAAK,IAAI,CAClF,GAAID,WAAW,CAAE,CACf,KAAM,CAAAE,UAAU,CAAGhJ,CAAC,CAAC4I,IAAI,CAAC,CACxBF,OAAO,IAAAtE,MAAA,CAAK6E,OAAO,CAACC,GAAG,CAACC,UAAU,wBAAsB,CACxDC,QAAQ,CAAE,CAAC,EAAE,CAAE,EAAE,CAAC,CAClBC,UAAU,CAAE,CAAC,GAAG,CAAE,GAAG,CAAC,CACtBC,SAAS,CAAE,cACb,CAAC,CAAC,CACFtJ,CAAC,CAACmD,MAAM,CAAC,CAACmK,SAAS,CAAEC,SAAS,CAAC,CAAE,CAAE3E,IAAI,CAAEI,UAAU,CAAEQ,WAAW,CAAE,KAAM,CAAC,CAAC,CAACX,KAAK,CAAClI,GAAG,CAAC,CACvF,CAEAY,qBAAqB,CAAC0B,OAAO,CAAC8E,IAAI,CAACY,aAAa,CAAC,CAEjD,KAAM,CAAA3C,UAAU,CAAGpB,sBAAsB,CAACzB,MAAM,CAAC8B,EAAE,CAAEvE,YAAY,CAAC,CAClE,KAAM,CAAAuF,gBAAgB,CAAGrC,mBAAmB,CAACoC,UAAU,CAAE,WAAW,CAAC,CAErE2C,aAAa,CAACc,EAAE,CAAC,WAAW,CAAE,IAAM,CAClC/H,aAAa,CAAC,CACZgI,MAAM,IAAAtF,MAAA,CAAKjB,MAAM,CAACkD,KAAK,QAAAjC,MAAA,CAAMjB,MAAM,CAACqD,MAAM,CAAE,CAC5CmD,SAAS,CAAE3D,UAAU,CAAChC,MAAM,CAC5BG,IAAI,CAAE8B,gBACR,CAAC,CAAC,CACFnE,YAAY,CAAC,SAAS,CAAC,CACzB,CAAC,CAAC,CAEF,KAAM,CAAA8H,YAAY,CAAG7D,mBAAmB,CAAC5C,MAAM,CAAE6C,UAAU,CAAEC,gBAAgB,CAAE,WAAW,CAAC,CAE3F,KAAM,CAAA/D,KAAK,CAAGlC,CAAC,CAACkC,KAAK,CAAC,CACpB2H,SAAS,CAAE,KAAK,CAChBC,YAAY,CAAE,KAAK,CACnBC,UAAU,CAAE,IAAI,CAChBC,OAAO,CAAE,KAAK,CACdC,QAAQ,CAAE,GAAG,CACbX,SAAS,CAAE,cACb,CAAC,CAAC,CAACY,UAAU,CAACN,YAAY,CAAC,CAE3BjB,aAAa,CAACwB,SAAS,CAACjI,KAAK,CAAC,CAE9ByG,aAAa,CAACc,EAAE,CAAC,WAAW,CAAGnG,CAAC,EAAK,CACnCrB,aAAa,CAACC,KAAK,CAAC,CACpBqG,UAAU,CAAC,IAAM,CACf,KAAM,CAAA6B,cAAc,CAAG9G,CAAC,CAACpB,KAAK,CAACC,UAAU,CAEzC,KAAM,CAAAkI,UAAU,CAAGD,cAAc,CAACE,gBAAgB,CAAC,mBAAmB,CAAC,CACvED,UAAU,CAACnH,OAAO,CAACqH,GAAG,EAAI,CACxBA,GAAG,CAACC,gBAAgB,CAAC,OAAO,CAAE,UAAY,CACxC,KAAM,CAAAC,OAAO,CAAG,IAAI,CAACC,YAAY,CAAC,UAAU,CAAC,CAE7CN,cAAc,CAACE,gBAAgB,CAAC,mBAAmB,CAAC,CAACpH,OAAO,CAACkC,CAAC,EAAIA,CAAC,CAACuF,SAAS,CAACC,MAAM,CAAC,QAAQ,CAAC,CAAC,CAC/FR,cAAc,CAACE,gBAAgB,CAAC,iBAAiB,CAAC,CAACpH,OAAO,CAAC2H,IAAI,EAAIA,IAAI,CAACF,SAAS,CAACC,MAAM,CAAC,QAAQ,CAAC,CAAC,CACnG,IAAI,CAACD,SAAS,CAACG,GAAG,CAAC,QAAQ,CAAC,CAC5BV,cAAc,CAACW,aAAa,+BAAA3G,MAAA,CAA8BqG,OAAO,OAAI,CAAC,CAACE,SAAS,CAACG,GAAG,CAAC,QAAQ,CAAC,CAE9F,GAAIL,OAAO,GAAK,YAAY,CAAE,CAC5B,KAAM,CAAAO,EAAE,CAAGZ,cAAc,CAACW,aAAa,gBAAA3G,MAAA,CAAgBjB,MAAM,CAAC8B,EAAE,CAAE,CAAC,CACnE,GAAI+F,EAAE,EAAI,CAACA,EAAE,CAACC,SAAS,CAAE,CACvB,KAAM,CAAAC,IAAI,CAAGjL,QAAQ,CAACkL,UAAU,CAACH,EAAE,CAAC,CACpCE,IAAI,CAACE,MAAM,cAAC1L,KAAK,CAAC2L,aAAa,CAACjL,UAAU,CAAE,CAC1CkL,QAAQ,CAAEtF,UAAU,CACpBuF,SAAS,CAAE,CAAC,CACZC,MAAM,CAAE,GAAG,CACXC,OAAO,CAAE,IACX,CAAC,CAAC,CAAC,CACHT,EAAE,CAACC,SAAS,CAAG,IAAI,CACnBD,EAAE,CAACU,MAAM,CAAGR,IAAI,CAClB,CACF,CACF,CAAC,CAAC,CACJ,CAAC,CAAC,CACJ,CAAC,CAAE,CAAC,CAAC,CACP,CAAC,CAAC,CAEFvC,aAAa,CAACc,EAAE,CAAC,YAAY,CAAGnG,CAAC,EAAK,KAAAmK,SAAA,CACpC,KAAM,CAAA7B,SAAS,EAAA6B,SAAA,CAAGnK,CAAC,CAACpB,KAAK,UAAAuL,SAAA,iBAAPA,SAAA,CAAStL,UAAU,CACrC,GAAI,CAACyJ,SAAS,CAAE,OAChB,KAAM,CAAAZ,EAAE,CAAGY,SAAS,CAACb,aAAa,gBAAA3G,MAAA,CAAgBjB,MAAM,CAAC8B,EAAE,CAAE,CAAC,CAC9D,GAAI+F,EAAE,EAAIA,EAAE,CAACU,MAAM,CAAE,CACnBV,EAAE,CAACU,MAAM,CAACG,OAAO,CAAC,CAAC,CACnBb,EAAE,CAACC,SAAS,CAAG,KAAK,CACpBD,EAAE,CAACU,MAAM,CAAG,IAAI,CAClB,CACF,CAAC,CAAC,CAEF/C,aAAa,CAACc,EAAE,CAAC,OAAO,CAAE,IAAMd,aAAa,CAACmD,SAAS,CAAC,CAAC,CAAC,CAC5D,CACF,CAAC,CAAC,CAEF,KAAM,CAAA4B,eAAe,CAAGjB,cAAc,CAAC1H,MAAM,CAACC,CAAC,EAAIA,CAAC,CAAC2I,kBAAkB,GAAK,IAAI,CAAC,CACjFD,eAAe,CAACxK,OAAO,CAAC0K,UAAU,EAAI,CACpC,KAAM,CAAAC,gBAAgB,CAAGtB,WAAW,CAACW,IAAI,CAAClI,CAAC,EAAIA,CAAC,CAACC,EAAE,GAAK2I,UAAU,CAAC3I,EAAE,CAAC,CACtE,GAAI,CAAC4I,gBAAgB,CAAE,OAEvB,KAAM,CAAAC,OAAO,CAAGtF,UAAU,CAACqF,gBAAgB,CAACnH,GAAG,CAAC,CAChD,KAAM,CAAAqH,OAAO,CAAGvF,UAAU,CAACqF,gBAAgB,CAACjH,GAAG,CAAC,CAChD,GAAI6B,KAAK,CAACqF,OAAO,CAAC,EAAIrF,KAAK,CAACsF,OAAO,CAAC,CAAE,OAEtC,KAAM,CAAAC,UAAU,CAAGxF,UAAU,CAAC9B,GAAG,CAAC,CAClC,KAAM,CAAAuH,UAAU,CAAGzF,UAAU,CAAC5B,GAAG,CAAC,CAElC,KAAM,CAAAsH,QAAQ,CAAGlO,CAAC,CAACkO,QAAQ,CACzB,CAAC,CAACF,UAAU,CAAEC,UAAU,CAAC,CAAE,CAACH,OAAO,CAAEC,OAAO,CAAC,CAAC,CAC9C,CAAEI,KAAK,CAAE,SAAS,CAAEC,MAAM,CAAE,CAAC,CAAEC,OAAO,CAAE,GAAG,CAAEC,SAAS,CAAE,MAAO,CACjE,CAAC,CAACzF,KAAK,CAAClI,GAAG,CAAC,CAEZa,WAAW,CAACyB,OAAO,CAAC8E,IAAI,CAACmG,QAAQ,CAAC,CACpC,CAAC,CAAC,CAEF,GAAIpC,SAAS,CAAE,CACbvD,UAAU,CAAC,IAAM,CACf,GAAI,CAAEuD,SAAS,CAACyC,IAAI,CAAG5N,GAAG,CAAEmL,SAAS,CAAC0C,MAAM,CAAC,CAAC,CAAE,CAAE,MAAOlL,CAAC,CAAE,CAAE,WAChE,CAAC,CAAE,EAAE,CAAC,CACR,CAEApC,oBAAoB,CAAC,IAAI,CAAC,CAC1BI,mBAAmB,CAACgF,GAAG,CAAC,CAC1B,CACF,CAAC,CAAE,CAAC5F,YAAY,CAAEH,OAAO,CAAEC,iBAAiB,CAAEG,GAAG,CAAEsB,aAAa,CAAEhB,iBAAiB,CAAEI,gBAAgB,CAAE+F,qBAAqB,CAAEpE,uBAAuB,CAAEO,cAAc,CAAEE,kBAAkB,CAAEG,mBAAmB,CAAEgB,sBAAsB,CAAEmB,mBAAmB,CAAC,CAAC,CAE7PpG,SAAS,CAAC,IAAM,CACd8O,MAAM,CAACpC,iBAAiB,CAAGA,iBAAiB,CAC9C,CAAC,CAAE,CAACA,iBAAiB,CAAC,CAAC,CAEvB;AACA1M,SAAS,CAAC,IAAM,CACd,GAAI,CAACgB,GAAG,EAAI,CAACJ,OAAO,EAAIA,OAAO,CAACyD,MAAM,GAAK,CAAC,CAAE,OAE9ChB,uBAAuB,CAAC,CAAC,CACzBO,cAAc,CAAC,CAAC,CAChBE,kBAAkB,CAAC,CAAC,CACpBvC,oBAAoB,CAAC,KAAK,CAAC,CAC3BI,mBAAmB,CAAC,IAAI,CAAC,CACzBF,sBAAsB,CAAC,IAAI,CAAC,CAE5BgG,qBAAqB,CAAC7G,OAAO,CAAE,IAAI,CAAC,CACtC,CAAC,CAAE,CAACI,GAAG,CAAEJ,OAAO,CAAEE,cAAc,CAAE2G,qBAAqB,CAAEpE,uBAAuB,CAAEO,cAAc,CAAEE,kBAAkB,CAAC,CAAC,CAEtH;AACA9D,SAAS,CAAC,IAAM,CACd,GAAI,CAACgB,GAAG,CAAE,OAEV,KAAM,CAAA+N,aAAa,CAAGA,CAAA,GAAM,CAC1B,GAAI1N,aAAa,CAACiC,OAAO,CAAE0L,YAAY,CAAC3N,aAAa,CAACiC,OAAO,CAAC,CAC9DjC,aAAa,CAACiC,OAAO,CAAGsF,UAAU,CAAC,IAAM,CACvC,GAAItH,iBAAiB,CAAE,CACrB;AAAA,CACD,IAAM,IAAIV,OAAO,EAAIA,OAAO,CAACyD,MAAM,CAAG,CAAC,CAAE,CACxCoD,qBAAqB,CAAC7G,OAAO,CAAE,KAAK,CAAC,CACvC,CACF,CAAC,CAAE,GAAG,CAAC,CACT,CAAC,CAEDI,GAAG,CAAC8I,EAAE,CAAC,SAAS,CAAEiF,aAAa,CAAC,CAChC,MAAO,IAAM,CAAE/N,GAAG,CAACiO,GAAG,CAAC,SAAS,CAAEF,aAAa,CAAC,CAAE,CAAC,CACrD,CAAC,CAAE,CAAC/N,GAAG,CAAEJ,OAAO,CAAE6G,qBAAqB,CAAEnG,iBAAiB,CAAC,CAAC,CAE5D;AACAtB,SAAS,CAAC,IAAM,CACd8O,MAAM,CAACI,4BAA4B,CAAG,CAACvI,GAAG,CAAErB,EAAE,CAAEsB,GAAG,CAAEwF,KAAK,GAAK,CAC7D,KAAM,CAAA+C,UAAU,CAAGxI,GAAG,EAAIrB,EAAE,CAC5B,GAAItE,GAAG,CAAEA,GAAG,CAACoO,YAAY,CAAC,CAAC,CAACC,KAAK,CAACC,MAAM,CAAG,WAAW,CACtDjN,iBAAiB,CAAC,CAAEsE,GAAG,CAAErB,EAAE,CAAEsB,GAAG,CAAEwF,KAAK,CAAErF,GAAG,CAAE,IAAI,CAAEE,GAAG,CAAE,IAAK,CAAC,CAAC,CAEhE,KAAM,CAAAsI,UAAU,CAAGC,QAAQ,CAACC,cAAc,kBAAAhL,MAAA,CAAkB0K,UAAU,CAAE,CAAC,CACzE,GAAII,UAAU,CAAE,CAAEA,UAAU,CAACG,QAAQ,CAAG,IAAI,CAAEH,UAAU,CAACF,KAAK,CAACX,OAAO,CAAG,KAAK,CAAE,CAEhF,KAAM,CAAAiB,UAAU,CAAGH,QAAQ,CAACC,cAAc,kBAAAhL,MAAA,CAAkB0K,UAAU,CAAE,CAAC,CACzE,GAAIQ,UAAU,CAAE,CAAEA,UAAU,CAACC,WAAW,CAAG,kBAAkB,CAAED,UAAU,CAACN,KAAK,CAACQ,UAAU,CAAG,SAAS,CAAE,CAC1G,CAAC,CAEDf,MAAM,CAACgB,4BAA4B,CAAG,MAAOnJ,GAAG,CAAErB,EAAE,CAAEsB,GAAG,CAAEwF,KAAK,GAAK,CACnE,GAAI,CAAChK,cAAc,EAAI,CAACA,cAAc,CAAC2E,GAAG,EAAI,CAAC3E,cAAc,CAAC6E,GAAG,CAAE,CACjE8I,KAAK,CAAC,qCAAqC,CAAC,CAC5C,OACF,CAEA,KAAM,CAAAZ,UAAU,CAAGxI,GAAG,EAAIrB,EAAE,CAE5B,GAAI,CAAA9B,MAAM,CAAG,IAAI,CACjB,GAAImD,GAAG,CAAE,CACPnD,MAAM,CAAG5C,OAAO,CAAC2M,IAAI,CAAClI,CAAC,EAAIA,CAAC,CAACsB,GAAG,GAAKA,GAAG,CAAC,GAAI9F,iBAAiB,SAAjBA,iBAAiB,iBAAjBA,iBAAiB,CAAE0M,IAAI,CAAClI,CAAC,EAAIA,CAAC,CAACsB,GAAG,GAAKA,GAAG,CAAC,IAAI5F,YAAY,SAAZA,YAAY,iBAAZA,YAAY,CAAEwM,IAAI,CAAClI,CAAC,EAAIA,CAAC,CAACsB,GAAG,GAAKA,GAAG,CAAC,EACpI,CACA,GAAI,CAACnD,MAAM,EAAI8B,EAAE,CAAE,CACjB9B,MAAM,CAAG5C,OAAO,CAAC2M,IAAI,CAAClI,CAAC,EAAIA,CAAC,CAACC,EAAE,GAAKA,EAAE,CAAC,GAAIzE,iBAAiB,SAAjBA,iBAAiB,iBAAjBA,iBAAiB,CAAE0M,IAAI,CAAClI,CAAC,EAAIA,CAAC,CAACC,EAAE,GAAKA,EAAE,CAAC,IAAIvE,YAAY,SAAZA,YAAY,iBAAZA,YAAY,CAAEwM,IAAI,CAAClI,CAAC,EAAIA,CAAC,CAACC,EAAE,GAAKA,EAAE,CAAC,EAC9H,CACA,GAAI,CAAC9B,MAAM,CAAE,CACXuM,KAAK,CAAC,qCAAqC,CAAC,CAC5C,OACF,CAEA,GAAI,CACF,KAAM,CAAAC,UAAU,CAAG,CACjB1K,EAAE,CAAEA,EAAE,EAAI9B,MAAM,CAAC8B,EAAE,EAAIqB,GAAG,CAC1BA,GAAG,CAAEA,GAAG,EAAInD,MAAM,CAACmD,GAAG,EAAIrB,EAAE,CAC5BsB,GAAG,CAAEA,GAAG,EAAIpD,MAAM,CAACoD,GAAG,EAAI,EAAE,CAC5BwF,KAAK,CAAEA,KAAK,EAAI5I,MAAM,CAACkD,KAAK,EAAI,EAAE,CAClCuJ,MAAM,CAAEzM,MAAM,CAAC2D,MAAM,EAAI,EAAE,CAC3B+I,aAAa,CAAE9N,cAAc,CAAC2E,GAAG,CACjCoJ,aAAa,CAAE/N,cAAc,CAAC6E,GAChC,CAAC,CAED,KAAM,CAAAzG,0BAA0B,CAACwP,UAAU,CAAC,CAE5C,KAAM,CAAAzH,QAAQ,CAAGzH,cAAc,CAC/B,KAAM,CAAAoE,QAAQ,IAAAT,MAAA,CAAM8D,QAAQ,MAAA9D,MAAA,CAAIjB,MAAM,CAAC8B,EAAE,CAAE,CAC3C,GAAI,CAAA0D,aAAa,CAAG/H,UAAU,CAACqC,OAAO,CAAC4B,QAAQ,CAAC,CAEhD,GAAI,CAAC8D,aAAa,EAAIpH,qBAAqB,CAAC0B,OAAO,CAACe,MAAM,CAAG,CAAC,CAAE,CAC9D2E,aAAa,CAAGpH,qBAAqB,CAAC0B,OAAO,CAACiK,IAAI,CAAClI,CAAC,EAAI,CACtD,KAAM,CAAA+K,MAAM,CAAG/K,CAAC,CAAC1C,SAAS,CAAC,CAAC,CAC5B,MAAO,CAAAyN,MAAM,CAACrJ,GAAG,GAAKvD,MAAM,CAACuD,GAAG,EAAIqJ,MAAM,CAACnJ,GAAG,GAAKzD,MAAM,CAACyD,GAAG,CAC/D,CAAC,CAAC,CACJ,CAEA,GAAI+B,aAAa,EAAIhI,GAAG,CAAE,CACxB,KAAM,CAAAqP,SAAS,CAAGhQ,CAAC,CAAC+P,MAAM,CAAChO,cAAc,CAAC2E,GAAG,CAAE3E,cAAc,CAAC6E,GAAG,CAAC,CAClE+B,aAAa,CAACsH,SAAS,CAACD,SAAS,CAAC,CAElC,GAAInP,gBAAgB,CAACoC,OAAO,CAAC4B,QAAQ,CAAC,CAAE,CACtChE,gBAAgB,CAACoC,OAAO,CAAC4B,QAAQ,CAAC,CAACoL,SAAS,CAACD,SAAS,CAAC,CACzD,CAEArP,GAAG,CAACuP,OAAO,CAACF,SAAS,CAAErP,GAAG,CAACwP,OAAO,CAAC,CAAC,CAAC,CAErC,GAAIxH,aAAa,CAACyH,WAAW,CAAC,CAAC,CAAE,CAC/BzH,aAAa,CAAC0H,UAAU,CAAC,CAAC,CAC1B9H,UAAU,CAAC,IAAM,CAAEI,aAAa,CAACmD,SAAS,CAAC,CAAC,CAAE,CAAC,CAAE,GAAG,CAAC,CACvD,CACF,CAEA3I,MAAM,CAACuD,GAAG,CAAG3E,cAAc,CAAC2E,GAAG,CAC/BvD,MAAM,CAACyD,GAAG,CAAG7E,cAAc,CAAC6E,GAAG,CAE/B5E,iBAAiB,CAAC,IAAI,CAAC,CACvB,GAAIrB,GAAG,CAAEA,GAAG,CAACoO,YAAY,CAAC,CAAC,CAACC,KAAK,CAACC,MAAM,CAAG,EAAE,CAC/C,CAAE,MAAOnM,KAAK,CAAE,CACd4M,KAAK,CAAC,sBAAsB,CAAG5M,KAAK,CAACwN,OAAO,CAAC,CAC/C,CACF,CAAC,CAED,MAAO,IAAM,CACX,MAAO,CAAA7B,MAAM,CAACI,4BAA4B,CAC1C,MAAO,CAAAJ,MAAM,CAACgB,4BAA4B,CAC5C,CAAC,CACH,CAAC,CAAE,CAAC9O,GAAG,CAAEoB,cAAc,CAAExB,OAAO,CAAEC,iBAAiB,CAAEE,YAAY,CAAED,cAAc,CAAC,CAAC,CAEnFd,SAAS,CAAC,IAAM,CACd,GAAI,CAACgB,GAAG,EAAI,CAACoB,cAAc,CAAE,OAE7B,KAAM,CAAAwO,cAAc,CAAIjN,CAAC,EAAK,CAC5B,KAAM,CAAEoD,GAAG,CAAEE,GAAI,CAAC,CAAGtD,CAAC,CAACkN,MAAM,CAC7BxO,iBAAiB,CAACyO,IAAI,EAAAC,aAAA,CAAAA,aAAA,IAAUD,IAAI,MAAE/J,GAAG,CAAEE,GAAG,EAAG,CAAC,CAElD,KAAM,CAAAkI,UAAU,CAAG/M,cAAc,CAACuE,GAAG,EAAIvE,cAAc,CAACkD,EAAE,CAC1D,KAAM,CAAA0L,OAAO,CAAGxB,QAAQ,CAACC,cAAc,eAAAhL,MAAA,CAAe0K,UAAU,CAAE,CAAC,CACnE,KAAM,CAAA8B,OAAO,CAAGzB,QAAQ,CAACC,cAAc,eAAAhL,MAAA,CAAe0K,UAAU,CAAE,CAAC,CACnE,GAAI6B,OAAO,CAAEA,OAAO,CAACpB,WAAW,CAAG7I,GAAG,CAACC,OAAO,CAAC,CAAC,CAAC,CACjD,GAAIiK,OAAO,CAAEA,OAAO,CAACrB,WAAW,CAAG3I,GAAG,CAACD,OAAO,CAAC,CAAC,CAAC,CAEjD,KAAM,CAAAuI,UAAU,CAAGC,QAAQ,CAACC,cAAc,kBAAAhL,MAAA,CAAkB0K,UAAU,CAAE,CAAC,CACzE,GAAII,UAAU,CAAE,CAAEA,UAAU,CAACG,QAAQ,CAAG,KAAK,CAAEH,UAAU,CAACF,KAAK,CAACX,OAAO,CAAG,GAAG,CAAE,CAE/E,KAAM,CAAAiB,UAAU,CAAGH,QAAQ,CAACC,cAAc,kBAAAhL,MAAA,CAAkB0K,UAAU,CAAE,CAAC,CACzE,GAAIQ,UAAU,CAAE,CAAEA,UAAU,CAACC,WAAW,CAAG,uBAAuB,CAAED,UAAU,CAACN,KAAK,CAACQ,UAAU,CAAG,SAAS,CAAE,CAE7G7O,GAAG,CAACoO,YAAY,CAAC,CAAC,CAACC,KAAK,CAACC,MAAM,CAAG,EAAE,CACtC,CAAC,CAEDtO,GAAG,CAAC8I,EAAE,CAAC,OAAO,CAAE8G,cAAc,CAAC,CAC/B,MAAO,IAAM,CAAE5P,GAAG,CAACiO,GAAG,CAAC,OAAO,CAAE2B,cAAc,CAAC,CAAE,CAAC,CACpD,CAAC,CAAE,CAAC5P,GAAG,CAAEoB,cAAc,CAAC,CAAC,CAEzB,MAAO,KAAI,CACb,CAAC,CAED,cAAe,CAAA1B,gBAAgB","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}