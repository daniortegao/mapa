{"ast":null,"code":"import _objectSpread from\"C:/Users/e08f/Desktop/Proyectos/Resumen/mapa-v2/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useEffect,useRef,useState,useCallback}from'react';import{useMap}from'react-leaflet';import L from'leaflet';import ReactDOM from'react-dom/client';import{createCustomIcon}from'../utils/iconHelpers';import{guardarCoordenadaCorregida}from'../services/apiService';import MapPopup from'./MapPopup';import'../styles/iconMarkersLayer.css';import{jsx as _jsx}from\"react/jsx-runtime\";const IconMarkersLayer=_ref=>{var _markers$;let{markers,markersForMercado=null,selectedRegion,baseCompData=[]}=_ref;const map=useMap();const markersRef=useRef({});const guerraMarkersRef=useRef({});const competenciaMarkersRef=useRef([]);const polylineRef=useRef([]);console.log('游꿢 IconMarkersLayer RENDER:',{markersCount:markers===null||markers===void 0?void 0:markers.length,markersRefCount:Object.keys(markersRef.current).length,selectedRegion,firstMarkerComuna:markers===null||markers===void 0?void 0:(_markers$=markers[0])===null||_markers$===void 0?void 0:_markers$.Comuna,uniqueComunas:[...new Set((markers||[]).map(m=>m.Comuna))]});const[showingAssociated,setShowingAssociated]=useState(false);const[activeMercadoPbl,setActiveMercadoPbl]=useState(null);const[modoCorreccion,setModoCorreccion]=useState(null);// --- Helpers de UI (Draggable & Resize) ---\nconst makeDraggable=useCallback(popup=>{if(!map||!popup||!popup._container)return;try{const pos=map.latLngToLayerPoint(popup.getLatLng());L.DomUtil.setPosition(popup._wrapper.parentNode,pos);const draggable=new L.Draggable(popup._container,popup._wrapper);draggable.enable();}catch(error){console.error('Error draggable:',error);}},[map]);const crearGripEnWrapper=useCallback(popupContainer=>{const wrapper=popupContainer.querySelector('.leaflet-popup-content-wrapper');const content=popupContainer.querySelector('.leaflet-popup-content');if(!wrapper||!content)return;content===null||content===void 0?void 0:content.querySelectorAll('.popup-resize-grip').forEach(n=>n.remove());const handleWheel=e=>{e.preventDefault();const scrollSpeed=0.5;const scrollAmount=e.deltaY*scrollSpeed;content.scrollTop+=scrollAmount;};content.addEventListener('wheel',handleWheel,{passive:false});let grip=wrapper.querySelector('.popup-resize-grip');if(!grip){grip=document.createElement('div');grip.className='popup-resize-grip';wrapper.appendChild(grip);let isResizing=false;const startResize=e=>{isResizing=true;document.body.classList.add('is-resizing-popup');document.body.style.cursor='nwse-resize';document.body.style.userSelect='none';e.preventDefault();e.stopPropagation();};const doResize=e=>{if(!isResizing)return;const clientX=e.clientX||e.touches&&e.touches[0].clientX;const clientY=e.clientY||e.touches&&e.touches[0].clientY;const gripRect=grip.getBoundingClientRect();const gripCenterX=gripRect.left+gripRect.width/2;const gripCenterY=gripRect.top+gripRect.height/2;const deltaX=clientX-gripCenterX;const deltaY=clientY-gripCenterY;if(Math.abs(deltaX)>5||Math.abs(deltaY)>5){const currentRect=content.getBoundingClientRect();const newWidth=Math.max(240,currentRect.width+deltaX);const newHeight=Math.max(180,currentRect.height+deltaY);content.style.width=newWidth+'px';content.style.height=newHeight+'px';}e.preventDefault();};const stopResize=()=>{if(!isResizing)return;isResizing=false;document.body.classList.remove('is-resizing-popup');document.body.style.cursor='';document.body.style.userSelect='';};grip.addEventListener('mousedown',startResize);document.addEventListener('mousemove',doResize);document.addEventListener('mouseup',stopResize);grip.addEventListener('touchstart',startResize,{passive:false});document.addEventListener('touchmove',doResize,{passive:false});document.addEventListener('touchend',stopResize);const cleanup=()=>{content.removeEventListener('wheel',handleWheel);document.removeEventListener('mousemove',doResize);document.removeEventListener('mouseup',stopResize);document.removeEventListener('touchmove',doResize);document.removeEventListener('touchend',stopResize);document.body.classList.remove('is-resizing-popup');};grip._cleanup=cleanup;}},[]);// --- Helpers de limpieza ---\nconst clearCompetenciaMarkers=useCallback(()=>{competenciaMarkersRef.current.forEach(marker=>{try{if(map&&map.hasLayer(marker))map.removeLayer(marker);}catch(e){}});competenciaMarkersRef.current=[];},[map]);const clearPolylines=useCallback(()=>{polylineRef.current.forEach(line=>{try{if(map&&map.hasLayer(line))map.removeLayer(line);}catch(e){}});polylineRef.current=[];},[map]);const clearGuerraMarkers=useCallback(()=>{Object.values(guerraMarkersRef.current).forEach(marker=>{try{if(map&&map.hasLayer(marker))map.removeLayer(marker);}catch(e){}});guerraMarkersRef.current={};},[map]);// --- Handlers ---\nconst handleActivateCoords=useCallback(marker=>{if(modoCorreccion&&(modoCorreccion.id===marker.id||modoCorreccion.pbl===marker.pbl)){// Si ya est치 activo para este marcador, lo desactivamos (cancelar)\nsetModoCorreccion(null);if(map)map.getContainer().style.cursor='';return;}if(map)map.getContainer().style.cursor='crosshair';setModoCorreccion({pbl:marker.pbl,id:marker.id,eds:marker.eds,marca:marker.Marca,lat:null,lng:null});},[map,modoCorreccion]);const handleSaveCoords=useCallback(async marker=>{if(!modoCorreccion||!modoCorreccion.lat||!modoCorreccion.lng)return;try{const coordenada={id:marker.id||marker.pbl,pbl:marker.pbl||marker.id,eds:marker.eds||'',marca:marker.Marca||'',comuna:marker.Comuna||'',lat_corregida:modoCorreccion.lat,lon_corregida:modoCorreccion.lng};await guardarCoordenadaCorregida(coordenada);// Actualizar marcador localmente\nmarker.lat=modoCorreccion.lat;marker.lng=modoCorreccion.lng;// Resetear modo correcci칩n\nsetModoCorreccion(null);if(map)map.getContainer().style.cursor='';// Re-renderizar marcadores (esto forzar치 un update del efecto principal)\n// Nota: En una app real, deber칤amos actualizar el estado 'markers' en el padre\n// pero aqu칤 simulamos el refresco limpiando y dejando que el efecto corra.\n// Para simplificar, forzamos un re-render limpiando refs (el efecto lo notar치 si markers cambia, \n// pero como mutamos el objeto, necesitamos forzar update o confiar en que el padre refresque).\n// Aqu칤 asumimos que el padre refrescar치 o que el efecto de abajo se encargar치 si cambiamos algo.\n// Como mutamos 'marker', React no detecta cambio de prop 'markers' si es el mismo array.\n// ACTUALIZACI칍N OPTIMIZADA: No borrar todo. Solo mover el marcador.\nconst leafletMarker=markersRef.current[marker.id];if(leafletMarker){const newLatLng=new L.LatLng(modoCorreccion.lat,modoCorreccion.lng);leafletMarker.setLatLng(newLatLng);// Si el popup est치 abierto, Leaflet lo mueve con el marcador autom치ticamente.\n// Pero necesitamos actualizar el contenido del popup para que refleje que ya no estamos en modo correcci칩n\n// y muestre las nuevas coordenadas fijas.\n// Esto se hace abajo con el re-render manual de popups.\n}// No borramos markersRef.current ni clearGuerraMarkers() para evitar parpadeo/cierre.\n// Solo limpiamos si fuera necesario por l칩gica de negocio estricta, pero el usuario quiere que se mantenga.\n// Disparamos un evento custom o callback si fuera necesario, \n// por ahora confiamos en que el usuario recargue o que el efecto se dispare si cambiamos algo de estado.\n// Un truco es setear un estado dummy para forzar re-render, pero mejor dejemos que el flujo siga.\n}catch(error){console.error(\"Error guardando coordenadas:\",error);}},[modoCorreccion,map,clearGuerraMarkers]);// --- Refs para romper ciclo de dependencias ---\nconst showAssociatedIdsRef=useRef(null);const handleActivateCoordsRef=useRef(handleActivateCoords);const handleSaveCoordsRef=useRef(handleSaveCoords);const modoCorreccionRef=useRef(modoCorreccion);useEffect(()=>{handleActivateCoordsRef.current=handleActivateCoords;handleSaveCoordsRef.current=handleSaveCoords;modoCorreccionRef.current=modoCorreccion;});// --- L칩gica de Mercado (Show Associated) ---\nconst showAssociatedIds=useCallback((pbl,lat,lng,originalMarkerId)=>{const searchArray=markersForMercado&&markersForMercado.length>0?markersForMercado:markers;// Toggle ON (o cambio de PBL)\n// Definir associatedData aqu칤\nconst associatedData=baseCompData.filter(item=>String(item.pbl).trim()===String(pbl).trim());if(showingAssociated&&activeMercadoPbl===pbl){// Toggle OFF\nclearCompetenciaMarkers();clearPolylines();setShowingAssociated(false);setActiveMercadoPbl(null);// Restaurar marcadores originales\nObject.values(markersRef.current).forEach(marker=>{try{if(map&&map.hasLayer(marker))map.removeLayer(marker);}catch(e){}});markersRef.current={};// Re-crear todos\nmarkers.forEach(marker=>{const leafletMarker=createMarkerWithPopup(marker,markersForMercado||markers,'primary');if(leafletMarker){map.addLayer(leafletMarker);markersRef.current[marker.id]=leafletMarker;addGuerraMarker(marker);}});return;}// Si no hay datos asociados, no hacemos nada\nif(associatedData.length===0)return;// Toggle ON\nclearCompetenciaMarkers();clearPolylines();const ids=associatedData.map(item=>item.id);// Mostrar competencia\nconst associatedMarkers=searchArray.filter(item=>ids.includes(item.id));const uniqueAssociatedMarkers=[];const seenIds=new Set();associatedMarkers.forEach(marker=>{if(!seenIds.has(marker.id)){seenIds.add(marker.id);uniqueAssociatedMarkers.push(marker);}});uniqueAssociatedMarkers.forEach(marker=>{const leafletMarker=createMarkerWithPopup(marker,markersForMercado||baseCompData,'secondary');if(leafletMarker){map.addLayer(leafletMarker);competenciaMarkersRef.current.push(leafletMarker);if(marker.Guerra_Precio==='Si'){// Guerra marker logic for secondary\nconst guerraIcon=L.icon({iconUrl:\"\".concat(process.env.PUBLIC_URL,\"/iconos/calavera.jpg\"),iconSize:[15,15],iconAnchor:[7.5,7.5],className:'icono-guerra'});const guerraMarker=L.marker([marker.lat,marker.lng],{icon:guerraIcon,interactive:false});map.addLayer(guerraMarker);// No lo guardamos en ref global para no borrarlo accidentalmente con clearGuerraMarkers si solo queremos borrar los principales, \n// aunque aqu칤 borramos todo al cambiar de vista.\n// Para simplificar, los agregamos a competenciaMarkersRef si queremos limpiarlos con eso, o los dejamos sueltos (pero hay que limpiarlos).\n// Mejor los metemos en competenciaMarkersRef tambi칠n (aunque sean markers distintos).\ncompetenciaMarkersRef.current.push(guerraMarker);}}});// Polylines\nconst mainMarkersData=associatedData.filter(m=>m.Marcador_Principal==='Si');mainMarkersData.forEach(mainMarker=>{const markerWithCoords=searchArray.find(m=>m.id===mainMarker.id);if(!markerWithCoords)return;const mainLat=parseFloat(markerWithCoords.lat);const mainLng=parseFloat(markerWithCoords.lng);if(isNaN(mainLat)||isNaN(mainLng))return;const polyline=L.polyline([[parseFloat(lat),parseFloat(lng)],[mainLat,mainLng]],{color:'#FF6B6B',weight:3,opacity:0.8,dashArray:'5, 5'}).addTo(map);polylineRef.current.push(polyline);});setShowingAssociated(true);setActiveMercadoPbl(pbl);},[baseCompData,markers,markersForMercado,map,showingAssociated,activeMercadoPbl,clearCompetenciaMarkers,clearPolylines,clearGuerraMarkers]);useEffect(()=>{showAssociatedIdsRef.current=showAssociatedIds;},[showAssociatedIds]);// Helper para Guerra Marker\nconst addGuerraMarker=marker=>{if(marker.Guerra_Precio==='Si'){const guerraIcon=L.icon({iconUrl:\"\".concat(process.env.PUBLIC_URL,\"/iconos/calavera.jpg\"),iconSize:[15,15],iconAnchor:[7.5,7.5],className:'icono-guerra'});const guerraMarker=L.marker([marker.lat,marker.lng],{icon:guerraIcon,interactive:false});map.addLayer(guerraMarker);guerraMarkersRef.current[marker.id]=guerraMarker;}};// --- Crear Marcador con Popup React ---\nconst createMarkerWithPopup=useCallback(function(marker,allMarkers){let variant=arguments.length>2&&arguments[2]!==undefined?arguments[2]:'primary';const lat=parseFloat(marker.lat);const lng=parseFloat(marker.lng);if(isNaN(lat)||isNaN(lng))return null;const iconUrl=createCustomIcon(marker.Marca);const leafletMarker=L.marker([lat,lng],{icon:iconUrl});// Popup vac칤o inicial\nconst popup=L.popup({autoClose:false,closeOnClick:false,keepInView:true,autoPan:false,maxWidth:450,className:'custom-popup'}).setContent('<div id=\"popup-root-'+marker.id+'\"></div>');leafletMarker.bindPopup(popup);leafletMarker.on('popupopen',e=>{makeDraggable(popup);const container=e.popup._contentNode;const wrapperContainer=e.popup._container;if(wrapperContainer){crearGripEnWrapper(wrapperContainer);}setTimeout(()=>{const rootDiv=document.getElementById('popup-root-'+marker.id);if(rootDiv&&!rootDiv._reactRoot){const root=ReactDOM.createRoot(rootDiv);rootDiv._reactRoot=root;root.render(/*#__PURE__*/_jsx(MapPopup,{marker:marker,allMarkers:allMarkers,onShowAssociated:function(){return showAssociatedIdsRef.current&&showAssociatedIdsRef.current(...arguments);},onActivateCoords:function(){return handleActivateCoordsRef.current&&handleActivateCoordsRef.current(...arguments);},onSaveCoords:function(){return handleSaveCoordsRef.current&&handleSaveCoordsRef.current(...arguments);},modoCorreccion:modoCorreccionRef.current,variant:variant}));}},0);});leafletMarker.on('popupclose',e=>{var _e$popup;const container=(_e$popup=e.popup)===null||_e$popup===void 0?void 0:_e$popup._container;if(container){const wrapper=container.querySelector('.leaflet-popup-content-wrapper');const grip=wrapper===null||wrapper===void 0?void 0:wrapper.querySelector('.popup-resize-grip');if(grip&&grip._cleanup){grip._cleanup();}}const rootDiv=document.getElementById('popup-root-'+marker.id);if(rootDiv&&rootDiv._reactRoot){setTimeout(()=>{if(rootDiv._reactRoot){rootDiv._reactRoot.unmount();rootDiv._reactRoot=null;}},0);}});return leafletMarker;},[makeDraggable,crearGripEnWrapper]);// --- Efecto Principal de Renderizado ---\nuseEffect(()=>{if(!map||!markers||markers.length===0)return;// Si estamos mostrando asociados, no refrescamos todo (a menos que cambien los filtros dr치sticamente, \n// pero aqu칤 asumimos que si 'markers' cambia, reseteamos vista).\n// Para simplificar: si markers cambia, reseteamos todo.\nclearCompetenciaMarkers();clearPolylines();setShowingAssociated(false);setActiveMercadoPbl(null);Object.values(markersRef.current).forEach(marker=>{try{if(map&&map.hasLayer(marker))map.removeLayer(marker);}catch(e){}});markersRef.current={};clearGuerraMarkers();markers.forEach(marker=>{const leafletMarker=createMarkerWithPopup(marker,markersForMercado||markers,'primary');if(leafletMarker){map.addLayer(leafletMarker);markersRef.current[marker.id]=leafletMarker;addGuerraMarker(marker);}});if(markers.length===1&&markersRef.current[markers[0].id]){markersRef.current[markers[0].id].openPopup();}},[map,markers,markersForMercado,selectedRegion,clearCompetenciaMarkers,clearPolylines,clearGuerraMarkers,createMarkerWithPopup]);// --- Efecto para Click en Mapa (Correcci칩n Coordenadas) ---\nuseEffect(()=>{if(!map||!modoCorreccion)return;const handleMapClick=e=>{const{lat,lng}=e.latlng;setModoCorreccion(prev=>_objectSpread(_objectSpread({},prev),{},{lat,lng}));};map.on('click',handleMapClick);return()=>{map.off('click',handleMapClick);};},[map,modoCorreccion]);// --- Efecto para Actualizar Popups cuando cambia modoCorreccion ---\nuseEffect(()=>{if(!map)return;// Iterar sobre los popups abiertos y re-renderizarlos con el nuevo estado\nmap.eachLayer(layer=>{if(layer.getPopup&&layer.getPopup()&&layer.getPopup().isOpen()){const markerId=Object.keys(markersRef.current).find(key=>markersRef.current[key]===layer);if(markerId){const marker=markers.find(m=>m.id===markerId)||(markersForMercado||[]).find(m=>m.id===markerId);if(marker){const rootDiv=document.getElementById('popup-root-'+marker.id);if(rootDiv&&rootDiv._reactRoot){rootDiv._reactRoot.render(/*#__PURE__*/_jsx(MapPopup,{marker:marker,allMarkers:markersForMercado||markers,onShowAssociated:function(){return showAssociatedIdsRef.current&&showAssociatedIdsRef.current(...arguments);},onActivateCoords:function(){return handleActivateCoordsRef.current&&handleActivateCoordsRef.current(...arguments);},onSaveCoords:function(){return handleSaveCoordsRef.current&&handleSaveCoordsRef.current(...arguments);},modoCorreccion:modoCorreccion// Usamos el valor actual del estado\n,variant:markersForMercado&&markersForMercado.includes(marker)?'secondary':'primary'}));}}}}});},[modoCorreccion,map,markers,markersForMercado]);// Re-render open popups when markers data updates (auto-refresh)\nuseEffect(()=>{if(!map)return;map.eachLayer(layer=>{if(layer instanceof L.Marker&&layer.getPopup&&layer.getPopup()){const popup=layer.getPopup();if(popup.isOpen()){const markerData=layer.options.markerData;if(markerData&&markerData.pbl){// Find updated marker data\nconst updatedMarker=markers.find(m=>m.pbl===markerData.pbl);if(updatedMarker){var _popup$getElement;const rootDiv=(_popup$getElement=popup.getElement())===null||_popup$getElement===void 0?void 0:_popup$getElement.querySelector('.popup-root');if(rootDiv&&rootDiv._reactRoot){// Re-render with updated data\nrootDiv._reactRoot.render(/*#__PURE__*/_jsx(MapPopup,{marker:updatedMarker,allMarkers:markersForMercado||markers,onShowAssociated:function(){return showAssociatedIdsRef.current&&showAssociatedIdsRef.current(...arguments);},onActivateCoords:function(){return handleActivateCoordsRef.current&&handleActivateCoordsRef.current(...arguments);},onSaveCoords:function(){return handleSaveCoordsRef.current&&handleSaveCoordsRef.current(...arguments);},modoCorreccion:modoCorreccion,variant:markersForMercado&&markersForMercado.includes(updatedMarker)?'secondary':'primary'}));}}}}}});},[markers,map,markersForMercado,modoCorreccion]);return null;};export default IconMarkersLayer;","map":{"version":3,"names":["React","useEffect","useRef","useState","useCallback","useMap","L","ReactDOM","createCustomIcon","guardarCoordenadaCorregida","MapPopup","jsx","_jsx","IconMarkersLayer","_ref","_markers$","markers","markersForMercado","selectedRegion","baseCompData","map","markersRef","guerraMarkersRef","competenciaMarkersRef","polylineRef","console","log","markersCount","length","markersRefCount","Object","keys","current","firstMarkerComuna","Comuna","uniqueComunas","Set","m","showingAssociated","setShowingAssociated","activeMercadoPbl","setActiveMercadoPbl","modoCorreccion","setModoCorreccion","makeDraggable","popup","_container","pos","latLngToLayerPoint","getLatLng","DomUtil","setPosition","_wrapper","parentNode","draggable","Draggable","enable","error","crearGripEnWrapper","popupContainer","wrapper","querySelector","content","querySelectorAll","forEach","n","remove","handleWheel","e","preventDefault","scrollSpeed","scrollAmount","deltaY","scrollTop","addEventListener","passive","grip","document","createElement","className","appendChild","isResizing","startResize","body","classList","add","style","cursor","userSelect","stopPropagation","doResize","clientX","touches","clientY","gripRect","getBoundingClientRect","gripCenterX","left","width","gripCenterY","top","height","deltaX","Math","abs","currentRect","newWidth","max","newHeight","stopResize","cleanup","removeEventListener","_cleanup","clearCompetenciaMarkers","marker","hasLayer","removeLayer","clearPolylines","line","clearGuerraMarkers","values","handleActivateCoords","id","pbl","getContainer","eds","marca","Marca","lat","lng","handleSaveCoords","coordenada","comuna","lat_corregida","lon_corregida","leafletMarker","newLatLng","LatLng","setLatLng","showAssociatedIdsRef","handleActivateCoordsRef","handleSaveCoordsRef","modoCorreccionRef","showAssociatedIds","originalMarkerId","searchArray","associatedData","filter","item","String","trim","createMarkerWithPopup","addLayer","addGuerraMarker","ids","associatedMarkers","includes","uniqueAssociatedMarkers","seenIds","has","push","Guerra_Precio","guerraIcon","icon","iconUrl","concat","process","env","PUBLIC_URL","iconSize","iconAnchor","guerraMarker","interactive","mainMarkersData","Marcador_Principal","mainMarker","markerWithCoords","find","mainLat","parseFloat","mainLng","isNaN","polyline","color","weight","opacity","dashArray","addTo","allMarkers","variant","arguments","undefined","autoClose","closeOnClick","keepInView","autoPan","maxWidth","setContent","bindPopup","on","container","_contentNode","wrapperContainer","setTimeout","rootDiv","getElementById","_reactRoot","root","createRoot","render","onShowAssociated","onActivateCoords","onSaveCoords","_e$popup","unmount","openPopup","handleMapClick","latlng","prev","_objectSpread","off","eachLayer","layer","getPopup","isOpen","markerId","key","Marker","markerData","options","updatedMarker","_popup$getElement","getElement"],"sources":["C:/Users/e08f/Desktop/Proyectos/Resumen/mapa-v2/src/components/IconMarkersLayer.jsx"],"sourcesContent":["import React, { useEffect, useRef, useState, useCallback } from 'react';\r\nimport { useMap } from 'react-leaflet';\r\nimport L from 'leaflet';\r\nimport ReactDOM from 'react-dom/client';\r\nimport { createCustomIcon } from '../utils/iconHelpers';\r\nimport { guardarCoordenadaCorregida } from '../services/apiService';\r\nimport MapPopup from './MapPopup';\r\nimport '../styles/iconMarkersLayer.css';\r\n\r\nconst IconMarkersLayer = ({ markers, markersForMercado = null, selectedRegion, baseCompData = [] }) => {\r\n  const map = useMap();\r\n  const markersRef = useRef({});\r\n  const guerraMarkersRef = useRef({});\r\n  const competenciaMarkersRef = useRef([]);\r\n  const polylineRef = useRef([]);\r\n\r\n  console.log('游꿢 IconMarkersLayer RENDER:', {\r\n    markersCount: markers?.length,\r\n    markersRefCount: Object.keys(markersRef.current).length,\r\n    selectedRegion,\r\n    firstMarkerComuna: markers?.[0]?.Comuna,\r\n    uniqueComunas: [...new Set((markers || []).map(m => m.Comuna))]\r\n  });\r\n\r\n  const [showingAssociated, setShowingAssociated] = useState(false);\r\n  const [activeMercadoPbl, setActiveMercadoPbl] = useState(null);\r\n  const [modoCorreccion, setModoCorreccion] = useState(null);\r\n\r\n  // --- Helpers de UI (Draggable & Resize) ---\r\n  const makeDraggable = useCallback((popup) => {\r\n    if (!map || !popup || !popup._container) return;\r\n    try {\r\n      const pos = map.latLngToLayerPoint(popup.getLatLng());\r\n      L.DomUtil.setPosition(popup._wrapper.parentNode, pos);\r\n      const draggable = new L.Draggable(popup._container, popup._wrapper);\r\n      draggable.enable();\r\n    } catch (error) {\r\n      console.error('Error draggable:', error);\r\n    }\r\n  }, [map]);\r\n\r\n  const crearGripEnWrapper = useCallback((popupContainer) => {\r\n    const wrapper = popupContainer.querySelector('.leaflet-popup-content-wrapper');\r\n    const content = popupContainer.querySelector('.leaflet-popup-content');\r\n    if (!wrapper || !content) return;\r\n\r\n    content?.querySelectorAll('.popup-resize-grip').forEach(n => n.remove());\r\n\r\n    const handleWheel = (e) => {\r\n      e.preventDefault();\r\n      const scrollSpeed = 0.5;\r\n      const scrollAmount = e.deltaY * scrollSpeed;\r\n      content.scrollTop += scrollAmount;\r\n    };\r\n\r\n    content.addEventListener('wheel', handleWheel, { passive: false });\r\n\r\n    let grip = wrapper.querySelector('.popup-resize-grip');\r\n    if (!grip) {\r\n      grip = document.createElement('div');\r\n      grip.className = 'popup-resize-grip';\r\n      wrapper.appendChild(grip);\r\n\r\n      let isResizing = false;\r\n\r\n      const startResize = (e) => {\r\n        isResizing = true;\r\n        document.body.classList.add('is-resizing-popup');\r\n        document.body.style.cursor = 'nwse-resize';\r\n        document.body.style.userSelect = 'none';\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n      };\r\n\r\n      const doResize = (e) => {\r\n        if (!isResizing) return;\r\n\r\n        const clientX = e.clientX || (e.touches && e.touches[0].clientX);\r\n        const clientY = e.clientY || (e.touches && e.touches[0].clientY);\r\n\r\n        const gripRect = grip.getBoundingClientRect();\r\n        const gripCenterX = gripRect.left + gripRect.width / 2;\r\n        const gripCenterY = gripRect.top + gripRect.height / 2;\r\n\r\n        const deltaX = clientX - gripCenterX;\r\n        const deltaY = clientY - gripCenterY;\r\n\r\n        if (Math.abs(deltaX) > 5 || Math.abs(deltaY) > 5) {\r\n          const currentRect = content.getBoundingClientRect();\r\n          const newWidth = Math.max(240, currentRect.width + deltaX);\r\n          const newHeight = Math.max(180, currentRect.height + deltaY);\r\n\r\n          content.style.width = newWidth + 'px';\r\n          content.style.height = newHeight + 'px';\r\n        }\r\n\r\n        e.preventDefault();\r\n      };\r\n\r\n      const stopResize = () => {\r\n        if (!isResizing) return;\r\n        isResizing = false;\r\n        document.body.classList.remove('is-resizing-popup');\r\n        document.body.style.cursor = '';\r\n        document.body.style.userSelect = '';\r\n      };\r\n\r\n      grip.addEventListener('mousedown', startResize);\r\n      document.addEventListener('mousemove', doResize);\r\n      document.addEventListener('mouseup', stopResize);\r\n\r\n      grip.addEventListener('touchstart', startResize, { passive: false });\r\n      document.addEventListener('touchmove', doResize, { passive: false });\r\n      document.addEventListener('touchend', stopResize);\r\n\r\n      const cleanup = () => {\r\n        content.removeEventListener('wheel', handleWheel);\r\n        document.removeEventListener('mousemove', doResize);\r\n        document.removeEventListener('mouseup', stopResize);\r\n        document.removeEventListener('touchmove', doResize);\r\n        document.removeEventListener('touchend', stopResize);\r\n        document.body.classList.remove('is-resizing-popup');\r\n      };\r\n\r\n      grip._cleanup = cleanup;\r\n    }\r\n  }, []);\r\n\r\n  // --- Helpers de limpieza ---\r\n  const clearCompetenciaMarkers = useCallback(() => {\r\n    competenciaMarkersRef.current.forEach(marker => {\r\n      try { if (map && map.hasLayer(marker)) map.removeLayer(marker); } catch (e) { }\r\n    });\r\n    competenciaMarkersRef.current = [];\r\n  }, [map]);\r\n\r\n  const clearPolylines = useCallback(() => {\r\n    polylineRef.current.forEach(line => {\r\n      try { if (map && map.hasLayer(line)) map.removeLayer(line); } catch (e) { }\r\n    });\r\n    polylineRef.current = [];\r\n  }, [map]);\r\n\r\n  const clearGuerraMarkers = useCallback(() => {\r\n    Object.values(guerraMarkersRef.current).forEach(marker => {\r\n      try { if (map && map.hasLayer(marker)) map.removeLayer(marker); } catch (e) { }\r\n    });\r\n    guerraMarkersRef.current = {};\r\n  }, [map]);\r\n\r\n  // --- Handlers ---\r\n  const handleActivateCoords = useCallback((marker) => {\r\n    if (modoCorreccion && (modoCorreccion.id === marker.id || modoCorreccion.pbl === marker.pbl)) {\r\n      // Si ya est치 activo para este marcador, lo desactivamos (cancelar)\r\n      setModoCorreccion(null);\r\n      if (map) map.getContainer().style.cursor = '';\r\n      return;\r\n    }\r\n\r\n    if (map) map.getContainer().style.cursor = 'crosshair';\r\n    setModoCorreccion({\r\n      pbl: marker.pbl,\r\n      id: marker.id,\r\n      eds: marker.eds,\r\n      marca: marker.Marca,\r\n      lat: null,\r\n      lng: null\r\n    });\r\n  }, [map, modoCorreccion]);\r\n\r\n  const handleSaveCoords = useCallback(async (marker) => {\r\n    if (!modoCorreccion || !modoCorreccion.lat || !modoCorreccion.lng) return;\r\n\r\n    try {\r\n      const coordenada = {\r\n        id: marker.id || marker.pbl,\r\n        pbl: marker.pbl || marker.id,\r\n        eds: marker.eds || '',\r\n        marca: marker.Marca || '',\r\n        comuna: marker.Comuna || '',\r\n        lat_corregida: modoCorreccion.lat,\r\n        lon_corregida: modoCorreccion.lng\r\n      };\r\n      await guardarCoordenadaCorregida(coordenada);\r\n\r\n      // Actualizar marcador localmente\r\n      marker.lat = modoCorreccion.lat;\r\n      marker.lng = modoCorreccion.lng;\r\n\r\n      // Resetear modo correcci칩n\r\n      setModoCorreccion(null);\r\n      if (map) map.getContainer().style.cursor = '';\r\n\r\n      // Re-renderizar marcadores (esto forzar치 un update del efecto principal)\r\n      // Nota: En una app real, deber칤amos actualizar el estado 'markers' en el padre\r\n      // pero aqu칤 simulamos el refresco limpiando y dejando que el efecto corra.\r\n      // Para simplificar, forzamos un re-render limpiando refs (el efecto lo notar치 si markers cambia, \r\n      // pero como mutamos el objeto, necesitamos forzar update o confiar en que el padre refresque).\r\n      // Aqu칤 asumimos que el padre refrescar치 o que el efecto de abajo se encargar치 si cambiamos algo.\r\n      // Como mutamos 'marker', React no detecta cambio de prop 'markers' si es el mismo array.\r\n\r\n      // ACTUALIZACI칍N OPTIMIZADA: No borrar todo. Solo mover el marcador.\r\n      const leafletMarker = markersRef.current[marker.id];\r\n      if (leafletMarker) {\r\n        const newLatLng = new L.LatLng(modoCorreccion.lat, modoCorreccion.lng);\r\n        leafletMarker.setLatLng(newLatLng);\r\n\r\n        // Si el popup est치 abierto, Leaflet lo mueve con el marcador autom치ticamente.\r\n        // Pero necesitamos actualizar el contenido del popup para que refleje que ya no estamos en modo correcci칩n\r\n        // y muestre las nuevas coordenadas fijas.\r\n        // Esto se hace abajo con el re-render manual de popups.\r\n      }\r\n\r\n      // No borramos markersRef.current ni clearGuerraMarkers() para evitar parpadeo/cierre.\r\n      // Solo limpiamos si fuera necesario por l칩gica de negocio estricta, pero el usuario quiere que se mantenga.\r\n\r\n      // Disparamos un evento custom o callback si fuera necesario, \r\n      // por ahora confiamos en que el usuario recargue o que el efecto se dispare si cambiamos algo de estado.\r\n      // Un truco es setear un estado dummy para forzar re-render, pero mejor dejemos que el flujo siga.\r\n\r\n    } catch (error) {\r\n      console.error(\"Error guardando coordenadas:\", error);\r\n    }\r\n  }, [modoCorreccion, map, clearGuerraMarkers]);\r\n\r\n  // --- Refs para romper ciclo de dependencias ---\r\n  const showAssociatedIdsRef = useRef(null);\r\n  const handleActivateCoordsRef = useRef(handleActivateCoords);\r\n  const handleSaveCoordsRef = useRef(handleSaveCoords);\r\n  const modoCorreccionRef = useRef(modoCorreccion);\r\n\r\n  useEffect(() => {\r\n    handleActivateCoordsRef.current = handleActivateCoords;\r\n    handleSaveCoordsRef.current = handleSaveCoords;\r\n    modoCorreccionRef.current = modoCorreccion;\r\n  });\r\n\r\n\r\n  // --- L칩gica de Mercado (Show Associated) ---\r\n  const showAssociatedIds = useCallback((pbl, lat, lng, originalMarkerId) => {\r\n    const searchArray = markersForMercado && markersForMercado.length > 0 ? markersForMercado : markers;\r\n\r\n    // Toggle ON (o cambio de PBL)\r\n    // Definir associatedData aqu칤\r\n    const associatedData = baseCompData.filter(item => String(item.pbl).trim() === String(pbl).trim());\r\n\r\n    if (showingAssociated && activeMercadoPbl === pbl) {\r\n      // Toggle OFF\r\n      clearCompetenciaMarkers();\r\n      clearPolylines();\r\n      setShowingAssociated(false);\r\n      setActiveMercadoPbl(null);\r\n\r\n      // Restaurar marcadores originales\r\n      Object.values(markersRef.current).forEach(marker => {\r\n        try { if (map && map.hasLayer(marker)) map.removeLayer(marker); } catch (e) { }\r\n      });\r\n      markersRef.current = {};\r\n\r\n      // Re-crear todos\r\n      markers.forEach(marker => {\r\n        const leafletMarker = createMarkerWithPopup(marker, markersForMercado || markers, 'primary');\r\n        if (leafletMarker) {\r\n          map.addLayer(leafletMarker);\r\n          markersRef.current[marker.id] = leafletMarker;\r\n          addGuerraMarker(marker);\r\n        }\r\n      });\r\n      return;\r\n    }\r\n\r\n    // Si no hay datos asociados, no hacemos nada\r\n    if (associatedData.length === 0) return;\r\n\r\n    // Toggle ON\r\n    clearCompetenciaMarkers();\r\n    clearPolylines();\r\n\r\n    const ids = associatedData.map(item => item.id);\r\n\r\n    // Mostrar competencia\r\n    const associatedMarkers = searchArray.filter(item => ids.includes(item.id));\r\n    const uniqueAssociatedMarkers = [];\r\n    const seenIds = new Set();\r\n    associatedMarkers.forEach(marker => {\r\n      if (!seenIds.has(marker.id)) {\r\n        seenIds.add(marker.id);\r\n        uniqueAssociatedMarkers.push(marker);\r\n      }\r\n    });\r\n\r\n    uniqueAssociatedMarkers.forEach(marker => {\r\n      const leafletMarker = createMarkerWithPopup(marker, markersForMercado || baseCompData, 'secondary');\r\n      if (leafletMarker) {\r\n        map.addLayer(leafletMarker);\r\n        competenciaMarkersRef.current.push(leafletMarker);\r\n        if (marker.Guerra_Precio === 'Si') {\r\n          // Guerra marker logic for secondary\r\n          const guerraIcon = L.icon({\r\n            iconUrl: `${process.env.PUBLIC_URL}/iconos/calavera.jpg`,\r\n            iconSize: [15, 15],\r\n            iconAnchor: [7.5, 7.5],\r\n            className: 'icono-guerra'\r\n          });\r\n          const guerraMarker = L.marker([marker.lat, marker.lng], { icon: guerraIcon, interactive: false });\r\n          map.addLayer(guerraMarker);\r\n          // No lo guardamos en ref global para no borrarlo accidentalmente con clearGuerraMarkers si solo queremos borrar los principales, \r\n          // aunque aqu칤 borramos todo al cambiar de vista.\r\n          // Para simplificar, los agregamos a competenciaMarkersRef si queremos limpiarlos con eso, o los dejamos sueltos (pero hay que limpiarlos).\r\n          // Mejor los metemos en competenciaMarkersRef tambi칠n (aunque sean markers distintos).\r\n          competenciaMarkersRef.current.push(guerraMarker);\r\n        }\r\n      }\r\n    });\r\n\r\n    // Polylines\r\n    const mainMarkersData = associatedData.filter(m => m.Marcador_Principal === 'Si');\r\n    mainMarkersData.forEach(mainMarker => {\r\n      const markerWithCoords = searchArray.find(m => m.id === mainMarker.id);\r\n      if (!markerWithCoords) return;\r\n      const mainLat = parseFloat(markerWithCoords.lat);\r\n      const mainLng = parseFloat(markerWithCoords.lng);\r\n      if (isNaN(mainLat) || isNaN(mainLng)) return;\r\n\r\n      const polyline = L.polyline(\r\n        [[parseFloat(lat), parseFloat(lng)], [mainLat, mainLng]],\r\n        { color: '#FF6B6B', weight: 3, opacity: 0.8, dashArray: '5, 5' }\r\n      ).addTo(map);\r\n      polylineRef.current.push(polyline);\r\n    });\r\n\r\n    setShowingAssociated(true);\r\n    setActiveMercadoPbl(pbl);\r\n\r\n  }, [baseCompData, markers, markersForMercado, map, showingAssociated, activeMercadoPbl, clearCompetenciaMarkers, clearPolylines, clearGuerraMarkers]);\r\n\r\n  useEffect(() => {\r\n    showAssociatedIdsRef.current = showAssociatedIds;\r\n  }, [showAssociatedIds]);\r\n\r\n  // Helper para Guerra Marker\r\n  const addGuerraMarker = (marker) => {\r\n    if (marker.Guerra_Precio === 'Si') {\r\n      const guerraIcon = L.icon({\r\n        iconUrl: `${process.env.PUBLIC_URL}/iconos/calavera.jpg`,\r\n        iconSize: [15, 15],\r\n        iconAnchor: [7.5, 7.5],\r\n        className: 'icono-guerra'\r\n      });\r\n      const guerraMarker = L.marker([marker.lat, marker.lng], { icon: guerraIcon, interactive: false });\r\n      map.addLayer(guerraMarker);\r\n      guerraMarkersRef.current[marker.id] = guerraMarker;\r\n    }\r\n  };\r\n\r\n  // --- Crear Marcador con Popup React ---\r\n  const createMarkerWithPopup = useCallback((marker, allMarkers, variant = 'primary') => {\r\n    const lat = parseFloat(marker.lat);\r\n    const lng = parseFloat(marker.lng);\r\n    if (isNaN(lat) || isNaN(lng)) return null;\r\n\r\n    const iconUrl = createCustomIcon(marker.Marca);\r\n    const leafletMarker = L.marker([lat, lng], { icon: iconUrl });\r\n\r\n    // Popup vac칤o inicial\r\n    const popup = L.popup({\r\n      autoClose: false,\r\n      closeOnClick: false,\r\n      keepInView: true,\r\n      autoPan: false,\r\n      maxWidth: 450,\r\n      className: 'custom-popup'\r\n    }).setContent('<div id=\"popup-root-' + marker.id + '\"></div>');\r\n\r\n    leafletMarker.bindPopup(popup);\r\n\r\n    leafletMarker.on('popupopen', (e) => {\r\n      makeDraggable(popup);\r\n      const container = e.popup._contentNode;\r\n      const wrapperContainer = e.popup._container;\r\n      if (wrapperContainer) {\r\n        crearGripEnWrapper(wrapperContainer);\r\n      }\r\n\r\n      setTimeout(() => {\r\n        const rootDiv = document.getElementById('popup-root-' + marker.id);\r\n        if (rootDiv && !rootDiv._reactRoot) {\r\n          const root = ReactDOM.createRoot(rootDiv);\r\n          rootDiv._reactRoot = root;\r\n          root.render(\r\n            <MapPopup\r\n              marker={marker}\r\n              allMarkers={allMarkers}\r\n              onShowAssociated={(...args) => showAssociatedIdsRef.current && showAssociatedIdsRef.current(...args)}\r\n              onActivateCoords={(...args) => handleActivateCoordsRef.current && handleActivateCoordsRef.current(...args)}\r\n              onSaveCoords={(...args) => handleSaveCoordsRef.current && handleSaveCoordsRef.current(...args)}\r\n              modoCorreccion={modoCorreccionRef.current}\r\n              variant={variant}\r\n            />\r\n          );\r\n        }\r\n      }, 0);\r\n    });\r\n\r\n    leafletMarker.on('popupclose', (e) => {\r\n      const container = e.popup?._container;\r\n      if (container) {\r\n        const wrapper = container.querySelector('.leaflet-popup-content-wrapper');\r\n        const grip = wrapper?.querySelector('.popup-resize-grip');\r\n        if (grip && grip._cleanup) {\r\n          grip._cleanup();\r\n        }\r\n      }\r\n\r\n      const rootDiv = document.getElementById('popup-root-' + marker.id);\r\n      if (rootDiv && rootDiv._reactRoot) {\r\n        setTimeout(() => {\r\n          if (rootDiv._reactRoot) {\r\n            rootDiv._reactRoot.unmount();\r\n            rootDiv._reactRoot = null;\r\n          }\r\n        }, 0);\r\n      }\r\n    });\r\n\r\n    return leafletMarker;\r\n  }, [makeDraggable, crearGripEnWrapper]);\r\n\r\n\r\n  // --- Efecto Principal de Renderizado ---\r\n  useEffect(() => {\r\n    if (!map || !markers || markers.length === 0) return;\r\n\r\n    // Si estamos mostrando asociados, no refrescamos todo (a menos que cambien los filtros dr치sticamente, \r\n    // pero aqu칤 asumimos que si 'markers' cambia, reseteamos vista).\r\n    // Para simplificar: si markers cambia, reseteamos todo.\r\n\r\n    clearCompetenciaMarkers();\r\n    clearPolylines();\r\n    setShowingAssociated(false);\r\n    setActiveMercadoPbl(null);\r\n\r\n    Object.values(markersRef.current).forEach(marker => {\r\n      try { if (map && map.hasLayer(marker)) map.removeLayer(marker); } catch (e) { }\r\n    });\r\n    markersRef.current = {};\r\n    clearGuerraMarkers();\r\n\r\n    markers.forEach(marker => {\r\n      const leafletMarker = createMarkerWithPopup(\r\n        marker,\r\n        markersForMercado || markers,\r\n        'primary'\r\n      );\r\n      if (leafletMarker) {\r\n        map.addLayer(leafletMarker);\r\n        markersRef.current[marker.id] = leafletMarker;\r\n        addGuerraMarker(marker);\r\n      }\r\n    });\r\n\r\n    if (markers.length === 1 && markersRef.current[markers[0].id]) {\r\n      markersRef.current[markers[0].id].openPopup();\r\n    }\r\n\r\n  }, [map, markers, markersForMercado, selectedRegion, clearCompetenciaMarkers, clearPolylines, clearGuerraMarkers, createMarkerWithPopup]);\r\n\r\n\r\n  // --- Efecto para Click en Mapa (Correcci칩n Coordenadas) ---\r\n  useEffect(() => {\r\n    if (!map || !modoCorreccion) return;\r\n\r\n    const handleMapClick = (e) => {\r\n      const { lat, lng } = e.latlng;\r\n      setModoCorreccion(prev => ({ ...prev, lat, lng }));\r\n    };\r\n\r\n    map.on('click', handleMapClick);\r\n    return () => { map.off('click', handleMapClick); };\r\n  }, [map, modoCorreccion]);\r\n\r\n  // --- Efecto para Actualizar Popups cuando cambia modoCorreccion ---\r\n  useEffect(() => {\r\n    if (!map) return;\r\n\r\n    // Iterar sobre los popups abiertos y re-renderizarlos con el nuevo estado\r\n    map.eachLayer(layer => {\r\n      if (layer.getPopup && layer.getPopup() && layer.getPopup().isOpen()) {\r\n        const markerId = Object.keys(markersRef.current).find(key => markersRef.current[key] === layer);\r\n        if (markerId) {\r\n          const marker = markers.find(m => m.id === markerId) || (markersForMercado || []).find(m => m.id === markerId);\r\n          if (marker) {\r\n            const rootDiv = document.getElementById('popup-root-' + marker.id);\r\n            if (rootDiv && rootDiv._reactRoot) {\r\n              rootDiv._reactRoot.render(\r\n                <MapPopup\r\n                  marker={marker}\r\n                  allMarkers={markersForMercado || markers}\r\n                  onShowAssociated={(...args) => showAssociatedIdsRef.current && showAssociatedIdsRef.current(...args)}\r\n                  onActivateCoords={(...args) => handleActivateCoordsRef.current && handleActivateCoordsRef.current(...args)}\r\n                  onSaveCoords={(...args) => handleSaveCoordsRef.current && handleSaveCoordsRef.current(...args)}\r\n                  modoCorreccion={modoCorreccion} // Usamos el valor actual del estado\r\n                  variant={markersForMercado && markersForMercado.includes(marker) ? 'secondary' : 'primary'}\r\n                />\r\n              );\r\n            }\r\n          }\r\n        }\r\n      }\r\n    });\r\n  }, [modoCorreccion, map, markers, markersForMercado]);\r\n\r\n  // Re-render open popups when markers data updates (auto-refresh)\r\n  useEffect(() => {\r\n    if (!map) return;\r\n\r\n    map.eachLayer((layer) => {\r\n      if (layer instanceof L.Marker && layer.getPopup && layer.getPopup()) {\r\n        const popup = layer.getPopup();\r\n        if (popup.isOpen()) {\r\n          const markerData = layer.options.markerData;\r\n          if (markerData && markerData.pbl) {\r\n            // Find updated marker data\r\n            const updatedMarker = markers.find(m => m.pbl === markerData.pbl);\r\n            if (updatedMarker) {\r\n              const rootDiv = popup.getElement()?.querySelector('.popup-root');\r\n              if (rootDiv && rootDiv._reactRoot) {\r\n                // Re-render with updated data\r\n                rootDiv._reactRoot.render(\r\n                  <MapPopup\r\n                    marker={updatedMarker}\r\n                    allMarkers={markersForMercado || markers}\r\n                    onShowAssociated={(...args) => showAssociatedIdsRef.current && showAssociatedIdsRef.current(...args)}\r\n                    onActivateCoords={(...args) => handleActivateCoordsRef.current && handleActivateCoordsRef.current(...args)}\r\n                    onSaveCoords={(...args) => handleSaveCoordsRef.current && handleSaveCoordsRef.current(...args)}\r\n                    modoCorreccion={modoCorreccion}\r\n                    variant={markersForMercado && markersForMercado.includes(updatedMarker) ? 'secondary' : 'primary'}\r\n                  />\r\n                );\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    });\r\n  }, [markers, map, markersForMercado, modoCorreccion]);\r\n\r\n\r\n  return null;\r\n};\r\n\r\nexport default IconMarkersLayer;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}