{"ast":null,"code":"import _objectSpread from\"C:/Users/e08f/Desktop/Proyectos/Resumen/mapa-v2/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useEffect,useRef,useState,useCallback}from'react';import{useMap}from'react-leaflet';import L from'leaflet';import ReactDOM from'react-dom/client';import{createCustomIcon}from'../utils/iconHelpers';import{guardarCoordenadaCorregida}from'../services/apiService';import MapPopup from'./MapPopup';import'../styles/iconMarkersLayer.css';import{jsx as _jsx}from\"react/jsx-runtime\";const IconMarkersLayer=_ref=>{let{markers,markersForMercado=null,selectedRegion,baseCompData=[]}=_ref;const map=useMap();const markersRef=useRef({});const guerraMarkersRef=useRef({});const competenciaMarkersRef=useRef([]);const polylineRef=useRef([]);const[showingAssociated,setShowingAssociated]=useState(false);const[activeMercadoPbl,setActiveMercadoPbl]=useState(null);const[modoCorreccion,setModoCorreccion]=useState(null);// --- Helpers de limpieza ---\nconst clearCompetenciaMarkers=useCallback(()=>{competenciaMarkersRef.current.forEach(marker=>{try{if(map&&map.hasLayer(marker))map.removeLayer(marker);}catch(e){}});competenciaMarkersRef.current=[];},[map]);const clearPolylines=useCallback(()=>{polylineRef.current.forEach(line=>{try{if(map&&map.hasLayer(line))map.removeLayer(line);}catch(e){}});polylineRef.current=[];},[map]);const clearGuerraMarkers=useCallback(()=>{Object.values(guerraMarkersRef.current).forEach(marker=>{try{if(map&&map.hasLayer(marker))map.removeLayer(marker);}catch(e){}});guerraMarkersRef.current={};},[map]);// --- Handlers ---\nconst handleActivateCoords=useCallback(marker=>{if(map)map.getContainer().style.cursor='crosshair';setModoCorreccion({pbl:marker.pbl,id:marker.id,eds:marker.eds,marca:marker.Marca,lat:null,lng:null});},[map]);const handleSaveCoords=useCallback(async marker=>{if(!modoCorreccion||!modoCorreccion.lat||!modoCorreccion.lng)return;try{const coordenada={id:marker.id||marker.pbl,pbl:marker.pbl||marker.id,eds:marker.eds||'',marca:marker.Marca||'',comuna:marker.Comuna||'',lat_corregida:modoCorreccion.lat,lon_corregida:modoCorreccion.lng};await guardarCoordenadaCorregida(coordenada);// Actualizar marcador localmente\nmarker.lat=modoCorreccion.lat;marker.lng=modoCorreccion.lng;// Resetear modo corrección\nsetModoCorreccion(null);if(map)map.getContainer().style.cursor='';// Re-renderizar marcadores (esto forzará un update del efecto principal)\n// Nota: En una app real, deberíamos actualizar el estado 'markers' en el padre\n// pero aquí simulamos el refresco limpiando y dejando que el efecto corra.\n// Para simplificar, forzamos un re-render limpiando refs (el efecto lo notará si markers cambia, \n// pero como mutamos el objeto, necesitamos forzar update o confiar en que el padre refresque).\n// Aquí asumimos que el padre refrescará o que el efecto de abajo se encargará si cambiamos algo.\n// Como mutamos 'marker', React no detecta cambio de prop 'markers' si es el mismo array.\n// Forzamos limpieza manual y re-creación:\nObject.values(markersRef.current).forEach(m=>{if(map.hasLayer(m))map.removeLayer(m);});markersRef.current={};clearGuerraMarkers();// Disparamos un evento custom o callback si fuera necesario, \n// por ahora confiamos en que el usuario recargue o que el efecto se dispare si cambiamos algo de estado.\n// Un truco es setear un estado dummy para forzar re-render, pero mejor dejemos que el flujo siga.\n}catch(error){console.error(\"Error guardando coordenadas:\",error);}},[modoCorreccion,map,clearGuerraMarkers]);// --- Lógica de Mercado (Show Associated) ---\nconst showAssociatedIds=useCallback((pbl,lat,lng,originalMarkerId)=>{const searchArray=markersForMercado&&markersForMercado.length>0?markersForMercado:markers;if(showingAssociated&&activeMercadoPbl===pbl){// Toggle OFF\nclearCompetenciaMarkers();clearPolylines();setShowingAssociated(false);setActiveMercadoPbl(null);// Restaurar marcadores originales\nObject.values(markersRef.current).forEach(marker=>{try{if(map&&map.hasLayer(marker))map.removeLayer(marker);}catch(e){}});markersRef.current={};// Re-crear todos\nmarkers.forEach(marker=>{const leafletMarker=createMarkerWithPopup(marker,markersForMercado||markers,'primary');if(leafletMarker){map.addLayer(leafletMarker);markersRef.current[marker.id]=leafletMarker;addGuerraMarker(marker);}});return;}// Toggle ON (o cambio de PBL)\nclearCompetenciaMarkers();clearPolylines();const associatedData=baseCompData.filter(item=>String(item.pbl).trim()===String(pbl).trim());if(associatedData.length===0)return;const ids=associatedData.map(item=>item.id);// Limpiar actuales\nObject.values(markersRef.current).forEach(marker=>{try{if(map&&map.hasLayer(marker))map.removeLayer(marker);}catch(e){}});markersRef.current={};clearGuerraMarkers();// Mostrar original\nconst originalMarker=markers.find(m=>m.id===originalMarkerId);if(originalMarker){const leafletMarker=createMarkerWithPopup(originalMarker,markersForMercado||markers,'primary');if(leafletMarker){map.addLayer(leafletMarker);markersRef.current[originalMarker.id]=leafletMarker;addGuerraMarker(originalMarker);}}// Mostrar competencia\nconst associatedMarkers=searchArray.filter(item=>ids.includes(item.id));const uniqueAssociatedMarkers=[];const seenIds=new Set();associatedMarkers.forEach(marker=>{if(!seenIds.has(marker.id)){seenIds.add(marker.id);uniqueAssociatedMarkers.push(marker);}});uniqueAssociatedMarkers.forEach(marker=>{const leafletMarker=createMarkerWithPopup(marker,markersForMercado||baseCompData,'secondary');if(leafletMarker){map.addLayer(leafletMarker);competenciaMarkersRef.current.push(leafletMarker);if(marker.Guerra_Precio==='Si'){// Guerra marker logic for secondary\nconst guerraIcon=L.icon({iconUrl:\"\".concat(process.env.PUBLIC_URL,\"/iconos/calavera.jpg\"),iconSize:[15,15],iconAnchor:[7.5,7.5],className:'icono-guerra'});const guerraMarker=L.marker([marker.lat,marker.lng],{icon:guerraIcon,interactive:false});map.addLayer(guerraMarker);// No lo guardamos en ref global para no borrarlo accidentalmente con clearGuerraMarkers si solo queremos borrar los principales, \n// aunque aquí borramos todo al cambiar de vista.\n// Para simplificar, los agregamos a competenciaMarkersRef si queremos limpiarlos con eso, o los dejamos sueltos (pero hay que limpiarlos).\n// Mejor los metemos en competenciaMarkersRef también (aunque sean markers distintos).\ncompetenciaMarkersRef.current.push(guerraMarker);}}});// Polylines\nconst mainMarkersData=associatedData.filter(m=>m.Marcador_Principal==='Si');mainMarkersData.forEach(mainMarker=>{const markerWithCoords=searchArray.find(m=>m.id===mainMarker.id);if(!markerWithCoords)return;const mainLat=parseFloat(markerWithCoords.lat);const mainLng=parseFloat(markerWithCoords.lng);if(isNaN(mainLat)||isNaN(mainLng))return;const polyline=L.polyline([[parseFloat(lat),parseFloat(lng)],[mainLat,mainLng]],{color:'#FF6B6B',weight:3,opacity:0.8,dashArray:'5, 5'}).addTo(map);polylineRef.current.push(polyline);});setShowingAssociated(true);setActiveMercadoPbl(pbl);},[baseCompData,markers,markersForMercado,map,showingAssociated,activeMercadoPbl,clearCompetenciaMarkers,clearPolylines,clearGuerraMarkers]);// createMarkerWithPopup is defined below, using ref to avoid circular dep or hoisting issues if possible, or just define it before.\n// Helper para Guerra Marker\nconst addGuerraMarker=marker=>{if(marker.Guerra_Precio==='Si'){const guerraIcon=L.icon({iconUrl:\"\".concat(process.env.PUBLIC_URL,\"/iconos/calavera.jpg\"),iconSize:[15,15],iconAnchor:[7.5,7.5],className:'icono-guerra'});const guerraMarker=L.marker([marker.lat,marker.lng],{icon:guerraIcon,interactive:false});map.addLayer(guerraMarker);guerraMarkersRef.current[marker.id]=guerraMarker;}};// --- Crear Marcador con Popup React ---\nconst createMarkerWithPopup=useCallback(function(marker,allMarkers){let variant=arguments.length>2&&arguments[2]!==undefined?arguments[2]:'primary';const lat=parseFloat(marker.lat);const lng=parseFloat(marker.lng);if(isNaN(lat)||isNaN(lng))return null;const iconUrl=createCustomIcon(marker.Marca);const leafletMarker=L.marker([lat,lng],{icon:iconUrl});// Popup vacío inicial\nconst popup=L.popup({autoClose:false,closeOnClick:false,keepInView:true,autoPan:false,maxWidth:450,className:'custom-popup'}).setContent('<div id=\"popup-root-'+marker.id+'\"></div>');leafletMarker.bindPopup(popup);// Renderizar React en el Popup al abrir\nleafletMarker.on('popupopen',e=>{const container=e.popup._contentNode;// o _container\n// Buscar el div root que pusimos\n// Nota: Leaflet a veces envuelve el contenido.\n// Mejor estrategia: usar el contenido del popup como container.\n// Esperamos un tick para asegurar que el DOM existe\nsetTimeout(()=>{const rootDiv=document.getElementById('popup-root-'+marker.id);if(rootDiv&&!rootDiv._reactRoot){const root=ReactDOM.createRoot(rootDiv);rootDiv._reactRoot=root;root.render(/*#__PURE__*/_jsx(MapPopup,{marker:marker,allMarkers:allMarkers,onShowAssociated:showAssociatedIds,onActivateCoords:handleActivateCoords,onSaveCoords:handleSaveCoords,modoCorreccion:modoCorreccion}));}},0);});leafletMarker.on('popupclose',e=>{const rootDiv=document.getElementById('popup-root-'+marker.id);if(rootDiv&&rootDiv._reactRoot){// Desmontar para evitar leaks\n// rootDiv._reactRoot.unmount(); // A veces da problemas si se cierra muy rápido, pero es buena práctica.\n// Dejamos que React maneje la limpieza si es posible, o unmount explícito.\nsetTimeout(()=>{if(rootDiv._reactRoot){rootDiv._reactRoot.unmount();rootDiv._reactRoot=null;}},0);}});return leafletMarker;},[showAssociatedIds,handleActivateCoords,handleSaveCoords,modoCorreccion]);// --- Efecto Principal de Renderizado ---\nuseEffect(()=>{if(!map||!markers||markers.length===0)return;// Si estamos mostrando asociados, no refrescamos todo (a menos que cambien los filtros drásticamente, \n// pero aquí asumimos que si 'markers' cambia, reseteamos vista).\n// Para simplificar: si markers cambia, reseteamos todo.\nclearCompetenciaMarkers();clearPolylines();setShowingAssociated(false);setActiveMercadoPbl(null);Object.values(markersRef.current).forEach(marker=>{try{if(map&&map.hasLayer(marker))map.removeLayer(marker);}catch(e){}});markersRef.current={};clearGuerraMarkers();markers.forEach(marker=>{const leafletMarker=createMarkerWithPopup(marker,markersForMercado||markers,'primary');if(leafletMarker){map.addLayer(leafletMarker);markersRef.current[marker.id]=leafletMarker;addGuerraMarker(marker);}});if(markers.length===1&&markersRef.current[markers[0].id]){markersRef.current[markers[0].id].openPopup();}},[map,markers,markersForMercado,selectedRegion,clearCompetenciaMarkers,clearPolylines,clearGuerraMarkers,createMarkerWithPopup]);// --- Efecto para Click en Mapa (Corrección Coordenadas) ---\nuseEffect(()=>{if(!map||!modoCorreccion)return;const handleMapClick=e=>{const{lat,lng}=e.latlng;setModoCorreccion(prev=>_objectSpread(_objectSpread({},prev),{},{lat,lng}));// Actualizar UI del popup si está abierto?\n// Como el popup se renderiza con 'modoCorreccion' como prop, \n// necesitamos que se re-renderice.\n// Al cambiar el estado 'modoCorreccion', el componente IconMarkersLayer se re-renderiza.\n// Pero los popups ya abiertos son árboles de React independientes montados en nodos DOM.\n// NO se actualizarán automáticamente con las nuevas props porque createMarkerWithPopup se recrea\n// pero los popups ya montados no reciben las nuevas props a menos que los actualicemos explícitamente.\n// SOLUCIÓN: Cerrar y abrir popup es brusco.\n// Mejor: Usar un Context o un Store simple, o forzar update.\n// Dado que 'createMarkerWithPopup' depende de 'modoCorreccion', \n// cuando 'modoCorreccion' cambia, la función cambia.\n// Pero los markers ya están en el mapa.\n// Para esta refactorización rápida, podemos aceptar que el usuario cierre y abra, \n// O intentar actualizar el popup activo.\n// Lo más simple y robusto en React-Leaflet \"vanilla\" es difícil.\n// Sin embargo, como MapPopup es hijo de IconMarkersLayer (indirectamente), \n// NO lo es. Es un árbol nuevo.\n// TRUCO: Disparar un evento custom que MapPopup escuche, o usar un ref mutable.\n// O simplemente re-renderizar el contenido del popup activo.\n// Vamos a iterar sobre los popups abiertos y re-renderizarlos.\nmap.eachLayer(layer=>{if(layer.getPopup&&layer.getPopup()&&layer.getPopup().isOpen()){const markerId=Object.keys(markersRef.current).find(key=>markersRef.current[key]===layer);if(markerId){const marker=markers.find(m=>m.id===markerId)||(markersForMercado||[]).find(m=>m.id===markerId);if(marker){const rootDiv=document.getElementById('popup-root-'+marker.id);if(rootDiv&&rootDiv._reactRoot){rootDiv._reactRoot.render(/*#__PURE__*/_jsx(MapPopup,{marker:marker,allMarkers:markersForMercado||markers,onShowAssociated:showAssociatedIds,onActivateCoords:handleActivateCoords,onSaveCoords:handleSaveCoords,modoCorreccion:_objectSpread(_objectSpread({},modoCorreccion),{},{lat,lng})// Pasamos el nuevo valor\n}));}}}}});};map.on('click',handleMapClick);return()=>{map.off('click',handleMapClick);};},[map,modoCorreccion,markers,markersForMercado,showAssociatedIds,handleActivateCoords,handleSaveCoords]);return null;};export default IconMarkersLayer;","map":{"version":3,"names":["React","useEffect","useRef","useState","useCallback","useMap","L","ReactDOM","createCustomIcon","guardarCoordenadaCorregida","MapPopup","jsx","_jsx","IconMarkersLayer","_ref","markers","markersForMercado","selectedRegion","baseCompData","map","markersRef","guerraMarkersRef","competenciaMarkersRef","polylineRef","showingAssociated","setShowingAssociated","activeMercadoPbl","setActiveMercadoPbl","modoCorreccion","setModoCorreccion","clearCompetenciaMarkers","current","forEach","marker","hasLayer","removeLayer","e","clearPolylines","line","clearGuerraMarkers","Object","values","handleActivateCoords","getContainer","style","cursor","pbl","id","eds","marca","Marca","lat","lng","handleSaveCoords","coordenada","comuna","Comuna","lat_corregida","lon_corregida","m","error","console","showAssociatedIds","originalMarkerId","searchArray","length","leafletMarker","createMarkerWithPopup","addLayer","addGuerraMarker","associatedData","filter","item","String","trim","ids","originalMarker","find","associatedMarkers","includes","uniqueAssociatedMarkers","seenIds","Set","has","add","push","Guerra_Precio","guerraIcon","icon","iconUrl","concat","process","env","PUBLIC_URL","iconSize","iconAnchor","className","guerraMarker","interactive","mainMarkersData","Marcador_Principal","mainMarker","markerWithCoords","mainLat","parseFloat","mainLng","isNaN","polyline","color","weight","opacity","dashArray","addTo","allMarkers","variant","arguments","undefined","popup","autoClose","closeOnClick","keepInView","autoPan","maxWidth","setContent","bindPopup","on","container","_contentNode","setTimeout","rootDiv","document","getElementById","_reactRoot","root","createRoot","render","onShowAssociated","onActivateCoords","onSaveCoords","unmount","openPopup","handleMapClick","latlng","prev","_objectSpread","eachLayer","layer","getPopup","isOpen","markerId","keys","key","off"],"sources":["C:/Users/e08f/Desktop/Proyectos/Resumen/mapa-v2/src/components/IconMarkersLayer.jsx"],"sourcesContent":["import React, { useEffect, useRef, useState, useCallback } from 'react';\r\nimport { useMap } from 'react-leaflet';\r\nimport L from 'leaflet';\r\nimport ReactDOM from 'react-dom/client';\r\nimport { createCustomIcon } from '../utils/iconHelpers';\r\nimport { guardarCoordenadaCorregida } from '../services/apiService';\r\nimport MapPopup from './MapPopup';\r\nimport '../styles/iconMarkersLayer.css';\r\n\r\nconst IconMarkersLayer = ({ markers, markersForMercado = null, selectedRegion, baseCompData = [] }) => {\r\n  const map = useMap();\r\n  const markersRef = useRef({});\r\n  const guerraMarkersRef = useRef({});\r\n  const competenciaMarkersRef = useRef([]);\r\n  const polylineRef = useRef([]);\r\n\r\n  const [showingAssociated, setShowingAssociated] = useState(false);\r\n  const [activeMercadoPbl, setActiveMercadoPbl] = useState(null);\r\n  const [modoCorreccion, setModoCorreccion] = useState(null);\r\n\r\n  // --- Helpers de limpieza ---\r\n  const clearCompetenciaMarkers = useCallback(() => {\r\n    competenciaMarkersRef.current.forEach(marker => {\r\n      try { if (map && map.hasLayer(marker)) map.removeLayer(marker); } catch (e) { }\r\n    });\r\n    competenciaMarkersRef.current = [];\r\n  }, [map]);\r\n\r\n  const clearPolylines = useCallback(() => {\r\n    polylineRef.current.forEach(line => {\r\n      try { if (map && map.hasLayer(line)) map.removeLayer(line); } catch (e) { }\r\n    });\r\n    polylineRef.current = [];\r\n  }, [map]);\r\n\r\n  const clearGuerraMarkers = useCallback(() => {\r\n    Object.values(guerraMarkersRef.current).forEach(marker => {\r\n      try { if (map && map.hasLayer(marker)) map.removeLayer(marker); } catch (e) { }\r\n    });\r\n    guerraMarkersRef.current = {};\r\n  }, [map]);\r\n\r\n  // --- Handlers ---\r\n  const handleActivateCoords = useCallback((marker) => {\r\n    if (map) map.getContainer().style.cursor = 'crosshair';\r\n    setModoCorreccion({\r\n      pbl: marker.pbl,\r\n      id: marker.id,\r\n      eds: marker.eds,\r\n      marca: marker.Marca,\r\n      lat: null,\r\n      lng: null\r\n    });\r\n  }, [map]);\r\n\r\n  const handleSaveCoords = useCallback(async (marker) => {\r\n    if (!modoCorreccion || !modoCorreccion.lat || !modoCorreccion.lng) return;\r\n\r\n    try {\r\n      const coordenada = {\r\n        id: marker.id || marker.pbl,\r\n        pbl: marker.pbl || marker.id,\r\n        eds: marker.eds || '',\r\n        marca: marker.Marca || '',\r\n        comuna: marker.Comuna || '',\r\n        lat_corregida: modoCorreccion.lat,\r\n        lon_corregida: modoCorreccion.lng\r\n      };\r\n      await guardarCoordenadaCorregida(coordenada);\r\n\r\n      // Actualizar marcador localmente\r\n      marker.lat = modoCorreccion.lat;\r\n      marker.lng = modoCorreccion.lng;\r\n\r\n      // Resetear modo corrección\r\n      setModoCorreccion(null);\r\n      if (map) map.getContainer().style.cursor = '';\r\n\r\n      // Re-renderizar marcadores (esto forzará un update del efecto principal)\r\n      // Nota: En una app real, deberíamos actualizar el estado 'markers' en el padre\r\n      // pero aquí simulamos el refresco limpiando y dejando que el efecto corra.\r\n      // Para simplificar, forzamos un re-render limpiando refs (el efecto lo notará si markers cambia, \r\n      // pero como mutamos el objeto, necesitamos forzar update o confiar en que el padre refresque).\r\n      // Aquí asumimos que el padre refrescará o que el efecto de abajo se encargará si cambiamos algo.\r\n      // Como mutamos 'marker', React no detecta cambio de prop 'markers' si es el mismo array.\r\n      // Forzamos limpieza manual y re-creación:\r\n      Object.values(markersRef.current).forEach(m => {\r\n        if (map.hasLayer(m)) map.removeLayer(m);\r\n      });\r\n      markersRef.current = {};\r\n      clearGuerraMarkers();\r\n\r\n      // Disparamos un evento custom o callback si fuera necesario, \r\n      // por ahora confiamos en que el usuario recargue o que el efecto se dispare si cambiamos algo de estado.\r\n      // Un truco es setear un estado dummy para forzar re-render, pero mejor dejemos que el flujo siga.\r\n\r\n    } catch (error) {\r\n      console.error(\"Error guardando coordenadas:\", error);\r\n    }\r\n  }, [modoCorreccion, map, clearGuerraMarkers]);\r\n\r\n\r\n  // --- Lógica de Mercado (Show Associated) ---\r\n  const showAssociatedIds = useCallback((pbl, lat, lng, originalMarkerId) => {\r\n    const searchArray = markersForMercado && markersForMercado.length > 0 ? markersForMercado : markers;\r\n\r\n    if (showingAssociated && activeMercadoPbl === pbl) {\r\n      // Toggle OFF\r\n      clearCompetenciaMarkers();\r\n      clearPolylines();\r\n      setShowingAssociated(false);\r\n      setActiveMercadoPbl(null);\r\n\r\n      // Restaurar marcadores originales\r\n      Object.values(markersRef.current).forEach(marker => {\r\n        try { if (map && map.hasLayer(marker)) map.removeLayer(marker); } catch (e) { }\r\n      });\r\n      markersRef.current = {};\r\n\r\n      // Re-crear todos\r\n      markers.forEach(marker => {\r\n        const leafletMarker = createMarkerWithPopup(marker, markersForMercado || markers, 'primary');\r\n        if (leafletMarker) {\r\n          map.addLayer(leafletMarker);\r\n          markersRef.current[marker.id] = leafletMarker;\r\n          addGuerraMarker(marker);\r\n        }\r\n      });\r\n      return;\r\n    }\r\n\r\n    // Toggle ON (o cambio de PBL)\r\n    clearCompetenciaMarkers();\r\n    clearPolylines();\r\n\r\n    const associatedData = baseCompData.filter(item => String(item.pbl).trim() === String(pbl).trim());\r\n    if (associatedData.length === 0) return;\r\n\r\n    const ids = associatedData.map(item => item.id);\r\n\r\n    // Limpiar actuales\r\n    Object.values(markersRef.current).forEach(marker => {\r\n      try { if (map && map.hasLayer(marker)) map.removeLayer(marker); } catch (e) { }\r\n    });\r\n    markersRef.current = {};\r\n    clearGuerraMarkers();\r\n\r\n    // Mostrar original\r\n    const originalMarker = markers.find(m => m.id === originalMarkerId);\r\n    if (originalMarker) {\r\n      const leafletMarker = createMarkerWithPopup(originalMarker, markersForMercado || markers, 'primary');\r\n      if (leafletMarker) {\r\n        map.addLayer(leafletMarker);\r\n        markersRef.current[originalMarker.id] = leafletMarker;\r\n        addGuerraMarker(originalMarker);\r\n      }\r\n    }\r\n\r\n    // Mostrar competencia\r\n    const associatedMarkers = searchArray.filter(item => ids.includes(item.id));\r\n    const uniqueAssociatedMarkers = [];\r\n    const seenIds = new Set();\r\n    associatedMarkers.forEach(marker => {\r\n      if (!seenIds.has(marker.id)) {\r\n        seenIds.add(marker.id);\r\n        uniqueAssociatedMarkers.push(marker);\r\n      }\r\n    });\r\n\r\n    uniqueAssociatedMarkers.forEach(marker => {\r\n      const leafletMarker = createMarkerWithPopup(marker, markersForMercado || baseCompData, 'secondary');\r\n      if (leafletMarker) {\r\n        map.addLayer(leafletMarker);\r\n        competenciaMarkersRef.current.push(leafletMarker);\r\n        if (marker.Guerra_Precio === 'Si') {\r\n          // Guerra marker logic for secondary\r\n          const guerraIcon = L.icon({\r\n            iconUrl: `${process.env.PUBLIC_URL}/iconos/calavera.jpg`,\r\n            iconSize: [15, 15],\r\n            iconAnchor: [7.5, 7.5],\r\n            className: 'icono-guerra'\r\n          });\r\n          const guerraMarker = L.marker([marker.lat, marker.lng], { icon: guerraIcon, interactive: false });\r\n          map.addLayer(guerraMarker);\r\n          // No lo guardamos en ref global para no borrarlo accidentalmente con clearGuerraMarkers si solo queremos borrar los principales, \r\n          // aunque aquí borramos todo al cambiar de vista.\r\n          // Para simplificar, los agregamos a competenciaMarkersRef si queremos limpiarlos con eso, o los dejamos sueltos (pero hay que limpiarlos).\r\n          // Mejor los metemos en competenciaMarkersRef también (aunque sean markers distintos).\r\n          competenciaMarkersRef.current.push(guerraMarker);\r\n        }\r\n      }\r\n    });\r\n\r\n    // Polylines\r\n    const mainMarkersData = associatedData.filter(m => m.Marcador_Principal === 'Si');\r\n    mainMarkersData.forEach(mainMarker => {\r\n      const markerWithCoords = searchArray.find(m => m.id === mainMarker.id);\r\n      if (!markerWithCoords) return;\r\n      const mainLat = parseFloat(markerWithCoords.lat);\r\n      const mainLng = parseFloat(markerWithCoords.lng);\r\n      if (isNaN(mainLat) || isNaN(mainLng)) return;\r\n\r\n      const polyline = L.polyline(\r\n        [[parseFloat(lat), parseFloat(lng)], [mainLat, mainLng]],\r\n        { color: '#FF6B6B', weight: 3, opacity: 0.8, dashArray: '5, 5' }\r\n      ).addTo(map);\r\n      polylineRef.current.push(polyline);\r\n    });\r\n\r\n    setShowingAssociated(true);\r\n    setActiveMercadoPbl(pbl);\r\n\r\n  }, [baseCompData, markers, markersForMercado, map, showingAssociated, activeMercadoPbl, clearCompetenciaMarkers, clearPolylines, clearGuerraMarkers]); // createMarkerWithPopup is defined below, using ref to avoid circular dep or hoisting issues if possible, or just define it before.\r\n\r\n  // Helper para Guerra Marker\r\n  const addGuerraMarker = (marker) => {\r\n    if (marker.Guerra_Precio === 'Si') {\r\n      const guerraIcon = L.icon({\r\n        iconUrl: `${process.env.PUBLIC_URL}/iconos/calavera.jpg`,\r\n        iconSize: [15, 15],\r\n        iconAnchor: [7.5, 7.5],\r\n        className: 'icono-guerra'\r\n      });\r\n      const guerraMarker = L.marker([marker.lat, marker.lng], { icon: guerraIcon, interactive: false });\r\n      map.addLayer(guerraMarker);\r\n      guerraMarkersRef.current[marker.id] = guerraMarker;\r\n    }\r\n  };\r\n\r\n  // --- Crear Marcador con Popup React ---\r\n  const createMarkerWithPopup = useCallback((marker, allMarkers, variant = 'primary') => {\r\n    const lat = parseFloat(marker.lat);\r\n    const lng = parseFloat(marker.lng);\r\n    if (isNaN(lat) || isNaN(lng)) return null;\r\n\r\n    const iconUrl = createCustomIcon(marker.Marca);\r\n    const leafletMarker = L.marker([lat, lng], { icon: iconUrl });\r\n\r\n    // Popup vacío inicial\r\n    const popup = L.popup({\r\n      autoClose: false,\r\n      closeOnClick: false,\r\n      keepInView: true,\r\n      autoPan: false,\r\n      maxWidth: 450,\r\n      className: 'custom-popup'\r\n    }).setContent('<div id=\"popup-root-' + marker.id + '\"></div>');\r\n\r\n    leafletMarker.bindPopup(popup);\r\n\r\n    // Renderizar React en el Popup al abrir\r\n    leafletMarker.on('popupopen', (e) => {\r\n      const container = e.popup._contentNode; // o _container\r\n      // Buscar el div root que pusimos\r\n      // Nota: Leaflet a veces envuelve el contenido.\r\n      // Mejor estrategia: usar el contenido del popup como container.\r\n\r\n      // Esperamos un tick para asegurar que el DOM existe\r\n      setTimeout(() => {\r\n        const rootDiv = document.getElementById('popup-root-' + marker.id);\r\n        if (rootDiv && !rootDiv._reactRoot) {\r\n          const root = ReactDOM.createRoot(rootDiv);\r\n          rootDiv._reactRoot = root;\r\n          root.render(\r\n            <MapPopup\r\n              marker={marker}\r\n              allMarkers={allMarkers}\r\n              onShowAssociated={showAssociatedIds}\r\n              onActivateCoords={handleActivateCoords}\r\n              onSaveCoords={handleSaveCoords}\r\n              modoCorreccion={modoCorreccion}\r\n            />\r\n          );\r\n        }\r\n      }, 0);\r\n    });\r\n\r\n    leafletMarker.on('popupclose', (e) => {\r\n      const rootDiv = document.getElementById('popup-root-' + marker.id);\r\n      if (rootDiv && rootDiv._reactRoot) {\r\n        // Desmontar para evitar leaks\r\n        // rootDiv._reactRoot.unmount(); // A veces da problemas si se cierra muy rápido, pero es buena práctica.\r\n        // Dejamos que React maneje la limpieza si es posible, o unmount explícito.\r\n        setTimeout(() => {\r\n          if (rootDiv._reactRoot) {\r\n            rootDiv._reactRoot.unmount();\r\n            rootDiv._reactRoot = null;\r\n          }\r\n        }, 0);\r\n      }\r\n    });\r\n\r\n    return leafletMarker;\r\n  }, [showAssociatedIds, handleActivateCoords, handleSaveCoords, modoCorreccion]);\r\n\r\n\r\n  // --- Efecto Principal de Renderizado ---\r\n  useEffect(() => {\r\n    if (!map || !markers || markers.length === 0) return;\r\n\r\n    // Si estamos mostrando asociados, no refrescamos todo (a menos que cambien los filtros drásticamente, \r\n    // pero aquí asumimos que si 'markers' cambia, reseteamos vista).\r\n    // Para simplificar: si markers cambia, reseteamos todo.\r\n\r\n    clearCompetenciaMarkers();\r\n    clearPolylines();\r\n    setShowingAssociated(false);\r\n    setActiveMercadoPbl(null);\r\n\r\n    Object.values(markersRef.current).forEach(marker => {\r\n      try { if (map && map.hasLayer(marker)) map.removeLayer(marker); } catch (e) { }\r\n    });\r\n    markersRef.current = {};\r\n    clearGuerraMarkers();\r\n\r\n    markers.forEach(marker => {\r\n      const leafletMarker = createMarkerWithPopup(\r\n        marker,\r\n        markersForMercado || markers,\r\n        'primary'\r\n      );\r\n      if (leafletMarker) {\r\n        map.addLayer(leafletMarker);\r\n        markersRef.current[marker.id] = leafletMarker;\r\n        addGuerraMarker(marker);\r\n      }\r\n    });\r\n\r\n    if (markers.length === 1 && markersRef.current[markers[0].id]) {\r\n      markersRef.current[markers[0].id].openPopup();\r\n    }\r\n\r\n  }, [map, markers, markersForMercado, selectedRegion, clearCompetenciaMarkers, clearPolylines, clearGuerraMarkers, createMarkerWithPopup]);\r\n\r\n\r\n  // --- Efecto para Click en Mapa (Corrección Coordenadas) ---\r\n  useEffect(() => {\r\n    if (!map || !modoCorreccion) return;\r\n\r\n    const handleMapClick = (e) => {\r\n      const { lat, lng } = e.latlng;\r\n      setModoCorreccion(prev => ({ ...prev, lat, lng }));\r\n\r\n      // Actualizar UI del popup si está abierto?\r\n      // Como el popup se renderiza con 'modoCorreccion' como prop, \r\n      // necesitamos que se re-renderice.\r\n      // Al cambiar el estado 'modoCorreccion', el componente IconMarkersLayer se re-renderiza.\r\n      // Pero los popups ya abiertos son árboles de React independientes montados en nodos DOM.\r\n      // NO se actualizarán automáticamente con las nuevas props porque createMarkerWithPopup se recrea\r\n      // pero los popups ya montados no reciben las nuevas props a menos que los actualicemos explícitamente.\r\n\r\n      // SOLUCIÓN: Cerrar y abrir popup es brusco.\r\n      // Mejor: Usar un Context o un Store simple, o forzar update.\r\n      // Dado que 'createMarkerWithPopup' depende de 'modoCorreccion', \r\n      // cuando 'modoCorreccion' cambia, la función cambia.\r\n      // Pero los markers ya están en el mapa.\r\n\r\n      // Para esta refactorización rápida, podemos aceptar que el usuario cierre y abra, \r\n      // O intentar actualizar el popup activo.\r\n      // Lo más simple y robusto en React-Leaflet \"vanilla\" es difícil.\r\n      // Sin embargo, como MapPopup es hijo de IconMarkersLayer (indirectamente), \r\n      // NO lo es. Es un árbol nuevo.\r\n\r\n      // TRUCO: Disparar un evento custom que MapPopup escuche, o usar un ref mutable.\r\n      // O simplemente re-renderizar el contenido del popup activo.\r\n\r\n      // Vamos a iterar sobre los popups abiertos y re-renderizarlos.\r\n      map.eachLayer(layer => {\r\n        if (layer.getPopup && layer.getPopup() && layer.getPopup().isOpen()) {\r\n          const markerId = Object.keys(markersRef.current).find(key => markersRef.current[key] === layer);\r\n          if (markerId) {\r\n            const marker = markers.find(m => m.id === markerId) || (markersForMercado || []).find(m => m.id === markerId);\r\n            if (marker) {\r\n              const rootDiv = document.getElementById('popup-root-' + marker.id);\r\n              if (rootDiv && rootDiv._reactRoot) {\r\n                rootDiv._reactRoot.render(\r\n                  <MapPopup\r\n                    marker={marker}\r\n                    allMarkers={markersForMercado || markers}\r\n                    onShowAssociated={showAssociatedIds}\r\n                    onActivateCoords={handleActivateCoords}\r\n                    onSaveCoords={handleSaveCoords}\r\n                    modoCorreccion={{ ...modoCorreccion, lat, lng }} // Pasamos el nuevo valor\r\n                  />\r\n                );\r\n              }\r\n            }\r\n          }\r\n        }\r\n      });\r\n    };\r\n\r\n    map.on('click', handleMapClick);\r\n    return () => { map.off('click', handleMapClick); };\r\n  }, [map, modoCorreccion, markers, markersForMercado, showAssociatedIds, handleActivateCoords, handleSaveCoords]);\r\n\r\n\r\n  return null;\r\n};\r\n\r\nexport default IconMarkersLayer;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}