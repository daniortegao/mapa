{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\e08f\\\\Desktop\\\\Proyectos\\\\Resumen\\\\mapa-v2\\\\src\\\\components\\\\IconMarkersLayer.jsx\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useRef, useState, useCallback } from 'react';\nimport { useMap } from 'react-leaflet';\nimport L from 'leaflet';\nimport ReactDOM from 'react-dom/client';\nimport { createCustomIcon } from '../utils/iconHelpers';\nimport { guardarCoordenadaCorregida } from '../services/apiService';\nimport MapPopup from './MapPopup';\nimport '../styles/iconMarkersLayer.css';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst IconMarkersLayer = ({\n  markers,\n  markersForMercado = null,\n  selectedRegion,\n  baseCompData = []\n}) => {\n  _s();\n  const map = useMap();\n  const markersRef = useRef({});\n  const guerraMarkersRef = useRef({});\n  const competenciaMarkersRef = useRef([]);\n  const polylineRef = useRef([]);\n  const [showingAssociated, setShowingAssociated] = useState(false);\n  const [activeMercadoPbl, setActiveMercadoPbl] = useState(null);\n  const [modoCorreccion, setModoCorreccion] = useState(null);\n\n  // --- Helpers de UI (Draggable & Resize) ---\n  const makeDraggable = useCallback(popup => {\n    if (!map || !popup || !popup._container) return;\n    try {\n      const pos = map.latLngToLayerPoint(popup.getLatLng());\n      L.DomUtil.setPosition(popup._wrapper.parentNode, pos);\n      const draggable = new L.Draggable(popup._container, popup._wrapper);\n      draggable.enable();\n    } catch (error) {\n      console.error('Error draggable:', error);\n    }\n  }, [map]);\n  const crearGripEnWrapper = useCallback(popupContainer => {\n    const wrapper = popupContainer.querySelector('.leaflet-popup-content-wrapper');\n    const content = popupContainer.querySelector('.leaflet-popup-content');\n    if (!wrapper || !content) return;\n    content === null || content === void 0 ? void 0 : content.querySelectorAll('.popup-resize-grip').forEach(n => n.remove());\n    const handleWheel = e => {\n      e.preventDefault();\n      const scrollSpeed = 0.5;\n      const scrollAmount = e.deltaY * scrollSpeed;\n      content.scrollTop += scrollAmount;\n    };\n    content.addEventListener('wheel', handleWheel, {\n      passive: false\n    });\n    let grip = wrapper.querySelector('.popup-resize-grip');\n    if (!grip) {\n      grip = document.createElement('div');\n      grip.className = 'popup-resize-grip';\n      wrapper.appendChild(grip);\n      let isResizing = false;\n      const startResize = e => {\n        isResizing = true;\n        document.body.classList.add('is-resizing-popup');\n        document.body.style.cursor = 'nwse-resize';\n        document.body.style.userSelect = 'none';\n        e.preventDefault();\n        e.stopPropagation();\n      };\n      const doResize = e => {\n        if (!isResizing) return;\n        const clientX = e.clientX || e.touches && e.touches[0].clientX;\n        const clientY = e.clientY || e.touches && e.touches[0].clientY;\n        const gripRect = grip.getBoundingClientRect();\n        const gripCenterX = gripRect.left + gripRect.width / 2;\n        const gripCenterY = gripRect.top + gripRect.height / 2;\n        const deltaX = clientX - gripCenterX;\n        const deltaY = clientY - gripCenterY;\n        if (Math.abs(deltaX) > 5 || Math.abs(deltaY) > 5) {\n          const currentRect = content.getBoundingClientRect();\n          const newWidth = Math.max(240, currentRect.width + deltaX);\n          const newHeight = Math.max(180, currentRect.height + deltaY);\n          content.style.width = newWidth + 'px';\n          content.style.height = newHeight + 'px';\n        }\n        e.preventDefault();\n      };\n      const stopResize = () => {\n        if (!isResizing) return;\n        isResizing = false;\n        document.body.classList.remove('is-resizing-popup');\n        document.body.style.cursor = '';\n        document.body.style.userSelect = '';\n      };\n      grip.addEventListener('mousedown', startResize);\n      document.addEventListener('mousemove', doResize);\n      document.addEventListener('mouseup', stopResize);\n      grip.addEventListener('touchstart', startResize, {\n        passive: false\n      });\n      document.addEventListener('touchmove', doResize, {\n        passive: false\n      });\n      document.addEventListener('touchend', stopResize);\n      const cleanup = () => {\n        content.removeEventListener('wheel', handleWheel);\n        document.removeEventListener('mousemove', doResize);\n        document.removeEventListener('mouseup', stopResize);\n        document.removeEventListener('touchmove', doResize);\n        document.removeEventListener('touchend', stopResize);\n        document.body.classList.remove('is-resizing-popup');\n      };\n      grip._cleanup = cleanup;\n    }\n  }, []);\n\n  // --- Helpers de limpieza ---\n  const clearCompetenciaMarkers = useCallback(() => {\n    competenciaMarkersRef.current.forEach(marker => {\n      try {\n        if (map && map.hasLayer(marker)) map.removeLayer(marker);\n      } catch (e) {}\n    });\n    competenciaMarkersRef.current = [];\n  }, [map]);\n  const clearPolylines = useCallback(() => {\n    polylineRef.current.forEach(line => {\n      try {\n        if (map && map.hasLayer(line)) map.removeLayer(line);\n      } catch (e) {}\n    });\n    polylineRef.current = [];\n  }, [map]);\n  const clearGuerraMarkers = useCallback(() => {\n    Object.values(guerraMarkersRef.current).forEach(marker => {\n      try {\n        if (map && map.hasLayer(marker)) map.removeLayer(marker);\n      } catch (e) {}\n    });\n    guerraMarkersRef.current = {};\n  }, [map]);\n\n  // --- Handlers ---\n  const handleActivateCoords = useCallback(marker => {\n    if (modoCorreccion && (modoCorreccion.id === marker.id || modoCorreccion.pbl === marker.pbl)) {\n      // Si ya está activo para este marcador, lo desactivamos (cancelar)\n      setModoCorreccion(null);\n      if (map) map.getContainer().style.cursor = '';\n      return;\n    }\n    if (map) map.getContainer().style.cursor = 'crosshair';\n    setModoCorreccion({\n      pbl: marker.pbl,\n      id: marker.id,\n      eds: marker.eds,\n      marca: marker.Marca,\n      lat: null,\n      lng: null\n    });\n  }, [map, modoCorreccion]);\n  const handleSaveCoords = useCallback(async marker => {\n    if (!modoCorreccion || !modoCorreccion.lat || !modoCorreccion.lng) return;\n    try {\n      const coordenada = {\n        id: marker.id || marker.pbl,\n        pbl: marker.pbl || marker.id,\n        eds: marker.eds || '',\n        marca: marker.Marca || '',\n        comuna: marker.Comuna || '',\n        lat_corregida: modoCorreccion.lat,\n        lon_corregida: modoCorreccion.lng\n      };\n      await guardarCoordenadaCorregida(coordenada);\n\n      // Actualizar marcador localmente\n      marker.lat = modoCorreccion.lat;\n      marker.lng = modoCorreccion.lng;\n\n      // Resetear modo corrección\n      setModoCorreccion(null);\n      if (map) map.getContainer().style.cursor = '';\n\n      // Re-renderizar marcadores (esto forzará un update del efecto principal)\n      // Nota: En una app real, deberíamos actualizar el estado 'markers' en el padre\n      // pero aquí simulamos el refresco limpiando y dejando que el efecto corra.\n      // Para simplificar, forzamos un re-render limpiando refs (el efecto lo notará si markers cambia, \n      // pero como mutamos el objeto, necesitamos forzar update o confiar en que el padre refresque).\n      // Aquí asumimos que el padre refrescará o que el efecto de abajo se encargará si cambiamos algo.\n      // Como mutamos 'marker', React no detecta cambio de prop 'markers' si es el mismo array.\n\n      // ACTUALIZACIÓN OPTIMIZADA: No borrar todo. Solo mover el marcador.\n      const leafletMarker = markersRef.current[marker.id];\n      if (leafletMarker) {\n        const newLatLng = new L.LatLng(modoCorreccion.lat, modoCorreccion.lng);\n        leafletMarker.setLatLng(newLatLng);\n\n        // Si el popup está abierto, Leaflet lo mueve con el marcador automáticamente.\n        // Pero necesitamos actualizar el contenido del popup para que refleje que ya no estamos en modo corrección\n        // y muestre las nuevas coordenadas fijas.\n        // Esto se hace abajo con el re-render manual de popups.\n      }\n\n      // No borramos markersRef.current ni clearGuerraMarkers() para evitar parpadeo/cierre.\n      // Solo limpiamos si fuera necesario por lógica de negocio estricta, pero el usuario quiere que se mantenga.\n\n      // Disparamos un evento custom o callback si fuera necesario, \n      // por ahora confiamos en que el usuario recargue o que el efecto se dispare si cambiamos algo de estado.\n      // Un truco es setear un estado dummy para forzar re-render, pero mejor dejemos que el flujo siga.\n    } catch (error) {\n      console.error(\"Error guardando coordenadas:\", error);\n    }\n  }, [modoCorreccion, map, clearGuerraMarkers]);\n\n  // --- Refs para romper ciclo de dependencias ---\n  const showAssociatedIdsRef = useRef(null);\n  const handleActivateCoordsRef = useRef(handleActivateCoords);\n  const handleSaveCoordsRef = useRef(handleSaveCoords);\n  const modoCorreccionRef = useRef(modoCorreccion);\n  useEffect(() => {\n    handleActivateCoordsRef.current = handleActivateCoords;\n    handleSaveCoordsRef.current = handleSaveCoords;\n    modoCorreccionRef.current = modoCorreccion;\n  });\n\n  // --- Lógica de Mercado (Show Associated) ---\n  const showAssociatedIds = useCallback((pbl, lat, lng, originalMarkerId) => {\n    const searchArray = markersForMercado && markersForMercado.length > 0 ? markersForMercado : markers;\n    if (showingAssociated && activeMercadoPbl === pbl) {\n      // Toggle OFF\n      clearCompetenciaMarkers();\n      clearPolylines();\n      setShowingAssociated(false);\n      setActiveMercadoPbl(null);\n\n      // Restaurar marcadores originales\n      Object.values(markersRef.current).forEach(marker => {\n        try {\n          if (map && map.hasLayer(marker)) map.removeLayer(marker);\n        } catch (e) {}\n      });\n      markersRef.current = {};\n\n      // Re-crear todos\n      markers.forEach(marker => {\n        const leafletMarker = createMarkerWithPopup(marker, markersForMercado || markers, 'primary');\n        if (leafletMarker) {\n          map.addLayer(leafletMarker);\n          markersRef.current[marker.id] = leafletMarker;\n          addGuerraMarker(marker);\n        }\n      });\n      return;\n    }\n\n    // Toggle ON (o cambio de PBL)\n    clearCompetenciaMarkers();\n    clearPolylines();\n    const associatedData = baseCompData.filter(item => String(item.pbl).trim() === String(pbl).trim());\n    if (associatedData.length === 0) return;\n    const ids = associatedData.map(item => item.id);\n\n    // Limpiar actuales\n    Object.values(markersRef.current).forEach(marker => {\n      try {\n        if (map && map.hasLayer(marker)) map.removeLayer(marker);\n      } catch (e) {}\n    });\n    markersRef.current = {};\n    clearGuerraMarkers();\n\n    // Mostrar original\n    const originalMarker = markers.find(m => m.id === originalMarkerId);\n    if (originalMarker) {\n      const leafletMarker = createMarkerWithPopup(originalMarker, markersForMercado || markers, 'primary');\n      if (leafletMarker) {\n        map.addLayer(leafletMarker);\n        markersRef.current[originalMarker.id] = leafletMarker;\n        addGuerraMarker(originalMarker);\n      }\n    }\n\n    // Mostrar competencia\n    const associatedMarkers = searchArray.filter(item => ids.includes(item.id));\n    const uniqueAssociatedMarkers = [];\n    const seenIds = new Set();\n    associatedMarkers.forEach(marker => {\n      if (!seenIds.has(marker.id)) {\n        seenIds.add(marker.id);\n        uniqueAssociatedMarkers.push(marker);\n      }\n    });\n    uniqueAssociatedMarkers.forEach(marker => {\n      const leafletMarker = createMarkerWithPopup(marker, markersForMercado || baseCompData, 'secondary');\n      if (leafletMarker) {\n        map.addLayer(leafletMarker);\n        competenciaMarkersRef.current.push(leafletMarker);\n        if (marker.Guerra_Precio === 'Si') {\n          // Guerra marker logic for secondary\n          const guerraIcon = L.icon({\n            iconUrl: `${process.env.PUBLIC_URL}/iconos/calavera.jpg`,\n            iconSize: [15, 15],\n            iconAnchor: [7.5, 7.5],\n            className: 'icono-guerra'\n          });\n          const guerraMarker = L.marker([marker.lat, marker.lng], {\n            icon: guerraIcon,\n            interactive: false\n          });\n          map.addLayer(guerraMarker);\n          // No lo guardamos en ref global para no borrarlo accidentalmente con clearGuerraMarkers si solo queremos borrar los principales, \n          // aunque aquí borramos todo al cambiar de vista.\n          // Para simplificar, los agregamos a competenciaMarkersRef si queremos limpiarlos con eso, o los dejamos sueltos (pero hay que limpiarlos).\n          // Mejor los metemos en competenciaMarkersRef también (aunque sean markers distintos).\n          competenciaMarkersRef.current.push(guerraMarker);\n        }\n      }\n    });\n\n    // Polylines\n    const mainMarkersData = associatedData.filter(m => m.Marcador_Principal === 'Si');\n    mainMarkersData.forEach(mainMarker => {\n      const markerWithCoords = searchArray.find(m => m.id === mainMarker.id);\n      if (!markerWithCoords) return;\n      const mainLat = parseFloat(markerWithCoords.lat);\n      const mainLng = parseFloat(markerWithCoords.lng);\n      if (isNaN(mainLat) || isNaN(mainLng)) return;\n      const polyline = L.polyline([[parseFloat(lat), parseFloat(lng)], [mainLat, mainLng]], {\n        color: '#FF6B6B',\n        weight: 3,\n        opacity: 0.8,\n        dashArray: '5, 5'\n      }).addTo(map);\n      polylineRef.current.push(polyline);\n    });\n    setShowingAssociated(true);\n    setActiveMercadoPbl(pbl);\n  }, [baseCompData, markers, markersForMercado, map, showingAssociated, activeMercadoPbl, clearCompetenciaMarkers, clearPolylines, clearGuerraMarkers]);\n  useEffect(() => {\n    showAssociatedIdsRef.current = showAssociatedIds;\n  }, [showAssociatedIds]);\n\n  // Helper para Guerra Marker\n  const addGuerraMarker = marker => {\n    if (marker.Guerra_Precio === 'Si') {\n      const guerraIcon = L.icon({\n        iconUrl: `${process.env.PUBLIC_URL}/iconos/calavera.jpg`,\n        iconSize: [15, 15],\n        iconAnchor: [7.5, 7.5],\n        className: 'icono-guerra'\n      });\n      const guerraMarker = L.marker([marker.lat, marker.lng], {\n        icon: guerraIcon,\n        interactive: false\n      });\n      map.addLayer(guerraMarker);\n      guerraMarkersRef.current[marker.id] = guerraMarker;\n    }\n  };\n\n  // --- Crear Marcador con Popup React ---\n  const createMarkerWithPopup = useCallback((marker, allMarkers, variant = 'primary') => {\n    const lat = parseFloat(marker.lat);\n    const lng = parseFloat(marker.lng);\n    if (isNaN(lat) || isNaN(lng)) return null;\n    const iconUrl = createCustomIcon(marker.Marca);\n    const leafletMarker = L.marker([lat, lng], {\n      icon: iconUrl\n    });\n\n    // Popup vacío inicial\n    const popup = L.popup({\n      autoClose: false,\n      closeOnClick: false,\n      keepInView: true,\n      autoPan: false,\n      maxWidth: 450,\n      className: 'custom-popup'\n    }).setContent('<div id=\"popup-root-' + marker.id + '\"></div>');\n    leafletMarker.bindPopup(popup);\n    leafletMarker.on('popupopen', e => {\n      makeDraggable(popup);\n      const container = e.popup._contentNode;\n      const wrapperContainer = e.popup._container;\n      if (wrapperContainer) {\n        crearGripEnWrapper(wrapperContainer);\n      }\n      setTimeout(() => {\n        const rootDiv = document.getElementById('popup-root-' + marker.id);\n        if (rootDiv && !rootDiv._reactRoot) {\n          const root = ReactDOM.createRoot(rootDiv);\n          rootDiv._reactRoot = root;\n          root.render(/*#__PURE__*/_jsxDEV(MapPopup, {\n            marker: marker,\n            allMarkers: allMarkers,\n            onShowAssociated: (...args) => showAssociatedIdsRef.current && showAssociatedIdsRef.current(...args),\n            onActivateCoords: (...args) => handleActivateCoordsRef.current && handleActivateCoordsRef.current(...args),\n            onSaveCoords: (...args) => handleSaveCoordsRef.current && handleSaveCoordsRef.current(...args),\n            modoCorreccion: modoCorreccionRef.current,\n            variant: variant\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 397,\n            columnNumber: 13\n          }, this));\n        }\n      }, 0);\n    });\n    leafletMarker.on('popupclose', e => {\n      var _e$popup;\n      const container = (_e$popup = e.popup) === null || _e$popup === void 0 ? void 0 : _e$popup._container;\n      if (container) {\n        const wrapper = container.querySelector('.leaflet-popup-content-wrapper');\n        const grip = wrapper === null || wrapper === void 0 ? void 0 : wrapper.querySelector('.popup-resize-grip');\n        if (grip && grip._cleanup) {\n          grip._cleanup();\n        }\n      }\n      const rootDiv = document.getElementById('popup-root-' + marker.id);\n      if (rootDiv && rootDiv._reactRoot) {\n        setTimeout(() => {\n          if (rootDiv._reactRoot) {\n            rootDiv._reactRoot.unmount();\n            rootDiv._reactRoot = null;\n          }\n        }, 0);\n      }\n    });\n    return leafletMarker;\n  }, [makeDraggable, crearGripEnWrapper]);\n\n  // --- Efecto Principal de Renderizado ---\n  useEffect(() => {\n    if (!map || !markers || markers.length === 0) return;\n\n    // Si estamos mostrando asociados, no refrescamos todo (a menos que cambien los filtros drásticamente, \n    // pero aquí asumimos que si 'markers' cambia, reseteamos vista).\n    // Para simplificar: si markers cambia, reseteamos todo.\n\n    clearCompetenciaMarkers();\n    clearPolylines();\n    setShowingAssociated(false);\n    setActiveMercadoPbl(null);\n    Object.values(markersRef.current).forEach(marker => {\n      try {\n        if (map && map.hasLayer(marker)) map.removeLayer(marker);\n      } catch (e) {}\n    });\n    markersRef.current = {};\n    clearGuerraMarkers();\n    markers.forEach(marker => {\n      const leafletMarker = createMarkerWithPopup(marker, markersForMercado || markers, 'primary');\n      if (leafletMarker) {\n        map.addLayer(leafletMarker);\n        markersRef.current[marker.id] = leafletMarker;\n        addGuerraMarker(marker);\n      }\n    });\n    if (markers.length === 1 && markersRef.current[markers[0].id]) {\n      markersRef.current[markers[0].id].openPopup();\n    }\n  }, [map, markers, markersForMercado, selectedRegion, clearCompetenciaMarkers, clearPolylines, clearGuerraMarkers, createMarkerWithPopup]);\n\n  // --- Efecto para Click en Mapa (Corrección Coordenadas) ---\n  useEffect(() => {\n    if (!map || !modoCorreccion) return;\n    const handleMapClick = e => {\n      const {\n        lat,\n        lng\n      } = e.latlng;\n      setModoCorreccion(prev => ({\n        ...prev,\n        lat,\n        lng\n      }));\n    };\n    map.on('click', handleMapClick);\n    return () => {\n      map.off('click', handleMapClick);\n    };\n  }, [map, modoCorreccion]);\n\n  // --- Efecto para Actualizar Popups cuando cambia modoCorreccion ---\n  useEffect(() => {\n    if (!map) return;\n\n    // Iterar sobre los popups abiertos y re-renderizarlos con el nuevo estado\n    map.eachLayer(layer => {\n      if (layer.getPopup && layer.getPopup() && layer.getPopup().isOpen()) {\n        const markerId = Object.keys(markersRef.current).find(key => markersRef.current[key] === layer);\n        if (markerId) {\n          const marker = markers.find(m => m.id === markerId) || (markersForMercado || []).find(m => m.id === markerId);\n          if (marker) {\n            const rootDiv = document.getElementById('popup-root-' + marker.id);\n            if (rootDiv && rootDiv._reactRoot) {\n              rootDiv._reactRoot.render(/*#__PURE__*/_jsxDEV(MapPopup, {\n                marker: marker,\n                allMarkers: markersForMercado || markers,\n                onShowAssociated: (...args) => showAssociatedIdsRef.current && showAssociatedIdsRef.current(...args),\n                onActivateCoords: (...args) => handleActivateCoordsRef.current && handleActivateCoordsRef.current(...args),\n                onSaveCoords: (...args) => handleSaveCoordsRef.current && handleSaveCoordsRef.current(...args),\n                modoCorreccion: modoCorreccion // Usamos el valor actual del estado\n                ,\n                variant: markersForMercado && markersForMercado.includes(marker) ? 'secondary' : 'primary'\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 502,\n                columnNumber: 17\n              }, this));\n            }\n          }\n        }\n      }\n    });\n  }, [modoCorreccion, map, markers, markersForMercado]);\n\n  // Re-render open popups when markers data updates (auto-refresh)\n  useEffect(() => {\n    if (!map) return;\n    map.eachLayer(layer => {\n      if (layer instanceof L.Marker && layer.getPopup && layer.getPopup()) {\n        const popup = layer.getPopup();\n        if (popup.isOpen()) {\n          const markerData = layer.options.markerData;\n          if (markerData && markerData.pbl) {\n            // Find updated marker data\n            const updatedMarker = markers.find(m => m.pbl === markerData.pbl);\n            if (updatedMarker) {\n              var _popup$getElement;\n              const rootDiv = (_popup$getElement = popup.getElement()) === null || _popup$getElement === void 0 ? void 0 : _popup$getElement.querySelector('.popup-root');\n              if (rootDiv && rootDiv._reactRoot) {\n                // Re-render with updated data\n                rootDiv._reactRoot.render(/*#__PURE__*/_jsxDEV(MapPopup, {\n                  marker: updatedMarker,\n                  allMarkers: markersForMercado || markers,\n                  onShowAssociated: (...args) => showAssociatedIdsRef.current && showAssociatedIdsRef.current(...args),\n                  onActivateCoords: (...args) => handleActivateCoordsRef.current && handleActivateCoordsRef.current(...args),\n                  onSaveCoords: (...args) => handleSaveCoordsRef.current && handleSaveCoordsRef.current(...args),\n                  modoCorreccion: modoCorreccion,\n                  variant: markersForMercado && markersForMercado.includes(updatedMarker) ? 'secondary' : 'primary'\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 536,\n                  columnNumber: 19\n                }, this));\n              }\n            }\n          }\n        }\n      }\n    });\n  }, [markers, map, markersForMercado, modoCorreccion]);\n  return null;\n};\n_s(IconMarkersLayer, \"IGukVRBUzxXvW39rlogWElatWu4=\", false, function () {\n  return [useMap];\n});\n_c = IconMarkersLayer;\nexport default IconMarkersLayer;\nvar _c;\n$RefreshReg$(_c, \"IconMarkersLayer\");","map":{"version":3,"names":["React","useEffect","useRef","useState","useCallback","useMap","L","ReactDOM","createCustomIcon","guardarCoordenadaCorregida","MapPopup","jsxDEV","_jsxDEV","IconMarkersLayer","markers","markersForMercado","selectedRegion","baseCompData","_s","map","markersRef","guerraMarkersRef","competenciaMarkersRef","polylineRef","showingAssociated","setShowingAssociated","activeMercadoPbl","setActiveMercadoPbl","modoCorreccion","setModoCorreccion","makeDraggable","popup","_container","pos","latLngToLayerPoint","getLatLng","DomUtil","setPosition","_wrapper","parentNode","draggable","Draggable","enable","error","console","crearGripEnWrapper","popupContainer","wrapper","querySelector","content","querySelectorAll","forEach","n","remove","handleWheel","e","preventDefault","scrollSpeed","scrollAmount","deltaY","scrollTop","addEventListener","passive","grip","document","createElement","className","appendChild","isResizing","startResize","body","classList","add","style","cursor","userSelect","stopPropagation","doResize","clientX","touches","clientY","gripRect","getBoundingClientRect","gripCenterX","left","width","gripCenterY","top","height","deltaX","Math","abs","currentRect","newWidth","max","newHeight","stopResize","cleanup","removeEventListener","_cleanup","clearCompetenciaMarkers","current","marker","hasLayer","removeLayer","clearPolylines","line","clearGuerraMarkers","Object","values","handleActivateCoords","id","pbl","getContainer","eds","marca","Marca","lat","lng","handleSaveCoords","coordenada","comuna","Comuna","lat_corregida","lon_corregida","leafletMarker","newLatLng","LatLng","setLatLng","showAssociatedIdsRef","handleActivateCoordsRef","handleSaveCoordsRef","modoCorreccionRef","showAssociatedIds","originalMarkerId","searchArray","length","createMarkerWithPopup","addLayer","addGuerraMarker","associatedData","filter","item","String","trim","ids","originalMarker","find","m","associatedMarkers","includes","uniqueAssociatedMarkers","seenIds","Set","has","push","Guerra_Precio","guerraIcon","icon","iconUrl","process","env","PUBLIC_URL","iconSize","iconAnchor","guerraMarker","interactive","mainMarkersData","Marcador_Principal","mainMarker","markerWithCoords","mainLat","parseFloat","mainLng","isNaN","polyline","color","weight","opacity","dashArray","addTo","allMarkers","variant","autoClose","closeOnClick","keepInView","autoPan","maxWidth","setContent","bindPopup","on","container","_contentNode","wrapperContainer","setTimeout","rootDiv","getElementById","_reactRoot","root","createRoot","render","onShowAssociated","args","onActivateCoords","onSaveCoords","fileName","_jsxFileName","lineNumber","columnNumber","_e$popup","unmount","openPopup","handleMapClick","latlng","prev","off","eachLayer","layer","getPopup","isOpen","markerId","keys","key","Marker","markerData","options","updatedMarker","_popup$getElement","getElement","_c","$RefreshReg$"],"sources":["C:/Users/e08f/Desktop/Proyectos/Resumen/mapa-v2/src/components/IconMarkersLayer.jsx"],"sourcesContent":["import React, { useEffect, useRef, useState, useCallback } from 'react';\r\nimport { useMap } from 'react-leaflet';\r\nimport L from 'leaflet';\r\nimport ReactDOM from 'react-dom/client';\r\nimport { createCustomIcon } from '../utils/iconHelpers';\r\nimport { guardarCoordenadaCorregida } from '../services/apiService';\r\nimport MapPopup from './MapPopup';\r\nimport '../styles/iconMarkersLayer.css';\r\n\r\nconst IconMarkersLayer = ({ markers, markersForMercado = null, selectedRegion, baseCompData = [] }) => {\r\n  const map = useMap();\r\n  const markersRef = useRef({});\r\n  const guerraMarkersRef = useRef({});\r\n  const competenciaMarkersRef = useRef([]);\r\n  const polylineRef = useRef([]);\r\n\r\n  const [showingAssociated, setShowingAssociated] = useState(false);\r\n  const [activeMercadoPbl, setActiveMercadoPbl] = useState(null);\r\n  const [modoCorreccion, setModoCorreccion] = useState(null);\r\n\r\n  // --- Helpers de UI (Draggable & Resize) ---\r\n  const makeDraggable = useCallback((popup) => {\r\n    if (!map || !popup || !popup._container) return;\r\n    try {\r\n      const pos = map.latLngToLayerPoint(popup.getLatLng());\r\n      L.DomUtil.setPosition(popup._wrapper.parentNode, pos);\r\n      const draggable = new L.Draggable(popup._container, popup._wrapper);\r\n      draggable.enable();\r\n    } catch (error) {\r\n      console.error('Error draggable:', error);\r\n    }\r\n  }, [map]);\r\n\r\n  const crearGripEnWrapper = useCallback((popupContainer) => {\r\n    const wrapper = popupContainer.querySelector('.leaflet-popup-content-wrapper');\r\n    const content = popupContainer.querySelector('.leaflet-popup-content');\r\n    if (!wrapper || !content) return;\r\n\r\n    content?.querySelectorAll('.popup-resize-grip').forEach(n => n.remove());\r\n\r\n    const handleWheel = (e) => {\r\n      e.preventDefault();\r\n      const scrollSpeed = 0.5;\r\n      const scrollAmount = e.deltaY * scrollSpeed;\r\n      content.scrollTop += scrollAmount;\r\n    };\r\n\r\n    content.addEventListener('wheel', handleWheel, { passive: false });\r\n\r\n    let grip = wrapper.querySelector('.popup-resize-grip');\r\n    if (!grip) {\r\n      grip = document.createElement('div');\r\n      grip.className = 'popup-resize-grip';\r\n      wrapper.appendChild(grip);\r\n\r\n      let isResizing = false;\r\n\r\n      const startResize = (e) => {\r\n        isResizing = true;\r\n        document.body.classList.add('is-resizing-popup');\r\n        document.body.style.cursor = 'nwse-resize';\r\n        document.body.style.userSelect = 'none';\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n      };\r\n\r\n      const doResize = (e) => {\r\n        if (!isResizing) return;\r\n\r\n        const clientX = e.clientX || (e.touches && e.touches[0].clientX);\r\n        const clientY = e.clientY || (e.touches && e.touches[0].clientY);\r\n\r\n        const gripRect = grip.getBoundingClientRect();\r\n        const gripCenterX = gripRect.left + gripRect.width / 2;\r\n        const gripCenterY = gripRect.top + gripRect.height / 2;\r\n\r\n        const deltaX = clientX - gripCenterX;\r\n        const deltaY = clientY - gripCenterY;\r\n\r\n        if (Math.abs(deltaX) > 5 || Math.abs(deltaY) > 5) {\r\n          const currentRect = content.getBoundingClientRect();\r\n          const newWidth = Math.max(240, currentRect.width + deltaX);\r\n          const newHeight = Math.max(180, currentRect.height + deltaY);\r\n\r\n          content.style.width = newWidth + 'px';\r\n          content.style.height = newHeight + 'px';\r\n        }\r\n\r\n        e.preventDefault();\r\n      };\r\n\r\n      const stopResize = () => {\r\n        if (!isResizing) return;\r\n        isResizing = false;\r\n        document.body.classList.remove('is-resizing-popup');\r\n        document.body.style.cursor = '';\r\n        document.body.style.userSelect = '';\r\n      };\r\n\r\n      grip.addEventListener('mousedown', startResize);\r\n      document.addEventListener('mousemove', doResize);\r\n      document.addEventListener('mouseup', stopResize);\r\n\r\n      grip.addEventListener('touchstart', startResize, { passive: false });\r\n      document.addEventListener('touchmove', doResize, { passive: false });\r\n      document.addEventListener('touchend', stopResize);\r\n\r\n      const cleanup = () => {\r\n        content.removeEventListener('wheel', handleWheel);\r\n        document.removeEventListener('mousemove', doResize);\r\n        document.removeEventListener('mouseup', stopResize);\r\n        document.removeEventListener('touchmove', doResize);\r\n        document.removeEventListener('touchend', stopResize);\r\n        document.body.classList.remove('is-resizing-popup');\r\n      };\r\n\r\n      grip._cleanup = cleanup;\r\n    }\r\n  }, []);\r\n\r\n  // --- Helpers de limpieza ---\r\n  const clearCompetenciaMarkers = useCallback(() => {\r\n    competenciaMarkersRef.current.forEach(marker => {\r\n      try { if (map && map.hasLayer(marker)) map.removeLayer(marker); } catch (e) { }\r\n    });\r\n    competenciaMarkersRef.current = [];\r\n  }, [map]);\r\n\r\n  const clearPolylines = useCallback(() => {\r\n    polylineRef.current.forEach(line => {\r\n      try { if (map && map.hasLayer(line)) map.removeLayer(line); } catch (e) { }\r\n    });\r\n    polylineRef.current = [];\r\n  }, [map]);\r\n\r\n  const clearGuerraMarkers = useCallback(() => {\r\n    Object.values(guerraMarkersRef.current).forEach(marker => {\r\n      try { if (map && map.hasLayer(marker)) map.removeLayer(marker); } catch (e) { }\r\n    });\r\n    guerraMarkersRef.current = {};\r\n  }, [map]);\r\n\r\n  // --- Handlers ---\r\n  const handleActivateCoords = useCallback((marker) => {\r\n    if (modoCorreccion && (modoCorreccion.id === marker.id || modoCorreccion.pbl === marker.pbl)) {\r\n      // Si ya está activo para este marcador, lo desactivamos (cancelar)\r\n      setModoCorreccion(null);\r\n      if (map) map.getContainer().style.cursor = '';\r\n      return;\r\n    }\r\n\r\n    if (map) map.getContainer().style.cursor = 'crosshair';\r\n    setModoCorreccion({\r\n      pbl: marker.pbl,\r\n      id: marker.id,\r\n      eds: marker.eds,\r\n      marca: marker.Marca,\r\n      lat: null,\r\n      lng: null\r\n    });\r\n  }, [map, modoCorreccion]);\r\n\r\n  const handleSaveCoords = useCallback(async (marker) => {\r\n    if (!modoCorreccion || !modoCorreccion.lat || !modoCorreccion.lng) return;\r\n\r\n    try {\r\n      const coordenada = {\r\n        id: marker.id || marker.pbl,\r\n        pbl: marker.pbl || marker.id,\r\n        eds: marker.eds || '',\r\n        marca: marker.Marca || '',\r\n        comuna: marker.Comuna || '',\r\n        lat_corregida: modoCorreccion.lat,\r\n        lon_corregida: modoCorreccion.lng\r\n      };\r\n      await guardarCoordenadaCorregida(coordenada);\r\n\r\n      // Actualizar marcador localmente\r\n      marker.lat = modoCorreccion.lat;\r\n      marker.lng = modoCorreccion.lng;\r\n\r\n      // Resetear modo corrección\r\n      setModoCorreccion(null);\r\n      if (map) map.getContainer().style.cursor = '';\r\n\r\n      // Re-renderizar marcadores (esto forzará un update del efecto principal)\r\n      // Nota: En una app real, deberíamos actualizar el estado 'markers' en el padre\r\n      // pero aquí simulamos el refresco limpiando y dejando que el efecto corra.\r\n      // Para simplificar, forzamos un re-render limpiando refs (el efecto lo notará si markers cambia, \r\n      // pero como mutamos el objeto, necesitamos forzar update o confiar en que el padre refresque).\r\n      // Aquí asumimos que el padre refrescará o que el efecto de abajo se encargará si cambiamos algo.\r\n      // Como mutamos 'marker', React no detecta cambio de prop 'markers' si es el mismo array.\r\n\r\n      // ACTUALIZACIÓN OPTIMIZADA: No borrar todo. Solo mover el marcador.\r\n      const leafletMarker = markersRef.current[marker.id];\r\n      if (leafletMarker) {\r\n        const newLatLng = new L.LatLng(modoCorreccion.lat, modoCorreccion.lng);\r\n        leafletMarker.setLatLng(newLatLng);\r\n\r\n        // Si el popup está abierto, Leaflet lo mueve con el marcador automáticamente.\r\n        // Pero necesitamos actualizar el contenido del popup para que refleje que ya no estamos en modo corrección\r\n        // y muestre las nuevas coordenadas fijas.\r\n        // Esto se hace abajo con el re-render manual de popups.\r\n      }\r\n\r\n      // No borramos markersRef.current ni clearGuerraMarkers() para evitar parpadeo/cierre.\r\n      // Solo limpiamos si fuera necesario por lógica de negocio estricta, pero el usuario quiere que se mantenga.\r\n\r\n      // Disparamos un evento custom o callback si fuera necesario, \r\n      // por ahora confiamos en que el usuario recargue o que el efecto se dispare si cambiamos algo de estado.\r\n      // Un truco es setear un estado dummy para forzar re-render, pero mejor dejemos que el flujo siga.\r\n\r\n    } catch (error) {\r\n      console.error(\"Error guardando coordenadas:\", error);\r\n    }\r\n  }, [modoCorreccion, map, clearGuerraMarkers]);\r\n\r\n  // --- Refs para romper ciclo de dependencias ---\r\n  const showAssociatedIdsRef = useRef(null);\r\n  const handleActivateCoordsRef = useRef(handleActivateCoords);\r\n  const handleSaveCoordsRef = useRef(handleSaveCoords);\r\n  const modoCorreccionRef = useRef(modoCorreccion);\r\n\r\n  useEffect(() => {\r\n    handleActivateCoordsRef.current = handleActivateCoords;\r\n    handleSaveCoordsRef.current = handleSaveCoords;\r\n    modoCorreccionRef.current = modoCorreccion;\r\n  });\r\n\r\n\r\n  // --- Lógica de Mercado (Show Associated) ---\r\n  const showAssociatedIds = useCallback((pbl, lat, lng, originalMarkerId) => {\r\n    const searchArray = markersForMercado && markersForMercado.length > 0 ? markersForMercado : markers;\r\n\r\n    if (showingAssociated && activeMercadoPbl === pbl) {\r\n      // Toggle OFF\r\n      clearCompetenciaMarkers();\r\n      clearPolylines();\r\n      setShowingAssociated(false);\r\n      setActiveMercadoPbl(null);\r\n\r\n      // Restaurar marcadores originales\r\n      Object.values(markersRef.current).forEach(marker => {\r\n        try { if (map && map.hasLayer(marker)) map.removeLayer(marker); } catch (e) { }\r\n      });\r\n      markersRef.current = {};\r\n\r\n      // Re-crear todos\r\n      markers.forEach(marker => {\r\n        const leafletMarker = createMarkerWithPopup(marker, markersForMercado || markers, 'primary');\r\n        if (leafletMarker) {\r\n          map.addLayer(leafletMarker);\r\n          markersRef.current[marker.id] = leafletMarker;\r\n          addGuerraMarker(marker);\r\n        }\r\n      });\r\n      return;\r\n    }\r\n\r\n    // Toggle ON (o cambio de PBL)\r\n    clearCompetenciaMarkers();\r\n    clearPolylines();\r\n\r\n    const associatedData = baseCompData.filter(item => String(item.pbl).trim() === String(pbl).trim());\r\n    if (associatedData.length === 0) return;\r\n\r\n    const ids = associatedData.map(item => item.id);\r\n\r\n    // Limpiar actuales\r\n    Object.values(markersRef.current).forEach(marker => {\r\n      try { if (map && map.hasLayer(marker)) map.removeLayer(marker); } catch (e) { }\r\n    });\r\n    markersRef.current = {};\r\n    clearGuerraMarkers();\r\n\r\n    // Mostrar original\r\n    const originalMarker = markers.find(m => m.id === originalMarkerId);\r\n    if (originalMarker) {\r\n      const leafletMarker = createMarkerWithPopup(originalMarker, markersForMercado || markers, 'primary');\r\n      if (leafletMarker) {\r\n        map.addLayer(leafletMarker);\r\n        markersRef.current[originalMarker.id] = leafletMarker;\r\n        addGuerraMarker(originalMarker);\r\n      }\r\n    }\r\n\r\n    // Mostrar competencia\r\n    const associatedMarkers = searchArray.filter(item => ids.includes(item.id));\r\n    const uniqueAssociatedMarkers = [];\r\n    const seenIds = new Set();\r\n    associatedMarkers.forEach(marker => {\r\n      if (!seenIds.has(marker.id)) {\r\n        seenIds.add(marker.id);\r\n        uniqueAssociatedMarkers.push(marker);\r\n      }\r\n    });\r\n\r\n    uniqueAssociatedMarkers.forEach(marker => {\r\n      const leafletMarker = createMarkerWithPopup(marker, markersForMercado || baseCompData, 'secondary');\r\n      if (leafletMarker) {\r\n        map.addLayer(leafletMarker);\r\n        competenciaMarkersRef.current.push(leafletMarker);\r\n        if (marker.Guerra_Precio === 'Si') {\r\n          // Guerra marker logic for secondary\r\n          const guerraIcon = L.icon({\r\n            iconUrl: `${process.env.PUBLIC_URL}/iconos/calavera.jpg`,\r\n            iconSize: [15, 15],\r\n            iconAnchor: [7.5, 7.5],\r\n            className: 'icono-guerra'\r\n          });\r\n          const guerraMarker = L.marker([marker.lat, marker.lng], { icon: guerraIcon, interactive: false });\r\n          map.addLayer(guerraMarker);\r\n          // No lo guardamos en ref global para no borrarlo accidentalmente con clearGuerraMarkers si solo queremos borrar los principales, \r\n          // aunque aquí borramos todo al cambiar de vista.\r\n          // Para simplificar, los agregamos a competenciaMarkersRef si queremos limpiarlos con eso, o los dejamos sueltos (pero hay que limpiarlos).\r\n          // Mejor los metemos en competenciaMarkersRef también (aunque sean markers distintos).\r\n          competenciaMarkersRef.current.push(guerraMarker);\r\n        }\r\n      }\r\n    });\r\n\r\n    // Polylines\r\n    const mainMarkersData = associatedData.filter(m => m.Marcador_Principal === 'Si');\r\n    mainMarkersData.forEach(mainMarker => {\r\n      const markerWithCoords = searchArray.find(m => m.id === mainMarker.id);\r\n      if (!markerWithCoords) return;\r\n      const mainLat = parseFloat(markerWithCoords.lat);\r\n      const mainLng = parseFloat(markerWithCoords.lng);\r\n      if (isNaN(mainLat) || isNaN(mainLng)) return;\r\n\r\n      const polyline = L.polyline(\r\n        [[parseFloat(lat), parseFloat(lng)], [mainLat, mainLng]],\r\n        { color: '#FF6B6B', weight: 3, opacity: 0.8, dashArray: '5, 5' }\r\n      ).addTo(map);\r\n      polylineRef.current.push(polyline);\r\n    });\r\n\r\n    setShowingAssociated(true);\r\n    setActiveMercadoPbl(pbl);\r\n\r\n  }, [baseCompData, markers, markersForMercado, map, showingAssociated, activeMercadoPbl, clearCompetenciaMarkers, clearPolylines, clearGuerraMarkers]);\r\n\r\n  useEffect(() => {\r\n    showAssociatedIdsRef.current = showAssociatedIds;\r\n  }, [showAssociatedIds]);\r\n\r\n  // Helper para Guerra Marker\r\n  const addGuerraMarker = (marker) => {\r\n    if (marker.Guerra_Precio === 'Si') {\r\n      const guerraIcon = L.icon({\r\n        iconUrl: `${process.env.PUBLIC_URL}/iconos/calavera.jpg`,\r\n        iconSize: [15, 15],\r\n        iconAnchor: [7.5, 7.5],\r\n        className: 'icono-guerra'\r\n      });\r\n      const guerraMarker = L.marker([marker.lat, marker.lng], { icon: guerraIcon, interactive: false });\r\n      map.addLayer(guerraMarker);\r\n      guerraMarkersRef.current[marker.id] = guerraMarker;\r\n    }\r\n  };\r\n\r\n  // --- Crear Marcador con Popup React ---\r\n  const createMarkerWithPopup = useCallback((marker, allMarkers, variant = 'primary') => {\r\n    const lat = parseFloat(marker.lat);\r\n    const lng = parseFloat(marker.lng);\r\n    if (isNaN(lat) || isNaN(lng)) return null;\r\n\r\n    const iconUrl = createCustomIcon(marker.Marca);\r\n    const leafletMarker = L.marker([lat, lng], { icon: iconUrl });\r\n\r\n    // Popup vacío inicial\r\n    const popup = L.popup({\r\n      autoClose: false,\r\n      closeOnClick: false,\r\n      keepInView: true,\r\n      autoPan: false,\r\n      maxWidth: 450,\r\n      className: 'custom-popup'\r\n    }).setContent('<div id=\"popup-root-' + marker.id + '\"></div>');\r\n\r\n    leafletMarker.bindPopup(popup);\r\n\r\n    leafletMarker.on('popupopen', (e) => {\r\n      makeDraggable(popup);\r\n      const container = e.popup._contentNode;\r\n      const wrapperContainer = e.popup._container;\r\n      if (wrapperContainer) {\r\n        crearGripEnWrapper(wrapperContainer);\r\n      }\r\n\r\n      setTimeout(() => {\r\n        const rootDiv = document.getElementById('popup-root-' + marker.id);\r\n        if (rootDiv && !rootDiv._reactRoot) {\r\n          const root = ReactDOM.createRoot(rootDiv);\r\n          rootDiv._reactRoot = root;\r\n          root.render(\r\n            <MapPopup\r\n              marker={marker}\r\n              allMarkers={allMarkers}\r\n              onShowAssociated={(...args) => showAssociatedIdsRef.current && showAssociatedIdsRef.current(...args)}\r\n              onActivateCoords={(...args) => handleActivateCoordsRef.current && handleActivateCoordsRef.current(...args)}\r\n              onSaveCoords={(...args) => handleSaveCoordsRef.current && handleSaveCoordsRef.current(...args)}\r\n              modoCorreccion={modoCorreccionRef.current}\r\n              variant={variant}\r\n            />\r\n          );\r\n        }\r\n      }, 0);\r\n    });\r\n\r\n    leafletMarker.on('popupclose', (e) => {\r\n      const container = e.popup?._container;\r\n      if (container) {\r\n        const wrapper = container.querySelector('.leaflet-popup-content-wrapper');\r\n        const grip = wrapper?.querySelector('.popup-resize-grip');\r\n        if (grip && grip._cleanup) {\r\n          grip._cleanup();\r\n        }\r\n      }\r\n\r\n      const rootDiv = document.getElementById('popup-root-' + marker.id);\r\n      if (rootDiv && rootDiv._reactRoot) {\r\n        setTimeout(() => {\r\n          if (rootDiv._reactRoot) {\r\n            rootDiv._reactRoot.unmount();\r\n            rootDiv._reactRoot = null;\r\n          }\r\n        }, 0);\r\n      }\r\n    });\r\n\r\n    return leafletMarker;\r\n  }, [makeDraggable, crearGripEnWrapper]);\r\n\r\n\r\n  // --- Efecto Principal de Renderizado ---\r\n  useEffect(() => {\r\n    if (!map || !markers || markers.length === 0) return;\r\n\r\n    // Si estamos mostrando asociados, no refrescamos todo (a menos que cambien los filtros drásticamente, \r\n    // pero aquí asumimos que si 'markers' cambia, reseteamos vista).\r\n    // Para simplificar: si markers cambia, reseteamos todo.\r\n\r\n    clearCompetenciaMarkers();\r\n    clearPolylines();\r\n    setShowingAssociated(false);\r\n    setActiveMercadoPbl(null);\r\n\r\n    Object.values(markersRef.current).forEach(marker => {\r\n      try { if (map && map.hasLayer(marker)) map.removeLayer(marker); } catch (e) { }\r\n    });\r\n    markersRef.current = {};\r\n    clearGuerraMarkers();\r\n\r\n    markers.forEach(marker => {\r\n      const leafletMarker = createMarkerWithPopup(\r\n        marker,\r\n        markersForMercado || markers,\r\n        'primary'\r\n      );\r\n      if (leafletMarker) {\r\n        map.addLayer(leafletMarker);\r\n        markersRef.current[marker.id] = leafletMarker;\r\n        addGuerraMarker(marker);\r\n      }\r\n    });\r\n\r\n    if (markers.length === 1 && markersRef.current[markers[0].id]) {\r\n      markersRef.current[markers[0].id].openPopup();\r\n    }\r\n\r\n  }, [map, markers, markersForMercado, selectedRegion, clearCompetenciaMarkers, clearPolylines, clearGuerraMarkers, createMarkerWithPopup]);\r\n\r\n\r\n  // --- Efecto para Click en Mapa (Corrección Coordenadas) ---\r\n  useEffect(() => {\r\n    if (!map || !modoCorreccion) return;\r\n\r\n    const handleMapClick = (e) => {\r\n      const { lat, lng } = e.latlng;\r\n      setModoCorreccion(prev => ({ ...prev, lat, lng }));\r\n    };\r\n\r\n    map.on('click', handleMapClick);\r\n    return () => { map.off('click', handleMapClick); };\r\n  }, [map, modoCorreccion]);\r\n\r\n  // --- Efecto para Actualizar Popups cuando cambia modoCorreccion ---\r\n  useEffect(() => {\r\n    if (!map) return;\r\n\r\n    // Iterar sobre los popups abiertos y re-renderizarlos con el nuevo estado\r\n    map.eachLayer(layer => {\r\n      if (layer.getPopup && layer.getPopup() && layer.getPopup().isOpen()) {\r\n        const markerId = Object.keys(markersRef.current).find(key => markersRef.current[key] === layer);\r\n        if (markerId) {\r\n          const marker = markers.find(m => m.id === markerId) || (markersForMercado || []).find(m => m.id === markerId);\r\n          if (marker) {\r\n            const rootDiv = document.getElementById('popup-root-' + marker.id);\r\n            if (rootDiv && rootDiv._reactRoot) {\r\n              rootDiv._reactRoot.render(\r\n                <MapPopup\r\n                  marker={marker}\r\n                  allMarkers={markersForMercado || markers}\r\n                  onShowAssociated={(...args) => showAssociatedIdsRef.current && showAssociatedIdsRef.current(...args)}\r\n                  onActivateCoords={(...args) => handleActivateCoordsRef.current && handleActivateCoordsRef.current(...args)}\r\n                  onSaveCoords={(...args) => handleSaveCoordsRef.current && handleSaveCoordsRef.current(...args)}\r\n                  modoCorreccion={modoCorreccion} // Usamos el valor actual del estado\r\n                  variant={markersForMercado && markersForMercado.includes(marker) ? 'secondary' : 'primary'}\r\n                />\r\n              );\r\n            }\r\n          }\r\n        }\r\n      }\r\n    });\r\n  }, [modoCorreccion, map, markers, markersForMercado]);\r\n\r\n  // Re-render open popups when markers data updates (auto-refresh)\r\n  useEffect(() => {\r\n    if (!map) return;\r\n\r\n    map.eachLayer((layer) => {\r\n      if (layer instanceof L.Marker && layer.getPopup && layer.getPopup()) {\r\n        const popup = layer.getPopup();\r\n        if (popup.isOpen()) {\r\n          const markerData = layer.options.markerData;\r\n          if (markerData && markerData.pbl) {\r\n            // Find updated marker data\r\n            const updatedMarker = markers.find(m => m.pbl === markerData.pbl);\r\n            if (updatedMarker) {\r\n              const rootDiv = popup.getElement()?.querySelector('.popup-root');\r\n              if (rootDiv && rootDiv._reactRoot) {\r\n                // Re-render with updated data\r\n                rootDiv._reactRoot.render(\r\n                  <MapPopup\r\n                    marker={updatedMarker}\r\n                    allMarkers={markersForMercado || markers}\r\n                    onShowAssociated={(...args) => showAssociatedIdsRef.current && showAssociatedIdsRef.current(...args)}\r\n                    onActivateCoords={(...args) => handleActivateCoordsRef.current && handleActivateCoordsRef.current(...args)}\r\n                    onSaveCoords={(...args) => handleSaveCoordsRef.current && handleSaveCoordsRef.current(...args)}\r\n                    modoCorreccion={modoCorreccion}\r\n                    variant={markersForMercado && markersForMercado.includes(updatedMarker) ? 'secondary' : 'primary'}\r\n                  />\r\n                );\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    });\r\n  }, [markers, map, markersForMercado, modoCorreccion]);\r\n\r\n\r\n  return null;\r\n};\r\n\r\nexport default IconMarkersLayer;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}