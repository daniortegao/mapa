{"ast":null,"code":"// --- Utilidad para obtener la última fila por nivel ---\nexport function obtenerUltimaFilaPorNivel(nivel, data) {\n  const filas = data.filter(f => f.nivel && f.nivel.toString().toLowerCase() === nivel.toLowerCase()).sort((a, b) => new Date(b.fecha_aplicacion || b.Fecha) - new Date(a.fecha_aplicacion || a.Fecha));\n  return filas[0] || null;\n}\n\n/*\r\n * baseHistorico: tu arreglo de datos históricos filtrado (usas markersForMercado || markers, por ejemplo)\r\n * marker: el marcador que se está usando para el popup actual\r\n */\nexport function obtenerDiferenciasNiveles(marker, baseHistorico) {\n  const filaNivel1 = obtenerUltimaFilaPorNivel('Nivel 1', baseHistorico.filter(m => m.id === marker.id));\n  const filaNivel2 = obtenerUltimaFilaPorNivel('Nivel 2', baseHistorico.filter(m => m.id === marker.id));\n  if (!filaNivel1 || !filaNivel2) return null;\n  return {\n    g93: filaNivel2.g93 - filaNivel1.g93,\n    g95: filaNivel2.g95 - filaNivel1.g95,\n    g97: filaNivel2.g97 - filaNivel1.g97,\n    diesel: filaNivel2.diesel - filaNivel1.diesel,\n    kero: filaNivel2.kero - filaNivel1.kero\n  };\n}\n\n// Normaliza histórico del marker con filtro de nivel\nexport function obtenerHistoricoMarker(markerId, dataArray, nivel = \"Nivel 1\") {\n  const datos = dataArray.filter(m => m.id === markerId && m.nivel && m.nivel.toLowerCase() === nivel.toLowerCase());\n  return datos.sort((a, b) => {\n    const fechaA = a.fecha_aplicacion ? new Date(a.fecha_aplicacion) : new Date(0);\n    const fechaB = b.fecha_aplicacion ? new Date(b.fecha_aplicacion) : new Date(0);\n    return fechaB - fechaA;\n  }).map(item => ({\n    fecha: item.fecha_aplicacion || item.Fecha || 'S/F',\n    g93: item.precio_g93 || item.G93 || '-',\n    g95: item.precio_g95 || item.G95 || '-',\n    g97: item.precio_g97 || item.G97 || '-',\n    diesel: item.precio_diesel || item.Diesel || '-',\n    kero: item.precio_kero || item.Kero || '-'\n  }));\n}","map":{"version":3,"names":["obtenerUltimaFilaPorNivel","nivel","data","filas","filter","f","toString","toLowerCase","sort","a","b","Date","fecha_aplicacion","Fecha","obtenerDiferenciasNiveles","marker","baseHistorico","filaNivel1","m","id","filaNivel2","g93","g95","g97","diesel","kero","obtenerHistoricoMarker","markerId","dataArray","datos","fechaA","fechaB","map","item","fecha","precio_g93","G93","precio_g95","G95","precio_g97","G97","precio_diesel","Diesel","precio_kero","Kero"],"sources":["C:/Users/e08f/Desktop/Proyectos/Resumen/mapa-v2/src/utils/markerUtils.js"],"sourcesContent":["\r\n// --- Utilidad para obtener la última fila por nivel ---\r\nexport function obtenerUltimaFilaPorNivel(nivel, data) {\r\n    const filas = data\r\n        .filter(f => f.nivel && f.nivel.toString().toLowerCase() === nivel.toLowerCase())\r\n        .sort((a, b) => new Date(b.fecha_aplicacion || b.Fecha) - new Date(a.fecha_aplicacion || a.Fecha));\r\n    return filas[0] || null;\r\n}\r\n\r\n/*\r\n * baseHistorico: tu arreglo de datos históricos filtrado (usas markersForMercado || markers, por ejemplo)\r\n * marker: el marcador que se está usando para el popup actual\r\n */\r\nexport function obtenerDiferenciasNiveles(marker, baseHistorico) {\r\n    const filaNivel1 = obtenerUltimaFilaPorNivel('Nivel 1', baseHistorico.filter(m => m.id === marker.id));\r\n    const filaNivel2 = obtenerUltimaFilaPorNivel('Nivel 2', baseHistorico.filter(m => m.id === marker.id));\r\n    if (!filaNivel1 || !filaNivel2) return null;\r\n    return {\r\n        g93: filaNivel2.g93 - filaNivel1.g93,\r\n        g95: filaNivel2.g95 - filaNivel1.g95,\r\n        g97: filaNivel2.g97 - filaNivel1.g97,\r\n        diesel: filaNivel2.diesel - filaNivel1.diesel,\r\n        kero: filaNivel2.kero - filaNivel1.kero\r\n    };\r\n}\r\n\r\n// Normaliza histórico del marker con filtro de nivel\r\nexport function obtenerHistoricoMarker(markerId, dataArray, nivel = \"Nivel 1\") {\r\n    const datos = dataArray.filter(m =>\r\n        m.id === markerId &&\r\n        m.nivel &&\r\n        m.nivel.toLowerCase() === nivel.toLowerCase()\r\n    );\r\n\r\n    return datos\r\n        .sort((a, b) => {\r\n            const fechaA = a.fecha_aplicacion ? new Date(a.fecha_aplicacion) : new Date(0);\r\n            const fechaB = b.fecha_aplicacion ? new Date(b.fecha_aplicacion) : new Date(0);\r\n            return fechaB - fechaA;\r\n        })\r\n        .map(item => ({\r\n            fecha: item.fecha_aplicacion || item.Fecha || 'S/F',\r\n            g93: item.precio_g93 || item.G93 || '-',\r\n            g95: item.precio_g95 || item.G95 || '-',\r\n            g97: item.precio_g97 || item.G97 || '-',\r\n            diesel: item.precio_diesel || item.Diesel || '-',\r\n            kero: item.precio_kero || item.Kero || '-'\r\n        }));\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}